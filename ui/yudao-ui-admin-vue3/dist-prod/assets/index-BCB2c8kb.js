import{d as we,u as ke,e as o,an as Me,aX as C,f as De,aj as _e,g as Ye,h as Ae,o as g,n as k,w as i,l as y,k as d,a as r,m as Te,s as B,aY as W,t as K,c as I,F as z,p as Q,q as X,j as s,aZ as j,P as Ce,O as Ie,_ as ze,A as Ne,Q as Re,D as Fe,G as Se,R as Ee,J as We,K as je}from"./index-mcOGIq4g.js";import{_ as Pe}from"./CommonMenu-CxUjeIT-.js";import{_ as Ue}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Le}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ve}from"./download--D_IyRio.js";import{E as P}from"./index-U3-JpcYo.js";import{f as N,g as Z,c as R,e as $}from"./formatTime-f-_athMZ.js";import{I as qe}from"./index-Bla3Qadp.js";import"./index-KYPw-eK3.js";import{u as Ge}from"./useMessage-CGTQbR_M.js";import{i as He}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as Je}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const v=M=>(We("data-v-27ec6e40"),M=M(),je(),M),Oe=v(()=>s("br",null,null,-1)),Be=v(()=>s("br",null,null,-1)),Ke=v(()=>s("div",{class:"nav_data"},[s("div",{class:"descriptions-container",style:{"font-size":"14px"}},[s("div",{class:"description-item"},[s("span",{class:"label"},"\u6309\u65F6\u95F4\u8303\u56F4\u67E5\u8BE2\u5B9E\u65F6\u80FD\u8017")])])],-1)),Qe=v(()=>s("tr",null,[s("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[s("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),Xe={class:"realTotal"},Ze=v(()=>s("br",null,null,-1)),$e=v(()=>s("br",null,null,-1)),ea=v(()=>s("br",null,null,-1)),aa=v(()=>s("br",null,null,-1)),ta=Je(we({name:"PowerAnalysis",__name:"index",setup(M){const ee=Ge(),{push:ae}=ke(),U=o([]),te=o(0),le=o(0),ne=o(0),L=Me(),D=o(!1),c=o([]),b=o(0),V=o(0),w=new Date,u=o([C(new Date(w.getFullYear(),w.getMonth(),1)).format("YYYY-MM-DD"),C(new Date(w.getFullYear(),w.getMonth(),w.getDate())).format("YYYY-MM-DD")]),n=De({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,aisleIds:[]}),re=o([15,30,50,100]),ie=o(),F=o(!1),oe=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],se=a=>{const e=(a-1)*n.pageSize+1,t=a*n.pageSize,f=[];for(let x=e;x<=t;x++)f.push("\u5E8F\u53F7"+x);return f},S=o(null);let m=null;const q=o([]);window.addEventListener("resize",function(){m==null||m.resize()}),_e(()=>n.granularity,()=>{_()});const ue=o([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"180px"},{label:"\u5F00\u59CB\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"eleActiveStart",istrue:!0,formatter:h},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"createTimeMin",formatter:J,width:"150px",istrue:!0}]},{label:"\u7ED3\u675F\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"eleActiveEnd",istrue:!0,formatter:h},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"createTimeMax",formatter:J,width:"150px",istrue:!0}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eleActive",istrue:!0,formatter:h},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),G=async()=>{D.value=!0;try{if(u.value==null)return void j.error("\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4");if(u.value!=null){const e=N(Z(R(u.value[0]))),t=N($(R(u.value[1])));n.timeRange=[e,t]}u.value==null&&(n.timeRange=void 0);const a=await P.getAisleEleTotalRealtime(n);q.value=a.list.map(e=>ce(e.eleActive,1)),c.value=a.list,V.value=a.total,a.total>1e4?b.value=1e4:b.value=a.total}finally{S.value&&L&&(m=He(S.value),m.setOption({title:{text:"\u5404\u67DC\u5217\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:pe},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:se(n.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:q.value,label:{show:!0,position:"top"},barWidth:50}]}),m.on("click",function(a){E(c.value[a.dataIndex].roomId,c.value[a.dataIndex].createTimeMin,c.value[a.dataIndex].createTimeMax)}),L.appContext.config.globalProperties.rankChart=m),D.value=!1}};function pe(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+c.value[t.dataIndex].location+"<br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+H(null,null,c.value[t.dataIndex].createTimeMin)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+h(null,null,c.value[t.dataIndex].eleActiveStart)+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+H(null,null,c.value[t.dataIndex].createTimeMax)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+h(null,null,c.value[t.dataIndex].eleActiveEnd)+"kWh <br/>"+t.marker+"\u8017\u7535\u91CF\uFF1A"+h(null,null,c.value[t.dataIndex].eleActive)+"kWh"}const de=Ye(()=>{const a=Math.ceil(b.value/n.pageSize);return n.pageNo===a&&b.value>=1e4});function H(a,e,t){return t?C(t).format("YYYY-MM-DD"):""}function J(a,e,t){return t?C(t).format("YYYY-MM-DD"):""}function h(a,e,t){return t==null?"":Number(t).toFixed(1)}const ce=(a,e)=>isNaN(a)?null:Number(a).toFixed(e),me=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},_=()=>{n.pageNo=1,G()},ge=async a=>{let e=[];a.forEach(t=>{t.type==2&&e.push(t.id)}),e.length==0&&a.length!=0&&(e.push(0),m==null||m.clear(),j({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),n.aisleIds=e,_()},ve=async()=>{try{if(u.value==null)return void j.error("\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4");await ee.exportConfirm(),n.pageNo=1,F.value=!0;const a={timeout:0},e=N(Z(R(u.value[0]))),t=N($(R(u.value[1])));n.timeRange=[e,t];const f=await P.getAisleEleTotalRealtimeExcel(n,a);await Ve.excel(f,"\u67DC\u5217\u5B9E\u65F6\u80FD\u8017.xlsx")}catch{}finally{F.value=!1}},E=(a,e,t)=>{ae("/aisle/aisleenergyconsumption/powerAnalysis?start="+e+"&end="+t+"&id="+a+"&startTime="+u.value[0]+"&endTime="+u.value[1])};return Ae(()=>{(async()=>{const a=await qe.getAisleMenu();U.value=a})(),(async()=>{const a=await P.getNavNewData({});te.value=a.day,le.value=a.week,ne.value=a.month})()}),_(),(a,e)=>{const t=Ce,f=Ie,x=ze,Y=Ne,fe=Re,A=Fe,he=Se,xe=Le,ye=Ue,be=Pe,O=Ee;return g(),k(be,{dataList:r(U),onCheck:ge,navTitle:"\u67DC\u5217\u5B9E\u65F6\u80FD\u8017"},{NavInfo:i(()=>[Oe,y(),Be,Ke]),ActionBar:i(()=>[d(fe,{class:"-mb-15px",model:r(n),ref_key:"queryFormRef",ref:ie,inline:!0,"label-width":"auto"},{default:i(()=>[d(f,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[d(t,{"value-format":"YYYY-MM-DD",modelValue:r(u),"onUpdate:modelValue":e[0]||(e[0]=l=>Te(u)?u.value=l:null),type:"daterange",shortcuts:oe,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":me},null,8,["modelValue"])]),_:1}),d(f,null,{default:i(()=>[d(Y,{onClick:_},{default:i(()=>[d(x,{icon:"ep:search",class:"mr-5px"}),y(" \u641C\u7D22")]),_:1})]),_:1}),d(Y,{style:{position:"absolute",right:"20px"},type:"success",plain:"",loading:r(F),onClick:ve},{default:i(()=>[d(x,{icon:"ep:download",class:"mr-5px"}),y(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1},8,["model"])]),Content:i(()=>[B((g(),k(he,{data:r(c),stripe:!0,"show-overflow-tooltip":!0},W({default:i(()=>[d(A,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:l})=>[y(K(l+1+(r(n).pageNo-1)*r(n).pageSize),1)]),_:1}),(g(!0),I(z,null,Q(r(ue),l=>(g(),I(z,{key:l.label},[!l.children&&l.istrue?(g(),k(A,{key:l.prop,label:l.label,align:l.align,prop:l.prop,formatter:l.formatter,width:l.width},W({_:2},[l.slot==="actions"?{name:"default",fn:i(({row:p})=>[d(Y,{link:"",type:"primary",onClick:T=>E(p.id,p.createTimeMin,p.createTimeMax)},{default:i(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):l.istrue?(g(),k(A,{key:1,label:l.label,align:l.align},{default:i(()=>[(g(!0),I(z,null,Q(l.children,p=>(g(),I(z,{key:p.prop},[p.istrue?(g(),k(A,{key:p.prop,label:p.label,align:p.align,prop:p.prop,formatter:p.formatter,width:p.width},W({_:2},[p.slot==="actions"?{name:"default",fn:i(({row:T})=>[d(Y,{link:"",type:"primary",onClick:la=>E(T.id,T.createTimeMin,T.createTimeMax)},{default:i(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):X("",!0)],64))),128))]),_:2},1032,["label","align"])):X("",!0)],64))),128))]),_:2},[r(de)?{name:"append",fn:i(()=>[Qe]),key:"0"}:void 0]),1032,["data"])),[[O,r(D)]]),d(xe,{total:r(b),"page-size-arr":r(re),layout:"sizes, prev, pager, next, jumper",page:r(n).pageNo,"onUpdate:page":e[1]||(e[1]=l=>r(n).pageNo=l),limit:r(n).pageSize,"onUpdate:limit":e[2]||(e[2]=l=>r(n).pageSize=l),onPagination:G},null,8,["total","page-size-arr","page","limit"]),s("div",Xe,"\u5171 "+K(r(V))+" \u6761",1),Ze,$e,ea,aa,d(ye,null,{default:i(()=>[B(s("div",{ref_key:"rankChartContainer",ref:S,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[O,r(D)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-27ec6e40"]]);export{ta as default};
