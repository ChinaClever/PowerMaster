import{d as _,af as l,g as O,o as d,n as f,w as y,aT as B,a as C,aO as F,A as X,q as I,l as v,t as U,_ as A,r as w,e as b,T as D,h as G,aj as L,k as u,j as x,c as q,F as N,D as P,G as V}from"./index-mcOGIq4g.js";import{_ as $}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{S as R}from"./constants-D0aoFN3l.js";import{g as z}from"./profile-CKYUJvZd.js";import{u as E}from"./useMessage-CGTQbR_M.js";const H=$(_({name:"XTextButton",__name:"XTextButton",props:{modelValue:l.bool.def(!1),loading:l.bool.def(!1),preIcon:l.string.def(""),postIcon:l.string.def(""),title:l.string.def(""),type:l.oneOf(["","primary","success","warning","danger","info"]).def("primary"),circle:l.bool.def(!1),round:l.bool.def(!1),plain:l.bool.def(!1),onClick:{type:Function,default:null}},setup(n){const g=n,m=O(()=>{const c=["title","preIcon","postIcon","onClick"],a={...F(),...g};for(const i in a)c.indexOf(i)!==-1&&delete a[i];return a});return(c,a)=>{const i=A,k=X;return d(),f(k,B({link:""},C(m),{onClick:n.onClick}),{default:y(()=>[n.preIcon?(d(),f(i,{key:0,icon:n.preIcon,class:"mr-1px"},null,8,["icon"])):I("",!0),v(" "+U(n.title?n.title:"")+" ",1),n.postIcon?(d(),f(i,{key:1,icon:n.postIcon,class:"mr-1px"},null,8,["icon"])):I("",!0)]),_:1},16,["onClick"])}}}),[["__scopeId","data-v-7561ab3f"]]),J=["src"],K={class:"mr-5"},M=_({name:"UserSocial",__name:"UserSocial",props:{activeName:{}},emits:["update:activeName"],setup(n,{emit:g}){const m=E(),c=b([]),a=b(),i=D(),k=g,S=()=>{const s=(t="type",new URL(decodeURIComponent(location.href)).searchParams.get(t)??"");var t;const e=i.query.code,o=i.query.state;e&&((p,r,h)=>w.post({url:"/system/social-user/bind",data:{type:p,code:r,state:h}}))(s,e,o).then(()=>{m.success("\u7ED1\u5B9A\u6210\u529F"),k("update:activeName","userSocial")})},T=s=>{const t=location.origin+"/user/profile?"+encodeURIComponent(`type=${s.type}`);((e,o)=>w.get({url:"/system/auth/social-auth-redirect?type="+e+"&redirectUri="+o}))(s.type,encodeURIComponent(t)).then(e=>{window.location.href=e})},j=async s=>{var t,e;await(t=s.type,e=s.openid,w.delete({url:"/system/social-user/unbind",data:{type:t,openid:e}}))&&(s.openid=void 0),m.success("\u89E3\u7ED1\u6210\u529F")};return G(async()=>{await(async()=>{var t;c.value=[];const s=await z();a.value=s;for(const e in R){const o={...R[e]};if(c.value.push(o),(t=a.value)==null?void 0:t.socialUsers){for(const p in a.value.socialUsers)if(o.type===a.value.socialUsers[p].type){o.openid=a.value.socialUsers[p].openid;break}}}})()}),L(()=>i,()=>{S()},{immediate:!0}),(s,t)=>{const e=P,o=H,p=V;return d(),f(p,{data:C(c),"show-header":!1},{default:y(()=>[u(e,{fixed:"left",title:"\u5E8F\u53F7",type:"seq",width:"60"}),u(e,{align:"left",label:"\u793E\u4EA4\u5E73\u53F0",width:"120"},{default:y(({row:r})=>[x("img",{src:r.img,alt:"",class:"h-5 align-middle"},null,8,J),x("p",K,U(r.title),1)]),_:1}),u(e,{align:"center",label:"\u64CD\u4F5C"},{default:y(({row:r})=>[r.openid?(d(),q(N,{key:0},[v(" \u5DF2\u7ED1\u5B9A "),u(o,{class:"mr-5",title:"(\u89E3\u7ED1)",type:"primary",onClick:h=>j(r)},null,8,["onClick"])],64)):(d(),q(N,{key:1},[v(" \u672A\u7ED1\u5B9A "),u(o,{class:"mr-5",title:"(\u7ED1\u5B9A)",type:"primary",onClick:h=>T(r)},null,8,["onClick"])],64))]),_:1})]),_:1},8,["data"])}}});export{M as _};
