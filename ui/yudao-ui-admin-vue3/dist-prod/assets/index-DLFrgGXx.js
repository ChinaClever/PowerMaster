import{d as _e,e as n,f as he,aj as we,g as xe,aX as De,h as ke,o as g,n as D,w as s,l as y,j as o,t as k,a as l,k as p,m as O,s as Ue,aY as Q,c as N,F as X,p as Me,q as Z,aZ as Ce,c5 as Ne,O as Ye,S as Se,N as Ve,P as ze,_ as Fe,A as Ie,Q as Pe,D as qe,G as Re,R as Te,J as $e,K as Be}from"./index-mcOGIq4g.js";import{_ as We}from"./CommonMenu-CxUjeIT-.js";import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as je}from"./download--D_IyRio.js";import{E as Y}from"./index-83lIWP6s.js";import{H as Ee}from"./index-BJx6voQi.js";import{f as ee,e as ae,c as te,a as He}from"./formatTime-f-_athMZ.js";import{C as Le}from"./index-JEsRnusb.js";import{P as S}from"./PDU-QxJ-Axz0.js";import{u as Je}from"./useMessage-CGTQbR_M.js";import{_ as Ke}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const f=U=>($e("data-v-dca318bf"),U=U(),Be(),U),Ge=f(()=>o("br",null,null,-1)),Oe=f(()=>o("br",null,null,-1)),Qe={class:"nav_data"},Xe={class:"descriptions-container",style:{"font-size":"14px"}},Ze={class:"description-item"},ea=f(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),aa={class:"value"},ta={class:"description-item"},la=f(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),ra={class:"value"},ia={class:"description-item"},na=f(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),oa={class:"value"},sa=f(()=>o("div",null,[o("span",null,"\u5168\u90E8PDU\u65B0\u589E\u7535\u8D39\u7EDF\u8BA1"),o("div",{class:"line",style:{"margin-top":"10px"}})],-1)),pa={key:2},ua=f(()=>o("tr",null,[o("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[o("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),da={key:0,class:"realTotal"},ca=Ke(_e({name:"BillStatistics",__name:"index",setup(U){const R=n([]),T=n(0),$=n(0),B=n(0),V=n(!0),le=n(!1),W=n([]),A=n(""),j=n(""),re=Je(),z=n([]),_=n(0),E=n(0),v=n(void 0),t=he({pageNo:1,pageSize:15,outletId:void 0,type:"total",granularity:"day",timeRange:void 0,ipArray:[]}),ie=n([15,30,50,100]),ne=n(),F=n(!1);n([{imgUrl:S},{imgUrl:S},{imgUrl:S},{imgUrl:S}]);const oe=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],I=n(["total"]),H=n([]),se=a=>{t.type=a[0],a[0]==="outlet"?t.outletId=a[1]:t.outletId=void 0,M()};we(()=>[t.granularity,t.type],()=>{t.type==="outlet"?t.granularity=="day"?h.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address",istrue:!0,width:"300%"},{label:"\u8F93\u51FA\u4F4D",align:"center",prop:"outlet_id",istrue:!0},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!0},{label:"\u53D1\u751F\u65F6\u95F4",align:"center",prop:"start_time",formatter:b,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:w},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:x},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:h.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address",istrue:!0,width:"300%"},{label:"\u8F93\u51FA\u4F4D",align:"center",prop:"outlet_id",istrue:!0},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!0},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"start_time",formatter:b,istrue:!0},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"end_time",formatter:b,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:w},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:x}]:t.granularity=="day"?h.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address",istrue:!0,width:"300%"},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!0},{label:"\u53D1\u751F\u65F6\u95F4",align:"center",prop:"start_time",formatter:b,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:w},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:x},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:h.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address",istrue:!0,width:"300%"},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!0},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"start_time",formatter:b,istrue:!0},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"end_time",formatter:b,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:w},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:x}],M()});const h=n([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address",istrue:!0,width:"300%"},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!0},{label:"\u53D1\u751F\u65F6\u95F4",align:"center",prop:"start_time",formatter:b,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:w},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:x},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]),P=async()=>{V.value=!0;try{if(v.value!=null){const e=ee(ae(te(v.value[0]))),r=864e5,d=ee(ae(He(te(v.value[1]),r)));t.timeRange=[e,d]}const a=await Y.getBillDataPage(t);z.value=a.list,E.value=a.total,a.total>1e4?_.value=1e4:_.value=a.total}finally{V.value=!1}},pe=xe(()=>{const a=Math.ceil(_.value/t.pageSize);return t.pageNo===a&&_.value>=1e4});function b(a,e,r){return r?De(r).format("YYYY-MM-DD"):""}function w(a,e,r){return Number(r).toFixed(1)}function x(a,e,r){return Number(r).toFixed(2)}const ue=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},M=()=>{t.pageNo=1,P()},de=async a=>{let e=[];a.forEach(r=>{r.type==4&&e.push(r.unique)}),e.length==0&&a.length!=0&&(e.push(0),Ce({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),t.ipArray=e,M()},L=async(a,e,r,d,c)=>{W.value=[],A.value="",j.value="";let m={};m=t.type=="total"?{pduId:a,startTime:e,type:t.type}:{pduId:a,outletId:c,startTime:e,type:t.type};const q=await Y.getSubBillDetails(m);W.value=q.list,A.value=r,j.value=e+" - "+d,le.value=!0},ce=async()=>{try{await re.exportConfirm(),t.pageNo=1,F.value=!0;const a={timeout:0},e=await Y.exportBillPageData(t,a);await je.excel(e,"PDU\u7535\u8D39\u67E5\u8BE2.xlsx")}catch{}finally{F.value=!1}};ke(()=>{(async()=>{let r=[];var d=await Le.getRoomPDUList();r=r.concat(d),R.value=r})(),(async()=>{const r=await Y.getNavNewData({});T.value=r.day,$.value=r.week,B.value=r.month})(),(async()=>{const r=(await Ee.getTypeMaxValue()).outlet_id_max_value,d=[{value:"total",label:"\u603B"},{value:"outlet",label:"\u8F93\u51FA\u4F4D",children:(()=>{const c=[];c.push({value:void 0,label:"\u5168\u90E8"});for(let m=1;m<=r;m++)c.push({value:`${m}`,label:`${m}`});return c})()}];H.value=d})();const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);v.value=[J(e),J(a)],P()});const J=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return(a,e)=>{const r=Ne,d=Ye,c=Se,m=Ve,q=ze,K=Fe,C=Ie,me=Pe,G=qe,ge=Re,ve=Ae,be=We,fe=Te;return g(),D(be,{dataList:l(R),onCheck:de,navTitle:"PDU\u7535\u8D39\u67E5\u8BE2",placeholder:"\u5982:192.168.1.96-0"},{NavInfo:s(()=>[Ge,y(),Oe,o("div",Qe,[o("div",Xe,[o("div",Ze,[ea,o("span",aa,k(l(T))+"\u6761",1)]),o("div",ta,[la,o("span",ra,k(l($))+"\u6761",1)]),o("div",ia,[na,o("span",oa,k(l(B))+"\u6761",1)]),sa])])]),ActionBar:s(()=>[p(me,{class:"-mb-15px",model:l(t),ref_key:"queryFormRef",ref:ne,inline:!0,"label-width":"auto"},{default:s(()=>[p(d,{label:"\u53C2\u6570\u7C7B\u578B",prop:"type"},{default:s(()=>[p(r,{modelValue:l(I),"onUpdate:modelValue":e[0]||(e[0]=i=>O(I)?I.value=i:null),"collapse-tags":"",options:l(H),"collapse-tags-tooltip":"","show-all-levels":!0,onChange:se,class:"!w-140px"},null,8,["modelValue","options"])]),_:1}),p(d,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:s(()=>[p(m,{modelValue:l(t).granularity,"onUpdate:modelValue":e[1]||(e[1]=i=>l(t).granularity=i),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:s(()=>[p(c,{label:"\u5929",value:"day"}),p(c,{label:"\u5468",value:"week"}),p(c,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),p(d,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:s(()=>[p(q,{"value-format":"YYYY-MM-DD",modelValue:l(v),"onUpdate:modelValue":e[2]||(e[2]=i=>O(v)?v.value=i:null),type:"daterange",shortcuts:oe,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ue},null,8,["modelValue"])]),_:1}),p(d,null,{default:s(()=>[p(C,{onClick:M},{default:s(()=>[p(K,{icon:"ep:search",class:"mr-5px"}),y(" \u641C\u7D22")]),_:1}),p(C,{type:"success",plain:"",onClick:ce,loading:l(F)},{default:s(()=>[p(K,{icon:"ep:download",class:"mr-5px"}),y(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:s(()=>[Ue((g(),D(ge,{data:l(z),stripe:!0,"show-overflow-tooltip":!0,border:!0},Q({default:s(()=>[p(G,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:s(({$index:i})=>[y(k(i+1+(l(t).pageNo-1)*l(t).pageSize),1)]),_:1}),(g(!0),N(X,null,Me(l(h),i=>(g(),N(X,{key:i.label},[i.istrue&&!i.children?(g(),D(G,{key:i.prop,label:i.label,align:i.align,prop:i.prop,formatter:i.formatter,width:i.width},Q({_:2},[i.slot==="actions"&&l(t).granularity=="day"?{name:"default",fn:s(({row:u})=>[u.bill_mode_real&&u.bill_mode_real==2&&l(t).type=="total"?(g(),D(C,{key:0,link:"",type:"primary",onClick:ye=>L(u.pdu_id,u.start_time,u.location,u.end_time)},{default:s(()=>[y("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):u.bill_mode_real&&u.bill_mode_real==2&&l(t).type=="outlet"?(g(),D(C,{key:1,link:"",type:"primary",onClick:ye=>L(u.pdu_id,u.outlet_id,u.start_time,u.location,u.end_time)},{default:s(()=>[y("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):(g(),N("div",pa,"\u56FA\u5B9A\u8BA1\u8D39"))]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):Z("",!0)],64))),128))]),_:2},[l(pe)?{name:"append",fn:s(()=>[ua]),key:"0"}:void 0]),1032,["data"])),[[fe,l(V)]]),p(ve,{total:l(_),"page-size-arr":l(ie),layout:"sizes, prev, pager, next, jumper",page:l(t).pageNo,"onUpdate:page":e[3]||(e[3]=i=>l(t).pageNo=i),limit:l(t).pageSize,"onUpdate:limit":e[4]||(e[4]=i=>l(t).pageSize=i),onPagination:P},null,8,["total","page-size-arr","page","limit"]),l(z).length!=0?(g(),N("div",da,"\u5171 "+k(l(E))+" \u6761",1)):Z("",!0)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-dca318bf"]]);export{ca as default};
