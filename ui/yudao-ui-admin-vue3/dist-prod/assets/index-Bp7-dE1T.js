import{_ as st}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{d as it,e as h,aj as lt,h as nt,i as ot,o as u,c as p,k as D,w as E,j as f,l as N,t as y,a as d,n as R,q as I,ax as w,F as A,p as H,v as j,ao as S,b8 as ut,bX as dt,A as rt,J as ct,K as pt}from"./index-mcOGIq4g.js";import{n as mt}from"./jsplumb.browser-ui.es-D8lVyB7K.js";import{d as ft}from"./vuedraggable.umd-DnsY9z5D.js";import{C as z}from"./index-JEsRnusb.js";import{P}from"./index-CjSFrYfq.js";import{_ as vt}from"./bindingFrom.vue_vue_type_script_setup_true_lang-DtLZzEPl.js";import{u as ht}from"./useMessage-CGTQbR_M.js";import{_ as gt}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./el-card-FPJq94NZ.js";import"./Dialog.vue_vue_type_style_index_0_lang-BHwm1lq5.js";const M="/assets/plug-n-DQ-H41iz.svg",W=L=>(ct("data-v-2e1fabfe"),L=L(),pt(),L),yt={class:"cab-info"},It={class:"cab-btns"},_t={style:{display:"flex","justify-content":"center"}},kt={class:"portLeft"},Et=["id"],bt={class:"info"},xt=W(()=>f("img",{class:"plug",alt:"",src:M},null,-1)),At={class:"frameList"},Lt={class:"bottomFrame"},Bt={class:"topFrame"},Ct=["id"],Nt={class:"portRight"},Rt=["id"],Ht=W(()=>f("img",{class:"plug",alt:"",src:M},null,-1)),Dt={class:"info"},wt=it({__name:"index",setup(L){var U;const X=ht(),b=h(!1),$=h(),F=h(),_=h([]),k=h([]),r=h([]),B=h([]),g=h({}),q=((U=history==null?void 0:history.state)==null?void 0:U.cabinetId)||1,G={name:"FrameFill",pull:!0,put:!0},J={name:"FrameBlank",pull:!1,put:!0},m=h({left:"0px",top:"0px",show:!1,add:!1,curIndex:0,Uindex:0});let l=null;const Q=t=>{},Y=t=>{if(t.from==t.to)return!1;const a=+t.from.id.split("-")[1],s=+t.to.id.split("-")[1],i=a-s,n=r.value[s][0];n.uAddress=n.uAddress+i,l==null||l.deleteEveryConnection(),C()},C=()=>{const t={source:!0,target:!0,endpoint:{type:"Dot",options:{radius:2,fillStyle:"rgba(0, 0, 0, 0)"}}},a={strokeWidth:2,stroke:r.value.length>100?"rgba(0, 0, 0, 0)":"#000",dashstyle:"5 5",outlineWidth:13,outlineStroke:"rgba(0, 0, 0, 0)"};_.value.forEach(s=>{const i=document.getElementById(`portLeft${s.id}`);l==null||l.addEndpoint(i,{...t,anchor:"Right"})}),k.value.forEach(s=>{const i=document.getElementById(`portRight${s.id}`);l==null||l.addEndpoint(i,{...t,anchor:"Left"})}),r.value.forEach((s,i)=>{if(s[0]){const n=s[0],e=document.getElementById(`frame-${i}-child`),o=[];l==null||l.addEndpoint(e,{...t,anchor:"Left"}),l==null||l.addEndpoint(e,{...t,anchor:"Right"}),n.outletIdA&&n.outletIdA.length>0&&n.outletIdA.forEach(c=>{n.uHeight;const v=document.getElementById(`portLeft${c}`);let x=l==null?void 0:l.connect({source:e,target:v,endpoint:{type:"Dot",options:{radius:2,fillStyle:"rgba(0, 0, 0, 0)"}},anchors:["Left","Right"],paintStyle:a});o.push({connect:x,element:v,frameElement:e})}),n.outletIdB&&n.outletIdB.length>0&&n.outletIdB.forEach(c=>{const v=document.getElementById(`portRight${c}`);let x=l==null?void 0:l.connect({source:e,target:v,endpoint:{type:"Dot",options:{radius:2,fillStyle:"rgba(0, 0, 0, 0)"}},anchors:["Right","Left"],paintStyle:a});o.push({connect:x,element:v})}),e.onclick=null,e.onclick=c=>{o.forEach((v,x)=>{l==null||l.deleteConnection(v.connect),o[x].connect=l==null?void 0:l.connect({source:e,target:v.element,endpoint:{type:"Dot",options:{radius:2,fillStyle:"rgba(0, 0, 0, 0)"}},anchors:v.element.id.includes("Left")?["Left","Right"]:["Right","Left"],paintStyle:a})})}}})},K=(t,a)=>{let s=0,i=0,n="A";return a.includes("Left")?(s=a.split("portLeft")[1],i=t.split("-")[1]):t.includes("Left")?(s=t.split("portLeft")[1],i=a.split("-")[1]):a.includes("Right")?(s=a.split("portRight")[1],i=t.split("-")[1],n="B"):t.includes("Right")&&(s=t.split("portRight")[1],i=a.split("-")[1],n="B"),{portNum:s,frameNum:i,outletId:"outletId"+n}},Z=t=>{t.preventDefault();const a=t.currentTarget,s=t.target.id.split("-")[1],i=t.target.className;if(i.includes("active")||i=="frame"){const n=a.getBoundingClientRect(),e=t.clientX-Math.ceil(n.left)+1,o=t.clientY-Math.ceil(n.top)+1,c=at(s);m.value={left:e+"px",top:o+"px",show:!0,add:i=="frame",curIndex:s,Uindex:c}}},O=async()=>{const t=g.value;if(t.pduIpA){const a=await P.PDUDisplay({devKey:t.pduIpA});if(a.pdu_data&&a.pdu_data.output_item_list){const s=a.pdu_data.output_item_list.cur_value.reverse(),i=a.pdu_data.output_item_list.relay_state.reverse();_.value.forEach((n,e)=>{_.value[e].value=s[e],_.value[e].status=i[e]})}}if(t.pduIpB){const a=await P.PDUDisplay({devKey:t.pduIpB});if(a.pdu_data&&a.pdu_data.output_item_list){const s=a.pdu_data.output_item_list.cur_value.reverse(),i=a.pdu_data.output_item_list.relay_state.reverse();k.value.forEach((n,e)=>{k.value[e].value=s[e],k.value[e].status=i[e]})}}},V=async()=>{const t=r.value.filter(a=>a[0]).map(a=>a[0]);await z.saveRackBatch({cabinetId:g.value.id,roomId:g.value.roomId,racks:t})&&X.success("\u4FDD\u5B58\u6210\u529F")},tt=()=>{ut.confirm("\u786E\u8BA4\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E \u8BA4",cancelButtonText:"\u53D6 \u6D88"}).then(()=>{const t=m.value.curIndex;r.value[t].pop(),S(C)}).catch(()=>{})},T=t=>{const a=m.value.curIndex,s=r.value,i=s[a].length>0?s[a][0]:{};$.value.open(t,i,m.value.Uindex,g.value.outletA,g.value.outletB)},et=t=>{const a=m.value.curIndex,s=[...r.value],i=s[a][0];if(i){const n=i.id||-1,e=t.uHeight-i.uHeight;if(e==0)s.splice(a,1,[{id:n,...t}]);else if(e>0)s.splice(a-e,1+e,[{id:n,...t}]);else if(e<0){const o=[];for(let c=0;c<-e;c++)o.push([]);s.splice(a,1,[{id:n,...t}],...o)}}else s.splice(a-(t.uHeight-1),t.uHeight,[{undefined:void 0,...t}]);r.value=s,l==null||l.deleteEveryConnection(),S(C)},at=t=>{let a=0;return r.value.find((s,i)=>{const n=s[0];if(n&&n.uHeight>1?a+=n.uHeight:a++,i==t)return!0}),B.value.length-a+1};return lt(r,t=>{if(r.value.length<1)return;const a=[],s=[];t.forEach(i=>{i[0]&&(a.push(...i[0].outletIdA),s.push(...i[0].outletIdB))})}),nt(()=>{l=mt({container:F.value}),l.bind("beforeDrop",t=>{const a=K(t.sourceId,t.targetId);return r.value[a.frameNum][0][a.outletId].push(+a.portNum),t.sourceId.slice(0,5)!=t.targetId.slice(0,5)}),l.bind("beforeDetach",function(t){if(t.suspendedElement){let a=t.sourceId;t.suspendedElement.id.includes("frame")?a=t.sourceId.includes("port")?t.sourceId:t.targetId:t.suspendedElement.id.includes("port")&&(a=t.sourceId.includes("frame")?t.sourceId:t.targetId);const s=K(a,t.suspendedElement.id),i=r.value[s.frameNum][0];i[s.outletId]=i[s.outletId].filter(n=>n!=s.portNum)}return!0}),(async()=>{const t=await z.getCabinetInfoItem({id:q});g.value=t;const a=[],s=[],i=[];for(let e=1;e<=t.outletA;e++)a.push({id:e,value:null,status:null});for(let e=1;e<=t.outletB;e++)s.push({id:e,value:null,status:null});for(let e=1;e<=t.cabinetHeight;e++)i.push([]);B.value=[...i];let n=0;t.rackIndexList&&Array.isArray(t.rackIndexList)&&t.rackIndexList.length>0&&(t.rackIndexList.sort((e,o)=>e.uAddress-o.uAddress),t.rackIndexList.forEach(e=>{i.splice(e.uAddress-1-n,e.uHeight,[{id:e.id,rackName:e.rackName,rackType:e.rackType,company:e.company,uAddress:e.uAddress,uHeight:e.uHeight,outletIdA:e.outletIdA,outletIdB:e.outletIdB}]),n=n+e.uHeight-1})),r.value=i.reverse(),_.value=a.reverse(),k.value=s.reverse(),O(),S(C)})(),document.addEventListener("mouseup",t=>{const a=t.target;t.button==0&&m.value.show&&a.className!="menu_item"&&(m.value.show=!1),t.button==0&&a.className&&typeof a.className=="string"&&a.className.includes("active")&&(l==null||l.deleteEveryConnection())})}),ot(()=>{document.removeEventListener("mouseup",()=>{})}),(t,a)=>{const s=dt,i=rt,n=st;return u(),p(A,null,[D(n,null,{default:E(()=>[f("div",yt,[D(s,{class:"tag",size:"large"},{default:E(()=>[N(y(d(g).roomName)+"-"+y(d(g).cabinetName),1)]),_:1})]),f("div",It,[d(b)?(u(),R(i,{key:1,onClick:a[1]||(a[1]=e=>b.value=!1),plain:"",type:"primary"},{default:E(()=>[N("\u53D6\u6D88")]),_:1})):(u(),R(i,{key:0,onClick:a[0]||(a[0]=e=>b.value=!0),type:"primary"},{default:E(()=>[N("\u7F16\u8F91")]),_:1})),d(b)?(u(),R(i,{key:2,onClick:V,plain:"",type:"primary"},{default:E(()=>[N("\u4FDD\u5B58")]),_:1})):I("",!0)]),f("div",_t,[f("div",{ref_key:"frameContainer",ref:F,class:"frameContainer",style:{position:"relative","z-index":"1"},onContextmenu:w(Z,["right"])},[d(b)?I("",!0):(u(),p("div",{key:0,onClick:a[2]||(a[2]=w(()=>{},["prevent"])),class:"mask"})),f("div",kt,[(u(!0),p(A,null,H(d(_),e=>(u(),p("div",{class:"port",key:e,id:"portLeft"+e.id},[f("div",bt,y(e.id)+"\uFF1A"+y(e.value)+"A",1),xt],8,Et))),128))]),f("div",At,[f("div",Lt,[(u(!0),p(A,null,H(d(B).length,(e,o)=>(u(),p("div",{key:o,class:"frame"},y(d(B).length-o),1))),128))]),f("div",Bt,[(u(!0),p(A,null,H(d(r),(e,o)=>(u(),R(d(ft),{key:o,style:j(`height: ${e[0]?26*e[0].uHeight:26}px`),class:"frame",id:"frame-"+o,list:e,itemKey:c=>c.id,group:e[0]?G:J,tag:"div",animation:"100",onStart:Q,onEnd:w(Y,["prevent"])},{item:E(({element:c})=>[c?(u(),p("div",{key:0,class:"active",id:"frame-"+o+"-child"},y(c.rackName),9,Ct)):I("",!0)]),_:2},1032,["style","id","list","itemKey","group"]))),128))])]),f("div",Nt,[(u(!0),p(A,null,H(d(k),e=>(u(),p("div",{class:"port",key:e,id:"portRight"+e.id},[Ht,f("div",Dt,y(e.id)+"\uFF1A"+y(e.value)+"A",1)],8,Rt))),128))]),d(m).show?(u(),p("div",{key:1,class:"menu",style:j({left:`${d(m).left}`,top:`${d(m).top}`})},[d(m).add?(u(),p("div",{key:0,class:"menu_item",onClick:a[3]||(a[3]=e=>T("add"))},"\u65B0\u589E")):I("",!0),d(m).add?I("",!0):(u(),p("div",{key:1,class:"menu_item",onClick:a[4]||(a[4]=e=>T("edit"))},"\u7F16\u8F91")),d(m).add?I("",!0):(u(),p("div",{key:2,class:"menu_item",onClick:tt},"\u5220\u9664"))],4)):I("",!0)],544)])]),_:1}),D(vt,{ref_key:"binding",ref:$,onSuccess:et},null,512)],64)}}}),St=gt(wt,[["__scopeId","data-v-2e1fabfe"]]);export{St as default};
