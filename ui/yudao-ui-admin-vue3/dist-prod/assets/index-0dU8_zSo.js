import{d as bt,u as pt,e as k,f as ue,aj as Be,h as mt,b2 as vt,o as d,c,k as h,w as C,j as r,a as n,s as ee,I as te,F as $,p as T,n as O,v as H,l as B,t as D,q as y,aD as yt,ax as M,m as xt,ao as Z,aZ as ht,b8 as Ue,A as gt,_ as ft,aR as It,S as At,N as Bt,O as kt,Q as wt,P as Ct,D as Nt,G as _t,B as Dt,J as Et,K as Lt}from"./index-mcOGIq4g.js";import{_ as $t}from"./Echart.vue_vue_type_script_setup_true_lang-NDPlWfCz.js";import{_ as Ft}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{n as Vt}from"./jsplumb.browser-ui.es-D8lVyB7K.js";import{M as be}from"./index-CN_W-U9Z.js";import{C as G}from"./index-JEsRnusb.js";import{I as ke}from"./index-r17IU-lS.js";import{d as St}from"./download--D_IyRio.js";import Tt from"./PluginForm-BXlYSYtu.js";import{_ as Ot}from"./PFDetail.vue_vue_type_script_setup_true_lang-OaQosx8A.js";import zt from"./CabForm-D_0JFDUN.js";import pe from"./InitialBox-C1x11WLl.js";import We from"./PluginBox-9kB7EJyw.js";import Kt from"./BoxForm-Dzn_DHMc.js";import{u as jt}from"./useMessage-CGTQbR_M.js";import{_ as Ht}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./installCanvasRenderer-WHaFMoQ9.js";import"./el-card-FPJq94NZ.js";import"./Dialog.vue_vue_type_style_index_0_lang-BHwm1lq5.js";import"./el-collapse-item-B2FzqckI.js";import"./index-KYPw-eK3.js";import"./install-DiAPpr4Z.js";const I=S=>(Et("data-v-ac98ea23"),S=S(),Lt(),S),Mt={class:"btn-main",style:{"justify-content":"space-between"}},Ut={style:{display:"flex","flex-direction":"column",width:"500px"}},Wt={key:0,class:"btns"},Rt={key:1,class:"btns",style:{"margin-top":"10px"}},Pt={style:{display:"flex"}},qt={key:0,style:{"margin-left":"10px"}},Yt=I(()=>r("div",{style:{"margin-top":"-25px"}},null,-1)),Xt=I(()=>r("div",{style:{height:"20px"}},null,-1)),Zt=I(()=>r("div",{class:"maskPoint1"},null,-1)),Gt=I(()=>r("div",{class:"maskPoint2"},null,-1)),Jt={class:"main"},Qt=I(()=>r("div",{class:"bridge"},null,-1)),ea={class:"busList1"},ta=["id","onClick"],aa={class:"pointContainer"},oa=["id"],la=["id"],ia=I(()=>r("div",{class:"connector"},[r("span",{class:"text"},"\u8FDE\u63A5\u5668")],-1)),na={key:0,class:"Tbox"},sa=I(()=>r("div",{class:"bridge"},null,-1)),ra={class:"busList2"},da=["id","onClick"],ca={class:"pointContainer"},ua=["id"],ba=["id"],pa=I(()=>r("div",{class:"connector"},[r("span",{class:"text"},"\u8FDE\u63A5\u5668")],-1)),ma={key:0,class:"Tbox"},va={key:0,class:"cabinetList"},ya={class:"point"},xa=["id"],ha=["id"],ga={class:"cabinet"},fa=I(()=>r("br",null,null,-1)),Ia=I(()=>r("br",null,null,-1)),Aa=I(()=>r("br",null,null,-1)),Ba=I(()=>r("br",null,null,-1)),ka=I(()=>r("br",null,null,-1)),wa=I(()=>r("br",null,null,-1)),Ca=I(()=>r("br",null,null,-1)),Na=I(()=>r("br",null,null,-1)),_a=I(()=>r("br",null,null,-1)),Da=I(()=>r("br",null,null,-1)),Ea=I(()=>r("br",null,null,-1)),La=["onClick","onDblclick","id"],$a={key:0,class:"fill_box"},Fa=I(()=>r("div",{style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"center","font-size":"12px"}},[r("div",null,"\u8D1F\u8F7D\u7387")],-1)),Va={key:1,class:"fill_box"},Sa={style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"space-around","font-size":"12px"}},Ta=I(()=>r("div",null,"Ia",-1)),Oa={key:0},za={key:1},Ka={key:2,class:"fill_box"},ja={style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"space-around","font-size":"12px"}},Ha=I(()=>r("div",null,"Ua",-1)),Ma={key:0},Ua={key:1},Wa={key:3,class:"fill_box"},Ra=I(()=>r("div",{style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"center","font-size":"12px"}},[r("div",null,"\u529F\u7387\u56E0\u6570")],-1)),Pa={key:4,class:"fill_box"},qa=I(()=>r("div",{style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"center","font-size":"12px"}},[r("div",null,"\u529F\u7387")],-1)),Ya={key:5,class:"fill_box"},Xa=I(()=>r("div",{style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"space-around","font-size":"12px"}},[r("div",null,"A\u8DEF"),r("div",null,"B\u8DEF")],-1)),Za={key:6,class:"fill_box"},Ga=I(()=>r("div",{style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"space-around","font-size":"12px"}},[r("div",null,"\u524D\u95E8"),r("div",null,"\u540E\u95E8")],-1)),Ja={key:7,class:"fill_box"},Qa=I(()=>r("div",{style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"center","font-size":"12px"}},[r("div",null,"\u5BB9\u91CF")],-1)),eo={key:8,class:"fill_box"},to=I(()=>r("div",{style:{"background-color":"black",position:"absolute",bottom:"5px",color:"white",display:"flex",width:"90%","justify-content":"center","font-size":"12px"}},[r("div",null,"\u6628\u65E5\u7528\u80FD")],-1)),ao=["id"],oo=I(()=>r("div",{style:{width:"100%",display:"flex","justify-content":"center"}},[r("div",{class:"ti_xing"})],-1)),lo={class:"status"},io={class:"operateBox"},no={key:1,class:"Bus"},so=I(()=>r("span",{class:"line"},null,-1)),ro={class:"custom-row",style:{display:"flex","align-items":"center"}},co={class:"location-tag el-col"},uo=I(()=>r("span",{style:{"margin-right":"10px","font-size":"18px","font-weight":"bold"}},"\u529F\u7387\u56E0\u7D20\u8BE6\u60C5",-1)),bo={class:"date-picker-col el-col"},po={class:"chart-data-buttons el-col",style:{"margin-right":"50px"}},mo={class:"button-group"},vo=I(()=>r("i",{class:"el-icon-download"},null,-1)),yo=I(()=>r("br",null,null,-1)),xo={key:1,style:{width:"100%",height:"70vh","overflow-y":"auto"}},ho=Ht(bt({__name:"index",props:{containerInfo:{type:Object},isFromHome:{type:Boolean,default:!1}},emits:["backData","idChange","getpdubar","sendList"],setup(S,{emit:Re}){var je,He,Me;const J=jt(),{push:_}=pt();let o=null;const q=k([]),W=k([]),ae=k([]),oe=k(!1),Y=k(0),N=ue({cabinetColumnId:(je=history==null?void 0:history.state)==null?void 0:je.id,cabinetroomId:(He=history==null?void 0:history.state)==null?void 0:He.roomId,roomDownValId:(Me=history==null?void 0:history.state)==null?void 0:Me.roomValId}),me=ue([[{name:"\u8D1F\u8F7D\u91CF<30%",selected:!0,value:1,color:"#3bbb00"},{name:"30%\u2264\u8D1F\u8F7D\u91CF<60%",selected:!0,value:2,color:"#05ebfc"},{name:"60%\u2264\u8D1F\u8F7D\u91CF<90%",selected:!0,value:3,color:"#ffc402"},{name:"\u8D1F\u8F7D\u91CF>90%",selected:!0,value:4,color:"#fa3333"}],[{name:"Ia",selected:!0,value:1,color:"#E5B849"},{name:"Ib",selected:!0,value:2,color:"#C8603A"},{name:"Ic",selected:!0,value:3,color:"#AD3762"}],[{name:"Ua",selected:!0,value:1,color:"#075F71"},{name:"Ub",selected:!0,value:2,color:"#119CB5"},{name:"Uc",selected:!0,value:3,color:"#45C0C9"}],[{name:"\u529F\u7387\u56E0\u7D20<25%",selected:!0,value:1,color:"#FF6E76"},{name:"25%\u2264\u529F\u7387\u56E0\u7D20<50%",selected:!0,value:2,color:"#FDDD60"},{name:"50%\u2264\u529F\u7387\u56E0\u7D20<75%",selected:!0,value:3,color:"#58D9F9"},{name:"\u529F\u7387\u56E0\u7D20>75%",selected:!0,value:4,color:"#7CFFB2"}],[{name:"\u6709\u529F\u529F\u7387",selected:!0,value:1,color:"#91cc75"},{name:"\u65E0\u529F\u529F\u7387",selected:!0,value:2,color:"#800080"}],[],[],[{name:"\u89C6\u5728\u529F\u7387",selected:!0,value:1,color:"#5470c6"}],[],[{name:"\u5269\u4F59\u91CF>50%",selected:!0,value:1,color:"#3bbb00"},{name:"30%\u2264\u5269\u4F59\u91CF<50%",selected:!0,value:2,color:"#ffc402"},{name:"\u5269\u4F59\u91CF<30%",selected:!0,value:3,color:"#fa3333"}]]),R=[{value:0,name:"\u8D1F\u8F7D\u7387",unitName:"\u8D1F\u8F7D\u7387"},{value:1,name:"\u7535\u6D41",unitName:"\u7535\u6D41"},{value:2,name:"\u7535\u538B",unitName:"\u7535\u538B"},{value:3,name:"\u529F\u7387\u56E0\u7D20",unitName:"\u529F\u7387\u56E0\u7D20"},{value:4,name:"\u529F\u7387",unitName:"\u529F\u7387(kW)"},{value:7,name:"\u4F9B\u7535\u5E73\u8861",unitName:"\u89C6\u5728\u529F\u7387(KVA)"},{value:8,name:"\u6E29\u5EA6",unitName:"\u6E29\u5EA6(\xB0C)"},{value:9,name:"\u5BB9\u91CF",unitName:"\u63D2\u63A5\u7BB1"},{value:10,name:"\u7528\u80FD",unitName:"\u6628\u65E5\u7528\u80FD(kW\xB7h)"}],Pe=k({}),we=k(),v=k(0),X=k(1),qe=k(100),E=k(!1),U=k(),Ce=k(),Ne=k(),_e=k(),i=ue({}),x=k([]);k([]),k([]),k();const F=k({left:"0px",top:"0px",show:!1,add:!1,curIndex:0}),A=k({left:"0px",top:"0px",show:!1,curIndex:0,type:""}),{containerInfo:z,isFromHome:Ye}=S,ve=Re,ye=(a=!1)=>{x.value&&x.value.length&&i.barA&&Z(()=>(i.barA.boxList.forEach(e=>{if(!e.type)for(let s=1;s<=e.outletNum;s++){const t=document.getElementById("plugin-"+e.boxIndex+"_A-"+s);o==null||o.removeAllEndpoints(t),o==null||o.addEndpoint(t,{source:!0,target:!0,endpoint:"Dot"}),o==null||o.revalidate(t)}}),i.barB.boxList.forEach(e=>{if(!e.type)for(let s=1;s<=e.outletNum;s++){const t=document.getElementById("plugin-"+e.boxIndex+"_B-"+s);o==null||o.removeAllEndpoints(t),o==null||o.addEndpoint(t,{source:!0,target:!0,endpoint:"Dot"}),o==null||o.revalidate(t)}}),x.value.forEach((e,s)=>{!e.cabinetName&&i.pduBar||le(s,e,a)}),Promise.resolve()))},De=()=>{x.value.forEach((a,e)=>{!a.cabinetName&&i.pduBar||le(e,a)})},Ee=(a,e)=>{o==null||o.deleteEveryConnection(),x.value.forEach((s,t)=>{if(!s.cabinetName&&i.pduBar)return;const u=document.getElementById("cab-A-"+t),b=document.getElementById("cab-B-"+t);if(o==null||o.removeAllEndpoints(u),o==null||o.removeAllEndpoints(b),o==null||o.addEndpoint(u,{source:!0,target:!0,endpoint:"Dot"}),o==null||o.addEndpoint(b,{source:!0,target:!0,endpoint:"Dot"}),s[`boxIndex${a}`]!==""&&s[`boxIndex${a}`]==e){const p=document.getElementById("cab-"+a+"-"+t),V=document.getElementById(`plugin-${s[`boxIndex${a}`]}_${a}-${s[`boxOutletId${a}`]}`);o==null||o.connect({source:p,target:V,paintStyle:{strokeWidth:1,stroke:a=="A"?"#ccc":"#bb0000",dashstyle:"5 5"}})}o==null||o.revalidate(u),o==null||o.revalidate(b)})},Le=a=>{setTimeout(()=>{document.querySelectorAll(".jtk-endpoint").forEach(e=>{e.style.opacity=1})},100)},$e=()=>{x.value&&x.value.length&&i.barA&&(i.barA.boxList.forEach(a=>{if(!a.type)for(let e=1;e<=a.outletNum;e++){const s=document.getElementById("plugin-"+a.boxIndex+"_A-"+e);o==null||o.revalidate(s)}}),i.barB.boxList.forEach(a=>{if(!a.type)for(let e=1;e<=a.outletNum;e++){const s=document.getElementById("plugin-"+a.boxIndex+"_B-"+e);o==null||o.revalidate(s)}}))},le=(a,e={},s=!1)=>{const t=document.getElementById("cab-A-"+a),u=document.getElementById("cab-B-"+a);if(o==null||o.removeAllEndpoints(t),o==null||o.removeAllEndpoints(u),!s){if(e.boxIndexA!==""&&e.boxOutletIdA||(o==null||o.addEndpoint(t,{source:!0,target:!0,endpoint:"Dot"})),e.boxIndexA!==""&&e.boxOutletIdB||(o==null||o.addEndpoint(u,{source:!0,target:!0,endpoint:"Dot"})),e.boxIndexA!==""&&e.boxIndexA>-1&&e.boxOutletIdA){const b=document.getElementById("cab-A-"+a),p=document.getElementById(`plugin-${e.boxIndexA}_A-${e.boxOutletIdA}`);o==null||o.connect({source:b,target:p,paintStyle:{strokeWidth:1,stroke:"#ccc",dashstyle:"5 5"}})}if(e.boxIndexA!==""&&e.boxIndexA>-1&&e.boxOutletIdB){const b=document.getElementById("cab-B-"+a),p=document.getElementById(`plugin-${e.boxIndexB}_B-${e.boxOutletIdB}`);o==null||o.connect({source:b,target:p,paintStyle:{strokeWidth:1,stroke:"#bb0000",dashstyle:"5 5"}})}o==null||o.revalidate(t),o==null||o.revalidate(u)}},xe=()=>{Z(()=>{x.value.forEach((a,e)=>{if(!a.cabinetName||!i.barA)return;const s=document.getElementById("cab-A-"+e),t=document.getElementById("cab-B-"+e);o==null||o.revalidate(s),o==null||o.revalidate(t)}),$e()})},L=ue({pageNo:1,pageSize:24,cabinetIds:[]}),Q=k({}),he=k([]),ge=k(!1),Fe=async()=>{var e,s,t,u,b,p,V;const a=await ke.getCabinetPFDetail(L);Q.value=a==null?void 0:a.chart,(s=(e=Q.value)==null?void 0:e.powerFactorAvgValueTotal)==null||s.forEach(m=>{m=m==null?void 0:m.toFixed(2)}),(u=(t=Q.value)==null?void 0:t.powerFactorAvgValueA)==null||u.forEach(m=>{m=m==null?void 0:m.toFixed(2)}),(p=(b=Q.value)==null?void 0:b.powerFactorAvgValueB)==null||p.forEach(m=>{m=m==null?void 0:m.toFixed(2)}),he.value=a==null?void 0:a.table,(V=he.value)==null||V.forEach(m=>{var g,K,se;m.factor_total_avg_value=(g=m==null?void 0:m.factor_total_avg_value)==null?void 0:g.toFixed(2),m.factor_a_avg_value=(K=m==null?void 0:m.factor_a_avg_value)==null?void 0:K.toFixed(2),m.factor_b_avg_value=(se=m==null?void 0:m.factor_b_avg_value)==null?void 0:se.toFixed(2)})},Ve=async()=>{L!=null&&L.startTime&&await Fe()},Xe=async()=>{try{await J.exportConfirm(),L.pageNo=1,ge.value=!0;const a={timeout:0},e=await ke.getCabinetPFDetailExcel(L,a);await St.excel(e,"\u529F\u7387\u56E0\u6570\u8BE6\u7EC6.xlsx")}catch{}finally{ge.value=!1}},Ze=a=>{var e=a.getFullYear(),s=a.getMonth(),t=a.getDate(),u=a.getHours(),b=a.getMinutes(),p=a.getSeconds();return e+"-"+(s+1>9?s+1:"0"+(s+1))+"-"+(t>9?t:"0"+t)+" "+(u>9?u:"0"+u)+":"+(b>9?b:"0"+b)+":"+(p>9?p:"0"+p)},Ge=a=>{if(a.preventDefault(),!E.value||!a.target.className.includes("inner_empty")&&!a.target.className.includes("inner_fill"))return;const e=a.currentTarget,s=a.target.id.split("-")[1],t=e.getBoundingClientRect(),u=a.clientX-Math.ceil(t.left)+1,b=a.clientY-Math.ceil(t.top)+1,p=!x.value[s].cabinetName;F.value={left:u+"px",top:b+"px",show:!0,add:p,curIndex:s}},Se=(a,e)=>{if(a.preventDefault(),!E.value)return;const s=a.target.id||a.target.parentNode.id;if(!s||!s.includes("box"))return;const t=a.currentTarget,u=s.split("-")[1],b=t.getBoundingClientRect(),p=a.clientX-Math.ceil(b.left)+1,V=a.clientY-Math.ceil(b.top)+1;A.value={left:p+"px",top:V+"px",show:!0,curIndex:u,type:e}},ie=(a,e)=>{v.value==0?_({path:"/bus/busmonitor/powerLoadDetail",state:{devKey:i[`bar${e}`].devIp+"-"+i[`bar${e}`].barId,roomName:i.roomName}}):v.value==1||v.value==2?_({path:"/bus/busmonitor/buspowerdetail",state:{devKey:i[`bar${e}`].devIp+"-"+i[`bar${e}`].barId,roomName:i.roomName}}):v.value==3?_({path:"/bus/busmonitor/buspowerfactor",state:{devKey:i[`bar${e}`].devIp+"-"+i[`bar${e}`].barId,roomName:i.roomName}}):v.value==4?_({path:"/bus/busmonitor/buspowerdetail",state:{devKey:i[`bar${e}`].devIp+"-"+i[`bar${e}`].barId,roomName:i.roomName}}):v.value==7?_({path:"/bus/busmonitor/busbalancedetail",state:{devKey:i[`bar${e}`].devIp+"-"+i[`bar${e}`].barId,roomName:i.roomName}}):v.value==8?_({path:"/bus/busmonitor/bustem",state:{devKey:i[`bar${e}`].devIp+"-"+i[`bar${e}`].barId,roomName:i.roomName}}):v.value==10&&_({path:"/bus/busmonitor/busenergydetail",state:{devKey:i[`bar${e}`].devIp+"-"+i[`bar${e}`].barId,roomName:i.roomName}})},Te=(a,e)=>{const s=(a.target.id||a.target.parentNode.id).split("-")[1];v.value==0?_({path:"/bus/boxmonitor/boxpowerLoadDetail",state:{devKey:i[`bar${e}`].boxList[s].boxKey,roomName:i.roomName}}):v.value==1||v.value==2?_({path:"/bus/boxmonitor/boxpowerDetail",state:{devKey:i[`bar${e}`].boxList[s].boxKey,roomName:i.roomName}}):v.value==3?_({path:"/bus/boxmonitor/boxpowerfactor",state:{devKey:i[`bar${e}`].boxList[s].boxKey,roomName:i.roomName}}):v.value==4?_({path:"/bus/boxmonitor/boxpowerDetail",state:{devKey:i[`bar${e}`].boxList[s].boxKey,roomName:i.roomName}}):v.value==7?_({path:"/bus/boxmonitor/boxbalancedetail",state:{devKey:i[`bar${e}`].boxList[s].boxKey,roomName:i.roomName}}):v.value==8?_({path:"/bus/boxmonitor/boxtem",state:{devKey:i[`bar${e}`].boxList[s].boxKey,roomName:i.roomName}}):v.value==10&&_({path:"/bus/boxmonitor/boxenergydetail",state:{devKey:i[`bar${e}`].boxList[s].boxKey,roomName:i.roomName}})},Oe=async a=>{A.value.curIndex,a=="edit"?Ke():(U.value="delete",i.barA=null,i.barB=null,x.value.forEach(e=>{e.busIpA=null,e.busIpB=null,e.barIdA=null,e.barIdB=null,e.boxIndexA=null,e.boxIndexB=null,e.boxOutletIdA=null,e.boxOutletIdB=null,e.cabinetBoxes=null}),o==null||o.deleteEveryConnection(),A.value.show=!1)},ne=async(a,e)=>{const s=A.value.curIndex;if(a=="edit"){const t=i[`bar${e}`].boxList[s];Ne.value.open(t)}else{const t=i[`bar${e}`].boxList[s];await be.getDeleteAisleSingleBox({id:t.id})!="1"&&J.error("\u67DC\u5217\u63D2\u63A5\u7BB1/\u8FDE\u63A5\u5668\u5355\u4E2A\u5220\u9664\u5931\u8D25!"),A.value.show=!1,x.value.forEach(async u=>{u[`boxIndex${e}`]==s&&(u[`busIp${e}`]=null,u[`barId${e}`]=null,u[`boxIndex${e}`]=null,u[`boxOutletId${e}`]=null,u.cabinetBoxes=null,await G.saveCabinetInfo({...u,pduBox:!0}))}),J.success("\u67DC\u5217\u63D2\u63A5\u7BB1/\u8FDE\u63A5\u5668\u5355\u4E2A\u5220\u9664\u6210\u529F!"),setTimeout(()=>{P()},1e3)}},ze=a=>{let e={};e=a||x.value[F.value.curIndex],e.id?v.value==0?_({path:"/cabinet/cab/cabinetPowerLoadDetail",state:{cabinet:e.id,roomId:e.roomId,roomName:i.roomName,cabinetName:e.cabinetName}}):v.value==1||v.value==2?_({path:"/cabinet/cab/detail",state:{id:e.id,roomId:e.roomId,type:"hour",location:i.roomName,cabinetName:e.cabinetName}}):v.value==3?(async s=>{L.cabinetName=s.cabinetName,L.cabinetIds=[s.id],L.startTime=Ze(new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate(),0,0,0)),await Fe(),oe.value=!0})(e):v.value==4?_({path:"/cabinet/cab/detail",state:{id:e.id,roomId:e.roomId,type:"hour",location:i.roomName,cabinetName:e.cabinetName}}):v.value==7?_({path:"/cabinet/cab/balance",state:{cabinetIds:e.id,isFirst:!1}}):v.value==8?_({path:"/cabinet/cab/cabinetenvdetail",state:{id:e.id}}):v.value==9?_({path:"/cabinet/cab/screen",state:{id:e.id,roomId:e.roomId}}):v.value==10&&_({path:"/cabinet/cab/energyDetail",state:{cabinetId:e.id,cabinetroomId:e.roomId,roomName:i.roomName,cabinetName:e.cabinetName}}):J.error("\u8BE5\u673A\u67DC\u6682\u672A\u4FDD\u5B58\u7ED1\u5B9A\uFF0C\u65E0\u6CD5\u8DF3\u8F6C")},fe=a=>{F.value.show=!1;const e=F.value.curIndex;if(a=="add"||a=="edit"){if(U.value=="edit")return void ht({message:"\u8BF7\u5148\u4FDD\u5B58\u6BCD\u7EBF",type:"warning"});let s={roomId:i.roomId,roomName:i.roomName,aisleId:i.id,barA:!1,index:Number(e)+1};i.barA&&(s={roomId:i.roomId,roomName:i.roomName,aisleId:i.id,index:Number(e)+1,barA:i.barA.boxList,barB:i.barB.boxList,barIdA:i.barA.barId,busIpA:i.barA.devIp,barIdB:i.barB.barId,busIpB:i.barB.devIp,boxAmount:i.barA.boxList.length});const t=a=="add"?null:x.value[e];_e.value.open(a,t,s)}else a=="delete"&&Ue.confirm("\u786E\u8BA4\u5220\u9664\u5417\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E \u8BA4",cancelButtonText:"\u53D6 \u6D88",type:"warning"}).then(async()=>{const s=x.value[e];s.cabinetBoxes?await G.deleteCabinetInfo({id:s.id,type:2}):s.cabinetPdus?await G.deleteCabinetInfo({id:s.id,type:1}):s.rackIndices?await G.deleteCabinetInfo({id:s.id,type:3}):(x.value.splice(e,1,{}),await G.deleteCabinetInfo({id:s.id,type:4})),P()})},Je=()=>{E.value=!0,Le()},Qe=()=>{Ue.confirm("\u53D6\u6D88\u4F1A\u4F7F\u5DF2\u4FEE\u6539\u7684\u64CD\u4F5C\u4E22\u5931\uFF0C\u786E\u8BA4\u53D6\u6D88\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E \u8BA4",cancelButtonText:"\u53D6 \u6D88",type:"warning"}).then(async()=>{o==null||o.deleteEveryConnection(),E.value=!1,U.value="",P()})},Ke=()=>{let a=null;if(i.barA){const e=i.barA.boxList;a={barIdA:i.barA.barId,ipA:i.barA.devIp,barIdB:i.barB.barId,directionA:i.barA.direction,directionB:i.barB.direction,casAddrA:i.barA.casAddr,casAddrB:i.barB.casAddr,ipB:i.barB.devIp,cjxAmount:e.length}}Ce.value.open(a)},et=()=>{lt()},tt=a=>{U.value="edit";let e=[],s=[];const t=i.barA&&i.barA.boxList?i.barA.boxList.length:0;for(let p=0;p<a.cjxAmount;p++)p<t?(e.push(i.barA.boxList[p]),s.push(i.barB.boxList[p])):(e.push({casAddr:p+2,outletNum:3,type:0,boxName:"box-"+p,boxIndex:p}),s.push({casAddr:p+2,outletNum:3,type:0,boxName:"box-"+p,boxIndex:p}));const u={barId:a.barIdA,casAddr:a.casAddrA,devIp:a.ipA,path:"A",direction:a.directionA,boxList:e},b={barId:a.barIdB,casAddr:a.casAddrB,devIp:a.ipB,path:"B",direction:a.directionB,boxList:s};i.barA=u,i.barB=b,i.pduBar=1,ye()},at=a=>{a.index=+F.value.curIndex+1,x.value.splice(F.value.curIndex,1,a),i.barA&&i.pduBar&&Z(()=>{le(F.value.curIndex,a)}),P()},ot=a=>{const e=[],s=`bar${A.value.type}`,t=A.value.curIndex,u=a.outletNum;i[s].boxList.splice(t,1,a),x.value.forEach(b=>{b[`boxIndex${A.value.type}`]==Number(t)&&(b[`boxOutletId${A.value.type}`]=null,b[`boxIndex${A.value.type}`]=null,b[`barId${A.value.type}`]=null,b[`busIp${A.value.type}`]=null)}),o==null||o.deleteEveryConnection(),De();for(let b=1;b<=u;b++)document.getElementById("plugin-"+t+"_"+A.value.type+"-"+b)||e.push(b);Z(()=>{for(let b=1;b<=u;b++){const p=document.getElementById("plugin-"+t+"_"+A.value.type+"-"+b);e.includes(b)&&(o==null||o.addEndpoint(p,{source:!0,target:!0,endpoint:"Dot"})),o==null||o.revalidate(p)}})},P=async()=>{const a=await be.getAisleDetail({id:N.cabinetColumnId});ve("sendList",a),Object.assign(i,a),it(a)},lt=async()=>{const a=x.value.filter(e=>e.cabinetName);await be.saveAisleDetail({...i,length:x.value.length,cabinetList:a}),a.length&&U.value!="edit"&&U.value!="delete"&&a.forEach(async(e,s)=>{await G.saveCabinetInfo({...e,pduBox:!0})}),J.success("\u4FDD\u5B58\u6210\u529F\uFF01"),E.value=!1,U.value="",setTimeout(()=>{P()},1e3)},it=async a=>{const e=[];for(let t=0;t<a.length;t++)e.push({});var s;a.cabinetList&&a.cabinetList.forEach(t=>{t.index>0&&e.splice(t.index-1,1,t)}),x.value=e,(s=a).cabinetList&&s.cabinetList.forEach(t=>{x.value.forEach((u,b)=>{if(u.id==t.id){const p={type:"bar",emphasis:{focus:"series"},label:{show:!0,formatter:"{c}"}};let V=[{name:"L1",data:[t.lineCurA?t.lineCurA[0]:0,t.lineCurB?t.lineCurB[0]:0],...p}];return t.lineCurA&&t.lineCurB&&t.lineCurA.length==3&&t.lineCurB.length==3&&(V=[...V,{name:"L2",data:[t.lineCurA?t.lineCurA[1]:0,t.lineCurB?t.lineCurB[1]:0],...p},{name:"L3",data:[t.lineCurA?t.lineCurA[2]:0,t.lineCurB?t.lineCurB[2]:0],...p}]),void(x.value[b]={...u,...t,echartsOptionLoad:{xAxis:{type:"category",data:["\u8D1F\u8F7D\u7387"],axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},grid:{left:"-30",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},yAxis:{type:"value",max:100,show:!1},series:[{name:"load",data:[t.loadRate?t.loadRate.toFixed(0):0],type:"bar",barWidth:"100%",showBackground:!0,itemStyle:{color:function(m){const g=m.value;return g<30?"#3bbb00":g<60?"#05ebfc":g<90?"#ffc402":"#fa3333"}},label:{show:!0,position:"top",formatter:"{c}"}}]},echartsOptionA1:{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:t.lineCurA&&t.lineCurA.length==3||t.lineCurB&&t.lineCurB.length==3?["Ia","Ib","Ic"]:["Ia"],axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!1}},grid:{left:"-22",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},yAxis:{type:"value",show:!1},series:[{name:"A",itemStyle:{color:function(m){const g=m.dataIndex;return g==0?"#E5B849":g==1?"#C8603A":g==2?"#AD3762":"#fa3333"}},data:t.lineCurA&&t.lineCurA.length==3?[t.lineCurA?t.lineCurA[0]:0,t.lineCurA?t.lineCurA[1]:0,t.lineCurA?t.lineCurA[2]:0]:[t.lineCurA?t.lineCurA[0]:0],...p},{name:"B",itemStyle:{color:function(m){const g=m.dataIndex;return g==0?"#E5B849":g==1?"#C8603A":g==2?"#AD3762":"#fa3333"}},data:t.lineCurB&&t.lineCurB.length==3?[t.lineCurB?t.lineCurB[0]:0,t.lineCurB?t.lineCurB[1]:0,t.lineCurB?t.lineCurB[2]:0]:[t.lineCurB?t.lineCurB[0]:0],...p}]},echartsOptionV1:{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:t.lineVolA&&t.lineVolA.length==3||t.lineVolB&&t.lineVolB.length==3?["Ua","Ub","Uc"]:["Ua"],axisTick:{show:!1},axisLabel:{show:!1},axisLine:{show:!1}},grid:{left:"-28",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},yAxis:{type:"value",show:!1},series:[{name:"A",itemStyle:{color:function(m){const g=m.dataIndex;return g==0?"#075F71":g==1?"#119CB5":g==2?"#45C0C9":"#fa3333"}},data:t.lineVolA&&t.lineVolA.length==3?[t.lineVolA?t.lineVolA[0]:0,t.lineVolA?t.lineVolA[1]:0,t.lineVolA?t.lineVolA[2]:0]:[t.lineVolA?t.lineVolA[0]:0],...p},{name:"B",itemStyle:{color:function(m){const g=m.dataIndex;return g==0?"#075F71":g==1?"#119CB5":g==2?"#45C0C9":"#fa3333"}},data:t.lineVolB&&t.lineVolB.length==3?[t.lineVolB?t.lineVolB[0]:0,t.lineVolB?t.lineVolB[1]:0,t.lineVolB?t.lineVolB[2]:0]:[t.lineVolB?t.lineVolB[0]:0],...p}]},echartsOptionFactor:{xAxis:{type:"category",data:["\u529F\u7387\u56E0\u7D20"],axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},grid:{left:"-26",right:"0",bottom:"4.6%",top:"8%",containLabel:!0},yAxis:{type:"value",max:1,show:!1},series:[{name:"load",data:[t.powerFactor],type:"bar",barWidth:"100%",showBackground:!0,itemStyle:{color:function(m){const g=m.value;return g<.25?"#FF6E76":g<.5?"#FDDD60":g<.75?"#58D9F9":"#7CFFB2"}},label:{show:!0,position:"top",formatter:"{c}"}}]},echartsOptionApparent:{xAxis:{type:"category",data:["\u529F\u7387"],axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",show:!1},grid:{left:"-22",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},series:[{name:"Small Red Bar",type:"bar",data:[t.powActive.toFixed(3)],itemStyle:{color:"#91cc75"},stack:"Ad",barWidth:"100%",label:{show:!0,position:"inside",color:"white",fontSize:12}},{name:"Small Blue Bar",type:"bar",data:[t.powReactive.toFixed(3)],itemStyle:{color:"#800080"},stack:"Ad",barWidth:"100%",label:{show:!0,position:"inside",color:"white",fontSize:12}}]},echartsOptionBalance:{xAxis:{type:"category",data:["A\u8DEF","B\u8DEF"],axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",show:!1},grid:{left:"-22",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},series:[{name:"\u89C6\u5728\u529F\u7387",type:"bar",data:[t.powApparentA,t.powApparentB],itemStyle:{color:"#5470c6"},z:1,label:{show:!0,position:"top",fontSize:12}}]},echartsOptionTemp:{xAxis:{type:"category",data:["\u51B7\u901A\u9053\u6E29\u5EA6","\u70ED\u901A\u9053\u6E29\u5EA6"],axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!1}},grid:{left:"-22",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},yAxis:{type:"value",show:!1},series:[{data:[t.temData?t.temData:0,t.temDataHot?t.temDataHot:0],type:"bar",itemStyle:{color:function(m){const g=m.dataIndex;if(g==0){for(const K of ae.value)if(m.value<K.max)return K.color;return"red"}if(g==1){for(const K of ae.value)if(m.value<K.hotMax)return K.hotColor;return"red"}return"#fa3333"}},label:{show:!0,position:"top",formatter:"{c}\xB0C"}}]},echartsOptionCapacity:{xAxis:{type:"category",data:[`\u603B\u5BB9\u91CF:${u.cabinetHeight}`],axisTick:{show:!1},axisLabel:{show:!1}},grid:{left:"-22",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},yAxis:{type:"value",max:u.cabinetHeight,show:!1},series:[{data:[u.usedSpace],type:"bar",barWidth:"100%",showBackground:!0,itemStyle:{color:function(m){const g=m.value;return g/u.cabinetHeight<.5?"#3bbb00":g/u.cabinetHeight<.7?"#ffc402":"#fa3333"}},backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},label:{show:!0,position:"top",formatter:`\u5DF2\u7528\u5BB9\u91CF:
{c}`}}]},echartsOptionEq:{xAxis:{type:"category",data:["\u6628\u65E5\u7528\u80FD"],axisTick:{show:!1},axisLabel:{show:!1}},grid:{left:"-40",right:"0",bottom:"4.9%",top:"8%",containLabel:!0},yAxis:{type:"value",max:u.eleLimitDay,show:!1},series:[{name:"load",data:[u.yesterdayEq?u.yesterdayEq.toFixed(2):0],type:"bar",barWidth:"100%",showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"},label:{show:!0,position:"top",formatter:"{c}"}}]}})}})}),ve("backData",[...x.value],X.value),Pe.value={title:{text:"\u673A\u67DC\u5217\u5B9E\u65F6\u7EDF\u8BA1"},grid:{left:"45",right:"80",bottom:"0",top:"50",containLabel:!0},xAxis:{type:"category",data:x.value.map(t=>t.cabinetName||"")},legend:{top:"0",right:"80",selectedMode:"single"},yAxis:{type:"value"},series:[{name:"\u6709\u529F\u529F\u7387",data:x.value.map(t=>t.powActive==null?null:t.powActive),type:"bar",barWidth:"92%",label:{show:!0,position:"top",formatter:"{c}"}},{name:"\u6628\u65E5\u7528\u80FD",data:x.value.map(t=>t.yesterdayEq==null?null:t.yesterdayEq),type:"bar",barWidth:"92%",label:{show:!0,position:"top",formatter:"{c}"}}]},rt(),await ye(),Le()},nt=()=>{x.value.push({}),xe()},st=()=>{x.value.pop(),xe()};window.addEventListener("resize",function(){xe()});const rt=()=>{X.value=1,Ye&&Z(()=>{const a=document.querySelector(".topologyContainer > .Container > .main"),e=i.pduBar?132:0,s=a.getBoundingClientRect().width+e,t=a.getBoundingClientRect().height+30;qe.value=t,X.value=+(((z==null?void 0:z.width)-30)/s).toFixed(2),t>400&&(X.value=+(400/t).toFixed(2)),X.value>1&&(X.value=1)})},dt=a=>{let e=null;N.cabinetroomId?e=q.value.find(s=>s.roomId==N.cabinetroomId):(N.roomDownValId==null||N.roomDownValId==""?N.cabinetroomId=q.value[0].roomId:N.cabinetroomId=N.roomDownValId,e=q.value[0]),W.value=e.aisleList||[],!N.cabinetColumnId&&W.value&&(N.cabinetColumnId=W.value[0].id),P()};return Be(()=>N.cabinetroomId,a=>{if(a){const e=q.value.find(s=>s.roomId==a);W.value=e.aisleList||[],W.value.find(s=>s.id==N.cabinetColumnId)||(N.cabinetColumnId=W.value[0].id)}}),Be(()=>N.cabinetColumnId,a=>{ve("idChange",a),E.value=!1,U.value="",ye(!0),o==null||o.deleteEveryConnection(),P()}),Be(()=>z,a=>{a&&(N.cabinetColumnId=z==null?void 0:z.cabinetColumnId,N.cabinetroomId=z==null?void 0:z.cabinetroomId)},{immediate:!0}),mt(()=>{(async()=>{const a=await be.getAisleList({});a&&a.length&&(q.value=a,dt(N.cabinetroomId))})(),o=Vt({container:we.value}),o.bind("beforeDrop",({connection:a})=>{const e=a.source.id,s=a.target.id,t=e.includes("cab")?e:s,u=t.split("-")[2],b=t.split("-")[1],p=e.includes("plugin")?e:s,V=p.split("_")[0],m=p.split("-")[2];return!(t.split("-")[0]==p.split("-")[0]||b=="A"&&p.includes("B")||b=="B"&&p.includes("A")||(x.value[u][`boxOutletId${b}`]=+m,x.value[u][`boxIndex${b}`]=i[`bar${b}`].boxList[Number(V.split("-")[1])-1].boxIndex,x.value[u][`barId${b}`]=i[`bar${b}`].barId,x.value[u][`busIp${b}`]=i[`bar${b}`].devIp,b=="A"?a.paintStyle={strokeWidth:1,stroke:"#ccc",dashstyle:"5 5"}:b=="B"&&(a.paintStyle={strokeWidth:1,stroke:"#bb0000",dashstyle:"5 5"}),0))}),o.bind("beforeDetach",function(a){if(a.suspendedElement){const e=a.target.id,s=a.source.id,t=a.source.id.includes("cab")?s.split("-")[1]:e.split(/[-_]/)[2],u=a.source.id.includes("cab")?s.split("-")[2]:e.split(/[-_]/)[1];x.value[u][`boxOutletId${t}`]=null,x.value[u][`boxIndex${t}`]=null,x.value[u][`barId${t}`]=null,x.value[u][`busIp${t}`]=null;const b=document.getElementById("cab-"+t+"-"+u);o==null||o.addEndpoint(b,{source:!0,target:!0,endpoint:"Dot"})}return!0}),(async()=>{const a=await ke.getCabinetColorAll();a!=null&&(ae.value=a,ae.value.forEach((e,s)=>{me[8].push({name:e.min+"\xB0C ~ "+e.max+"\xB0C",selected:!0,value:s+1,color:e.color,hotName:e.hotMin+"\xB0C ~ "+e.hotMax+"\xB0C",hotColor:e.hotColor})}))})(),document.addEventListener("mouseup",a=>{const e=a.target;a.button==0&&F.value.show&&e.className!="menu_item"&&(F.value.show=!1),a.button==0&&A.value.show&&e.className!="menu_item"&&(A.value.show=!1)})}),vt(()=>{}),(a,e)=>{const s=gt,t=ft,u=Ft,b=It,p=$t,V=At,m=Bt,g=kt,K=wt,se=Ct,re=Nt,ct=_t,ut=Dt;return d(),c($,null,[h(u,null,{default:C(()=>[r("div",Mt,[r("div",Ut,[n(x)&&n(x).length?(d(),c("div",Wt,[ee(r("span",null,"\u524D\u95E8\uFF1A",512),[[te,n(v)==8]]),(d(!0),c($,null,T(n(me)[n(v)],(l,f)=>(d(),O(s,{key:f,size:S.isFromHome?"small":"default",style:H(`background-color: ${l.color};color: white;`)},{default:C(()=>[B(D(l.name),1)]),_:2},1032,["size","style"]))),128))])):y("",!0),n(x)&&n(x).length?ee((d(),c("div",Rt,[ee(r("span",null,"\u540E\u95E8\uFF1A",512),[[te,n(v)==8]]),(d(!0),c($,null,T(n(me)[n(v)],(l,f)=>(d(),O(s,{key:f,size:S.isFromHome?"small":"default",style:H(`background-color: ${l.hotColor};color: white;`)},{default:C(()=>[B(D(l.hotName),1)]),_:2},1032,["size","style"]))),128))],512)),[[te,n(v)==8]]):y("",!0)]),r("div",null,[(d(),c($,null,T(R,l=>h(s,{key:l.value,onClick:f=>{return w=l.value,v.value=w,void Z(()=>{$e()});var w},type:"primary",plain:n(v)!=l.value},{default:C(()=>[B(D(l.name),1)]),_:2},1032,["onClick","plain"])),64))]),r("div",Pt,[S.isFromHome?y("",!0):(d(),c("div",qt,[n(E)?y("",!0):(d(),O(s,{key:0,onClick:Je,type:"primary",plain:""},{default:C(()=>[h(t,{icon:"ep:edit",class:"mr-5px"}),B("\u7F16\u8F91")]),_:1})),n(E)?(d(),O(s,{key:1,onClick:Qe,type:"primary",plain:""},{default:C(()=>[B("\u53D6\u6D88")]),_:1})):y("",!0),n(E)?(d(),O(s,{key:2,onClick:Ke,type:"primary",plain:""},{default:C(()=>[B("\u914D\u7F6E")]),_:1})):y("",!0),n(E)?(d(),O(s,{key:3,onClick:et,type:"primary",plain:""},{default:C(()=>[B("\u4FDD\u5B58")]),_:1})):y("",!0)])),yt(a.$slots,"btn",{},void 0,!0)])])]),_:3}),h(u,null,{default:C(()=>[r("div",{ref_key:"topologyContainer",ref:we,class:"topologyContainer",style:"position: relative;z-index: 1;",onClick:De},[Yt,Xt,r("div",{class:"Container",style:H({alignItems:n(i).pduBar&&n(i).barA?"unset":"center",minHeight:S.isFromHome?"unset":"600px"})},[n(i).pduBar&&n(i).barA?(d(),c("div",{key:0,class:"Bus",onContextmenu:e[4]||(e[4]=M(l=>(f=>{if(f.preventDefault(),!E.value)return;f.target.id||f.target.parentNode.id;const w=f.currentTarget.getBoundingClientRect(),j=f.clientX-Math.ceil(w.left)+1,de=f.clientY-Math.ceil(w.top)+1;A.value={left:j+"px",top:de+"px",show:!0,curIndex:0,type:"bar"}})(l),["right"]))},[r("div",{class:"startBus",style:H({opacity:n(i).barA.direction?0:1}),onDblclick:e[0]||(e[0]=l=>ie(0,"A"))},[h(pe,{chosenBtn:n(v),pluginData:n(i).barA,btns:R},null,8,["chosenBtn","pluginData"])],36),n(i).barB.direction?y("",!0):(d(),c("div",{key:0,class:"startBus",onDblclick:e[1]||(e[1]=l=>ie(0,"B"))},[h(pe,{chosenBtn:n(v),pluginData:n(i).barB,btns:R},null,8,["chosenBtn","pluginData"])],32)),Zt,Gt,n(A).show&&n(E)&&n(A).type=="bar"?(d(),c("div",{key:1,class:"menu",style:H({left:`${n(A).left}`,top:`${n(A).top}`})},[r("div",{class:"menu_item",onClick:e[2]||(e[2]=l=>Oe("edit"))},"\u7F16\u8F91"),r("div",{class:"menu_item",onClick:e[3]||(e[3]=l=>Oe("delete"))},"\u5220\u9664")],4)):y("",!0)],32)):y("",!0),r("div",Jt,[n(i).pduBar&&n(i).barA?(d(),c("div",{key:0,class:"busListContainer",onContextmenu:e[8]||(e[8]=M(l=>Se(l,"A"),["right"]))},[Qt,r("div",ea,[(d(!0),c($,null,T(n(i).barA.boxList,(l,f)=>(d(),c($,{key:f},[l.type==0||l.outletNum>0?(d(),c("div",{key:0,class:"plugin-box",id:`box-${f}`,onDblclick:e[5]||(e[5]=w=>Te(w,"A")),onClick:M(w=>Ee("A",l.boxIndex),["stop"])},[h(We,{chosenBtn:n(v),pluginData:l,btns:R},null,8,["chosenBtn","pluginData"]),r("div",aa,[(d(!0),c($,null,T(l.outletNum,w=>(d(),c("div",{key:w,class:"point",id:`plugin-${l.boxIndex}_A-${w}`},null,8,oa))),128))])],40,ta)):(d(),c("div",{key:1,class:"template-box",id:`box-${f}`},[ia,n(v)==8&&l.temData?(d(),c("div",na,[(d(!0),c($,null,T(l.temData,(w,j)=>(d(),c("div",{key:j,class:"T"},[r("div",null,"T(L"+D(j)+")",1),r("div",null,D(w)+"\xB0C",1)]))),128))])):y("",!0)],8,la))],64))),128))]),n(A).show&&n(E)&&n(A).type=="A"?(d(),c("div",{key:0,class:"menu",style:H({left:`${n(A).left}`,top:`${n(A).top}`})},[r("div",{class:"menu_item",onClick:e[6]||(e[6]=l=>ne("edit","A"))},"\u7F16\u8F91"),r("div",{class:"menu_item",onClick:e[7]||(e[7]=l=>ne("delete","A"))},"\u5220\u9664")],4)):y("",!0)],32)):y("",!0),n(i).pduBar&&n(i).barB?(d(),c("div",{key:1,class:"busListContainer",onContextmenu:e[12]||(e[12]=M(l=>Se(l,"B"),["right"])),style:{"margin-bottom":"80px"}},[sa,r("div",ra,[(d(!0),c($,null,T(n(i).barB.boxList,(l,f)=>(d(),c($,{key:f},[l.type==0||l.outletNum>0?(d(),c("div",{key:0,class:"plugin-box",id:`box-${f}`,onDblclick:e[9]||(e[9]=w=>Te(w,"B")),onClick:M(w=>Ee("B",l.boxIndex),["stop"])},[h(We,{chosenBtn:n(v),pluginData:l,btns:R},null,8,["chosenBtn","pluginData"]),r("div",ca,[(d(!0),c($,null,T(l.outletNum,w=>(d(),c("div",{key:w,class:"point",id:`plugin-${l.boxIndex}_B-${w}`},null,8,ua))),128))])],40,da)):(d(),c("div",{key:1,class:"template-box",id:`box-${f}`},[pa,n(v)==8&&l.temData?(d(),c("div",ma,[(d(!0),c($,null,T(l.temData,(w,j)=>(d(),c("div",{key:j,class:"T"},[r("div",null,"T(L"+D(j)+")",1),r("div",null,D(w)+"\xB0C",1)]))),128))])):y("",!0)],8,ba))],64))),128))]),n(A).show&&n(E)&&n(A).type=="B"?(d(),c("div",{key:0,class:"menu",style:H({left:`${n(A).left}`,top:`${n(A).top}`})},[r("div",{class:"menu_item",onClick:e[10]||(e[10]=l=>ne("edit","B"))},"\u7F16\u8F91"),r("div",{class:"menu_item",onClick:e[11]||(e[11]=l=>ne("delete","B"))},"\u5220\u9664")],4)):y("",!0)],32)):y("",!0),r("div",{class:"cabinetContainer",onContextmenu:M(Ge,["right"])},[n(x)&&n(x).length?(d(),c("div",va,[(d(!0),c($,null,T(n(x),(l,f)=>(d(),c("div",{key:f,class:"cabinetBox"},[r("div",ya,[l.cabinetName?(d(),c("div",{key:0,id:"cab-A-"+f,class:"leftPoint"},null,8,xa)):y("",!0),l.cabinetName?(d(),c("div",{key:1,id:"cab-B-"+f,class:"rightPoint"},null,8,ha)):y("",!0)]),r("div",ga,[l.cabinetName?(d(),c($,{key:0},[h(b,{effect:"light"},{content:C(()=>[B(" \u540D\u79F0\uFF1A"+D(l.cabinetName)+" ",1),fa,B(" \u8D1F\u8F7D\u7387\uFF1A"+D(l.loadRate?l.loadRate.toFixed(1):"0.0")+"%",1),Ia,B(" \u6628\u65E5\u7528\u80FD\uFF1A"+D(l.yesterdayEq||0)+"kW\xB7h",1),Aa,B(" \u603B\u6709\u529F\u529F\u7387\uFF1A"+D(l.powActive?l.powActive.toFixed(3):"0.000")+"kW",1),Ba,B(" \u603B\u89C6\u5728\u529F\u7387\uFF1A"+D(l.powApparent?l.powApparent.toFixed(3):"0.000")+"kVA",1),ka,B(" \u603B\u65E0\u529F\u529F\u7387\uFF1A"+D(l.powReactive?l.powReactive.toFixed(3):"0.000")+"kVar",1),wa,B(" \u603B\u529F\u7387\u56E0\u7D20\uFF1A"+D(l.powerFactor?l.powerFactor.toFixed(2):"0.00"),1),Ca,B(" A\u8DEF\u4F9B\u7535\u5360\u6BD4\uFF1A"+D(l.outletA)+" ",1),Na,B(" B\u8DEF\u4F9B\u7535\u5360\u6BD4\uFF1A"+D(l.outletB)+" ",1),_a,B(" \u5DF2\u7528\u7A7A\u95F4\uFF1A"+D(l.usedSpace)+"U",1),Da,B(" \u672A\u7528\u7A7A\u95F4\uFF1A"+D(l.freeSpace)+"U",1),Ea]),default:C(()=>[r("div",{class:"inner_fill",onClick:M(w=>{return j=f,o==null||o.deleteEveryConnection(),void x.value.forEach((de,ce)=>{if(de.cabinetName||!i.pduBar)if(ce==j)le(ce,de);else{const Ie=document.getElementById("cab-A-"+ce),Ae=document.getElementById("cab-B-"+ce);o==null||o.removeAllEndpoints(Ie),o==null||o.removeAllEndpoints(Ae),o==null||o.addEndpoint(Ie,{source:!0,target:!0,endpoint:"Dot"}),o==null||o.addEndpoint(Ae,{source:!0,target:!0,endpoint:"Dot"}),o==null||o.revalidate(Ie),o==null||o.revalidate(Ae)}});var j},["stop"]),onDblclick:w=>ze(l),id:"cabinet-"+f,style:H({backgroundColor:l.id?"rgba(180, 180, 180, 0.2)":"rgba(230, 240, 234)"})},null,44,La)]),_:2},1024),l.id?(d(),c($,{key:0},[n(v)==0?(d(),c("div",$a,[h(p,{options:l.echartsOptionLoad,height:"100%"},null,8,["options"]),Fa])):y("",!0),n(v)==1?(d(),c("div",Va,[l.lineCurA||l.lineCurB?(d(),O(p,{key:0,options:l.echartsOptionA1,height:"100%"},null,8,["options"])):y("",!0),r("div",Sa,[Ta,l.lineCurA&&l.lineCurA.length==3||l.lineCurB&&l.lineCurB.length==3?(d(),c("div",Oa,"Ib")):y("",!0),l.lineCurA&&l.lineCurA.length==3||l.lineCurB&&l.lineCurB.length==3?(d(),c("div",za,"Ic")):y("",!0)])])):y("",!0),n(v)==2?(d(),c("div",Ka,[l.lineVolA||l.lineVolB?(d(),O(p,{key:0,options:l.echartsOptionV1,height:"100%"},null,8,["options"])):y("",!0),r("div",ja,[Ha,l.lineVolA&&l.lineVolA.length==3||l.lineVolB&&l.lineVolB.length==3?(d(),c("div",Ma,"Ub")):y("",!0),l.lineVolA&&l.lineVolA.length==3||l.lineVolB&&l.lineVolB.length==3?(d(),c("div",Ua,"Uc")):y("",!0)])])):y("",!0),n(v)==3?(d(),c("div",Wa,[h(p,{options:l.echartsOptionFactor,height:"100%"},null,8,["options"]),Ra])):y("",!0),n(v)==4?(d(),c("div",Pa,[h(p,{options:l.echartsOptionApparent,height:"100%"},null,8,["options"]),qa])):y("",!0),n(v)==7?(d(),c("div",Ya,[h(p,{options:l.echartsOptionBalance,height:"100%"},null,8,["options"]),Xa])):y("",!0),n(v)==8?(d(),c("div",Za,[h(p,{options:l.echartsOptionTemp,height:"100%"},null,8,["options"]),Ga])):y("",!0),n(v)==9?(d(),c("div",Ja,[h(p,{options:l.echartsOptionCapacity,height:"100%"},null,8,["options"]),Qa])):y("",!0),n(v)==10?(d(),c("div",eo,[h(p,{options:l.echartsOptionEq,height:"100%"},null,8,["options"]),to])):y("",!0)],64)):y("",!0)],64)):(d(),c("div",{key:1,class:"inner_empty",id:"cabinet-"+f},null,8,ao))]),oo,r("div",lo,D(l.cabinetName||""),1)]))),128)),r("div",io,[ee(r("div",{class:"operateIcon",onClick:M(nt,["prevent"])},"+",512),[[te,n(E)]]),ee(r("div",{class:"operateIcon",onClick:M(st,["prevent"])},"-",512),[[te,n(E)]])])])):y("",!0),n(F).show&&n(E)?(d(),c("div",{key:1,class:"menu",style:H({left:`${n(F).left}`,top:`${n(F).top}`})},[n(F).add?(d(),c("div",{key:0,class:"menu_item",onClick:e[13]||(e[13]=l=>fe("add"))},"\u65B0\u589E")):y("",!0),n(F).add?y("",!0):(d(),c("div",{key:1,class:"menu_item",onClick:e[14]||(e[14]=l=>ze(!1))},"\u67E5\u770B")),n(F).add?y("",!0):(d(),c("div",{key:2,class:"menu_item",onClick:e[15]||(e[15]=l=>fe("edit"))},"\u7F16\u8F91")),n(F).add?y("",!0):(d(),c("div",{key:3,class:"menu_item",onClick:e[16]||(e[16]=l=>fe("delete"))},"\u5220\u9664"))],4)):y("",!0)],32)]),n(i).pduBar&&n(i).barA?(d(),c("div",no,[r("div",{class:"startBus",style:H({opacity:n(i).barA.direction}),onDblclick:e[17]||(e[17]=l=>ie(0,"A"))},[h(pe,{chosenBtn:n(v),pluginData:n(i).barA,btns:R},null,8,["chosenBtn","pluginData"])],36),n(i).barB.direction?(d(),c("div",{key:0,class:"startBus",onDblclick:e[18]||(e[18]=l=>ie(0,"B"))},[h(pe,{chosenBtn:n(v),pluginData:n(i).barB,btns:R},null,8,["chosenBtn","pluginData"])],32)):y("",!0)])):y("",!0)],4),S.isFromHome?y("",!0):(d(),O(K,{key:0,class:"mt-15px topForm",model:n(N),ref:"queryFormRef",inline:!0,"label-width":"68px"},{default:C(()=>[h(g,{label:"",prop:"jf"},{default:C(()=>[B(" \u673A\u623F\uFF1A"),h(m,{size:S.isFromHome?"small":"",modelValue:n(N).cabinetroomId,"onUpdate:modelValue":e[19]||(e[19]=l=>n(N).cabinetroomId=l),placeholder:"\u8BF7\u9009\u62E9",class:"!w-200px"},{default:C(()=>[(d(!0),c($,null,T(n(q),l=>(d(),O(V,{key:l.roomId,label:l.roomName,value:l.roomId},null,8,["label","value"]))),128))]),_:1},8,["size","modelValue"])]),_:1}),so,h(g,{label:"",prop:"jg"},{default:C(()=>[B(" \u67DC\u5217\uFF1A"),h(m,{size:S.isFromHome?"small":"",modelValue:n(N).cabinetColumnId,"onUpdate:modelValue":e[20]||(e[20]=l=>n(N).cabinetColumnId=l),placeholder:"\u8BF7\u9009\u62E9",class:"!w-200px"},{default:C(()=>[(d(!0),c($,null,T(n(W),l=>(d(),O(V,{key:l.id,label:l.aisleName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["size","modelValue"])]),_:1})]),_:1},8,["model"])),!n(E)&&n(i).barA?(d(),c("div",{key:1,class:"mask",onContextmenu:e[21]||(e[21]=M(l=>{},["right","prevent"]))},null,32)):y("",!0)],512)]),_:1}),h(Tt,{ref_key:"columnForm",ref:Ce,onSuccess:tt},null,512),h(zt,{ref_key:"cabinetForm",ref:_e,onSuccess:at},null,512),h(Kt,{ref_key:"columnBoxForm",ref:Ne,onSuccess:ot},null,512),h(ut,{modelValue:n(oe),"onUpdate:modelValue":e[27]||(e[27]=l=>xt(oe)?oe.value=l:null),style:{width:"80%",height:"80%","margin-top":"100px"}},{default:C(()=>[r("div",ro,[r("div",co,[uo,r("span",null,"\u6240\u5728\u4F4D\u7F6E\uFF1A"+D(n(i).roomName?n(i).roomName:"\u672A\u7ED1\u5B9A"),1),r("span",null," \u673A\u67DC\u540D\u79F0\uFF1A"+D(n(L).cabinetName?n(L).cabinetName:"\u672A\u7ED1\u5B9A"),1)]),r("div",bo,[h(se,{modelValue:n(L).startTime,"onUpdate:modelValue":e[22]||(e[22]=l=>n(L).startTime=l),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime","picker-options":a.pickerOptions,placeholder:"\u9009\u62E9\u65E5\u671F\u65F6\u95F4"},null,8,["modelValue","picker-options"]),h(s,{onClick:e[23]||(e[23]=l=>{var f;(f=new Date(L.startTime+"Z")).setDate(f.getDate()-1),L.startTime=f.toISOString().slice(0,19).replace("T"," "),Ve()}),type:"primary",style:{"margin-left":"10px"}},{default:C(()=>[B("< \u524D\u4E00\u65E5")]),_:1}),h(s,{onClick:e[24]||(e[24]=l=>{var f;(f=new Date(L.startTime+"Z")).setDate(f.getDate()+1),L.startTime=f.toISOString().slice(0,19).replace("T"," "),Ve()}),type:"primary"},{default:C(()=>[B("> \u540E\u4E00\u65E5")]),_:1})]),r("div",po,[r("div",mo,[h(s,{onClick:e[25]||(e[25]=l=>Y.value=0),type:n(Y)===0?"primary":""},{default:C(()=>[B("\u56FE\u8868")]),_:1},8,["type"]),h(s,{onClick:e[26]||(e[26]=l=>Y.value=1),type:n(Y)===1?"primary":""},{default:C(()=>[B("\u6570\u636E")]),_:1},8,["type"]),h(s,{type:"success",plain:"",onClick:Xe,loading:n(ge)},{default:C(()=>[vo,B(" \u5BFC\u51FA ")]),_:1},8,["loading"])])])]),yo,n(Y)==0?(d(),O(Ot,{key:0,width:"75vw",height:"70vh",list:n(Q)},null,8,["list"])):n(Y)==1?(d(),c("div",xo,[h(ct,{style:{height:"70vh"},data:n(he),"show-overflow-tooltip":!0},{default:C(()=>[h(re,{label:"\u65F6\u95F4",align:"center",prop:"create_time"}),h(re,{label:"\u603B\u529F\u7387\u56E0\u7D20",align:"center",prop:"factor_total_avg_value"}),h(re,{label:"A\u8DEF\u529F\u7387\u56E0\u7D20",align:"center",prop:"factor_a_avg_value"}),h(re,{label:"B\u8DEF\u529F\u7387\u56E0\u7D20",align:"center",prop:"factor_b_avg_value"})]),_:1},8,["data"])])):y("",!0)]),_:1},8,["modelValue"])],64)}}}),[["__scopeId","data-v-ac98ea23"]]);export{ho as default};
