import{d as ra,x as na,u as sa,e as h,f as ia,h as pa,U as da,o as s,c as D,k as a,w as e,a as o,V as M,F as E,p as ua,n as i,l as p,s as m,t as ca,q as R,Z as ma,O as fa,S as ba,N as _a,_ as ya,A as ga,Q as ha,D as wa,G as ka,R as va}from"./index-mcOGIq4g.js";import{_ as xa}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{E as ja,a as Ca,b as Na}from"./el-dropdown-item-YOt6BOHH.js";import{_ as Sa}from"./DictTag.vue_vue_type_script_lang-BqAWFSW1.js";import{_ as Oa}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Ra}from"./index-kf-imsI2.js";import{a as Va,D as I}from"./dict-Cu4dALpk.js";import{c as V}from"./permission-CvlSIf1u.js";import{_ as Ta}from"./JobForm.vue_vue_type_script_setup_true_lang-BZFNl7h-.js";import{_ as Aa}from"./JobDetail.vue_vue_type_script_setup_true_lang-BvScudL7.js";import{d as Pa}from"./download--D_IyRio.js";import{b as Ua,e as qa,d as Fa,f as Ja,r as La}from"./index-DA8icdNR.js";import{a as f}from"./constants-D0aoFN3l.js";import{u as za}from"./useMessage-CGTQbR_M.js";import"./index-BFNvSS9e.js";import"./color-DXkOL5Tu.js";import"./el-card-FPJq94NZ.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./Dialog.vue_vue_type_style_index_0_lang-BHwm1lq5.js";import"./el-descriptions-item--lSPrlFw.js";import"./formatTime-f-_athMZ.js";const Da=ra({name:"InfraJob",__name:"index",setup(Ma){const{t:j}=na(),b=za(),{push:K}=sa(),C=h(!0),T=h(0),A=h([]),n=ia({pageNo:1,pageSize:10,name:void 0,status:void 0,handlerName:void 0}),P=h(),N=h(!1),_=async()=>{C.value=!0;try{const t=await Ua(n);A.value=t.list,T.value=t.total}finally{C.value=!1}},k=()=>{n.pageNo=1,_()},B=()=>{P.value.resetFields(),k()},G=async()=>{try{await b.exportConfirm(),N.value=!0;const t=await qa(n);Pa.excel(t,"\u5B9A\u65F6\u4EFB\u52A1.xls")}catch{}finally{N.value=!1}},U=h(),q=(t,r)=>{U.value.open(t,r)},Q=async t=>{try{await b.confirm("\u786E\u8BA4\u8981\u7ACB\u5373\u6267\u884C\u4E00\u6B21"+t.name+"?",j("common.reminder")),await La(t.id),b.success("\u6267\u884C\u6210\u529F"),await _()}catch{}},F=h(),Z=t=>{F.value.open(t)},J=t=>{K(t&&t>0?"/job/job-log?id="+t:"/job/job-log")};return pa(()=>{_()}),(t,r)=>{const S=Ra,L=ma,v=fa,X=ba,H=_a,w=ya,u=ga,W=ha,z=Oa,y=wa,Y=Sa,O=ja,$=Ca,aa=Na,ea=ka,la=xa,g=da("hasPermi"),oa=va;return s(),D(E,null,[a(S,{title:"\u5B9A\u65F6\u4EFB\u52A1",url:"https://doc.iocoder.cn/job/"}),a(S,{title:"\u5F02\u6B65\u4EFB\u52A1",url:"https://doc.iocoder.cn/async-task/"}),a(S,{title:"\u6D88\u606F\u961F\u5217",url:"https://doc.iocoder.cn/message-queue/"}),a(z,null,{default:e(()=>[a(W,{class:"-mb-15px",model:o(n),ref_key:"queryFormRef",ref:P,inline:!0,"label-width":"100px"},{default:e(()=>[a(v,{label:"\u4EFB\u52A1\u540D\u79F0",prop:"name"},{default:e(()=>[a(L,{modelValue:o(n).name,"onUpdate:modelValue":r[0]||(r[0]=l=>o(n).name=l),placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",clearable:"",onKeyup:M(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(v,{label:"\u4EFB\u52A1\u72B6\u6001",prop:"status"},{default:e(()=>[a(H,{modelValue:o(n).status,"onUpdate:modelValue":r[1]||(r[1]=l=>o(n).status=l),placeholder:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u72B6\u6001",clearable:"",class:"!w-240px"},{default:e(()=>[(s(!0),D(E,null,ua(o(Va)(o(I).INFRA_JOB_STATUS),l=>(s(),i(X,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",prop:"handlerName"},{default:e(()=>[a(L,{modelValue:o(n).handlerName,"onUpdate:modelValue":r[2]||(r[2]=l=>o(n).handlerName=l),placeholder:"\u8BF7\u8F93\u5165\u5904\u7406\u5668\u7684\u540D\u5B57",clearable:"",onKeyup:M(k,["enter"]),class:"!w-240px"},null,8,["modelValue"])]),_:1}),a(v,null,{default:e(()=>[a(u,{onClick:k},{default:e(()=>[a(w,{icon:"ep:search",class:"mr-5px"}),p(" \u641C\u7D22")]),_:1}),a(u,{onClick:B},{default:e(()=>[a(w,{icon:"ep:refresh",class:"mr-5px"}),p(" \u91CD\u7F6E")]),_:1}),m((s(),i(u,{type:"primary",plain:"",onClick:r[3]||(r[3]=l=>q("create"))},{default:e(()=>[a(w,{icon:"ep:plus",class:"mr-5px"}),p(" \u65B0\u589E ")]),_:1})),[[g,["infra:job:create"]]]),m((s(),i(u,{type:"success",plain:"",onClick:G,loading:o(N)},{default:e(()=>[a(w,{icon:"ep:download",class:"mr-5px"}),p(" \u5BFC\u51FA ")]),_:1},8,["loading"])),[[g,["infra:job:export"]]]),m((s(),i(u,{type:"info",plain:"",onClick:r[4]||(r[4]=l=>J())},{default:e(()=>[a(w,{icon:"ep:zoom-in",class:"mr-5px"}),p(" \u6267\u884C\u65E5\u5FD7 ")]),_:1})),[[g,["infra:job:query"]]])]),_:1})]),_:1},8,["model"])]),_:1}),a(z,null,{default:e(()=>[m((s(),i(ea,{data:o(A)},{default:e(()=>[a(y,{label:"\u4EFB\u52A1\u7F16\u53F7",align:"center",prop:"id"}),a(y,{label:"\u4EFB\u52A1\u540D\u79F0",align:"center",prop:"name"}),a(y,{label:"\u4EFB\u52A1\u72B6\u6001",align:"center",prop:"status"},{default:e(l=>[a(Y,{type:o(I).INFRA_JOB_STATUS,value:l.row.status},null,8,["type","value"])]),_:1}),a(y,{label:"\u5904\u7406\u5668\u7684\u540D\u5B57",align:"center",prop:"handlerName"}),a(y,{label:"\u5904\u7406\u5668\u7684\u53C2\u6570",align:"center",prop:"handlerParam"}),a(y,{label:"CRON \u8868\u8FBE\u5F0F",align:"center",prop:"cronExpression"}),a(y,{label:"\u64CD\u4F5C",align:"center",width:"200"},{default:e(l=>[m((s(),i(u,{type:"primary",link:"",onClick:x=>q("update",l.row.id)},{default:e(()=>[p(" \u4FEE\u6539 ")]),_:2},1032,["onClick"])),[[g,["infra:job:update"]]]),m((s(),i(u,{type:"primary",link:"",onClick:x=>(async d=>{try{const c=d.status===f.STOP?"\u5F00\u542F":"\u5173\u95ED";await b.confirm("\u786E\u8BA4\u8981"+c+'\u5B9A\u65F6\u4EFB\u52A1\u7F16\u53F7\u4E3A"'+d.id+'"\u7684\u6570\u636E\u9879?',j("common.reminder"));const ta=d.status===f.STOP?f.NORMAL:f.STOP;await Fa(d.id,ta),b.success(c+"\u6210\u529F"),await _()}catch{d.status=d.status===f.NORMAL?f.STOP:f.NORMAL}})(l.row)},{default:e(()=>[p(ca(l.row.status===o(f).STOP?"\u5F00\u542F":"\u6682\u505C"),1)]),_:2},1032,["onClick"])),[[g,["infra:job:update"]]]),m((s(),i(u,{type:"danger",link:"",onClick:x=>(async d=>{try{await b.delConfirm(),await Ja(d),b.success(j("common.delSuccess")),await _()}catch{}})(l.row.id)},{default:e(()=>[p(" \u5220\u9664 ")]),_:2},1032,["onClick"])),[[g,["infra:job:delete"]]]),m((s(),i(aa,{onCommand:x=>((d,c)=>{switch(d){case"handleRun":Q(c);break;case"openDetail":Z(c.id);break;case"handleJobLog":J(c==null?void 0:c.id)}})(x,l.row)},{dropdown:e(()=>[a($,null,{default:e(()=>[o(V)(["infra:job:trigger"])?(s(),i(O,{key:0,command:"handleRun"},{default:e(()=>[p(" \u6267\u884C\u4E00\u6B21 ")]),_:1})):R("",!0),o(V)(["infra:job:query"])?(s(),i(O,{key:1,command:"openDetail"},{default:e(()=>[p(" \u4EFB\u52A1\u8BE6\u7EC6 ")]),_:1})):R("",!0),o(V)(["infra:job:query"])?(s(),i(O,{key:2,command:"handleJobLog"},{default:e(()=>[p(" \u8C03\u5EA6\u65E5\u5FD7 ")]),_:1})):R("",!0)]),_:1})]),default:e(()=>[a(u,{type:"primary",link:""},{default:e(()=>[a(w,{icon:"ep:d-arrow-right"}),p(" \u66F4\u591A")]),_:1})]),_:2},1032,["onCommand"])),[[g,["infra:job:trigger","infra:job:query"]]])]),_:1})]),_:1},8,["data"])),[[oa,o(C)]]),a(la,{total:o(T),page:o(n).pageNo,"onUpdate:page":r[5]||(r[5]=l=>o(n).pageNo=l),limit:o(n).pageSize,"onUpdate:limit":r[6]||(r[6]=l=>o(n).pageSize=l),onPagination:_},null,8,["total","page","limit"])]),_:1}),a(Ta,{ref_key:"formRef",ref:U,onSuccess:_},null,512),a(Aa,{ref_key:"detailRef",ref:F},null,512)],64)}}});export{Da as default};
