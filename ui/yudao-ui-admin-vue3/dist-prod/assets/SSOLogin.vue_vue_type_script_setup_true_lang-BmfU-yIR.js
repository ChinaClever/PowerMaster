import{r as L,d as A,T as J,u as M,e as b,f as x,g as N,a as n,aj as Q,s as R,I as B,o as u,c as m,k as l,w as i,j as D,l as S,F as E,p as G,ax as I,L as H,M as K,ay as P,O as W,A as X,Q as Y,n as Z,t as $,ae as ee}from"./index-mcOGIq4g.js";import{_ as se}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-CCF9NEtS.js";import{u as ae,L as T}from"./useLogin-BGuj3iei.js";const te={class:"form-cont"},oe={key:0},re={key:1},ne=A({name:"SSOLogin",__name:"SSOLogin",setup(le){const c=J(),{currentRoute:U}=M(),{getLoginState:C,setLoginState:V}=ae(),k=b({name:"",logo:""}),s=x({responseType:"",clientId:"",redirectUri:"",state:"",scopes:[]}),j=N(()=>n(C)===T.SSO),p=x({scopes:[]}),d=b(!1),z=async()=>{if(c.query.client_id===void 0)return;if(s.responseType=c.query.response_type,s.clientId=c.query.client_id,s.redirectUri=c.query.redirect_uri,s.state=c.query.state,c.query.scope&&(s.scopes=c.query.scope.split(" ")),s.scopes.length>0){const e=await q(!0,s.scopes,[]);if(e)return void(location.href=e)}const t=await(a=s.clientId,L.get({url:"/system/oauth2/authorize?clientId="+a}));var a;let o;if(k.value=t.client,s.scopes.length>0){o=[];for(const e of t.scopes)s.scopes.indexOf(e.key)>=0&&o.push(e)}else{o=t.scopes;for(const e of o)s.scopes.push(e.key)}for(const e of o)e.value&&p.scopes.push(e.key)},O=async t=>{let a,o;t?(a=p.scopes,o=s.scopes.filter(e=>a.indexOf(e)===-1)):(a=[],o=s.scopes),d.value=!0;try{const e=await q(!1,a,o);if(!e)return;location.href=e}finally{d.value=!1}},q=(t,a,o)=>((e,_,g,f,y,h,r)=>{const v={};for(const w of h)v[w]=!0;for(const w of r)v[w]=!1;return L.post({url:"/system/oauth2/authorize",headers:{"Content-type":"application/x-www-form-urlencoded"},params:{response_type:e,client_id:_,redirect_uri:g,state:f,auto_approve:y,scope:JSON.stringify(v)}})})(s.responseType,s.clientId,s.redirectUri,s.state,t,a,o),F=t=>{switch(t){case"user.read":return"\u8BBF\u95EE\u4F60\u7684\u4E2A\u4EBA\u4FE1\u606F";case"user.write":return"\u4FEE\u6539\u4F60\u7684\u4E2A\u4EBA\u4FE1\u606F";default:return t}};return Q(()=>U.value,t=>{t.name==="SSOLogin"&&(V(T.SSO),z())},{immediate:!0}),(t,a)=>{const o=H,e=K,_=ee,g=P,f=W,y=X,h=Y;return R((u(),m("div",te,[l(se,{style:{width:"100%"}}),l(e,{class:"form",style:{float:"none"},value:"uname"},{default:i(()=>[l(o,{label:n(k).name,name:"uname"},null,8,["label"])]),_:1}),D("div",null,[l(h,{model:n(p),class:"login-form"},{default:i(()=>[S(" \u6B64\u7B2C\u4E09\u65B9\u5E94\u7528\u8BF7\u6C42\u83B7\u5F97\u4EE5\u4E0B\u6743\u9650\uFF1A "),l(f,{prop:"scopes"},{default:i(()=>[l(g,{modelValue:n(p).scopes,"onUpdate:modelValue":a[0]||(a[0]=r=>n(p).scopes=r)},{default:i(()=>[(u(!0),m(E,null,G(n(s).scopes,r=>(u(),Z(_,{key:r,label:r,style:{display:"block","margin-bottom":"-10px"}},{default:i(()=>[S($(F(r)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{class:"w-1/1"},{default:i(()=>[l(y,{loading:n(d),class:"w-6/10",type:"primary",onClick:a[1]||(a[1]=I(r=>O(!0),["prevent"]))},{default:i(()=>[n(d)?(u(),m("span",re,"\u6388 \u6743 \u4E2D...")):(u(),m("span",oe,"\u540C\u610F\u6388\u6743"))]),_:1},8,["loading"]),l(y,{class:"w-3/10",onClick:a[2]||(a[2]=I(r=>O(!1),["prevent"]))},{default:i(()=>[S("\u62D2\u7EDD")]),_:1})]),_:1})]),_:1},8,["model"])])],512)),[[B,n(j)]])}}});export{ne as _};
