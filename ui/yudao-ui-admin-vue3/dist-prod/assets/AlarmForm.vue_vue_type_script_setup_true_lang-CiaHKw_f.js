import{_ as L}from"./Dialog.vue_vue_type_style_index_0_lang-BHwm1lq5.js";import{d as M,x as O,e as w,o as p,n as c,w as i,k as o,l as y,a as l,q as h,t as P,m as S,D as q,Z as F,ba as G,A as Z,G as $}from"./index-mcOGIq4g.js";import{A as _}from"./index-D7J3j60l.js";import{u as z}from"./useMessage-CGTQbR_M.js";const B=M({__name:"AlarmForm",emits:["success"],setup(H,{expose:U,emit:C}){O();const g=z();w("");const d=w(""),b=w(!1),D=w(""),f=w(!1),u=w(""),n=w([]),k={id:"",isEnable:0,updateTime:"",createTime:""};U({open:async v=>{d.value="",n.value=[],b.value=!0,D.value=v=="phone"?"\u624B\u673A\u914D\u7F6E":"\u90AE\u7BB1\u914D\u7F6E",u.value=v;try{f.value=!0;let m=null;m=v=="mail"?await _.getMailList({}):await _.getPhoneList({}),n.value=m,v=="mail"?n.value.push({...k,mail:"",mailDesc:""}):n.value.push({...k,phone:"",smsDesc:""})}finally{f.value=!1}}});const E=C,x=async()=>{f.value=!0;const v=n.value.pop();try{let m=null;m=u.value=="mail"?await _.saveMailConfig(n.value.map(a=>{const r={mail:a.mail,isEnable:a.isEnable,mailDesc:a.mailDesc};return String(a.id).indexOf("\u4E34\u65F6")<0&&(r.id=a.id),r})):await _.savePhoneConfig(n.value.map(a=>{const r={phone:a.phone,isEnable:a.isEnable,smsDesc:a.smsDesc};return String(a.id).indexOf("\u4E34\u65F6")<0&&(r.id=a.id),r})),b.value=!1,g.success("\u914D\u7F6E\u6210\u529F"),E("success")}catch{n.value.push(v)}finally{f.value=!1}};return(v,m)=>{const a=q,r=F,T=G,V=Z,A=$,j=L;return p(),c(j,{modelValue:l(b),"onUpdate:modelValue":m[1]||(m[1]=e=>S(b)?b.value=e:null),title:l(D),width:"80%"},{footer:i(()=>[o(V,{onClick:m[0]||(m[0]=e=>b.value=!1)},{default:i(()=>[y("\u53D6 \u6D88")]),_:1}),o(V,{disabled:l(f),type:"primary",onClick:x},{default:i(()=>[y("\u786E \u5B9A")]),_:1},8,["disabled"])]),default:i(()=>[o(A,{data:l(n),style:{width:"100%"}},{default:i(()=>[o(a,{prop:"id",label:"\u7F16\u53F7",width:"135",align:"center"}),l(u)=="mail"?(p(),c(a,{key:0,prop:"mail",label:"\u90AE\u7BB1","min-width":"120",align:"center"},{default:i(e=>[o(r,{disabled:e.row.id!=l(d),modelValue:e.row.mail,"onUpdate:modelValue":t=>e.row.mail=t},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:1})):h("",!0),l(u)=="phone"?(p(),c(a,{key:1,prop:"phone",label:"\u624B\u673A\u53F7","min-width":"120",align:"center"},{default:i(e=>[o(r,{disabled:e.row.id!=l(d),modelValue:e.row.phone,"onUpdate:modelValue":t=>e.row.phone=t},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:1})):h("",!0),o(a,{prop:"isEnable",label:"\u662F\u5426\u53EF\u7528","min-width":"100",align:"center"},{default:i(e=>[o(T,{disabled:e.row.id!=l(d),modelValue:e.row.isEnable,"onUpdate:modelValue":t=>e.row.isEnable=t,"active-value":1,"inactive-value":0},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:1}),l(u)=="mail"?(p(),c(a,{key:2,prop:"mailDesc",label:"\u63CF\u8FF0","min-width":"120",align:"center"},{default:i(e=>[o(r,{disabled:e.row.id!=l(d),modelValue:e.row.mailDesc,"onUpdate:modelValue":t=>e.row.mailDesc=t},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:1})):h("",!0),l(u)=="phone"?(p(),c(a,{key:3,prop:"smsDesc",label:"\u63CF\u8FF0","min-width":"120",align:"center"},{default:i(e=>[o(r,{disabled:e.row.id!=l(d),modelValue:e.row.smsDesc,"onUpdate:modelValue":t=>e.row.smsDesc=t},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:1})):h("",!0),o(a,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"100",align:"center"}),o(a,{prop:"updateTime",label:"\u66F4\u65B0\u65F6\u95F4","min-width":"100",align:"center"}),o(a,{label:"\u64CD\u4F5C","min-width":"100",align:"center"},{default:i(e=>[e.row.id!=l(d)?(p(),c(V,{key:0,link:"",type:"primary",onClick:t=>{return s=e.row,void(d.value=s.id);var s}},{default:i(()=>[y("\u7F16\u8F91")]),_:2},1032,["onClick"])):h("",!0),e.row.id!=l(d)?(p(),c(V,{key:1,link:"",type:"primary",onClick:t=>{return s=e.$index,void n.value.splice(s,1);var s}},{default:i(()=>[y("\u5220\u9664")]),_:2},1032,["onClick"])):h("",!0),e.row.id==l(d)?(p(),c(V,{key:2,link:"",type:"primary",onClick:t=>{return s=e.row,void(u.value=="mail"&&!s.mail||u.value=="phone"&&!s.phone?g.error("\u8BF7\u586B\u5199"+(u.value=="mail"?"\u90AE\u7BB1":"\u624B\u673A\u53F7")):(d.value="",s.id==""&&(u.value=="mail"?n.value.push({...k,mail:""}):n.value.push({...k,phone:""}),s.id=new Date().getTime()+"(\u4E34\u65F6\u7F16\u53F7)")));var s}},{default:i(()=>[y(P(l(d)==""?"\u6DFB\u52A0":"\u786E\u8BA4"),1)]),_:2},1032,["onClick"])):h("",!0)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])}}});export{B as _};
