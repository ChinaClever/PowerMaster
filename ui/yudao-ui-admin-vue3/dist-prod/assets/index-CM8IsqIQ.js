import{r as O,d as ye,u as we,e as i,an as be,f as ke,aj as De,g as Me,aX as I,h as _e,o as g,n as k,w as o,l as y,k as d,a as r,m as Ye,s as X,aY as E,t as B,c as C,F as T,p as G,q as K,j as s,aZ as U,P as Ie,O as Ce,_ as Te,A as Ne,Q as Ae,D as ze,G as Re,R as Se,J as We,K as Fe}from"./index-mcOGIq4g.js";import{_ as Ee}from"./CommonMenu-CxUjeIT-.js";import{_ as Ue}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Pe}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as je}from"./download--D_IyRio.js";import{E as Le}from"./index-D85m9HA9.js";import{f as Q,g as Ve,c as Z,e as qe}from"./formatTime-f-_athMZ.js";import{I as He}from"./index-DA5JCs6I.js";import"./index-KYPw-eK3.js";import{u as Je}from"./useMessage-CGTQbR_M.js";import{i as Oe}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as Xe}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const Be=async v=>await O.post({url:"/room/index/eleTotalRealtime",data:v}),Ge=async(v,N)=>await O.downloadPost({url:"/room/index/eleTotalRealtimeExcel",data:v,...N}),f=v=>(We("data-v-f84a65f1"),v=v(),Fe(),v),Ke=f(()=>s("br",null,null,-1)),Qe=f(()=>s("br",null,null,-1)),Ze=f(()=>s("div",{class:"nav_data"},[s("div",{class:"descriptions-container",style:{"font-size":"14px"}},[s("div",{class:"description-item"},[s("span",{class:"label"},"\u6309\u65F6\u95F4\u8303\u56F4\u67E5\u8BE2\u5B9E\u65F6\u80FD\u8017")])])],-1)),$e=f(()=>s("tr",null,[s("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[s("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ea={class:"realTotal"},aa=f(()=>s("br",null,null,-1)),ta=f(()=>s("br",null,null,-1)),la=f(()=>s("br",null,null,-1)),na=f(()=>s("br",null,null,-1)),ra=Xe(ye({name:"PowerAnalysis",__name:"index",setup(v){const N=Je(),{push:$}=we(),P=i([]),ee=i(0),ae=i(0),te=i(0),j=be(),D=i(!1),m=i([]),w=i(0),L=i(0),u=i([]),n=ke({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,roomIds:[]}),le=i([15,30,50,100]),ne=i(),A=i(!1),re=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],oe=a=>{const e=(a-1)*n.pageSize+1,t=a*n.pageSize,b=[];for(let x=e;x<=t;x++)b.push("\u5E8F\u53F7"+x);return b},z=i(null);let c=null;const V=i([]);window.addEventListener("resize",function(){c==null||c.resize()}),De(()=>n.granularity,()=>{S()});const ie=i([{label:"\u4F4D\u7F6E",align:"center",prop:"name",istrue:!0,width:"180px"},{label:"\u5F00\u59CB\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"eleActiveStart",istrue:!0,formatter:h},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"createTimeMin",formatter:H,width:"150px",istrue:!0}]},{label:"\u7ED3\u675F\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"eleActiveEnd",istrue:!0,formatter:h},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"createTimeMax",formatter:H,width:"150px",istrue:!0}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eleActive",istrue:!0,formatter:h},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),R=async()=>{D.value=!0;try{if(u.value!=null){const e=Q(Ve(Z(u.value[0]))),t=Q(qe(Z(u.value[1])));n.timeRange=[e,t]}if(u.value==null&&(n.timeRange=void 0),u.value==null)return void U({message:"\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4",type:"error",plain:!0});const a=await Be(n);V.value=a.list.map(e=>pe(e.eleActive,1)),m.value=a.list,L.value=a.total,a.total>1e4?w.value=1e4:w.value=a.total}finally{z.value&&j&&(c=Oe(z.value),c.setOption({title:{text:"\u5404\u673A\u623F\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:se},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:oe(n.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:V.value,label:{show:!0,position:"top"}}]}),c.on("click",function(a){W(m.value[a.dataIndex].roomId,m.value[a.dataIndex].createTimeMin,m.value[a.dataIndex].createTimeMax)}),j.appContext.config.globalProperties.rankChart=c),D.value=!1}};function se(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+m.value[t.dataIndex].name+"<br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+q(null,null,m.value[t.dataIndex].createTimeMin)+"  \u5F00\u59CB\u7535\u80FD\uFF1A"+h(null,null,m.value[t.dataIndex].eleActiveStart)+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+q(null,null,m.value[t.dataIndex].createTimeMax)+"  \u7ED3\u675F\u7535\u80FD\uFF1A"+h(null,null,m.value[t.dataIndex].eleActiveEnd)+"kWh  <br/>"+t.marker+"\u8017\u7535\u91CF\uFF1A"+h(null,null,m.value[t.dataIndex].eleActive)+"kWh"}const ue=Me(()=>{const a=Math.ceil(w.value/n.pageSize);return n.pageNo===a&&w.value>=1e4});function q(a,e,t){return t?I(t).format("YYYY-MM-DD"):""}function H(a,e,t){return t?I(t).format("YYYY-MM-DD"):""}function h(a,e,t){return t==null?"":Number(t).toFixed(1)}const pe=(a,e)=>isNaN(a)?null:Number(a).toFixed(e),de=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},S=()=>{n.pageNo=1,R()},me=async a=>{let e=[];a.forEach(t=>{e.push(t.id)}),e.length==0&&a.length!=0&&(e.push(0),c==null||c.clear(),U({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),n.roomIds=e,S()},ce=async()=>{try{await N.exportConfirm(),n.pageNo=1,A.value=!0;const a={timeout:0},e=await Ge(n,a);await je.excel(e,"\u673A\u623F\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{A.value=!1}},W=(a,e,t)=>{u.value!=null&&u.value.length!=0||U({message:"\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4",type:"error",plain:!0}),$("/room/energyConsumption/powerAnalysis?type=total&granularity=day&start="+e+"&end="+t+"&roomId="+a+"&startTime="+u.value[0]+"&endTime="+u.value[1])};_e(()=>{(async()=>{const a=await He.getRoomList();P.value=a.map(e=>({id:e.id,name:e.roomName,children:[]}))})(),(async()=>{const a=await Le.getNavNewData({});ee.value=a.day,ae.value=a.week,te.value=a.month})()});let F=new Date;return u.value=[I(new Date(F.getFullYear(),F.getMonth(),1)).format("YYYY-MM-DD"),I(F).format("YYYY-MM-DD")],R(),(a,e)=>{const t=Ie,b=Ce,x=Te,M=Ne,ge=Ae,_=ze,ve=Re,fe=Pe,he=Ue,xe=Ee,J=Se;return g(),k(xe,{dataList:r(P),onCheck:me,navTitle:"\u673A\u623F\u80FD\u8017\u8D8B\u52BF"},{NavInfo:o(()=>[Ke,y(),Qe,Ze]),ActionBar:o(()=>[d(ge,{class:"-mb-15px",model:r(n),ref_key:"queryFormRef",ref:ne,inline:!0,"label-width":"auto"},{default:o(()=>[d(b,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[d(t,{"value-format":"YYYY-MM-DD",modelValue:r(u),"onUpdate:modelValue":e[0]||(e[0]=l=>Ye(u)?u.value=l:null),type:"daterange",shortcuts:re,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":de},null,8,["modelValue"])]),_:1}),d(b,null,{default:o(()=>[d(M,{onClick:S},{default:o(()=>[d(x,{icon:"ep:search",class:"mr-5px"}),y(" \u641C\u7D22")]),_:1}),d(M,{type:"success",plain:"",loading:r(A),onClick:ce},{default:o(()=>[d(x,{icon:"ep:download",class:"mr-5px"}),y(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:o(()=>[X((g(),k(ve,{data:r(m),stripe:!0,"show-overflow-tooltip":!0},E({default:o(()=>[d(_,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:o(({$index:l})=>[y(B(l+1+(r(n).pageNo-1)*r(n).pageSize),1)]),_:1}),(g(!0),C(T,null,G(r(ie),l=>(g(),C(T,{key:l.label},[!l.children&&l.istrue?(g(),k(_,{key:l.prop,label:l.label,align:l.align,prop:l.prop,formatter:l.formatter,width:l.width},E({_:2},[l.slot==="actions"?{name:"default",fn:o(({row:p})=>[d(M,{link:"",type:"primary",onClick:Y=>W(p.roomId,p.createTimeMin,p.createTimeMax)},{default:o(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):l.istrue?(g(),k(_,{key:1,label:l.label,align:l.align},{default:o(()=>[(g(!0),C(T,null,G(l.children,p=>(g(),C(T,{key:p.prop},[p.istrue?(g(),k(_,{key:p.prop,label:p.label,align:p.align,prop:p.prop,formatter:p.formatter,width:p.width},E({_:2},[p.slot==="actions"?{name:"default",fn:o(({row:Y})=>[d(M,{link:"",type:"primary",onClick:oa=>W(Y.roomId,Y.createTimeMin,Y.createTimeMax)},{default:o(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):K("",!0)],64))),128))]),_:2},1032,["label","align"])):K("",!0)],64))),128))]),_:2},[r(ue)?{name:"append",fn:o(()=>[$e]),key:"0"}:void 0]),1032,["data"])),[[J,r(D)]]),d(fe,{total:r(w),"page-size-arr":r(le),layout:"sizes, prev, pager, next, jumper",page:r(n).pageNo,"onUpdate:page":e[1]||(e[1]=l=>r(n).pageNo=l),limit:r(n).pageSize,"onUpdate:limit":e[2]||(e[2]=l=>r(n).pageSize=l),onPagination:R},null,8,["total","page-size-arr","page","limit"]),s("div",ea,"\u5171 "+B(r(L))+" \u6761",1),aa,ta,la,na,d(he,null,{default:o(()=>[X(s("div",{ref_key:"rankChartContainer",ref:z,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[J,r(D)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-f84a65f1"]]);export{ra as default};
