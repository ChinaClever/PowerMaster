import{d as da,u as fa,e as s,f as ba,aj as wa,g as xa,aX as ha,h as ya,o as m,n as A,w as i,l as h,j as p,t as U,a as l,c as y,q as V,k as o,m as J,s as ka,aY as K,F as O,p as Da,aZ as Na,S as Va,N as Ma,O as Sa,P as za,c5 as Ca,_ as Ya,A as Ha,Q as Aa,D as Ua,G as Wa,R as Fa,J as Ia,K as Pa}from"./index-mcOGIq4g.js";import{_ as Ra}from"./CommonMenu-CxUjeIT-.js";import{_ as $a}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as ja}from"./download--D_IyRio.js";import{H as W}from"./index-1a85tQeY.js";import{C as La}from"./index-JEsRnusb.js";import{f as Q,e as X,c as Z}from"./formatTime-f-_athMZ.js";import{u as Ea}from"./useMessage-CGTQbR_M.js";import{_ as Ta}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const v=k=>(Ia("data-v-03034365"),k=k(),Pa(),k),qa=v(()=>p("br",null,null,-1)),Ba=v(()=>p("br",null,null,-1)),Ga={class:"nav_data"},Ja={class:"descriptions-container",style:{"font-size":"14px"}},Ka={class:"description-item"},Oa=v(()=>p("span",{class:"label"},"\u603B\u6570\u636E :",-1)),Qa={class:"value"},Xa={style:{"text-align":"center"}},Za={key:0,style:{"text-align":"center"}},ae=[v(()=>p("span",null,"\u5168\u90E8PDU\u6700\u8FD1\u4E00\u5206\u949F\u65B0\u589E\u8BB0\u5F55",-1))],ee={key:1,style:{"text-align":"center"}},te=[v(()=>p("span",null,"\u5168\u90E8PDU\u6700\u8FD1\u4E00\u5C0F\u65F6\u65B0\u589E\u8BB0\u5F55",-1))],le={key:2,style:{"text-align":"center"}},re=[v(()=>p("span",null,"\u5168\u90E8PDU\u6700\u8FD1\u4E00\u5929\u65B0\u589E\u8BB0\u5F55",-1))],ne=v(()=>p("div",{class:"line",style:{"margin-top":"10px"}},null,-1)),oe=v(()=>p("tr",null,[p("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[p("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ie={class:"realTotal"},pe=Ta(da({name:"CabinetHistoryData",__name:"index",setup(k){const{push:aa}=fa(),F=s([]),I=s(0),ea=Ea(),M=s(!0),P=s([]),f=s(0),R=s(0),ta=s([15,30,50,100]),t=ba({pageNo:1,pageSize:15,granularity:"realtime",timeRange:void 0,rackIds:[]}),la=s(),S=s(!1),_=s(void 0),ra=[{text:"\u6700\u8FD1\u4E00\u5C0F\u65F6",value:()=>{const e=new Date,a=new Date;return a.setHours(a.getHours()-1),[a,e]}},{text:"\u6700\u8FD1\u4E00\u5929",value:()=>{const e=new Date,a=new Date;return a.setDate(a.getDate()-1),[a,e]}},{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const e=new Date,a=new Date;return a.setDate(a.getDate()-7),[a,e]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const e=new Date,a=new Date;return a.setMonth(a.getMonth()-1),[a,e]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const e=new Date,a=new Date;return a.setMonth(a.getMonth()-6),[a,e]}}],na={multiple:!0},b=s([["active_total"],["apparent_total"]]),z=s([{value:"active_total",label:"\u6709\u529F\u529F\u7387"},{value:"apparent_total",label:"\u89C6\u5728\u529F\u7387"}]),C=s(["active_total","apparent_total"]),oa=e=>{let a=e.map(u=>u[u.length-1]),n=C.value.filter(u=>!a.includes(u));D.value.forEach(u=>{var d,N;for(const x of a)if((d=u.prop)!=null&&d.startsWith(x)){u.istrue=!0;break}for(const x of n)if((N=u.prop)!=null&&N.startsWith(x)){u.istrue=!1;break}})},ia=()=>{j()};wa(()=>t.granularity,e=>{e=="realtime"?(b.value=[["active_total"],["apparent_total"]],z.value=[{value:"active_total",label:"\u6709\u529F\u529F\u7387"},{value:"apparent_total",label:"\u89C6\u5728\u529F\u7387"}],C.value=["active_total","apparent_total"],D.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u673A\u67B6\u540D",align:"center",prop:"rack_name",istrue:!0},{label:"\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total",istrue:!0,formatter:c},{label:"\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total",istrue:!0,formatter:c},{label:"\u65F6\u95F4",align:"center",prop:"create_time",formatter:g,istrue:!0},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0}],t.pageNo=1,t.pageSize=15,w()):(b.value=[["active_pow","active_total_avg_value"],["active_pow","active_total_max"],["active_pow","active_total_min"],["apparent_pow","apparent_total_avg_value"],["apparent_pow","apparent_total_max"],["apparent_pow","apparent_total_min"]],z.value=[{value:"active_pow",label:"\u6709\u529F\u529F\u7387",children:[{value:"active_total_avg_value",label:"\u5E73\u5747\u6709\u529F\u529F\u7387"},{value:"active_total_max",label:"\u6700\u5927\u6709\u529F\u529F\u7387"},{value:"active_total_min",label:"\u6700\u5C0F\u6709\u529F\u529F\u7387"}]},{value:"apparent_pow",label:"\u89C6\u5728\u529F\u7387",children:[{value:"apparent_total_avg_value",label:"\u5E73\u5747\u89C6\u5728\u529F\u7387"},{value:"apparent_total_max",label:"\u6700\u5927\u89C6\u5728\u529F\u7387"},{value:"apparent_total_min",label:"\u6700\u5C0F\u89C6\u5728\u529F\u7387"}]}],C.value=["active_total_avg_value","active_total_max","active_total_min","apparent_total_avg_value","apparent_total_max","apparent_total_min"],D.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",width:"160px",istrue:!0},{label:"\u673A\u67B6\u540D",align:"center",prop:"rack_name",width:"160px",istrue:!0},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",width:"230px",formatter:g,istrue:!0},{label:"\u5E73\u5747\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total_avg_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u5927\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total_max_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u5927\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_total_max_time",formatter:g,width:"200px",istrue:!0},{label:"\u6700\u5C0F\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total_min_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u5C0F\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_total_min_time",formatter:g,width:"200px",istrue:!0},{label:"\u5E73\u5747\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total_avg_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u5927\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total_max_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u5927\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_total_max_time",formatter:g,width:"200px",istrue:!0},{label:"\u6700\u5C0F\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total_min_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u5C0F\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_total_min_time",formatter:g,width:"200px",istrue:!0},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0}],t.pageNo=1,t.pageSize=15,w())});const D=s([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u673A\u67B6\u540D",align:"center",prop:"rack_name",istrue:!0},{label:"\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total",istrue:!0,formatter:c},{label:"\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total",istrue:!0,formatter:c},{label:"\u65F6\u95F4",align:"center",prop:"create_time",formatter:g,istrue:!0},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0}]),w=async()=>{M.value=!0;try{if(_.value!=null){const a=Q(X(Z(_.value[0]))),n=Q(X(Z(_.value[1])));_.value=[a,n],t.timeRange=[a,n]}const e=await W.getHistoryDataPage(t);P.value=e.list,R.value=e.total,e.total>1e4?f.value=1e4:f.value=e.total}finally{M.value=!1}};function c(e,a,n){return Number(n).toFixed(3)}const pa=xa(()=>{const e=Math.ceil(f.value/t.pageSize);return t.pageNo===e&&f.value>=1e4}),$=()=>{t.pageNo=1,w()},sa=async e=>{let a=[];e.forEach(n=>{n.type==5&&a.push(n.id)}),a.length==0&&e.length!=0&&(a.push(0),Na({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),t.rackIds=a,$()},j=async()=>{const e=await W.getNavNewData(t.granularity);I.value=e.total};function g(e,a,n){return n?ha(n).format("YYYY-MM-DD HH:mm"):""}const ua=async()=>{try{await ea.exportConfirm(),t.pageNo=1,S.value=!0;const e={timeout:0},a=await W.exportHistoryData(t,e);await ja.excel(a,"\u673A\u67B6\u7535\u529B\u5386\u53F2\u6570\u636E.xlsx")}catch{}finally{S.value=!1}},L=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return ya(()=>{const e=new Date,a=new Date(e.getFullYear(),e.getMonth(),1);_.value=[L(a),L(e)],(async()=>{const n=await La.getRackMenuAll({});F.value=n})(),j(),w()}),(e,a)=>{const n=Va,u=Ma,d=Sa,N=za,x=Ca,E=Ya,Y=Ha,ca=Aa,T=Ua,_a=Wa,ma=$a,va=Ra,ga=Fa;return m(),A(va,{dataList:l(F),onCheck:sa,navTitle:"\u673A\u67B6\u7535\u529B\u6570\u636E"},{NavInfo:i(()=>[qa,h(),Ba,p("div",Ga,[p("div",Ja,[p("div",Ka,[Oa,p("span",Qa,U(l(I))+"\u6761",1)]),p("div",Xa,[l(t).granularity=="realtime"?(m(),y("div",Za,ae)):V("",!0),l(t).granularity=="hour"?(m(),y("div",ee,te)):V("",!0),l(t).granularity=="day"?(m(),y("div",le,re)):V("",!0),ne])])])]),ActionBar:i(()=>[o(ca,{class:"-mb-15px",model:l(t),ref_key:"queryFormRef",ref:la,inline:!0,"label-width":"80px"},{default:i(()=>[o(d,{label:"\u9897\u7C92\u5EA6",prop:"type"},{default:i(()=>[o(u,{modelValue:l(t).granularity,"onUpdate:modelValue":a[0]||(a[0]=r=>l(t).granularity=r),onChange:ia,placeholder:"\u8BF7\u9009\u62E9\u5206\u949F/\u5C0F\u65F6/\u5929",class:"!w-120px"},{default:i(()=>[o(n,{label:"\u5206\u949F",value:"realtime"}),o(n,{label:"\u5C0F\u65F6",value:"hour"}),o(n,{label:"\u5929",value:"day"})]),_:1},8,["modelValue"])]),_:1}),o(d,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[o(N,{"value-format":"YYYY-MM-DD HH:mm:ss",modelValue:l(_),"onUpdate:modelValue":a[1]||(a[1]=r=>J(_)?_.value=r:null),type:"datetimerange",shortcuts:ra,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u7B5B\u9009\u5217"},{default:i(()=>[o(x,{modelValue:l(b),"onUpdate:modelValue":a[2]||(a[2]=r=>J(b)?b.value=r:null),options:l(z),props:na,"collapse-tags":"","collapse-tags-tooltip":"","show-all-levels":!1,onChange:oa,class:"!w-210px"},null,8,["modelValue","options"])]),_:1}),o(d,null,{default:i(()=>[o(Y,{onClick:$},{default:i(()=>[o(E,{icon:"ep:search",class:"mr-5px"}),h(" \u641C\u7D22")]),_:1}),o(Y,{type:"success",plain:"",onClick:ua,loading:l(S)},{default:i(()=>[o(E,{icon:"ep:download",class:"mr-5px"}),h(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:i(()=>[ka((m(),A(_a,{data:l(P),stripe:!0,"show-overflow-tooltip":!0,border:!0},K({default:i(()=>[o(T,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:r})=>[h(U(r+1+(l(t).pageNo-1)*l(t).pageSize),1)]),_:1}),(m(!0),y(O,null,Da(l(D),r=>(m(),y(O,null,[r.istrue?(m(),A(T,{key:r.prop,label:r.label,align:r.align,prop:r.prop,formatter:r.formatter,width:r.width},K({_:2},[r.slot==="actions"?{name:"default",fn:i(({row:H})=>[o(Y,{link:"",type:"primary",onClick:se=>{return q=H.rack_id,B=H.location,G=H.rack_name,void aa("/u/record/historyLine?rackId="+q+"&location="+(B+="-"+G));var q,B,G}},{default:i(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):V("",!0)],64))),256))]),_:2},[l(pa)?{name:"append",fn:i(()=>[oe]),key:"0"}:void 0]),1032,["data"])),[[ga,l(M)]]),o(ma,{total:l(f),"page-size-arr":l(ta),layout:"sizes, prev, pager, next, jumper",page:l(t).pageNo,"onUpdate:page":a[3]||(a[3]=r=>l(t).pageNo=r),limit:l(t).pageSize,"onUpdate:limit":a[4]||(a[4]=r=>l(t).pageSize=r),onPagination:w},null,8,["total","page-size-arr","page","limit"]),p("div",ie,"\u5171 "+U(l(R))+" \u6761",1)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-03034365"]]);export{pe as default};
