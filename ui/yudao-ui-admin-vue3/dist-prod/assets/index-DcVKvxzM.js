import{d as Le,e as d,f as ve,aj as Ee,x as Me,h as Ye,b2 as Oe,dc as He,b3 as Re,U as je,o as c,n as f,w as n,j as s,t as y,a as l,l as u,k as r,s as M,a0 as G,c as b,F as Y,p as ye,ax as ge,q as g,I as qe,v as O,m as Xe,O as Ze,c4 as Je,_ as Ge,A as Qe,Q as We,D as $e,G as ea,bX as aa,P as la,B as ta,R as oa,J as sa,K as na}from"./index-mcOGIq4g.js";import{_ as ia}from"./CommonMenu-CxUjeIT-.js";import{E as ra}from"./el-empty-Bl_qCsZJ.js";import{_ as ca}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{E as ua}from"./el-text-BVz5ES0N.js";import{_ as da}from"./temicon-CvpAblBE.js";import{d as fe}from"./download--D_IyRio.js";import{I as C}from"./index-B_LT3qVv.js";import{B as pa}from"./index-D8rWpymm.js";import{_ as ma}from"./TemDetail.vue_vue_type_script_setup_true_lang-Cyif3-d_.js";import{u as va}from"./useMessage-CGTQbR_M.js";import{_ as ya}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";import"./Echart.vue_vue_type_script_setup_true_lang-NDPlWfCz.js";import"./installCanvasRenderer-WHaFMoQ9.js";import"./index-KYPw-eK3.js";import"./install-DiAPpr4Z.js";const A=P=>(sa("data-v-169544f5"),P=P(),na(),P),ga={class:"status"},fa={class:"box"},ba=A(()=>s("div",{class:"top"},[s("div",{class:"tag"}),u("\u6B63\u5E38")],-1)),xa={class:"value"},wa={class:"number"},ha={class:"box"},ka=A(()=>s("div",{class:"top"},[s("div",{class:"tag empty"}),u("\u79BB\u7EBF")],-1)),Ca={class:"value"},_a={class:"number"},Aa={class:"box"},Da=A(()=>s("div",{class:"top"},[s("div",{class:"tag error"}),u("\u544A\u8B66")],-1)),Va={class:"value"},Ia={class:"number"},Sa={class:"box"},Na=A(()=>s("div",{class:"top"}," \u603B\u5171",-1)),Fa={class:"value"},Ta={class:"number"},Ba=A(()=>s("div",{class:"line"},null,-1)),Ka=["onClick"],Pa=["onClick"],Ua={style:{float:"right"}},za={key:0},La={key:1,class:"arrayContainer"},Ea={key:0,class:"arrayItem"},Ma={class:"devKey"},Ya={class:"content"},Oa=A(()=>s("img",{class:"icon",src:da},null,-1)),Ha={class:"info flex-container"},Ra={class:"flex-row"},ja={class:"flex-row"},qa={key:0,class:"status"},Xa=["onClick"],Za={class:"custom-row",style:{display:"flex","align-items":"center"}},Ja={class:"location-tag el-col"},Ga=A(()=>s("span",{style:{"margin-right":"10px","font-size":"18px","font-weight":"bold"}},"\u6E29\u5EA6\u8BE6\u60C5",-1)),Qa={class:"date-picker-col el-col"},Wa={class:"chart-data-buttons el-col",style:{"margin-right":"50px"}},$a={class:"button-group"},el=A(()=>s("i",{class:"el-icon-download"},null,-1)),al=A(()=>s("br",null,null,-1)),ll={key:1,style:{width:"100%",height:"70vh","overflow-y":"auto"}},tl=Le({name:"PDUDevice",__name:"index",setup(P){var de;const Q=d(),W=d(),$=d(),ee=d(),ae=d(),U=d(!1),be=d(),D=d(),le=d(!0),H=d([24,36,48,96]),V=d(0),N=d(0),F=d(0),S=d(0),z=d(-1),B=d([]),xe=ve([{name:"\u79BB\u7EBF",selected:!0,value:0,cssClass:"btn_offline",activeClass:"btn_offline offline"},{name:"\u6B63\u5E38",selected:!0,value:1,cssClass:"btn_normal",activeClass:"btn_normal normal",color:"#3bbb00"},{name:"\u544A\u8B66",selected:!0,value:2,cssClass:"btn_error",activeClass:"btn_error error",color:"#fa3333"}]),R=d([]),te=a=>{S.value=1,z.value=a,i.status=[a],K()},we=()=>{S.value=0,z.value=-1,i.status=[],K()},he=async(a,t)=>{if(a.length>7){var o=await C.boxFindKeys({key:a});let p=[];o.map(v=>{p.push({value:v})}),t(p)}else t(a?R.value.filter(ke(a)):R.value)},ke=a=>t=>t.value.toLowerCase().indexOf(a.toLowerCase())===0,Ce=a=>{},_e=async a=>{if(a.length==0)return i.boxDevKeyList=null,void _();const t=[];var o=!1;a.forEach(p=>{p.type==7&&(t.push(p.unique),o=!0)}),i.boxDevKeyList=o?t:[-1],_()},L=async a=>{i.boxId=a.boxId,i.oldTime=Ae(new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate(),0,0,0)),Q.value=a.location?a.location:"\u672A\u7ED1\u5B9A",W.value=a.roomName,ee.value=a.busName,ae.value=a.boxName,$.value=a.devKey,await re(),U.value=!0},oe=async()=>{i!=null&&i.oldTime&&await re()},Ae=a=>{var t=a.getFullYear(),o=a.getMonth(),p=a.getDate(),v=a.getHours(),m=a.getMinutes(),h=a.getSeconds();return t+"-"+(o+1>9?o+1:"0"+(o+1))+"-"+(p>9?p:"0"+p)+" "+(v>9?v:"0"+v)+":"+(m>9?m:"0"+m)+":"+(h>9?h:"0"+h)},se=d([]),De=d(""),Ve=d();Ee(De,a=>{Ve.value.filter(a)});const E=va(),{t:Ie}=Me(),j=d(!1),ne=d([]),q=d([]),I=d([{id:null,status:null,apparentPow:null,pow:null,ele:null,devKey:null,location:null,dataUpdateTime:"",pduAlarm:"",pf:null,atem:null,btem:null,ctem:null,temUnbalance:null}]),X=d(0),i=ve({pageNo:1,pageSize:24,devKey:(de=history==null?void 0:history.state)==null?void 0:de.devKey,createTime:[],cascadeNum:void 0,serverRoomData:void 0,status:[],cabinetIds:[]}),ie=d(),T=d(!1),re=async()=>{var t;const a=await C.getBoxTemDetail(i);ne.value=a==null?void 0:a.chart,q.value=a==null?void 0:a.table,(t=q.value)==null||t.forEach(o=>{var p,v,m,h;o.temAvgValueA=(p=o==null?void 0:o.temAvgValueA)==null?void 0:p.toFixed(0),o.temAvgValueB=(v=o==null?void 0:o.temAvgValueB)==null?void 0:v.toFixed(0),o.temAvgValueC=(m=o==null?void 0:o.temAvgValueC)==null?void 0:m.toFixed(0),o.temAvgValueN=(h=o==null?void 0:o.temAvgValueN)==null?void 0:h.toFixed(0)})},_=async()=>{j.value=!0;try{const a=await C.getBoxTemPage(i),t=await C.getBoxIndexStatisticsAll();let o=a.list.map((p,v)=>{var h,x,k;const m=(i.pageNo-1)*i.pageSize+v+1;return{...p,tableId:m,atem:(h=p.atem)==null?void 0:h.toFixed(0),btem:(x=p.btem)==null?void 0:x.toFixed(0),ctem:(k=p.ctem)==null?void 0:k.toFixed(0)}});I.value=o,X.value=a.total,B.value=t}finally{j.value=!1}},ce=async()=>{try{const t=await C.getBoxTemPage(i);I.value=t.list;var a=0;I.value.forEach(o=>{var p,v,m,h;o.tableId=(i.pageNo-1)*i.pageSize+ ++a,(o==null?void 0:o.atem)!=null&&(o.atem=(p=o.atem)==null?void 0:p.toFixed(0),o.btem=(v=o.btem)==null?void 0:v.toFixed(0),o.ctem=(m=o.ctem)==null?void 0:m.toFixed(0),o.ntem=(h=o.ntem)==null?void 0:h.toFixed(0))}),X.value=t.total}catch{}},ue=async()=>{const a=await C.getBoxMenu();if(se.value=a,a&&a.length>0){const t=a[0],o=[];t.children.forEach(p=>{p.children.length>0&&p.children.forEach(v=>{o.push(v.id+"-"+v.type)})})}},K=()=>{i.pageNo=1,_()},Se=()=>{ie.value.resetFields(),S.value=0,i.status=[],z.value=-1,K()},Ne=async()=>{try{await E.exportConfirm(),i.pageNo=1,T.value=!0;const a={timeout:0},t=await C.getBoxTemDetailExcel(i,a);await fe.excel(t,"\u6E29\u5EA6\u8BE6\u7EC6.xlsx")}catch{}finally{T.value=!1}},Fe=async()=>{try{await E.exportConfirm(),T.value=!0;const a=await C.exportIndex(i);fe.excel(a,"PDU\u8BBE\u5907.xls")}catch{}finally{T.value=!1}};return Ye(async()=>{R.value=await(async()=>(await C.devKeyList()).map(a=>({value:a})))(),(async()=>{try{const a=await pa.getBoxIdAndLocation(i);a!=null?L(a):Q.value=null}finally{}})(),_(),ue(),D.value=setInterval(ce,5e3)}),Oe(()=>{D.value&&(clearInterval(D.value),D.value=null)}),He(()=>{D.value&&(clearInterval(D.value),D.value=null,le.value=!1)}),Re(()=>{_(),ue(),le.value||(D.value=setInterval(ce,5e3))}),(a,t)=>{const o=Ze,p=Je,v=Ge,m=Qe,h=We,x=$e,k=ua,pe=ea,Z=aa,Te=ca,Be=ra,Ke=la,Pe=ta,Ue=ia,me=je("hasPermi"),ze=oa;return c(),f(Ue,{onCheck:_e,onNodeClick:Ce,showSearch:!0,dataList:l(se),navTitle:"\u63D2\u63A5\u7BB1\u6E29\u5EA6"},{NavInfo:n(()=>[s("div",null,[s("div",ga,[s("div",fa,[ba,s("div",xa,[s("span",wa,y(l(B).normal),1),u("\u4E2A")])]),s("div",ha,[ka,s("div",Ca,[s("span",_a,y(l(B).offline),1),u("\u4E2A")])]),s("div",Aa,[Da,s("div",Va,[s("span",Ia,y(l(B).alarm),1),u("\u4E2A")])]),s("div",Sa,[Na,s("div",Fa,[s("span",Ta,y(l(B).total),1),u("\u4E2A")])])]),Ba])]),ActionBar:n(()=>[r(h,{class:"-mb-15px",model:l(i),ref_key:"queryFormRef",ref:ie,inline:!0,"label-width":"68px"},{default:n(()=>[M(r(o,null,{default:n(()=>[s("button",{class:G({btnallSelected:l(S)===0,btnallNotSelected:l(S)===1}),type:"button",onClick:we,style:{height:"34px"}}," \u5168\u90E8 ",2),(c(!0),b(Y,null,ye(l(xe),(e,w)=>(c(),b(Y,{key:w},[l(S)===0?(c(),b("button",{key:0,class:G([e.activeClass]),onClick:ge(J=>te(e.value),["prevent"])},y(e.name),11,Ka)):l(S)===1?(c(),b("button",{key:1,class:G([l(z)===e.value?e.activeClass:e.cssClass]),onClick:ge(J=>te(e.value),["prevent"])},y(e.name),11,Pa)):g("",!0)],64))),128))]),_:1},512),[[qe,l(F)!=3&&l(F)!=4]]),r(o,{label:"\u7F51\u7EDC\u5730\u5740",prop:"devKey"},{default:n(()=>[r(p,{modelValue:l(i).devKey,"onUpdate:modelValue":t[0]||(t[0]=e=>l(i).devKey=e),"fetch-suggestions":he,clearable:"",class:"!w-200px",placeholder:"\u8BF7\u8F93\u5165\u7F51\u7EDC\u5730\u5740",onSelect:K},null,8,["modelValue"]),r(o,{style:{"margin-left":"10px"}},{default:n(()=>[r(m,{onClick:K},{default:n(()=>[r(v,{icon:"ep:search",class:"mr-5px"}),u(" \u641C\u7D22")]),_:1}),r(m,{onClick:Se},{default:n(()=>[r(v,{icon:"ep:refresh",class:"mr-5px"}),u(" \u91CD\u7F6E")]),_:1}),M((c(),f(m,{type:"primary",plain:"",onClick:t[1]||(t[1]=e=>{return w="create",void be.value.open(w);var w})},{default:n(()=>[r(v,{icon:"ep:plus",class:"mr-5px"}),u(" \u65B0\u589E ")]),_:1})),[[me,["pdu:PDU-device:create"]]]),M((c(),f(m,{type:"success",plain:"",onClick:Fe,loading:l(T)},{default:n(()=>[r(v,{icon:"ep:download",class:"mr-5px"}),u(" \u5BFC\u51FA ")]),_:1},8,["loading"])),[[me,["pdu:PDU-device:export"]]])]),_:1})]),_:1}),s("div",Ua,[r(m,{onClick:t[2]||(t[2]=e=>{H.value=[24,36,48,96],l(i).pageSize=24,_(),V.value=0}),type:l(V)==0?"primary":""},{default:n(()=>[r(v,{icon:"ep:grid",style:{"margin-right":"4px"}}),u("\u9635\u5217\u6A21\u5F0F")]),_:1},8,["type"]),r(m,{onClick:t[3]||(t[3]=e=>{H.value=[15,25,30,50,100],l(i).pageSize=15,_(),V.value=3}),type:l(V)==3?"primary":""},{default:n(()=>[r(v,{icon:"ep:expand",style:{"margin-right":"4px"}}),u("\u8868\u683C\u6A21\u5F0F")]),_:1},8,["type"])])]),_:1},8,["model"])]),Content:n(()=>[l(V)!==0&&l(I).length>0?(c(),b("div",za,[l(V)==3?M((c(),f(pe,{key:0,style:{"margin-top":"-10px",height:"720px","overflow-y":"auto"},data:l(I),"show-overflow-tooltip":!0,onCellDblclick:L,border:!0},{default:n(()=>[r(x,{label:"\u7F16\u53F7",align:"center",prop:"tableId",width:"80px"}),r(x,{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location"}),r(x,{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"devKey",width:"250px"}),l(F)==0?(c(),f(x,{key:0,label:"A\u76F8\u6E29\u5EA6(\xB0C)",align:"center",prop:"atem",width:"130px"},{default:n(e=>[e.row.atem!=null?(c(),f(k,{key:0,"line-clamp":"2",type:e.row.atemStatus!=0?"danger":""},{default:n(()=>[u(y(e.row.atem),1)]),_:2},1032,["type"])):g("",!0)]),_:1})):g("",!0),l(F)==0?(c(),f(x,{key:1,label:"B\u76F8\u6E29\u5EA6(\xB0C)",align:"center",prop:"btem",width:"130px"},{default:n(e=>[e.row.btem!=null?(c(),f(k,{key:0,"line-clamp":"2",type:e.row.btemStatus!=0?"danger":""},{default:n(()=>[u(y(e.row.btem),1)]),_:2},1032,["type"])):g("",!0)]),_:1})):g("",!0),l(F)==0?(c(),f(x,{key:2,label:"C\u76F8\u6E29\u5EA6(\xB0C)",align:"center",prop:"ctem",width:"130px"},{default:n(e=>[e.row.ctem!=null?(c(),f(k,{key:0,"line-clamp":"2",type:e.row.ctemStatus!=0?"danger":""},{default:n(()=>[u(y(e.row.ctem),1)]),_:2},1032,["type"])):g("",!0)]),_:1})):g("",!0),r(x,{label:"\u64CD\u4F5C",align:"center",width:"130px"},{default:n(e=>[e.row.status!=null&&e.row.status!=0?(c(),f(m,{key:0,link:"",type:"primary",onClick:w=>L(e.row),style:{"background-color":"#409EFF",color:"#fff",border:"none",width:"100px",height:"30px"}},{default:n(()=>[u(" \u8BBE\u5907\u8BE6\u60C5 ")]),_:2},1032,["onClick"])):g("",!0),e.row.status==0?(c(),f(m,{key:1,link:"",type:"danger",onClick:w=>(async J=>{try{await E.delConfirm(),await C.deleteIndex(J),E.success(Ie("common.delSuccess")),await _()}catch{}})(e.row.boxId),style:{"background-color":"#fa3333",color:"#fff",border:"none",width:"60px",height:"30px"}},{default:n(()=>[u(" \u5220\u9664 ")]),_:2},1032,["onClick"])):g("",!0)]),_:1})]),_:1},8,["data"])),[[ze,l(j)]]):g("",!0)])):l(V)==0&&l(I).length>0?(c(),b("div",La,[(c(!0),b(Y,null,ye(l(I),e=>(c(),b(Y,{key:e.devKey},[e.devKey!==null?(c(),b("div",Ea,[s("div",Ma,y(e.location!=null?e.location:e.devKey),1),s("div",Ya,[Oa,s("div",Ha,[s("div",Ra,[e.atem!=null?(c(),b("div",{key:0,style:O({backgroundColor:e.atemColor})},"A:"+y(e.atem)+"\xB0C",5)):g("",!0),e.ctem!=null?(c(),b("div",{key:1,style:O({backgroundColor:e.ctemColor})},"C:"+y(e.ctem)+"\xB0C",5)):g("",!0)]),s("div",ja,[e.btem!=null?(c(),b("div",{key:0,style:O({backgroundColor:e.btemColor})},"B:"+y(e.btem)+"\xB0C",5)):g("",!0),e.ntem!=null?(c(),b("div",{key:1,style:O({backgroundColor:e.ntemColor})},"N:"+y(e.ntem)+"\xB0C",5)):g("",!0)])])]),l(F)==0?(c(),b("div",qa,[e.status==0?(c(),f(Z,{key:0,type:"info"},{default:n(()=>[u("\u79BB\u7EBF")]),_:1})):e.status==2?(c(),f(Z,{key:1,type:"danger"},{default:n(()=>[u("\u544A\u8B66")]),_:1})):e.status==1?(c(),f(Z,{key:2,type:"success"},{default:n(()=>[u("\u6B63\u5E38")]),_:1})):g("",!0)])):g("",!0),e.status!=null&&e.status!=0?(c(),b("button",{key:1,class:"detail",onClick:w=>L(e)},"\u8BE6\u60C5",8,Xa)):g("",!0)])):g("",!0)],64))),128))])):g("",!0),r(Te,{total:l(X),"page-size-arr":l(H),page:l(i).pageNo,"onUpdate:page":t[4]||(t[4]=e=>l(i).pageNo=e),limit:l(i).pageSize,"onUpdate:limit":t[5]||(t[5]=e=>l(i).pageSize=e),onPagination:_},null,8,["total","page-size-arr","page","limit"]),l(I).length==0&&l(V)!==null?(c(),f(Be,{key:2,description:"\u6682\u65E0\u6570\u636E","image-size":595})):g("",!0),r(Pe,{modelValue:l(U),"onUpdate:modelValue":t[11]||(t[11]=e=>Xe(U)?U.value=e:null)},{default:n(()=>[s("div",Za,[s("div",Ja,[Ga,s("span",null,"\u673A\u623F\uFF1A"+y(l(W))+"\xA0\xA0",1),s("span",null,"\u6BCD\u7EBF\uFF1A"+y(l(ee))+"\xA0\xA0",1),s("span",null,"\u63D2\u63A5\u7BB1\uFF1A"+y(l(ae))+"\xA0\xA0",1),s("span",null," \u7F51\u7EDC\u5730\u5740\uFF1A"+y(l($)),1)]),s("div",Qa,[r(Ke,{modelValue:l(i).oldTime,"onUpdate:modelValue":t[6]||(t[6]=e=>l(i).oldTime=e),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime","picker-options":a.pickerOptions,placeholder:"\u9009\u62E9\u65E5\u671F\u65F6\u95F4"},null,8,["modelValue","picker-options"]),r(m,{onClick:t[7]||(t[7]=e=>{var w;(w=new Date(i.oldTime+"Z")).setDate(w.getDate()-1),i.oldTime=w.toISOString().slice(0,19).replace("T"," "),oe()}),type:"primary",style:{"margin-left":"10px"}},{default:n(()=>[u("< \u524D\u4E00\u65E5")]),_:1}),r(m,{onClick:t[8]||(t[8]=e=>{var w;(w=new Date(i.oldTime+"Z")).setDate(w.getDate()+1),i.oldTime=w.toISOString().slice(0,19).replace("T"," "),oe()}),type:"primary"},{default:n(()=>[u("> \u540E\u4E00\u65E5")]),_:1})]),s("div",Wa,[s("div",$a,[r(m,{onClick:t[9]||(t[9]=e=>N.value=0),type:l(N)===0?"primary":""},{default:n(()=>[u("\u56FE\u8868")]),_:1},8,["type"]),r(m,{onClick:t[10]||(t[10]=e=>N.value=1),type:l(N)===1?"primary":""},{default:n(()=>[u("\u6570\u636E")]),_:1},8,["type"]),r(m,{type:"success",plain:"",onClick:Ne,loading:l(T)},{default:n(()=>[el,u(" \u5BFC\u51FA ")]),_:1},8,["loading"])])])]),al,l(N)==0?(c(),f(ma,{key:0,width:"75vw",height:"70vh",list:l(ne)},null,8,["list"])):l(N)==1?(c(),b("div",ll,[r(pe,{data:l(q),stripe:!0,"show-overflow-tooltip":!0,style:{height:"70vh"}},{default:n(()=>[r(x,{label:"\u65F6\u95F4",align:"center",prop:"temAvgTime"}),r(x,{label:"A\u76F8\u6E29\u5EA6",align:"center",prop:"temAvgValueA"},{default:n(e=>[r(k,{"line-clamp":"2"},{default:n(()=>[u(y(e.row.temAvgValueA)+"\xB0C ",1)]),_:2},1024)]),_:1}),r(x,{label:"B\u76F8\u6E29\u5EA6",align:"center",prop:"temAvgValueB"},{default:n(e=>[r(k,{"line-clamp":"2"},{default:n(()=>[u(y(e.row.temAvgValueB)+"\xB0C ",1)]),_:2},1024)]),_:1}),r(x,{label:"C\u76F8\u6E29\u5EA6",align:"center",prop:"temAvgValueC"},{default:n(e=>[r(k,{"line-clamp":"2"},{default:n(()=>[u(y(e.row.temAvgValueC)+"\xB0C ",1)]),_:2},1024)]),_:1}),r(x,{label:"N\u76F8\u6E29\u5EA6",align:"center",prop:"temAvgValueN"},{default:n(e=>[r(k,{"line-clamp":"2"},{default:n(()=>[u(y(e.row.temAvgValueN)+"\xB0C ",1)]),_:2},1024)]),_:1})]),_:1},8,["data"])])):g("",!0)]),_:1},8,["modelValue"])]),_:1},8,["dataList"])}}}),ol=ya(tl,[["__scopeId","data-v-169544f5"]]);export{ol as default};
