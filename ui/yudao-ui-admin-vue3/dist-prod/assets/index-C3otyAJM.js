import{d as W,e as m,cn as j,g as O,ds as z,ar as F,h as P,o as c,c as h,k as t,j as e,w as r,a as s,l as y,t as x,m as g,F as b,p as $,n as X,bX as Z,Z as q,A as B,S as G,N as H}from"./index-mcOGIq4g.js";import{E as K}from"./el-card-FPJq94NZ.js";import{_ as L}from"./index-kf-imsI2.js";import{f as M}from"./formatTime-f-_athMZ.js";import{g as Q}from"./index-CTA3ZZij.js";import{u as Y}from"./useMessage-CGTQbR_M.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const ee={class:"flex"},ae=e("div",{class:"card-header"},[e("span",null,"\u8FDE\u63A5")],-1),le={class:"flex items-center"},se=e("span",{class:"mr-4 text-lg font-medium"}," \u8FDE\u63A5\u72B6\u6001: ",-1),te=e("hr",{class:"my-4"},null,-1),re={class:"flex"},oe=e("p",{class:"mt-4 text-lg font-medium"},"\u6D88\u606F\u8F93\u5165\u6846",-1),ue=e("hr",{class:"my-4"},null,-1),ne=e("div",{class:"card-header"},[e("span",null,"\u6D88\u606F\u8BB0\u5F55")],-1),de={class:"max-h-80 overflow-auto"},ie={class:"flex items-center"},me=e("span",{class:"text-primary mr-2 font-medium"},"\u6536\u5230\u6D88\u606F:",-1),ce=W({name:"InfraWebSocket",__name:"index",setup(pe){const w=Y(),p=m("http://192.168.1.246:48081/infra/ws".replace("http","ws")+"?token="+j()),u=O(()=>k.value==="OPEN"),I=O(()=>u.value?"success":"red"),{status:k,data:n,send:J,close:D,open:R}=z(p.value,{autoReconnect:!1,heartbeat:!0}),v=m([]);F(()=>{if(n.value)try{if(n.value==="pong")return;const d=JSON.parse(n.value),l=d.type,o=JSON.parse(d.content);if(!l)return void w.error("\u672A\u77E5\u7684\u6D88\u606F\u7C7B\u578B\uFF1A"+n.value);if(l==="demo-message-receive")return void(o.single?v.value.push({text:`\u3010\u5355\u53D1\u3011\u7528\u6237\u7F16\u53F7(${o.fromUserId})\uFF1A${o.text}`,time:new Date().getTime()}):v.value.push({text:`\u3010\u7FA4\u53D1\u3011\u7528\u6237\u7F16\u53F7(${o.fromUserId})\uFF1A${o.text}`,time:new Date().getTime()}));if(l==="notice-push")return void v.value.push({text:`\u3010\u7CFB\u7EDF\u901A\u77E5\u3011\uFF1A${o.title}`,time:new Date().getTime()});w.error("\u672A\u5904\u7406\u6D88\u606F\uFF1A"+n.value)}catch{w.error("\u5904\u7406\u6D88\u606F\u53D1\u751F\u5F02\u5E38\uFF1A"+n.value)}});const i=m(""),f=m(""),T=()=>{const d=JSON.stringify({text:i.value,toUserId:f.value}),l=JSON.stringify({type:"demo-message-send",content:d});J(l),i.value=""},A=()=>{u.value?D():R()},_=m([]);return P(async()=>{_.value=await Q()}),(d,l)=>{const o=L,C=Z,V=q,N=B,S=G,E=H,U=K;return c(),h(b,null,[t(o,{title:"WebSocket \u5B9E\u65F6\u901A\u4FE1",url:"https://doc.iocoder.cn/websocket/"}),e("div",ee,[t(U,{gutter:12,class:"w-1/2",shadow:"always"},{header:r(()=>[ae]),default:r(()=>[e("div",le,[se,t(C,{color:s(I)},{default:r(()=>[y(x(s(k)),1)]),_:1},8,["color"])]),te,e("div",re,[t(V,{modelValue:s(p),"onUpdate:modelValue":l[0]||(l[0]=a=>g(p)?p.value=a:null),disabled:""},{prepend:r(()=>[y("\u670D\u52A1\u5730\u5740")]),_:1},8,["modelValue"]),t(N,{type:s(u)?"danger":"primary",onClick:A},{default:r(()=>[y(x(s(u)?"\u5173\u95ED\u8FDE\u63A5":"\u5F00\u542F\u8FDE\u63A5"),1)]),_:1},8,["type"])]),oe,ue,t(V,{modelValue:s(i),"onUpdate:modelValue":l[1]||(l[1]=a=>g(i)?i.value=a:null),autosize:{minRows:2,maxRows:4},disabled:!s(u),clearable:"",type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u4F60\u8981\u53D1\u9001\u7684\u6D88\u606F"},null,8,["modelValue","disabled"]),t(E,{modelValue:s(f),"onUpdate:modelValue":l[2]||(l[2]=a=>g(f)?f.value=a:null),class:"mt-4",placeholder:"\u8BF7\u9009\u62E9\u53D1\u9001\u4EBA"},{default:r(()=>[t(S,{key:"",label:"\u6240\u6709\u4EBA",value:""}),(c(!0),h(b,null,$(s(_),a=>(c(),X(S,{key:a.id,label:a.nickname,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(N,{disabled:!s(u),block:"",class:"ml-2 mt-4",type:"primary",onClick:T},{default:r(()=>[y(" \u53D1\u9001 ")]),_:1},8,["disabled"])]),_:1}),t(U,{gutter:12,class:"w-1/2",shadow:"always"},{header:r(()=>[ne]),default:r(()=>[e("div",de,[e("ul",null,[(c(!0),h(b,null,$(s(v).reverse(),a=>(c(),h("li",{key:a.time,class:"mt-2"},[e("div",ie,[me,e("span",null,x(s(M)(a.time)),1)]),e("div",null,x(a.text),1)]))),128))])])]),_:1})])],64)}}});export{ce as default};
