import{d as se,u as ue,e as p,an as pe,f as de,g as ce,aX as H,h as me,o as v,n as y,w as r,l as f,k as n,a as o,m as ge,j as d,t as h,q as k,c as fe,s as ve,aZ as he,P as xe,O as we,_ as be,A as ye,Q as ke,D as _e,G as Me,R as De,J as Ae,K as Se}from"./index-mcOGIq4g.js";import{_ as Te}from"./CommonMenu-CxUjeIT-.js";import{_ as Ce}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Ye}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{E as ze}from"./el-text-BVz5ES0N.js";import{E as V}from"./index-83lIWP6s.js";import{f as $,g as Ie,c as q,e as Ne}from"./formatTime-f-_athMZ.js";import{C as Ee}from"./index-JEsRnusb.js";import"./index-KYPw-eK3.js";import{P as S}from"./PDU-QxJ-Axz0.js";import{d as Fe}from"./download--D_IyRio.js";import{u as Ue}from"./useMessage-CGTQbR_M.js";import{i as We}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as Pe}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const x=D=>(Ae("data-v-de0514cd"),D=D(),Se(),D),Re=x(()=>d("br",null,null,-1)),Le=x(()=>d("br",null,null,-1)),He=x(()=>d("div",{class:"nav_data"},[d("div",{class:"descriptions-container",style:{"font-size":"14px"}},[d("div",{class:"description-item"},[d("span",{class:"label"},"\u6309\u65F6\u95F4\u8303\u56F4\u67E5\u8BE2\u5B9E\u65F6\u80FD\u8017")])])],-1)),Ve={key:0,class:"realTotal"},$e=x(()=>d("br",null,null,-1)),qe=x(()=>d("br",null,null,-1)),Ge=x(()=>d("br",null,null,-1)),je=x(()=>d("br",null,null,-1)),Oe=Pe(se({name:"PowerAnalysis",__name:"index",setup(D){const{push:G}=ue(),N=p([]),E=pe(),T=p(!1),j=Ue(),s=p([]),_=p(0),F=p(0),m=p();p([{imgUrl:S},{imgUrl:S},{imgUrl:S},{imgUrl:S}]);const i=de({pageNo:1,pageSize:15,timeRange:void 0,ipArray:[]}),O=p([15,30,50,100]),B=p(),C=p(!1),J=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const t=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,t]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const t=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,t]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const t=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,t]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const t=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,t]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,t]}}],K=t=>{const e=(t-1)*i.pageSize+1,a=t*i.pageSize,u=[];for(let b=e;b<=a;b++)u.push("\u5E8F\u53F7"+b);return u},Y=p(null);let g=null;const U=p([]),Q=()=>{if(Y.value&&E){const e=(a=>{const u=(a-1)*i.pageSize+1;return a*i.pageSize-u+1})(i.pageNo);g=We(Y.value),g.setOption({title:{text:"\u5404PDU\u5B9E\u65F6\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:X},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:K(i.pageNo),axisLabel:{interval:0,formatter:function(a,u){return e>30?"":a}}},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",barWidth:"auto",barGap:"30%",data:U.value,label:{show:e<=30,position:"top"}}]}),g.on("click",function(a){R(s.value[a.dataIndex].location,s.value[a.dataIndex].createTimeMin,s.value[a.dataIndex].createTimeMax)}),E.appContext.config.globalProperties.rankChart=g}};window.addEventListener("resize",function(){g==null||g.resize()}),p([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address",istrue:!0,width:"150%"},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!0,width:"150px"},{label:"\u5F00\u59CB\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"eleActiveStart",istrue:!0,formatter:w,width:"130px"},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"createTimeMin",formatter:A,width:"130px",istrue:!0}]},{label:"\u7ED3\u675F\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"eleActiveEnd",istrue:!0,formatter:w,width:"130px"},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"createTimeMax",formatter:A,width:"130px",istrue:!0}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eleActive",istrue:!0,formatter:w,width:"130px"},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]);const z=async()=>{T.value=!0;try{if(m.value!=null){const e=$(Ie(q(m.value[0]))),a=$(Ne(q(m.value[1])));i.timeRange=[e,a]}if(m.value==null)return void alert("\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4");const t=await V.getEleTotalRealtime(i);U.value=t.list.map(e=>{return a=e.eleActive,u=1,isNaN(a)?null:Number(a).toFixed(u);var a,u}),s.value=t.list,F.value=t.total,t.total>1e4?_.value=1e4:_.value=t.total}finally{Q(),T.value=!1}};function X(t){var e="",a=t[0];return e+="\u6240\u5728\u4F4D\u7F6E\uFF1A"+(s.value[a.dataIndex].address?s.value[a.dataIndex].address:"\u672A\u7ED1\u5B9A\u8BBE\u5907")+"<br/>"+a.marker+"\u7F51\u7EDC\u5730\u5740\uFF1A"+s.value[a.dataIndex].location+"<br/>"+a.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+W(null,null,s.value[a.dataIndex].createTimeMin)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+w(null,null,s.value[a.dataIndex].eleActiveStart)+"kWh <br/>"+a.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+W(null,null,s.value[a.dataIndex].createTimeMax)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+w(null,null,s.value[a.dataIndex].eleActiveEnd)+"kWh <br/>"+a.marker+"\u8017\u7535\u91CF\uFF1A"+w(null,null,s.value[a.dataIndex].eleActive)+"kWh"}function W(t,e,a){return a?H(a).format("YYYY-MM-DD HH:mm:ss"):""}function A(t,e,a){return a?H(a).format("YYYY-MM-DD"):""}function w(t,e,a){return a==null?"":Number(a).toFixed(1)}ce(()=>{const t=Math.ceil(_.value/i.pageSize);return i.pageNo===t&&_.value>=1e4});const Z=t=>{const e=new Date;return e.setHours(0,0,0,0),t.setHours(0,0,0,0),t>e},P=()=>{i.pageNo=1,z()},ee=async t=>{let e=[];t.forEach(a=>{a.type==4&&e.push(a.unique)}),e.length==0&&t.length!=0&&(e.push(0),g==null||g.clear(),he({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),i.ipArray=e,P()},R=(t,e,a)=>{G("/pdu/nenghao/powerAnalysis?type=total&granularity=day&start="+e+"&end="+a+"&ip="+t)},ae=async()=>{try{await j.exportConfirm(),i.pageNo=1,C.value=!0;const t={timeout:0},e=await V.getEleTotalRealtimeExcel(i,t);await Fe.excel(e,"PDU\u5B9E\u65F6\u80FD\u8017\u7EDF\u8BA1.xlsx")}catch{}finally{C.value=!1}};me(()=>{(async()=>{let a=[];var u=await Ee.getRoomPDUList();a=a.concat(u),N.value=a})();const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),1);m.value=[L(e),L(t)],z()});const L=t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`;return(t,e)=>{const a=xe,u=we,b=be,I=ye,te=ke,c=_e,M=ze,le=Me,re=Ye,ne=Ce,ie=Te,oe=De;return v(),y(ie,{dataList:o(N),onCheck:ee,navTitle:"PDU\u5B9E\u65F6\u80FD\u8017\u67E5\u8BE2",placeholder:"\u5982:192.168.1.96-0"},{NavInfo:r(()=>[Re,f(),Le,He]),ActionBar:r(()=>[n(te,{class:"-mb-15px",model:o(i),ref_key:"queryFormRef",ref:B,inline:!0,"label-width":"auto"},{default:r(()=>[n(u,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:r(()=>[n(a,{"value-format":"YYYY-MM-DD",modelValue:o(m),"onUpdate:modelValue":e[0]||(e[0]=l=>ge(m)?m.value=l:null),type:"daterange",shortcuts:J,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":Z},null,8,["modelValue"])]),_:1}),n(u,null,{default:r(()=>[n(I,{onClick:P},{default:r(()=>[n(b,{icon:"ep:search",class:"mr-5px"}),f(" \u641C\u7D22")]),_:1})]),_:1}),n(I,{type:"success",plain:"",onClick:ae,loading:o(C),style:{float:"right","margin-right":"10px"}},{default:r(()=>[n(b,{icon:"ep:download",class:"mr-5px"}),f(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1},8,["model"])]),Content:r(()=>[d("div",null,[n(le,{data:o(s),"show-overflow-tooltip":!0,width:"1800px","header-cell-style":{background:"#f7f7f7",color:"#606266",height:"30px"}},{default:r(()=>[n(c,{label:"\u7F16\u53F7",align:"center",prop:"tableId",width:"80px"},{default:r(({$index:l})=>[f(h(l+1+(o(i).pageNo-1)*o(i).pageSize),1)]),_:1}),n(c,{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address"}),n(c,{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",width:"150px"}),n(c,{label:"\u5F00\u59CB\u7535\u80FD",align:"center"},{default:r(()=>[n(c,{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"eleActiveStart",width:"130px"},{default:r(l=>[l.row.eleActiveStart?(v(),y(M,{key:0,"line-clamp":"2"},{default:r(()=>[f(h(l.row.eleActiveStart.toFixed(1)),1)]),_:2},1024)):k("",!0)]),_:1}),n(c,{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"createTimeMin",width:"165px"},{default:r(l=>[l.row.createTimeMin?(v(),y(M,{key:0,"line-clamp":"2"},{default:r(()=>[f(h(A(l.row,l.row.createTimeMin,l.row.createTimeMin)),1)]),_:2},1024)):k("",!0)]),_:1})]),_:1}),n(c,{label:"\u7ED3\u675F\u7535\u80FD",align:"center"},{default:r(()=>[n(c,{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"eleActiveEnd",width:"130px"},{default:r(l=>[l.row.eleActiveEnd?(v(),y(M,{key:0,"line-clamp":"2"},{default:r(()=>[f(h(l.row.eleActiveEnd.toFixed(1)),1)]),_:2},1024)):k("",!0)]),_:1}),n(c,{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"createTimeMax",width:"165px"},{default:r(l=>[l.row.createTimeMax?(v(),y(M,{key:0,"line-clamp":"2"},{default:r(()=>[f(h(A(l.row,l.row.createTimeMax,l.row.createTimeMax)),1)]),_:2},1024)):k("",!0)]),_:1})]),_:1}),n(c,{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eleActive",width:"130px"},{default:r(l=>[l.row.eleActive?(v(),y(M,{key:0,"line-clamp":"2"},{default:r(()=>[f(h(l.row.eleActive.toFixed(1)),1)]),_:2},1024)):k("",!0)]),_:1}),n(c,{label:"\u64CD\u4F5C",align:"center"},{default:r(l=>[n(I,{link:"",type:"primary",onClick:Be=>R(l.row.location,String(o(m)[0]),String(o(m)[1])),style:{"background-color":"#409EFF",color:"#fff",border:"none",width:"60px",height:"30px"}},{default:r(()=>[f(" \u8BE6\u60C5 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),n(re,{total:o(_),"page-size-arr":o(O),layout:"sizes, prev, pager, next, jumper",page:o(i).pageNo,"onUpdate:page":e[1]||(e[1]=l=>o(i).pageNo=l),limit:o(i).pageSize,"onUpdate:limit":e[2]||(e[2]=l=>o(i).pageSize=l),onPagination:z},null,8,["total","page-size-arr","page","limit"]),o(s).length!=0?(v(),fe("div",Ve,"\u5171 "+h(o(F))+" \u6761",1)):k("",!0),$e,qe,Ge,je,n(ne,null,{default:r(()=>[ve(d("div",{ref_key:"rankChartContainer",ref:Y,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[oe,o(T)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-de0514cd"]]);export{Oe as default};
