import{d as M,e as m,f as N,h as P,o as C,c as Y,j as p,k as o,w as s,a as i,t as F,l as h,n as O,q as H,F as K,C as R,bX as $,A as q,D as j,G,J as L,K as U}from"./index-mcOGIq4g.js";import{_ as V}from"./Echart.vue_vue_type_script_setup_true_lang-NDPlWfCz.js";import{E as I}from"./el-card-FPJq94NZ.js";import{C as D}from"./index-JEsRnusb.js";import"./dataZoom-Bkxs25kQ.js";import{_ as J}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./installCanvasRenderer-WHaFMoQ9.js";import"./install-DiAPpr4Z.js";const E=v=>(L("data-v-b987a59b"),v=v(),U(),v),S={class:"descriptionContainer"},X={class:"all-left"},Z={class:"progressBox"},Q=E(()=>p("div",{class:"title"},"\u603B\u8D1F\u8F7D\u7387",-1)),aa=E(()=>p("div",{class:"power"},"\u7535\u529B\u5BB9\u91CF",-1)),ta={class:"local"},ea={class:"btns"},ia={class:"descriptionContainer"},oa={class:"all-left"},la={class:"ABTotalData"},ra={class:"btns"},pa=J(M({__name:"index",setup(v){var B;const u=m(""),g=m("DAY"),d=N({}),x=m({}),k=((B=history==null?void 0:history.state)==null?void 0:B.id)||1,w=m(!1),W=m({}),z=m({}),f={DAY:["\u5F53\u65E5","\u6628\u65E5"],WEEK:["\u5F53\u5468","\u4E0A\u5468"],MONTH:["\u5F53\u6708","\u4E0A\u6708"]},A=async a=>{if(a==u.value)return;u.value=a;const t=await D.getPowTrend({id:k,type:a});z.value={title:{text:"\u673A\u67DC\u5217\u5B9E\u65F6\u529F\u7387\u8D70\u52BF"},tooltip:{trigger:"axis"},legend:{top:"2",left:"180",selectedMode:"single"},grid:{left:"8%",right:"8%",bottom:"35",top:"55"},xAxis:{type:"category",boundaryGap:!1,data:t.map(e=>e.dateTime)},yAxis:{type:"value"},series:[{name:"\u6709\u529F\u529F\u7387",type:"line",symbol:"none",data:t.map(e=>+e.activePow.toFixed(3)),markPoint:{data:[{type:"max",name:"Max"},{type:"min",name:"Min"}]}},{name:"\u89C6\u5728\u529F\u7387",type:"line",symbol:"none",data:t.map(e=>+e.apparentPow.toFixed(3)),markPoint:{data:[{type:"max",name:"Max"},{type:"min",name:"Min"}]}}]}},y=async a=>{try{w.value=!0;const t=await D.getEleTrend({id:k,type:a});W.value={title:{text:"\u5B9E\u65F6\u80FD\u8017\u8D70\u52BF"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){return`${e[0].seriesName}\uFF1A${e[0].value}kW\xB7h<br>${e[1].seriesName}\uFF1A${e[1].value}kW\xB7h`}},legend:{data:f[a],right:"45%"},grid:{left:"3%",right:"3%",bottom:"5",top:"65",containLabel:!0},dataZoom:[{type:"inside",realtime:!0,start:0,end:100}],xAxis:[{type:"category",data:t.map(e=>e.dateTime),axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value",name:"kW\xB7h"}],series:[{name:f[a][0],type:"bar",barWidth:"20%",data:t.map(e=>e.eq.toFixed(1))},{name:f[a][1],type:"bar",barWidth:"20%",data:t.map(e=>e.lastEq.toFixed(1)),itemStyle:{color:"#bd0000"}}]}}finally{w.value=!1,u.value=a}};return(async()=>{const a=await D.getRackDetail({id:k}),t=[],e=a.rack_power.path_a.pow_apparent.reduce((r,l)=>r+l).toFixed(3),c=a.rack_power.path_b.pow_apparent.reduce((r,l)=>r+l).toFixed(3),_=a.rack_power.path_a.pow_active.reduce((r,l)=>r+l).toFixed(3),n=a.rack_power.path_b.pow_active.reduce((r,l)=>r+l).toFixed(3);t.push({name:"\u89C6\u5728\u529F\u7387/kVA",pathA:e,pathB:c,total:a.rack_power.total_data.pow_apparent.toFixed(3)}),t.push({name:"\u6709\u529F\u529F\u7387/kW",pathA:_,pathB:n,total:a.rack_power.total_data.pow_active.toFixed(3)}),t.push({name:"\u65E0\u529F\u529F\u7387/kVar",pathA:a.rack_power.path_a.pow_reactive.reduce((r,l)=>r+l).toFixed(3),pathB:a.rack_power.path_b.pow_reactive.reduce((r,l)=>r+l).toFixed(3),total:a.rack_power.total_data.pow_reactive.toFixed(3)}),t.push({name:"\u529F\u7387\u56E0\u7D20",pathA:e>0?(_/e).toFixed(2):0,pathB:c>0?(n/c).toFixed(2):0,total:a.rack_power.total_data.pow_active>0?(a.rack_power.total_data.pow_active/a.rack_power.total_data.pow_apparent).toFixed(2):0}),t.push({name:"\u8D1F\u8F7D\u7387/%",pathA:e>0?100*Number((e/a.rack_power.total_data.pow_apparent).toFixed(2)):0,pathB:c>0?100*Number((c/a.rack_power.total_data.pow_apparent).toFixed(2)):0,total:"-"}),a.total_zb=a.rack_power.total_data.power_factor,a.total_ele_active=a.rack_power.total_data.ele_active,x.value=t,Object.assign(d,a)})(),A("DAY"),y("DAY"),P(()=>{}),(a,t)=>{const e=R,c=$,_=I,n=q,r=V,l=j,T=G;return C(),Y(K,null,[p("div",S,[p("div",X,[o(_,{class:"card",shadow:"hover"},{default:s(()=>[p("div",Z,[Q,o(e,{type:"dashboard",percentage:i(d).total_zb?100*Number(i(d).total_zb).toFixed(2):0},null,8,["percentage"]),aa,p("div",null,F(i(d).total_ele_active?i(d).total_ele_active.toFixed():0)+"kW",1),p("div",ta,[o(c,{size:"large",type:"success"},{default:s(()=>[h(F(i(d).room_name)+"-"+F(i(d).rack_name),1)]),_:1})])])]),_:1})]),o(_,{class:"all-right",shadow:"hover"},{default:s(()=>[p("div",ea,[o(n,{class:"btn",size:"small",loading:i(w),plain:i(g)!="DAY",type:"primary",onClick:t[0]||(t[0]=b=>y("DAY"))},{default:s(()=>[h("\u5F53\u65E5")]),_:1},8,["loading","plain"]),o(n,{class:"btn",size:"small",loading:i(w),plain:i(g)!="WEEK",type:"primary",onClick:t[1]||(t[1]=b=>y("WEEK"))},{default:s(()=>[h("\u5F53\u5468")]),_:1},8,["loading","plain"]),o(n,{class:"btn",size:"small",loading:i(w),plain:i(g)!="MONTH",type:"primary",onClick:t[2]||(t[2]=b=>y("MONTH"))},{default:s(()=>[h("\u5F53\u6708")]),_:1},8,["loading","plain"])]),o(r,{options:i(W),height:250},null,8,["options"])]),_:1})]),p("div",ia,[p("div",oa,[o(_,{class:"card",shadow:"hover"},{default:s(()=>[p("div",la,[i(x).length>0?(C(),O(T,{key:0,border:"",data:i(x),"max-height":"400"},{default:s(()=>[o(l,{prop:"name",label:"","min-width":"100",align:"center"}),o(l,{prop:"pathA",label:"A\u8DEF","min-width":"100",align:"center"}),o(l,{prop:"pathB",label:"B\u8DEF","min-width":"100",align:"center"}),o(l,{prop:"total",label:"\u7EDF\u8BA1","min-width":"100",align:"center"})]),_:1},8,["data"])):H("",!0)])]),_:1})]),o(_,{class:"all-right",shadow:"hover"},{default:s(()=>[o(r,{options:i(z),height:450},null,8,["options"]),p("div",ra,[o(n,{class:"btn",size:"small",plain:i(u)!="HOUR",type:"primary",onClick:t[3]||(t[3]=b=>A("HOUR"))},{default:s(()=>[h("\u6700\u8FD11\u5C0F\u65F6")]),_:1},8,["plain"]),o(n,{class:"btn",size:"small",plain:i(u)!="DAY",type:"primary",onClick:t[4]||(t[4]=b=>A("DAY"))},{default:s(()=>[h("\u6700\u8FD124\u5C0F\u65F6")]),_:1},8,["plain"])])]),_:1})])],64)}}}),[["__scopeId","data-v-b987a59b"]]);export{pa as default};
