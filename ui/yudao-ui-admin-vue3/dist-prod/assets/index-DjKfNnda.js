import{d as _e,u as ke,e as u,an as De,T as h,aX as z,f as Me,aj as Ye,g as Ce,h as Ne,o as g,n as x,w as s,l as y,j as l,t as _,a as r,k as o,m as ze,s as X,aY as R,c as I,F as q,p as Z,q as $,aZ as Ie,S as qe,N as Ae,O as Fe,P as Te,_ as We,A as Pe,Q as Ve,D as Re,G as Ue,R as Ee,J as Se,K as je}from"./index-mcOGIq4g.js";import{_ as Le}from"./CommonMenu-CxUjeIT-.js";import{_ as Qe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as He}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ke}from"./download--D_IyRio.js";import{E as U}from"./index-U3-JpcYo.js";import{f as ee,s as Oe,c as ae,e as Be}from"./formatTime-f-_athMZ.js";import{I as Ge}from"./index-Bla3Qadp.js";import"./index-KYPw-eK3.js";import{u as Je}from"./useMessage-CGTQbR_M.js";import{i as Xe}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as Ze}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const d=k=>(Se("data-v-47b3674b"),k=k(),je(),k),$e=d(()=>l("br",null,null,-1)),ea=d(()=>l("br",null,null,-1)),aa={class:"nav_data"},ta={class:"descriptions-container",style:{"font-size":"14px"}},la={class:"description-item"},na=d(()=>l("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ra={class:"value"},ia={class:"description-item"},sa=d(()=>l("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),oa={class:"value"},ua={class:"description-item"},pa=d(()=>l("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),da={class:"value"},ca=d(()=>l("br",null,null,-1)),ma=d(()=>l("div",null,[l("span",null,"\u5168\u90E8\u67DC\u5217\u65B0\u589E\u80FD\u8017\u8BB0\u5F55"),l("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ga=d(()=>l("tr",null,[l("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[l("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),va={class:"realTotal"},fa=d(()=>l("br",null,null,-1)),ha=d(()=>l("br",null,null,-1)),ya=d(()=>l("br",null,null,-1)),ba=d(()=>l("br",null,null,-1)),wa=Ze(_e({name:"PowerAnalysis",__name:"index",setup(k){const te=Je(),{push:le}=ke(),E=u([]),S=u(0),j=u(0),L=u(0),Q=De(),D=u(!0),v=u([]),b=u(0),H=u(0);let A=new Date;const c=u([h().query.startTime!=null?h().query.startTime:z(new Date(A.getFullYear(),A.getMonth(),1)).format("YYYY-MM-DD"),h().query.endTime!=null?h().query.endTime:z(A).format("YYYY-MM-DD")]),i=Me({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,aisleIds:h().query.id!=null?[h().query.id]:[]}),ne=u([15,30,50,100]),re=u(),F=u(!1),ie=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],se=a=>{const e=(a-1)*i.pageSize+1,t=a*i.pageSize,Y=[];for(let f=e;f<=t;f++)Y.push("\u5E8F\u53F7"+f);return Y},T=u(null);let m=null;const K=u([]);window.addEventListener("resize",function(){m==null||m.resize()}),Ye(()=>i.granularity,()=>{P()});const oe=u([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"180px"},{label:"\u8BB0\u5F55\u65E5\u671F",align:"center",prop:"create_time",formatter:M,width:"200px",istrue:!0},{label:"\u5F00\u59CB",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:O,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"start_ele",istrue:!0,formatter:w}]},{label:"\u7ED3\u675F",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"end_time",formatter:O,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"end_ele",istrue:!0,formatter:w}]},{label:`\u8017\u7535\u91CF
(kWh)`,align:"center",prop:"eq_value",istrue:!0,formatter:w},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),W=async()=>{D.value=!0;try{if(c.value!=null){const e=ee(Oe(ae(c.value[0]))),t=ee(Be(ae(c.value[1])));i.timeRange=[e,t]}c.value!=null&&c.value[0]!=null&&c.value[1]!=null||(i.timeRange=void 0);const a=await U.getEQDataPage(i);K.value=a.list.map(e=>de(e.eq_value,1)),v.value=a.list,H.value=a.total,a.total>1e4?b.value=1e4:b.value=a.total}finally{T.value&&Q&&(m=Xe(T.value),m.setOption({title:{text:"\u5404\u67DC\u5217\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:ue},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:se(i.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:K.value,label:{show:!0,position:"top"},barWidth:50}]}),Q.appContext.config.globalProperties.rankChart=m),D.value=!1}};function ue(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+v.value[t.dataIndex].location+"  ",e+="<br/>"+t.marker+"\u8BB0\u5F55\u65E5\u671F\uFF1A"+M(null,null,v.value[t.dataIndex].create_time)+" "+t.seriesName+": "+t.value+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+M(null,null,v.value[t.dataIndex].end_time)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+w(null,null,v.value[t.dataIndex].end_ele)+"kWh <br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+M(null,null,v.value[t.dataIndex].start_time)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+w(null,null,v.value[t.dataIndex].start_ele)+"kWh <br/>"}const pe=Ce(()=>{const a=Math.ceil(b.value/i.pageSize);return i.pageNo===a&&b.value>=1e4});function M(a,e,t){return t?z(t).format("YYYY-MM-DD"):""}function O(a,e,t){return t?z(t).format("MM-DD"):""}function w(a,e,t){return Number(t).toFixed(1)}const de=(a,e)=>isNaN(a)?null:Number(a).toFixed(e),ce=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},P=()=>{i.pageNo=1,W()},me=async a=>{let e=[];a.forEach(t=>{t.type==2&&e.push(t.id)}),e.length==0&&a.length!=0&&(e.push(0),m==null||m.clear(),Ie({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),i.aisleIds=e,P()},ge=async()=>{try{await te.exportConfirm(),i.pageNo=1,F.value=!0;const a={timeout:0},e=await U.exportEQPageData(i,a);await Ke.excel(e,"\u67DC\u5217\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{F.value=!1}},B=(a,e)=>{le("/aisle/aisleenergyconsumption/ecdistribution?aisleId="+a+"&location="+e)},ve=u(0);return Ne(()=>{(async()=>{const a=await Ge.getAisleMenu();E.value=a})(),(async()=>{const a=await U.getNavNewData({});S.value=a.day,j.value=a.week,L.value=a.month})(),ve.value=h().query.id,W()}),(a,e)=>{const t=qe,Y=Ae,f=Fe,fe=Te,G=We,C=Pe,he=Ve,N=Re,ye=Ue,be=He,we=Qe,xe=Le,J=Ee;return g(),x(xe,{dataList:r(E),onCheck:me,navTitle:"\u67DC\u5217\u80FD\u8017\u8D8B\u52BF"},{NavInfo:s(()=>[$e,y(),ea,l("div",aa,[l("div",ta,[l("div",la,[na,l("span",ra,_(r(S))+"\u6761",1)]),l("div",ia,[sa,l("span",oa,_(r(j))+"\u6761",1)]),l("div",ua,[pa,l("span",da,_(r(L))+"\u6761",1)]),y(),ca,ma])])]),ActionBar:s(()=>[o(he,{class:"-mb-15px",model:r(i),ref_key:"queryFormRef",ref:re,inline:!0,"label-width":"auto"},{default:s(()=>[o(f,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:s(()=>[o(Y,{modelValue:r(i).granularity,"onUpdate:modelValue":e[0]||(e[0]=n=>r(i).granularity=n),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:s(()=>[o(t,{label:"\u5929",value:"day"}),o(t,{label:"\u5468",value:"week"}),o(t,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:s(()=>[o(fe,{"value-format":"YYYY-MM-DD",modelValue:r(c),"onUpdate:modelValue":e[1]||(e[1]=n=>ze(c)?c.value=n:null),type:"daterange",shortcuts:ie,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":ce},null,8,["modelValue"])]),_:1}),o(f,null,{default:s(()=>[o(C,{onClick:P},{default:s(()=>[o(G,{icon:"ep:search",class:"mr-5px"}),y(" \u641C\u7D22")]),_:1}),o(C,{type:"success",plain:"",loading:r(F),onClick:ge},{default:s(()=>[o(G,{icon:"ep:download",class:"mr-5px"}),y(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:s(()=>[X((g(),x(ye,{data:r(v),stripe:!0,"show-overflow-tooltip":!0},R({default:s(()=>[o(N,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:s(({$index:n})=>[y(_(n+1+(r(i).pageNo-1)*r(i).pageSize),1)]),_:1}),(g(!0),I(q,null,Z(r(oe),n=>(g(),I(q,{key:n.label},[!n.children&&n.istrue?(g(),x(N,{key:n.prop,label:n.label,align:n.align,prop:n.prop,formatter:n.formatter,width:n.width},R({_:2},[n.slot==="actions"?{name:"default",fn:s(({row:p})=>[o(C,{link:"",type:"primary",onClick:V=>B(p.aisle_id,p.location)},{default:s(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):n.istrue?(g(),x(N,{key:1,label:n.label,align:n.align},{default:s(()=>[(g(!0),I(q,null,Z(n.children,p=>(g(),I(q,{key:p.prop},[p.istrue?(g(),x(N,{key:p.prop,label:p.label,align:p.align,prop:p.prop,formatter:p.formatter,width:p.width},R({_:2},[p.slot==="actions"?{name:"default",fn:s(({row:V})=>[o(C,{link:"",type:"primary",onClick:xa=>B(V.aisle_id,V.location)},{default:s(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):$("",!0)],64))),128))]),_:2},1032,["label","align"])):$("",!0)],64))),128))]),_:2},[r(pe)?{name:"append",fn:s(()=>[ga]),key:"0"}:void 0]),1032,["data"])),[[J,r(D)]]),o(be,{total:r(b),"page-size-arr":r(ne),layout:"sizes, prev, pager, next, jumper",page:r(i).pageNo,"onUpdate:page":e[2]||(e[2]=n=>r(i).pageNo=n),limit:r(i).pageSize,"onUpdate:limit":e[3]||(e[3]=n=>r(i).pageSize=n),onPagination:W},null,8,["total","page-size-arr","page","limit"]),l("div",va,"\u5171 "+_(r(H))+" \u6761",1),fa,ha,ya,ba,o(we,null,{default:s(()=>[X(l("div",{ref_key:"rankChartContainer",ref:T,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[J,r(D)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-47b3674b"]]);export{wa as default};
