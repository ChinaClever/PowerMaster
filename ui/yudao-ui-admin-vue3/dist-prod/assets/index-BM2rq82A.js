import{d as _e,u as xe,e as u,an as De,f as Ce,aj as Ne,g as Ie,aX as X,h as Me,T as V,o as m,n as k,w as o,l as h,j as l,t as w,a as i,k as s,m as ze,s as Z,aY as F,c as z,F as Y,p as $,q as ee,aZ as Ye,S as Ae,N as Se,O as We,P as qe,_ as Pe,A as Ve,Q as Fe,D as Te,G as Ue,R as Ee,J as Le,K as je}from"./index-mcOGIq4g.js";import{_ as Qe}from"./CommonMenu-CxUjeIT-.js";import{_ as Re}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as He}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Oe}from"./download--D_IyRio.js";import{E as T}from"./index-DEdYoS9M.js";import{f as ae,e as te,c as le}from"./formatTime-f-_athMZ.js";import{C as Be}from"./index-JEsRnusb.js";import"./index-KYPw-eK3.js";import{u as Ge}from"./useMessage-CGTQbR_M.js";import{i as Je}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as Ke}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const d=_=>(Le("data-v-c791192f"),_=_(),je(),_),Xe=d(()=>l("br",null,null,-1)),Ze=d(()=>l("br",null,null,-1)),$e={class:"nav_data"},ea={class:"descriptions-container",style:{"font-size":"14px"}},aa={class:"description-item"},ta=d(()=>l("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),la={class:"value"},na={class:"description-item"},ra=d(()=>l("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),ia={class:"value"},oa={class:"description-item"},sa=d(()=>l("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ua={class:"value"},pa=d(()=>l("br",null,null,-1)),da=d(()=>l("div",null,[l("span",null,"\u5168\u90E8\u673A\u67B6\u65B0\u589E\u80FD\u8017\u8BB0\u5F55"),l("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ca=d(()=>l("tr",null,[l("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[l("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ma={class:"realTotal"},ga=d(()=>l("br",null,null,-1)),va=d(()=>l("br",null,null,-1)),fa=d(()=>l("br",null,null,-1)),ha=d(()=>l("br",null,null,-1)),ba=Ke(_e({name:"PowerAnalysis",__name:"index",setup(_){const{push:ne}=xe(),U=u([]),E=u(0),L=u(0),j=u(0),Q=De(),x=u(!0),re=Ge(),g=u([]),b=u(0),R=u(0),y=u(),r=Ce({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,rackIds:[]}),ie=u([15,30,50,100]),oe=u(),A=u(!1),se=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],ue=a=>{const e=(a-1)*r.pageSize+1,t=a*r.pageSize,v=[];for(let f=e;f<=t;f++)v.push("\u5E8F\u53F7"+f);return v},S=u(null);let c=null;const H=u([]);window.addEventListener("resize",function(){c==null||c.resize()}),Ne(()=>r.granularity,()=>{P()});const pe=u([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"180px"},{label:"\u673A\u67B6\u540D",align:"center",prop:"rack_name",istrue:!0,width:"100px"},{label:"\u8BB0\u5F55\u65E5\u671F",align:"center",prop:"create_time",formatter:D,width:"150px",istrue:!0},{label:"\u5F00\u59CB",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:B,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"start_ele",istrue:!0,formatter:C}]},{label:"\u7ED3\u675F",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"end_time",formatter:B,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"end_ele",istrue:!0,formatter:C}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:C},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"100px"}]),W=u(""),O=u(""),q=async()=>{x.value=!0;try{if(W.value!=null){const e=ae(te(le(W.value))),t=ae(te(le(O.value)));y.value=[e,t],r.timeRange=[e,t]}y.value==null&&(r.timeRange=void 0);const a=await T.getEQDataPage(r);H.value=a.list.map(e=>{return t=e.eq_value,v=1,isNaN(t)?null:Number(t).toFixed(v);var t,v}),g.value=a.list,R.value=a.total,a.total>1e4?b.value=1e4:b.value=a.total}finally{S.value&&Q&&(c=Je(S.value),c.setOption({title:{text:"\u5404\u673A\u67B6\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:de},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:ue(r.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:H.value,label:{show:!0,position:"top"},barWidth:50}]}),Q.appContext.config.globalProperties.rankChart=c),x.value=!1}};function de(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+g.value[t.dataIndex].location+"  ",e+="<br/>"+t.marker+"\u8BB0\u5F55\u65F6\u95F4\uFF1A"+D(null,null,g.value[t.dataIndex].create_time)+" "+t.seriesName+": "+t.value+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65F6\u95F4\uFF1A"+D(null,null,g.value[t.dataIndex].end_time)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+g.value[t.dataIndex].end_ele+"kWh <br/>"+t.marker+"\u5F00\u59CB\u65F6\u95F4\uFF1A"+D(null,null,g.value[t.dataIndex].start_time)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+C(null,null,g.value[t.dataIndex].start_ele)+"kWh <br/>"}const ce=Ie(()=>{const a=Math.ceil(b.value/r.pageSize);return r.pageNo===a&&b.value>=1e4});function D(a,e,t){return t?X(t).format("YYYY-MM-DD"):""}function B(a,e,t){return t?X(t).format("MM-DD"):""}function C(a,e,t){return Number(t).toFixed(1)}const me=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},P=()=>{r.pageNo=1,q()},ge=async a=>{let e=[];a.forEach(t=>{t.type==5&&e.push(t.id)}),e.length==0&&a.length!=0&&(e.push(0),c==null||c.clear(),Ye({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),r.rackIds=e,P()},G=(a,e,t)=>{ne("/u/nenghao/ecdistribution?rackId="+a+"&location="+(e+="-"+t))},ve=async()=>{try{await re.exportConfirm(),r.pageNo=1,A.value=!0;const a={timeout:0},e=await T.exportEQPageData(r,a);await Oe.excel(e,"\u673A\u67B6\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{A.value=!1}};return Me(()=>{W.value=V().query.start,O.value=V().query.end;const a=V().query.rackId;a!==void 0&&r.rackIds.push(a),(async()=>{const e=await Be.getRackMenuAll({});U.value=e})(),(async()=>{const e=await T.getNavNewData({});E.value=e.day,L.value=e.week,j.value=e.month})(),q()}),(a,e)=>{const t=Ae,v=Se,f=We,fe=qe,J=Pe,N=Ve,he=Fe,I=Te,be=Ue,ye=He,ke=Re,we=Qe,K=Ee;return m(),k(we,{dataList:i(U),onCheck:ge,navTitle:"\u673A\u67B6\u80FD\u8017\u8D8B\u52BF"},{NavInfo:o(()=>[Xe,h(),Ze,l("div",$e,[l("div",ea,[l("div",aa,[ta,l("span",la,w(i(E))+"\u6761",1)]),l("div",na,[ra,l("span",ia,w(i(L))+"\u6761",1)]),l("div",oa,[sa,l("span",ua,w(i(j))+"\u6761",1)]),h(),pa,da])])]),ActionBar:o(()=>[s(he,{class:"-mb-15px",model:i(r),ref_key:"queryFormRef",ref:oe,inline:!0,"label-width":"auto"},{default:o(()=>[s(f,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:o(()=>[s(v,{modelValue:i(r).granularity,"onUpdate:modelValue":e[0]||(e[0]=n=>i(r).granularity=n),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:o(()=>[s(t,{label:"\u5929",value:"day"}),s(t,{label:"\u5468",value:"week"}),s(t,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),s(f,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[s(fe,{"value-format":"YYYY-MM-DD",modelValue:i(y),"onUpdate:modelValue":e[1]||(e[1]=n=>ze(y)?y.value=n:null),type:"daterange",shortcuts:se,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":me},null,8,["modelValue"])]),_:1}),s(f,null,{default:o(()=>[s(N,{onClick:P},{default:o(()=>[s(J,{icon:"ep:search",class:"mr-5px"}),h(" \u641C\u7D22")]),_:1}),s(N,{type:"success",plain:"",loading:i(A),onClick:ve},{default:o(()=>[s(J,{icon:"ep:download",class:"mr-5px"}),h(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:o(()=>[Z((m(),k(be,{data:i(g),stripe:!0,"show-overflow-tooltip":!0},F({default:o(()=>[s(I,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:o(({$index:n})=>[h(w(n+1+(i(r).pageNo-1)*i(r).pageSize),1)]),_:1}),(m(!0),z(Y,null,$(i(pe),n=>(m(),z(Y,{key:n.label},[!n.children&&n.istrue?(m(),k(I,{key:n.prop,label:n.label,align:n.align,prop:n.prop,formatter:n.formatter,width:n.width},F({_:2},[n.slot==="actions"?{name:"default",fn:o(({row:p})=>[s(N,{link:"",type:"primary",onClick:M=>G(p.rack_id,p.location,p.rack_name)},{default:o(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):n.istrue?(m(),k(I,{key:1,label:n.label,align:n.align},{default:o(()=>[(m(!0),z(Y,null,$(n.children,p=>(m(),z(Y,{key:p.prop},[p.istrue?(m(),k(I,{key:p.prop,label:p.label,align:p.align,prop:p.prop,formatter:p.formatter,width:p.width},F({_:2},[p.slot==="actions"?{name:"default",fn:o(({row:M})=>[s(N,{link:"",type:"primary",onClick:ya=>G(M.rack_id,M.location,M.rack_name)},{default:o(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):ee("",!0)],64))),128))]),_:2},1032,["label","align"])):ee("",!0)],64))),128))]),_:2},[i(ce)?{name:"append",fn:o(()=>[ca]),key:"0"}:void 0]),1032,["data"])),[[K,i(x)]]),s(ye,{total:i(b),"page-size-arr":i(ie),layout:"sizes, prev, pager, next, jumper",page:i(r).pageNo,"onUpdate:page":e[2]||(e[2]=n=>i(r).pageNo=n),limit:i(r).pageSize,"onUpdate:limit":e[3]||(e[3]=n=>i(r).pageSize=n),onPagination:q},null,8,["total","page-size-arr","page","limit"]),l("div",ma,"\u5171 "+w(i(R))+" \u6761",1),ga,va,fa,ha,s(ke,null,{default:o(()=>[Z(l("div",{ref_key:"rankChartContainer",ref:S,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[K,i(x)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-c791192f"]]);export{ba as default};
