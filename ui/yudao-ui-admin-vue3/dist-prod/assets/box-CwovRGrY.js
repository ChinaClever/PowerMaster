import{d as fe,e as s,f as be,aj as we,g as ye,aX as L,h as _e,o as c,n as _,w as o,l as v,j as n,t as f,a as t,k as u,m as he,s as xe,aY as G,c as S,F as J,p as De,q as ke,aZ as Ye,S as Me,N as Ne,O as Be,P as ze,_ as Se,A as Ue,Q as Ce,D as Fe,G as Ve,R as qe,J as He,K as Ie}from"./index-mcOGIq4g.js";import{_ as Pe}from"./CommonMenu-CxUjeIT-.js";import{_ as Re}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as je}from"./download--D_IyRio.js";import{E as h}from"./index-5UHMZISN.js";import{f as K}from"./formatTime-f-_athMZ.js";import{I as Te}from"./index-D-gmWooi.js";import{P as x}from"./PDU-QxJ-Axz0.js";import{u as We}from"./useMessage-CGTQbR_M.js";import{_ as Ae}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const d=b=>(He("data-v-6a66eb38"),b=b(),Ie(),b),Ee=d(()=>n("br",null,null,-1)),Le=d(()=>n("br",null,null,-1)),Ge={class:"nav_data"},Je={class:"descriptions-container",style:{"font-size":"14px"}},Ke={class:"description-item"},Oe=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),Qe={class:"value"},Xe={class:"description-item"},Ze=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),$e={class:"value"},ea={class:"description-item"},aa=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ta={class:"value"},la=d(()=>n("div",null,[n("span",null,"\u5168\u90E8\u63D2\u63A5\u7BB1\u65B0\u589E\u7535\u8D39\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ra={key:1},na=d(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ia={class:"realTotal"},sa=Ae(fe({name:"BillStatistics",__name:"box",setup(b){const U=s([]),C=s(0),F=s(0),V=s(0),O=s(!1),q=s([]),H=s(""),I=s(""),Q=We(),D=s(!0),P=s([]),g=s(0),R=s(0),p=s(),r=be({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,devkeys:[]}),X=s([15,30,50,100]),Z=s(),k=s(!1);s([{imgUrl:x},{imgUrl:x},{imgUrl:x},{imgUrl:x}]);const $=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];we(()=>r.granularity,()=>{r.granularity=="day"?Y.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:w,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:j},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:Y.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u5F00\u59CB\u65E5\u671F",align:"center",prop:"start_time",formatter:w,istrue:!0},{label:"\u7ED3\u675F\u65E5\u671F",align:"center",prop:"end_time",formatter:w,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:y}],N()});const Y=s([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:w,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:j},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]),M=async()=>{D.value=!0;try{if(p.value!=null){const e=K(p.value[0]),l=K(p.value[1]);r.timeRange=[e,l]}const a=await h.getBoxBillDataPage(r);P.value=a.list,R.value=a.total,a.total>1e4?g.value=1e4:g.value=a.total}finally{D.value=!1}},ee=ye(()=>{const a=Math.ceil(g.value/r.pageSize);return r.pageNo===a&&g.value>=1e4});function w(a,e,l){return l?L(l).format("YYYY-MM-DD"):""}function y(a,e,l){return Number(l).toFixed(1)}function j(a,e,l){return Number(l).toFixed(1)}const ae=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},N=()=>{r.pageNo=1,M()},te=async()=>{try{await Q.exportConfirm(),r.pageNo=1,k.value=!0;const a={timeout:0},e=await h.exportBoxBillPageData(r,a);await je.excel(e,"\u63D2\u63A5\u7BB1\u7535\u8D39\u7EDF\u8BA1.xlsx")}catch{}finally{k.value=!1}},le=async a=>{let e=[];a.forEach(l=>{l.type==7&&e.push(l.unique)}),e.length==0&&a.length!=0&&(e.push(0),Ye({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),r.devkeys=e,N()},T=a=>L(a).format("YYYY-MM-DD");return _e(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);p.value=[T(e),T(a)],(async()=>{const l=await Te.getBoxMenu();U.value=l})(),(async()=>{const l=await h.getBoxNavNewData({});C.value=l.day,F.value=l.week,V.value=l.month})(),M()}),(a,e)=>{const l=Me,re=Ne,B=Be,ne=ze,W=Se,z=Ue,ie=Ce,A=Fe,se=Ve,oe=Re,ue=Pe,pe=qe;return c(),_(ue,{dataList:t(U),onCheck:le,navTitle:"\u63D2\u63A5\u7BB1\u7535\u8D39\u7EDF\u8BA1"},{NavInfo:o(()=>[Ee,v(),Le,n("div",Ge,[n("div",Je,[n("div",Ke,[Oe,n("span",Qe,f(t(C))+"\u6761",1)]),n("div",Xe,[Ze,n("span",$e,f(t(F))+"\u6761",1)]),n("div",ea,[aa,n("span",ta,f(t(V))+"\u6761",1)]),la])])]),ActionBar:o(()=>[u(ie,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:Z,inline:!0,"label-width":"auto"},{default:o(()=>[u(B,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:o(()=>[u(re,{modelValue:t(r).granularity,"onUpdate:modelValue":e[0]||(e[0]=i=>t(r).granularity=i),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:o(()=>[u(l,{label:"\u5929",value:"day"}),u(l,{label:"\u5468",value:"week"}),u(l,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),u(B,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[u(ne,{format:"YYYY-MM-DD HH:mm:ss",modelValue:t(p),"onUpdate:modelValue":e[1]||(e[1]=i=>he(p)?p.value=i:null),type:"daterange",shortcuts:$,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ae},null,8,["modelValue"])]),_:1}),u(B,null,{default:o(()=>[u(z,{onClick:N},{default:o(()=>[u(W,{icon:"ep:search",class:"mr-5px"}),v(" \u641C\u7D22")]),_:1}),u(z,{type:"success",plain:"",loading:t(k),onClick:te},{default:o(()=>[u(W,{icon:"ep:download",class:"mr-5px"}),v(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:o(()=>[xe((c(),_(se,{data:t(P),stripe:!0,"show-overflow-tooltip":!0},G({default:o(()=>[u(A,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:o(({$index:i})=>[v(f(i+1+(t(r).pageNo-1)*t(r).pageSize),1)]),_:1}),(c(!0),S(J,null,De(t(Y),i=>(c(),S(J,null,[i.istrue?(c(),_(A,{key:i.prop,label:i.label,align:i.align,prop:i.prop,formatter:i.formatter,width:i.width},G({_:2},[i.slot==="actions"&&t(r).granularity=="day"?{name:"default",fn:o(({row:m})=>[m.bill_mode_real&&m.bill_mode_real==2?(c(),_(z,{key:0,link:"",type:"primary",onClick:oa=>(async(ce,E,de,me)=>{q.value=[],H.value="",I.value="";let ge={boxId:ce,startTime:E};const ve=await h.getBoxSubBillDetails(ge);q.value=ve.list,H.value=de,I.value=E+" - "+me,O.value=!0})(m.box_id,m.start_time,m.location,m.end_time)},{default:o(()=>[v("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):(c(),S("div",ra,"\u56FA\u5B9A\u8BA1\u8D39"))]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):ke("",!0)],64))),256))]),_:2},[t(ee)?{name:"append",fn:o(()=>[na]),key:"0"}:void 0]),1032,["data"])),[[pe,t(D)]]),u(oe,{total:t(g),"page-size-arr":t(X),layout:"sizes, prev, pager, next, jumper",page:t(r).pageNo,"onUpdate:page":e[2]||(e[2]=i=>t(r).pageNo=i),limit:t(r).pageSize,"onUpdate:limit":e[3]||(e[3]=i=>t(r).pageSize=i),onPagination:M},null,8,["total","page-size-arr","page","limit"]),n("div",ia,"\u5171 "+f(t(R))+" \u6761",1)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-6a66eb38"]]);export{sa as default};
