import{d as ge,u as xe,e as _,f as fe,g as he,aj as we,aX as O,h as ye,o as d,n as V,w as s,l as w,j as o,t as y,a as t,k as m,m as Q,s as ke,aY as De,c as B,F as X,p as Ce,q as E,aZ as Be,S as Ne,N as Ye,O as Ae,c5 as Me,P as ze,_ as He,A as Se,Q as Ve,D as Ee,G as Re,R as Ue,J as Fe,K as Ie}from"./index-mcOGIq4g.js";import{_ as je}from"./CommonMenu-CxUjeIT-.js";import{_ as qe}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Pe}from"./download--D_IyRio.js";import{E as R}from"./index-CrozypxO.js";import{I as Le}from"./index-D-gmWooi.js";import{f as Z,e as $,c as ee,a as Te}from"./formatTime-f-_athMZ.js";import{u as We}from"./useMessage-CGTQbR_M.js";import{_ as Je}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const b=k=>(Fe("data-v-f2bf3fa1"),k=k(),Ie(),k),Ke=b(()=>o("br",null,null,-1)),Ge=b(()=>o("br",null,null,-1)),Oe={class:"nav_data"},Qe={class:"descriptions-container",style:{"font-size":"14px"}},Xe={class:"description-item"},Ze=b(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),$e={class:"value"},ea={class:"description-item"},aa=b(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ta={class:"value"},la={class:"description-item"},ra=b(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u5C0F\u65F6 :",-1)),na={class:"value"},ia=b(()=>o("div",null,[o("span",null,"\u5168\u90E8\u59CB\u7AEF\u7BB1\u65B0\u589E\u73AF\u5883\u8BB0\u5F55"),o("div",{class:"line",style:{"margin-top":"10px"}})],-1)),oa={key:0},ma=b(()=>o("tr",null,[o("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[o("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),_a={key:0,class:"realTotal"},sa=Je(ge({name:"BusEnvHistoryData",__name:"box",setup(k){const{push:ae}=xe(),U=_([]),F=_(0),I=_(0),j=_(0),te=We(),N=_(!0),Y=_([]),g=_(0),q=_(0),c=_(),l=fe({pageNo:1,pageSize:15,granularity:"realtime",timeRange:void 0,devkeys:[]}),le=_([15,30,50,100]),re=_(),A=_(!1),ne=[{text:"\u6700\u8FD1\u4E00\u5C0F\u65F6",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-1),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5929",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-1),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}}],ie={multiple:!0},x=_([["tem_a"],["tem_b"],["tem_c"],["tem_n"],["dev_key"]]),M=_([{value:"tem_a",label:"A\u8DEF\u6E29\u5EA6"},{value:"tem_b",label:"B\u8DEF\u6E29\u5EA6"},{value:"tem_c",label:"C\u8DEF\u6E29\u5EA6"},{value:"tem_n",label:"\u4E2D\u7EBF\u6E29\u5EA6"},{value:"dev_key",label:"\u8BBE\u5907\u5730\u5740"}]),z=_(["tem_a","tem_b","tem_c","tem_n","dev_key"]),oe=a=>{let e=a.map(u=>u[u.length-1]),r=z.value.filter(u=>!e.includes(u));D.value.forEach(u=>{var v,C;for(const h of e)if((v=u.prop)!=null&&v.startsWith(h)){u.istrue=!0;break}for(const h of r)if((C=u.prop)!=null&&C.startsWith(h)){u.istrue=!1;break}})},me=he(()=>{const a=Math.ceil(g.value/l.pageSize);return l.pageNo===a&&g.value>=1e4});we(()=>l.granularity,a=>{a=="realtime"?(x.value=[["tem_a"],["tem_b"],["tem_c"],["tem_n"],["dev_key"]],M.value=[{value:"tem_a",label:"A\u8DEF\u6E29\u5EA6"},{value:"tem_b",label:"B\u8DEF\u6E29\u5EA6"},{value:"tem_c",label:"C\u8DEF\u6E29\u5EA6"},{value:"tem_n",label:"\u4E2D\u7EBF\u6E29\u5EA6"},{value:"dev_key",label:"\u8BBE\u5907\u5730\u5740"}],z.value=["tem_a","tem_b","tem_c","tem_n","dev_key"],D.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"250px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u65F6\u95F4",align:"center",prop:"create_time",width:"200px",formatter:p,istrue:!0},{label:"A\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a",istrue:!0,formatter:n,width:"110px"},{label:"B\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b",istrue:!0,formatter:n,width:"110px"},{label:"C\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c",istrue:!0,formatter:n,width:"110px"},{label:"\u4E2D\u7EBF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n",istrue:!0,formatter:n,width:"110px"},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"100px"}],l.pageNo=1,l.pageSize=15,f()):(x.value=[["tem_a_value","tem_a_avg_value"],["tem_a_value","tem_a_max"],["tem_a_value","tem_a_min"],["tem_b_value","tem_b_avg_value"],["tem_b_value","tem_b_max"],["tem_b_value","tem_b_min"],["tem_c_value","tem_c_avg_value"],["tem_c_value","tem_c_max"],["tem_c_value","tem_c_min"],["tem_n_value","tem_n_avg_value"],["tem_n_value","tem_n_max"],["tem_n_value","tem_n_min"],["dev_key"]],M.value=[{value:"tem_a_value",label:"A\u8DEF\u6E29\u5EA6",children:[{value:"tem_a_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_a_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_a_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"tem_b_value",label:"B\u8DEF\u6E29\u5EA6",children:[{value:"tem_b_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_b_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_b_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"tem_c_value",label:"C\u8DEF\u6E29\u5EA6",children:[{value:"tem_c_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_c_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_c_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"tem_n_value",label:"\u4E2D\u7EBF\u6E29\u5EA6",children:[{value:"tem_n_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_n_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_n_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"dev_key",label:"\u8BBE\u5907\u5730\u5740"}],z.value=["tem_a_avg_value","tem_a_max","tem_a_min","tem_b_avg_value","tem_b_max","tem_b_min","tem_c_avg_value","tem_c_max","tem_c_min","tem_n_avg_value","tem_n_max","tem_n_min","dev_key"],D.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"250px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",width:"230px",istrue:!0,formatter:p},{label:"A\u8DEF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a_avg_value",istrue:!0,width:"180px",formatter:n},{label:"A\u8DEF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a_max_value",istrue:!0,width:"180px",formatter:n},{label:"A\u8DEF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_a_max_time",width:"230px",istrue:!0,formatter:p},{label:"A\u8DEF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a_min_value",istrue:!0,width:"180px",formatter:n},{label:"A\u8DEF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_a_min_time",width:"230px",istrue:!0,formatter:p},{label:"B\u8DEF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b_avg_value",istrue:!0,width:"180px",formatter:n},{label:"B\u8DEF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b_max_value",istrue:!0,width:"180px",formatter:n},{label:"B\u8DEF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_b_max_time",width:"230px",istrue:!0,formatter:p},{label:"B\u8DEF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b_min_value",istrue:!0,width:"180px",formatter:n},{label:"B\u8DEF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_b_min_time",width:"230px",istrue:!0,formatter:p},{label:"C\u8DEF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c_avg_value",istrue:!0,width:"180px",formatter:n},{label:"C\u8DEF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c_max_value",istrue:!0,width:"180px",formatter:n},{label:"C\u8DEF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_c_max_time",width:"230px",istrue:!0,formatter:p},{label:"C\u8DEF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c_min_value",istrue:!0,width:"180px",formatter:n},{label:"C\u8DEF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_c_min_time",width:"230px",istrue:!0,formatter:p},{label:"\u4E2D\u7EBF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n_avg_value",istrue:!0,width:"180px",formatter:n},{label:"\u4E2D\u7EBF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n_max_value",istrue:!0,width:"180px",formatter:n},{label:"\u4E2D\u7EBF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_n_max_time",width:"230px",istrue:!0,formatter:p},{label:"\u4E2D\u7EBF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n_min_value",istrue:!0,width:"180px",formatter:n},{label:"\u4E2D\u7EBF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_n_min_time",width:"230px",istrue:!0,formatter:p},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"160px"}],l.pageNo=1,l.pageSize=15,f())});const D=_([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"250px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u65F6\u95F4",align:"center",prop:"create_time",width:"200px",formatter:p,istrue:!0},{label:"A\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a",istrue:!0,formatter:n,width:"110px"},{label:"B\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b",istrue:!0,formatter:n,width:"110px"},{label:"C\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c",istrue:!0,formatter:n,width:"110px"},{label:"\u4E2D\u7EBF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n",istrue:!0,formatter:n,width:"110px"},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),f=async()=>{N.value=!0;try{if(c.value!=null){const e=Z($(ee(c.value[0]))),r=864e5,u=Z($(Te(ee(c.value[1]),r)));l.timeRange=[e,u]}const a=await R.getBoxEnvDataPage(l);Y.value=a.list,q.value=a.total,a.total>1e4?g.value=1e4:g.value=a.total}finally{N.value=!1}};function p(a,e,r){return r?O(r).format("YYYY-MM-DD HH:mm"):""}function n(a,e,r){return Number(r).toFixed(0)}const _e=async a=>{let e=[];a.forEach(r=>{r.type==7&&e.push(r.unique)}),e.length==0&&a.length!=0&&(e.push(0),Be({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),l.devkeys=e,P()},se=a=>a>new Date,P=()=>{l.pageNo=1,f()},ue=async()=>{try{await te.exportConfirm(),l.pageNo=1,A.value=!0;const a={timeout:0},e=await R.exportBoxEnvHistoryData(l,a);await Pe.excel(e,"\u63D2\u63A5\u7BB1\u73AF\u5883\u5386\u53F2\u6570\u636E.xlsx")}catch{}finally{A.value=!1}},L=a=>O(a).format("YYYY-MM-DD HH:mm:ss");return ye(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);c.value=[L(e),L(a)],(async()=>{const r=await Le.getBoxMenu();U.value=r})(),(async()=>{const r=await R.getBoxEnvNavNewData();F.value=r.hour,I.value=r.day,j.value=r.week})(),f()}),(a,e)=>{const r=Ne,u=Ye,v=Ae,C=Me,h=ze,T=He,H=Se,pe=Ve,W=Ee,ce=Re,ve=qe,de=je,be=Ue;return d(),V(de,{dataList:t(U),onCheck:_e,navTitle:"\u63D2\u63A5\u7BB1\u6E29\u5EA6\u6570\u636E"},{NavInfo:s(()=>[Ke,w(),Ge,o("div",Oe,[o("div",Qe,[o("div",Xe,[Ze,o("span",$e,y(t(j))+"\u6761",1)]),o("div",ea,[aa,o("span",ta,y(t(I))+"\u6761",1)]),o("div",la,[ra,o("span",na,y(t(F))+"\u6761",1)]),ia])])]),ActionBar:s(()=>[m(pe,{class:"-mb-15px",model:t(l),ref_key:"queryFormRef",ref:re,inline:!0,"label-width":"auto"},{default:s(()=>[m(v,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:s(()=>[m(u,{modelValue:t(l).granularity,"onUpdate:modelValue":e[0]||(e[0]=i=>t(l).granularity=i),placeholder:"\u8BF7\u9009\u62E9\u5206\u949F/\u5C0F\u65F6/\u5929",class:"!w-100px"},{default:s(()=>[m(r,{label:"\u5206\u949F",value:"realtime"}),m(r,{label:"\u5C0F\u65F6",value:"hour"}),m(r,{label:"\u5929",value:"day"})]),_:1},8,["modelValue"])]),_:1}),m(v,{label:"\u7B5B\u9009\u5217"},{default:s(()=>[m(C,{modelValue:t(x),"onUpdate:modelValue":e[1]||(e[1]=i=>Q(x)?x.value=i:null),options:t(M),props:ie,"collapse-tags":"","collapse-tags-tooltip":"","show-all-levels":!1,onChange:oe,class:"!w-200px"},null,8,["modelValue","options"])]),_:1}),m(v,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:s(()=>[m(h,{"value-format":"YYYY-MM-DD HH:mm:ss",modelValue:t(c),"onUpdate:modelValue":e[2]||(e[2]=i=>Q(c)?c.value=i:null),type:"datetimerange",shortcuts:ne,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":se,class:"!w-335px"},null,8,["modelValue"])]),_:1}),m(v,null,{default:s(()=>[m(H,{onClick:P},{default:s(()=>[m(T,{icon:"ep:search",class:"mr-5px"}),w(" \u641C\u7D22")]),_:1}),m(H,{type:"success",plain:"",onClick:ue,loading:t(A)},{default:s(()=>[m(T,{icon:"ep:download",class:"mr-5px"}),w(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:s(()=>[ke((d(),V(ce,{data:t(Y),"show-overflow-tooltip":!1},De({default:s(()=>[m(W,{label:"\u5E8F\u53F7",align:"center",width:"100px"},{default:s(({$index:i})=>[w(y(i+1+(t(l).pageNo-1)*t(l).pageSize),1)]),_:1}),(d(!0),B(X,null,Ce(t(D),i=>(d(),B(X,null,[i.istrue?(d(),V(W,{key:i.prop,label:i.label,align:i.align,prop:i.prop,formatter:i.formatter,width:i.width},{default:s(({row:S})=>[i.slot==="actions"?(d(),B("div",oa,[m(H,{link:"",type:"primary",onClick:ua=>{return J=S.box_id,K=S.dev_key,G=S.location,void ae({path:"/bus/record/envAnalysis/box",state:{boxId:J,devKey:K,location:G}});var J,K,G}},{default:s(()=>[w("\u8BE6\u60C5")]),_:2},1032,["onClick"])])):E("",!0)]),_:2},1032,["label","align","prop","formatter","width"])):E("",!0)],64))),256))]),_:2},[t(me)?{name:"append",fn:s(()=>[ma]),key:"0"}:void 0]),1032,["data"])),[[be,t(N)]]),m(ve,{total:t(g),"page-size-arr":t(le),layout:"sizes, prev, pager, next, jumper",page:t(l).pageNo,"onUpdate:page":e[3]||(e[3]=i=>t(l).pageNo=i),limit:t(l).pageSize,"onUpdate:limit":e[4]||(e[4]=i=>t(l).pageSize=i),onPagination:f},null,8,["total","page-size-arr","page","limit"]),t(Y).length!=0?(d(),B("div",_a,"\u5171 "+y(t(q))+" \u6761",1)):E("",!0)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-f2bf3fa1"]]);export{sa as default};
