import{d as Ye,u as Ie,e as i,an as Fe,f as Se,aj as Pe,g as Ue,aX as ne,h as Ae,o as g,n as _,w as s,l as b,j as n,t as w,a as o,k as u,m as Be,s as re,aY as Q,c as Y,F as I,p as oe,q as ie,aZ as Re,S as Ve,N as qe,O as Ee,P as We,_ as Le,A as Qe,Q as je,D as Ke,G as He,R as Je,J as Oe,K as Te}from"./index-mcOGIq4g.js";import{_ as Xe}from"./CommonMenu-CxUjeIT-.js";import{_ as Ge}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Ze}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as $e}from"./download--D_IyRio.js";import{E as F}from"./index-5UHMZISN.js";import{f as S,e as P,c as U,a as ea}from"./formatTime-f-_athMZ.js";import{I as aa}from"./index-D-gmWooi.js";import"./index-KYPw-eK3.js";import{P as A}from"./PDU-QxJ-Axz0.js";import{u as ta}from"./useMessage-CGTQbR_M.js";import{i as la}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as na}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const c=k=>(Oe("data-v-68ea370f"),k=k(),Te(),k),ra=c(()=>n("br",null,null,-1)),oa=c(()=>n("br",null,null,-1)),ia={class:"nav_data"},sa={class:"nav_content"},ua={class:"descriptions-container",style:{"font-size":"14px"}},pa={class:"description-item"},da=c(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ca={class:"value"},ma={class:"description-item"},va=c(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),ga={class:"value"},fa={class:"description-item"},ha=c(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ya={class:"value"},ba=c(()=>n("br",null,null,-1)),xa=c(()=>n("div",null,[n("span",null,"\u6BCD\u7EBF\u63D2\u63A5\u7BB1\u65B0\u589E\u80FD\u8017\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),_a=c(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),wa={class:"realTotal"},ka=c(()=>n("br",null,null,-1)),Da=c(()=>n("br",null,null,-1)),Na=c(()=>n("br",null,null,-1)),za=c(()=>n("br",null,null,-1)),Ca=na(Ye({name:"PowerAnalysis",__name:"box",setup(k){var $,ee,ae;const se=ta(),{push:ue}=Ie(),j=i([]),K=i(0),H=i(0),J=i(0),O=Fe(),x=i(!0),m=i([]),h=i(0),B=i(0),f=i(void 0),l=Se({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,devkeys:void 0}),pe=i([15,30,50,100]),de=i(),R=i(!1);i([{imgUrl:A},{imgUrl:A},{imgUrl:A},{imgUrl:A}]);const ce=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],me=a=>{const e=(a-1)*l.pageSize+1,t=a*l.pageSize,p=[];for(let y=e;y<=t;y++)p.push("\u5E8F\u53F7"+y);return p},V=i(null);let v=null;const q=i([]),T=()=>{if(V.value&&O){const e=ve(l.pageNo);v=la(V.value),v.setOption({title:{text:"\u5404\u63D2\u63A5\u7BB1\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:fe},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:me(l.pageNo),axisLabel:{interval:0,formatter:function(t,p){return e>30?"":t}}},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:q.value,barWidth:"auto",label:{show:e<=30,position:"top"}}]}),O.appContext.config.globalProperties.rankChart=v}};window.addEventListener("resize",function(){v==null||v.resize()}),Pe(()=>l.granularity,()=>{W()});const ve=a=>{const e=(a-1)*l.pageSize+1;return a*l.pageSize-e+1},ge=i([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"200px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u8BB0\u5F55\u65E5\u671F",align:"center",prop:"create_time",formatter:D,width:"140px",istrue:!0},{label:"\u5F00\u59CB",align:"center",istrue:!0,children:[{label:"\u7535\u80FD(kWh)",align:"center",prop:"start_ele",istrue:!0,formatter:N},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:X,width:"100px",istrue:!0}]},{label:"\u7ED3\u675F",align:"center",istrue:!0,children:[{label:"\u7535\u80FD(kWh)",align:"center",prop:"end_ele",istrue:!0,formatter:N},{label:"\u65E5\u671F",align:"center",prop:"end_time",formatter:X,width:"100px",istrue:!0}]},{label:`\u8017\u7535\u91CF
(kWh)`,align:"center",prop:"eq_value",istrue:!0,formatter:function(a,e,t){let p;return l.granularity=="day"?(p=a.end_ele-a.start_ele,p<0&&(p=a.end_ele)):p=a.end_ele-a.start_ele,Number(p).toFixed(1)}},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),E=async()=>{x.value=!0;try{if(f.value!=null){const e=S(P(U(f.value[0]))),t=864e5,p=S(P(ea(U(f.value[1]),t)));l.timeRange=[e,p]}f.value==null&&(l.timeRange=void 0);const a=await F.getBoxEQDataPage(l);q.value=a.list.map(e=>G(e.eq_value,1)),m.value=a.list,B.value=a.total,a.total>1e4?h.value=1e4:h.value=a.total}finally{T(),x.value=!1}};function fe(a){var e="",t=a[0];return e+="\u6240\u5728\u4F4D\u7F6E\uFF1A"+(m.value[t.dataIndex].location?m.value[t.dataIndex].location:"\u672A\u7ED1\u5B9A\u8BBE\u5907")+"  ",e+="<br/>"+t.marker+"\u8BB0\u5F55\u65E5\u671F\uFF1A"+D(null,null,m.value[t.dataIndex].create_time)+" "+t.seriesName+": "+t.value+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+D(null,null,m.value[t.dataIndex].end_time)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+N(null,null,m.value[t.dataIndex].end_ele)+"kWh <br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+D(null,null,m.value[t.dataIndex].start_time)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+N(null,null,m.value[t.dataIndex].start_ele)+"kWh <br/>"}const he=Ue(()=>{const a=Math.ceil(h.value/l.pageSize);return l.pageNo===a&&h.value>=1e4});function D(a,e,t){return t?ne(t).format("YYYY-MM-DD"):""}function X(a,e,t){return t?ne(t).format("MM-DD"):""}function N(a,e,t){return Number(t).toFixed(1)}function G(a,e){return isNaN(a)?null:a.toFixed(e)}const ye=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},W=()=>{l.pageNo=1,E()},be=async a=>{let e=[];a.forEach(t=>{t.type==7&&e.push(t.unique)}),e.length==0&&a.length!=0&&(e.push(0),v==null||v.clear(),Re({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),l.devkeys=e,W()},xe=async()=>{try{await se.exportConfirm(),l.pageNo=1,R.value=!0;const a={timeout:0},e=await F.exportBoxEQPageData(l,a);await $e.excel(e,"\u63D2\u63A5\u7BB1\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{R.value=!1}},Z=(a,e,t)=>{ue({path:"/bus/nenghao/ecdistribution/box",state:{id:a,devKey:t,locationName:e}})},L=i(($=history==null?void 0:history.state)==null?void 0:$.start),_e=i((ee=history==null?void 0:history.state)==null?void 0:ee.end),we=i((ae=history==null?void 0:history.state)==null?void 0:ae.devKey);return Ae(()=>{(async()=>{const e=await aa.getBoxMenu();j.value=e})(),(async()=>{const e=await F.getBoxNavNewData({});K.value=e.day,H.value=e.week,J.value=e.month})();const a=new Date;new Date(a.getFullYear(),a.getMonth(),1),L.value!=null?(async()=>{x.value=!0;try{if(L.value!=null){const t=S(P(U(L.value))),p=S(P(U(_e.value)));f.value=[t,p],l.timeRange=[t,p]}l.devkeys=[we.value];const e=await F.getBoxEQDataPage(l);q.value=e.list.map(t=>G(t.eq_value,1)),m.value=e.list,B.value=e.total,e.total>1e4?h.value=1e4:h.value=e.total}finally{T(),x.value=!1}})():E()}),(a,e)=>{const t=Ve,p=qe,y=Ee,ke=We,te=Le,z=Qe,De=je,C=Ke,Ne=He,ze=Ze,Ce=Ge,Me=Xe,le=Je;return g(),_(Me,{dataList:o(j),onCheck:be,navTitle:"\u6BCD\u7EBF\u63D2\u63A5\u7BB1\u80FD\u8017\u8D8B\u52BF"},{NavInfo:s(()=>[ra,b(),oa,n("div",ia,[n("div",sa,[n("div",ua,[n("div",pa,[da,n("span",ca,w(o(K))+"\u6761",1)]),n("div",ma,[va,n("span",ga,w(o(H))+"\u6761",1)]),n("div",fa,[ha,n("span",ya,w(o(J))+"\u6761",1)]),b(),ba,xa])])])]),ActionBar:s(()=>[u(De,{class:"-mb-15px",model:o(l),ref_key:"queryFormRef",ref:de,inline:!0,"label-width":"auto"},{default:s(()=>[u(y,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:s(()=>[u(p,{modelValue:o(l).granularity,"onUpdate:modelValue":e[0]||(e[0]=r=>o(l).granularity=r),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:s(()=>[u(t,{label:"\u5929",value:"day"}),u(t,{label:"\u5468",value:"week"}),u(t,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),u(y,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:s(()=>[u(ke,{"value-format":"YYYY-MM-DD",modelValue:o(f),"onUpdate:modelValue":e[1]||(e[1]=r=>Be(f)?f.value=r:null),type:"daterange",shortcuts:ce,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":ye},null,8,["modelValue"])]),_:1}),u(y,null,{default:s(()=>[u(z,{onClick:W},{default:s(()=>[u(te,{icon:"ep:search",class:"mr-5px"}),b(" \u641C\u7D22")]),_:1}),u(z,{type:"success",plain:"",loading:o(R),onClick:xe},{default:s(()=>[u(te,{icon:"ep:download",class:"mr-5px"}),b(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:s(()=>[re((g(),_(Ne,{data:o(m),stripe:!0,"show-overflow-tooltip":!0},Q({default:s(()=>[u(C,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:s(({$index:r})=>[b(w(r+1+(o(l).pageNo-1)*o(l).pageSize),1)]),_:1}),(g(!0),Y(I,null,oe(o(ge),r=>(g(),Y(I,{key:r.label},[!r.children&&r.istrue?(g(),_(C,{key:r.prop,label:r.label,align:r.align,prop:r.prop,formatter:r.formatter,width:r.width},Q({_:2},[r.slot==="actions"?{name:"default",fn:s(({row:d})=>[u(z,{link:"",type:"primary",onClick:M=>Z(d.box_id,d.location,d.dev_key)},{default:s(()=>[b("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):r.istrue?(g(),_(C,{key:1,label:r.label,align:r.align},{default:s(()=>[(g(!0),Y(I,null,oe(r.children,d=>(g(),Y(I,{key:d.prop},[d.istrue?(g(),_(C,{key:d.prop,label:d.label,align:d.align,prop:d.prop,formatter:d.formatter,width:d.width},Q({_:2},[d.slot==="actions"?{name:"default",fn:s(({row:M})=>[u(z,{link:"",type:"primary",onClick:Ma=>Z(M.box_id,M.location,M.dev_key)},{default:s(()=>[b("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):ie("",!0)],64))),128))]),_:2},1032,["label","align"])):ie("",!0)],64))),128))]),_:2},[o(he)?{name:"append",fn:s(()=>[_a]),key:"0"}:void 0]),1032,["data"])),[[le,o(x)]]),u(ze,{total:o(h),"page-size-arr":o(pe),layout:"sizes, prev, pager, next, jumper",page:o(l).pageNo,"onUpdate:page":e[2]||(e[2]=r=>o(l).pageNo=r),limit:o(l).pageSize,"onUpdate:limit":e[3]||(e[3]=r=>o(l).pageSize=r),onPagination:E},null,8,["total","page-size-arr","page","limit"]),n("div",wa,"\u5171 "+w(o(B))+" \u6761",1),ka,Da,Na,za,u(Ce,null,{default:s(()=>[re(n("div",{ref_key:"rankChartContainer",ref:V,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[le,o(x)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-68ea370f"]]);export{Ca as default};
