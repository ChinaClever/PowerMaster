import{d as Se,u as He,e as s,f as Ie,g as Ve,aj as Me,aX as Re,h as Ye,o as d,n as V,w as o,l as C,j as n,t as x,a as l,k as i,m as B,c as w,F as j,p as le,s as ze,aY as Ue,q,aZ as Ee,S as $e,N as Fe,O as Pe,c5 as Ae,P as Be,_ as je,A as qe,Q as Le,D as Te,G as We,R as Ge,J as Je,K as Ke}from"./index-mcOGIq4g.js";import{_ as Oe}from"./CommonMenu-CxUjeIT-.js";import{_ as Qe}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Xe}from"./download--D_IyRio.js";import{E as L}from"./index-DmHmIPl8.js";import{C as Ze}from"./index-JEsRnusb.js";import{f as te}from"./formatTime-f-_athMZ.js";import{P as M}from"./PDU-QxJ-Axz0.js";import{u as ea}from"./useMessage-CGTQbR_M.js";import{_ as aa}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const b=S=>(Je("data-v-3331b579"),S=S(),Ke(),S),la=b(()=>n("br",null,null,-1)),ta=b(()=>n("br",null,null,-1)),ra={class:"nav_data"},na={class:"descriptions-container",style:{"font-size":"14px"}},ia={class:"description-item"},sa=b(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5C0F\u65F6 :",-1)),oa={class:"value"},ua={class:"description-item"},pa=b(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ma={class:"value"},da={class:"description-item"},ca=b(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),va={class:"value"},ga=b(()=>n("div",null,[n("span",null,"\u5168\u90E8\u4F20\u611F\u5668\u65B0\u589E\u73AF\u5883\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ha={style:{float:"right"}},_a={key:0},ba={key:1},fa=b(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),xa={key:0,class:"realTotal"},wa=aa(Se({name:"PDUEnvHistoryData",__name:"index",setup(S){const{push:re}=He(),T=s([]),W=s(0),G=s(0),J=s(0),ne=ea(),R=s(!0),Y=s([]),y=s(0),K=s(0),f=s("all"),h=s(),t=Ie({pageNo:1,pageSize:15,granularity:"realtime",channel:void 0,position:void 0,timeRange:void 0,cabinetIds:[]}),ie=s([15,30,50,100]),se=s(),z=s(!1);s([{imgUrl:M},{imgUrl:M},{imgUrl:M},{imgUrl:M}]);const oe=[{text:"\u6700\u8FD1\u4E00\u5C0F\u65F6",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-1),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5929",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-1),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}}],ue=s([{value:"all",label:"\u5168\u90E8"},{value:"1",label:"\u4F20\u611F\u56681"},{value:"2",label:"\u4F20\u611F\u56682"},{value:"3",label:"\u4F20\u611F\u56683"},{value:"4",label:"\u4F20\u611F\u56684"}]),pe={multiple:!0},D=s([["tem"],["hum"],["sensor_id"]]),U=s([{value:"tem",label:"\u6E29\u5EA6"},{value:"hum",label:"\u6E7F\u5EA6"},{value:"sensor_id",label:"\u4F20\u611F\u5668ID"},{value:"location",label:"\u7F51\u7EDC\u5730\u5740"}]),E=s(["tem","hum","location","sensor_id"]),me=a=>{let e=a.map(u=>u[u.length-1]),r=E.value.filter(u=>!e.includes(u));H.value.forEach(u=>{var v,I;for(const N of e)if((v=u.prop)!=null&&v.startsWith(N)){u.istrue=!0;break}for(const N of r)if((I=u.prop)!=null&&I.startsWith(N)){u.istrue=!1;break}})},de=Ve(()=>{const a=Math.ceil(y.value/t.pageSize);return t.pageNo===a&&y.value>=1e4});Me(()=>t.granularity,a=>{a=="realtime"?(D.value=[["tem"],["hum"]],U.value=[{value:"tem",label:"\u6E29\u5EA6"},{value:"hum",label:"\u6E7F\u5EA6"},{value:"sensor_id",label:"\u4F20\u611F\u5668ID"},{value:"location",label:"\u7F51\u7EDC\u5730\u5740"}],E.value=["tem","hum","location","sensor_id"],H.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"address.address",istrue:!0,width:"180px"},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!1,width:"180px"},{label:"\u65F6\u95F4",align:"center",prop:"create_time",width:"200px",formatter:_,istrue:!0},{label:"\u76D1\u6D4B\u70B9",align:"center",slot:"detect",istrue:!0},{label:"\u4F20\u611F\u5668ID",align:"center",prop:"sensor_id",istrue:!1,width:"120px"},{label:"\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_value",istrue:!0,formatter:c},{label:"\u6E7F\u5EA6(%RH)",align:"center",prop:"hum_value",istrue:!0,formatter:c},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}],t.pageNo=1,t.pageSize=15,k()):(D.value=[["tem_value","tem_avg_value"],["tem_value","tem_max"],["tem_value","tem_min"],["hum_value","hum_avg_value"],["hum_value","hum_max"],["hum_value","hum_min"]],U.value=[{value:"tem_value",label:"\u6E29\u5EA6",children:[{value:"tem_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"hum_value",label:"\u6E7F\u5EA6",children:[{value:"hum_avg_value",label:"\u5E73\u5747\u6E7F\u5EA6"},{value:"hum_max",label:"\u6700\u5927\u6E7F\u5EA6"},{value:"hum_min",label:"\u6700\u5C0F\u6E7F\u5EA6"}]},{value:"sensor_id",label:"\u4F20\u611F\u5668ID"},{value:"location",label:"\u7F51\u7EDC\u5730\u5740"}],E.value=["tem_avg_value","tem_max","tem_min","hum_avg_value","hum_max","hum_min","location","sensor_id"],H.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"address.address",istrue:!0,width:"180px"},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!1,width:"160px"},{label:"\u76D1\u6D4B\u70B9",align:"center",slot:"detect",istrue:!0},{label:"\u4F20\u611F\u5668ID",align:"center",prop:"sensor_id",istrue:!1,width:"160px"},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",width:"230px",istrue:!0,formatter:_},{label:"\u5E73\u5747\u6E7F\u5EA6(%RH)",align:"center",prop:"hum_avg_value",istrue:!1,width:"180px",formatter:c},{label:"\u6700\u5927\u6E7F\u5EA6(%RH)",align:"center",prop:"hum_max_value",istrue:!1,width:"180px",formatter:c},{label:"\u6700\u5927\u6E7F\u5EA6\u65F6\u95F4",align:"center",prop:"hum_max_time",width:"230px",istrue:!1,formatter:_},{label:"\u6700\u5C0F\u6E7F\u5EA6(%RH)",align:"center",prop:"hum_min_value",istrue:!1,width:"180px",formatter:c},{label:"\u6700\u5C0F\u6E7F\u5EA6\u65F6\u95F4",align:"center",prop:"hum_min_time",width:"230px",istrue:!1,formatter:_},{label:"\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_avg_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_max_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_max_time",width:"230px",istrue:!0,formatter:_},{label:"\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_min_value",istrue:!0,width:"180px",formatter:c},{label:"\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_min_time",width:"230px",istrue:!0,formatter:_},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"160px"}],t.pageNo=1,t.pageSize=15,k())});const H=s([{label:"\u4F4D\u7F6E",align:"center",prop:"address.address",istrue:!0,width:"230px"},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!1,width:"180px"},{label:"\u65F6\u95F4",align:"center",prop:"create_time",width:"200px",formatter:_,istrue:!0},{label:"\u76D1\u6D4B\u70B9",align:"center",slot:"detect",istrue:!0},{label:"\u4F20\u611F\u5668ID",align:"center",prop:"sensor_id",istrue:!0,width:"120px"},{label:"\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_value",istrue:!0,formatter:c},{label:"\u6E7F\u5EA6(%RH)",align:"center",prop:"hum_value",istrue:!0,formatter:function(a,e,r){return Number(r).toFixed(0)}},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),k=async()=>{R.value=!0;try{if(h.value!=null){const e=te(h.value[0]),r=te(h.value[1]);t.timeRange=[e,r]}const a=await L.getEnvDataPageByCabinet(t);Y.value=a.list,K.value=a.total,a.total>1e4?y.value=1e4:y.value=a.total}finally{R.value=!1}};function ce(a,e){let r="",u="";return a===1?r="\u524D":a===2&&(r="\u540E"),e===1?u="\u4E0A":e===2?u="\u4E2D":e===3&&(u="\u4E0B"),`${r}${u}`}function _(a,e,r){return r?Re(r).format("YYYY-MM-DD HH:mm"):""}function c(a,e,r){return Number(r).toFixed(1)}const ve=async a=>{let e=[];a.forEach(r=>{r.type==3&&e.push(r.id)}),e.length==0&&a.length!=0&&(e.push(0),Ee({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),t.cabinetIds=e,$()},ge=a=>a>new Date,$=()=>{t.pageNo=1,f.value!="all"?(t.channel=Number(f.value.split("")[0]),t.position=Number(f.value.split("")[0])):(t.channel=void 0,t.position=void 0),O(),k()},he=async()=>{try{await ne.exportConfirm(),t.pageNo=1,z.value=!0;const a={timeout:0},e=await L.exportEnvHistoryDataByCabinet(t,a);await Xe.excel(e,"\u673A\u67DC\u73AF\u5883\u8BB0\u5F55.xlsx")}catch{}finally{z.value=!1}},O=async()=>{const a=await L.getEnvNavNewDataByCabinet({});W.value=a.hour,G.value=a.day,J.value=a.week},Q=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return Ye(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);h.value=[Q(e),Q(a)],(async()=>{const r=await Ze.getRoomMenuAll({});T.value=r})(),O(),k()}),(a,e)=>{const r=$e,u=Fe,v=Pe,I=Ae,N=Be,X=je,F=qe,_e=Le,Z=Te,be=We,fe=Qe,xe=Oe,we=Ge;return d(),V(xe,{dataList:l(T),onCheck:ve,navTitle:"\u673A\u67DC\u73AF\u5883\u6570\u636E",placeholder:"\u673A\u67DC\u540D"},{NavInfo:o(()=>[la,C(),ta,n("div",ra,[n("div",na,[n("div",ia,[sa,n("span",oa,x(l(W))+"\u6761",1)]),n("div",ua,[pa,n("span",ma,x(l(G))+"\u6761",1)]),n("div",da,[ca,n("span",va,x(l(J))+"\u6761",1)]),ga])])]),ActionBar:o(()=>[i(_e,{class:"-mb-15px",model:l(t),ref_key:"queryFormRef",ref:se,inline:!0,"label-width":"auto"},{default:o(()=>[i(v,{label:"\u4F20\u611F\u5668ID",prop:"detect"},{default:o(()=>[i(u,{modelValue:l(f),"onUpdate:modelValue":e[0]||(e[0]=m=>B(f)?f.value=m:null),class:"!w-130px",onChange:$},{default:o(()=>[(d(!0),w(j,null,le(l(ue),m=>(d(),V(r,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(v,{label:"\u9897\u7C92\u5EA6",prop:"type"},{default:o(()=>[i(u,{modelValue:l(t).granularity,"onUpdate:modelValue":e[1]||(e[1]=m=>l(t).granularity=m),placeholder:"\u8BF7\u9009\u62E9\u5206\u949F/\u5C0F\u65F6/\u5929",class:"!w-100px"},{default:o(()=>[i(r,{label:"\u5206\u949F",value:"realtime"}),i(r,{label:"\u5C0F\u65F6",value:"hour"}),i(r,{label:"\u5929",value:"day"})]),_:1},8,["modelValue"])]),_:1}),i(v,{label:"\u7B5B\u9009\u5217"},{default:o(()=>[i(I,{modelValue:l(D),"onUpdate:modelValue":e[2]||(e[2]=m=>B(D)?D.value=m:null),options:l(U),props:pe,"collapse-tags":"","collapse-tags-tooltip":"","show-all-levels":!1,onChange:me,class:"!w-200px"},null,8,["modelValue","options"])]),_:1}),i(v,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[i(N,{format:"YYYY-MM-DD HH:mm:ss",modelValue:l(h),"onUpdate:modelValue":e[3]||(e[3]=m=>B(h)?h.value=m:null),type:"datetimerange",shortcuts:oe,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ge,class:"!w-335px"},null,8,["modelValue"])]),_:1}),i(v,null,{default:o(()=>[i(F,{onClick:$},{default:o(()=>[i(X,{icon:"ep:search",class:"mr-5px"}),C(" \u641C\u7D22")]),_:1})]),_:1}),n("div",ha,[i(F,{type:"success",plain:"",onClick:he,loading:l(z)},{default:o(()=>[i(X,{icon:"ep:download",class:"mr-5px"}),C(" \u5BFC\u51FA ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),Content:o(()=>{var m;return[ze((d(),V(be,{data:l(Y),"show-overflow-tooltip":!0},Ue({default:o(()=>[i(Z,{label:"\u5E8F\u53F7",align:"center",width:"100px"},{default:o(({$index:p})=>[C(x(p+1+(l(t).pageNo-1)*l(t).pageSize),1)]),_:1}),(d(!0),w(j,null,le(l(H),p=>(d(),w(j,null,[p.istrue?(d(),V(Z,{key:p.prop,label:p.label,align:p.align,prop:p.prop,formatter:p.formatter,width:p.width},{default:o(({row:g})=>{var ee,ae;return[p.slot==="actions"?(d(),w("div",_a,[i(F,{link:"",type:"primary",onClick:ya=>((ye,De,ke,P,A,Ne)=>{let Ce=(P==null?void 0:P.toString())+(A==null?void 0:A.toString());re("/cabinet/record/CabinetEnvAnalysis?pduId="+ye+"&location="+De+"&address="+ke+"&detectValue="+Ce+"&sensorId="+Ne)})(g.pdu_id,g.location,g.address.address,g.address.channel,g.address.position,g.sensor_id)},{default:o(()=>[C("\u8BE6\u60C5")]),_:2},1032,["onClick"])])):p.slot==="detect"?(d(),w("div",ba,x(ce((ee=g.address)==null?void 0:ee.channel,(ae=g.address)==null?void 0:ae.position)),1)):q("",!0)]}),_:2},1032,["label","align","prop","formatter","width"])):q("",!0)],64))),256))]),_:2},[l(de)?{name:"append",fn:o(()=>[fa]),key:"0"}:void 0]),1032,["data"])),[[we,l(R)]]),i(fe,{total:l(y),"page-size-arr":l(ie),layout:"sizes, prev, pager, next, jumper",page:l(t).pageNo,"onUpdate:page":e[4]||(e[4]=p=>l(t).pageNo=p),limit:l(t).pageSize,"onUpdate:limit":e[5]||(e[5]=p=>l(t).pageSize=p),onPagination:k},null,8,["total","page-size-arr","page","limit"]),((m=l(Y))==null?void 0:m.length)!=0?(d(),w("div",xa,"\u5171 "+x(l(K))+" \u6761",1)):q("",!0)]}),_:1},8,["dataList"])}}}),[["__scopeId","data-v-3331b579"]]);export{wa as default};
