import{d as fe,e as i,f as be,aj as ye,g as _e,aX as L,h as we,o as c,n as w,w as o,l as v,j as n,t as f,a as t,k as u,m as he,s as xe,aY as G,c as z,F as J,p as De,q as ke,aZ as Ye,S as Me,N as Ne,O as Ce,P as Ue,_ as ze,A as Fe,Q as Se,D as Re,G as qe,R as Be,J as He,K as Ie}from"./index-mcOGIq4g.js";import{_ as Te}from"./CommonMenu-CxUjeIT-.js";import{_ as Ve}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Pe}from"./download--D_IyRio.js";import{E as h}from"./index-CRHHgC4s.js";import{f as K}from"./formatTime-f-_athMZ.js";import{C as je}from"./index-JEsRnusb.js";import{P as x}from"./PDU-QxJ-Axz0.js";import{u as Ae}from"./useMessage-CGTQbR_M.js";import{_ as We}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const m=b=>(He("data-v-424f20f3"),b=b(),Ie(),b),Ee=m(()=>n("br",null,null,-1)),Le=m(()=>n("br",null,null,-1)),Ge={class:"nav_data"},Je={class:"descriptions-container",style:{"font-size":"14px"}},Ke={class:"description-item"},Oe=m(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),Qe={class:"value"},Xe={class:"description-item"},Ze=m(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),$e={class:"value"},ea={class:"description-item"},aa=m(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ta={class:"value"},la=m(()=>n("div",null,[n("span",null,"\u5168\u90E8\u673A\u67DC\u65B0\u589E\u7535\u8D39\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ra={key:1},na=m(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),sa={class:"realTotal"},ia=We(fe({name:"BillStatistics",__name:"index",setup(b){const F=i([]),S=i(0),R=i(0),q=i(0),O=i(!1),B=i([]),H=i(""),I=i(""),Q=Ae(),D=i(!0),T=i([]),g=i(0),V=i(0),p=i(void 0),r=be({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,cabinetIds:[]}),X=i([15,30,50,100]),Z=i(),k=i(!1);i([{imgUrl:x},{imgUrl:x},{imgUrl:x},{imgUrl:x}]);const $=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];ye(()=>r.granularity,()=>{r.granularity=="day"?Y.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:y,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:_},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:P},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:Y.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u5F00\u59CB\u65E5\u671F",align:"center",prop:"start_time",formatter:y,istrue:!0},{label:"\u7ED3\u675F\u65E5\u671F",align:"center",prop:"end_time",formatter:y,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:_},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:_}],N()});const Y=i([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:y,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:_},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:P},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]),M=async()=>{D.value=!0;try{if(p.value!=null){const e=K(p.value[0]),l=K(p.value[1]);r.timeRange=[e,l]}const a=await h.getBillDataPage(r);T.value=a.list,V.value=a.total,a.total>1e4?g.value=1e4:g.value=a.total}finally{D.value=!1}},ee=_e(()=>{const a=Math.ceil(g.value/r.pageSize);return r.pageNo===a&&g.value>=1e4});function y(a,e,l){return l?L(l).format("YYYY-MM-DD"):""}function _(a,e,l){return Number(l).toFixed(1)}function P(a,e,l){return Number(l).toFixed(1)}const ae=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},N=()=>{r.pageNo=1,M()},te=async()=>{try{await Q.exportConfirm(),r.pageNo=1,k.value=!0;const a={timeout:0},e=await h.exportBillPageData(r,a);await Pe.excel(e,"\u673A\u67DC\u7535\u8D39\u7EDF\u8BA1.xlsx")}catch{}finally{k.value=!1}},le=async a=>{let e=[];a.forEach(l=>{l.type==3&&e.push(l.id)}),e.length==0&&a.length!=0&&(e.push(0),Ye({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),r.cabinetIds=e,N()},j=a=>L(a).format("YYYY-MM-DD HH:mm:ss");return we(()=>{M(),(async()=>{const l=await je.getRoomMenuAll({});F.value=l})(),(async()=>{const l=await h.getNavNewData({});S.value=l.day,R.value=l.week,q.value=l.month})();const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);p.value=[j(e),j(a)]}),(a,e)=>{const l=Me,re=Ne,C=Ce,ne=Ue,A=ze,U=Fe,se=Se,W=Re,ie=qe,oe=Ve,ue=Te,pe=Be;return c(),w(ue,{dataList:t(F),onCheck:le,navTitle:"\u673A\u67DC\u7535\u8D39\u7EDF\u8BA1"},{NavInfo:o(()=>[Ee,v(),Le,n("div",Ge,[n("div",Je,[n("div",Ke,[Oe,n("span",Qe,f(t(S))+"\u6761",1)]),n("div",Xe,[Ze,n("span",$e,f(t(R))+"\u6761",1)]),n("div",ea,[aa,n("span",ta,f(t(q))+"\u6761",1)]),la])])]),ActionBar:o(()=>[u(se,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:Z,inline:!0,"label-width":"auto"},{default:o(()=>[u(C,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:o(()=>[u(re,{modelValue:t(r).granularity,"onUpdate:modelValue":e[0]||(e[0]=s=>t(r).granularity=s),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:o(()=>[u(l,{label:"\u5929",value:"day"}),u(l,{label:"\u5468",value:"week"}),u(l,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),u(C,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[u(ne,{format:"YYYY-MM-DD HH:mm:ss",modelValue:t(p),"onUpdate:modelValue":e[1]||(e[1]=s=>he(p)?p.value=s:null),type:"datetimerange",shortcuts:$,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ae},null,8,["modelValue"])]),_:1}),u(C,null,{default:o(()=>[u(U,{onClick:N},{default:o(()=>[u(A,{icon:"ep:search",class:"mr-5px"}),v(" \u641C\u7D22")]),_:1}),u(U,{type:"success",plain:"",loading:t(k),onClick:te},{default:o(()=>[u(A,{icon:"ep:download",class:"mr-5px"}),v(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:o(()=>[xe((c(),w(ie,{data:t(T),stripe:!0,"show-overflow-tooltip":!0},G({default:o(()=>[u(W,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:o(({$index:s})=>[v(f(s+1+(t(r).pageNo-1)*t(r).pageSize),1)]),_:1}),(c(!0),z(J,null,De(t(Y),s=>(c(),z(J,null,[s.istrue?(c(),w(W,{key:s.prop,label:s.label,align:s.align,prop:s.prop,formatter:s.formatter,width:s.width},G({_:2},[s.slot==="actions"&&t(r).granularity=="day"?{name:"default",fn:o(({row:d})=>[d.bill_mode_real&&d.bill_mode_real==2?(c(),w(U,{key:0,link:"",type:"primary",onClick:oa=>(async(ce,E,me,de)=>{B.value=[],H.value="",I.value="";let ge={cabinetId:ce,startTime:E};const ve=await h.getSubBillDetails(ge);B.value=ve.list,H.value=me,I.value=E+" - "+de,O.value=!0})(d.cabinet_id,d.start_time,d.location,d.end_time)},{default:o(()=>[v("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):(c(),z("div",ra,"\u56FA\u5B9A\u8BA1\u8D39"))]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):ke("",!0)],64))),256))]),_:2},[t(ee)?{name:"append",fn:o(()=>[na]),key:"0"}:void 0]),1032,["data"])),[[pe,t(D)]]),u(oe,{total:t(g),"page-size-arr":t(X),layout:"sizes, prev, pager, next, jumper",page:t(r).pageNo,"onUpdate:page":e[2]||(e[2]=s=>t(r).pageNo=s),limit:t(r).pageSize,"onUpdate:limit":e[3]||(e[3]=s=>t(r).pageSize=s),onPagination:M},null,8,["total","page-size-arr","page","limit"]),n("div",sa,"\u5171 "+f(t(V))+" \u6761",1)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-424f20f3"]]);export{ia as default};
