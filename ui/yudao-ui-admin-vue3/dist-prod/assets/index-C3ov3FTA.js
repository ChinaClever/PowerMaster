import{d as ua,u as sa,e as u,f as va,aj as ca,g as ma,aX as ba,h as ga,o as c,n as H,w as n,l as x,j as p,t as M,a as _,c as h,q as B,k as i,s as da,aY as G,F as J,p as fa,aZ as xa,S as ha,N as wa,O as ya,P as Aa,c5 as ka,_ as Ba,A as Va,Q as Da,D as Wa,G as Na,R as Ca,J as za,K as Ha}from"./index-mcOGIq4g.js";import{_ as Ma}from"./CommonMenu-CxUjeIT-.js";import{_ as Ua}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ya}from"./download--D_IyRio.js";import{H as U}from"./index-DoMdbktO.js";import{C as Ra}from"./index-JEsRnusb.js";import{P as V}from"./PDU-QxJ-Axz0.js";import{u as Sa}from"./useMessage-CGTQbR_M.js";import{_ as Ia}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const m=w=>(za("data-v-03bb73d7"),w=w(),Ha(),w),Pa=m(()=>p("br",null,null,-1)),ja=m(()=>p("br",null,null,-1)),Fa={class:"nav_data"},La={class:"descriptions-container",style:{"font-size":"14px"}},Ta={class:"description-item"},Ea=m(()=>p("span",{class:"label"},"\u603B\u6570\u636E :",-1)),qa={class:"value"},Ga={style:{"text-align":"center"}},Ja={key:0,style:{"text-align":"center"}},Ka=[m(()=>p("span",null,"\u5168\u90E8\u673A\u67DC\u6700\u8FD1\u4E00\u5206\u949F\u65B0\u589E\u8BB0\u5F55",-1))],Oa={key:1,style:{"text-align":"center"}},Qa=[m(()=>p("span",null,"\u5168\u90E8\u673A\u67DC\u6700\u8FD1\u4E00\u5C0F\u65F6\u65B0\u589E\u8BB0\u5F55",-1))],Xa={key:2,style:{"text-align":"center"}},Za=[m(()=>p("span",null,"\u5168\u90E8\u673A\u67DC\u6700\u8FD1\u4E00\u5929\u65B0\u589E\u8BB0\u5F55",-1))],$a=m(()=>p("div",{class:"line",style:{"margin-top":"10px"}},null,-1)),ae=m(()=>p("tr",null,[p("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[p("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ee={class:"realTotal"},te=Ia(ua({name:"CabinetHistoryData",__name:"index",setup(w){const{push:K}=sa(),Y=u([]),R=u(0),O=Sa(),D=u(!0),S=u([]),g=u(0),I=u(0),Q=u([15,30,50,100]),l=va({pageNo:1,pageSize:15,granularity:"realtime",timeRange:void 0,cabinetIds:[]}),X=u(),W=u(!1);u([{imgUrl:V},{imgUrl:V},{imgUrl:V},{imgUrl:V}]);const Z=[{text:"\u6700\u8FD1\u4E00\u5C0F\u65F6",value:()=>{const e=new Date,a=new Date;return a.setHours(a.getHours()-1),[a,e]}},{text:"\u6700\u8FD1\u4E00\u5929",value:()=>{const e=new Date,a=new Date;return a.setDate(a.getDate()-1),[a,e]}},{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const e=new Date,a=new Date;return a.setDate(a.getDate()-7),[a,e]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const e=new Date,a=new Date;return a.setMonth(a.getMonth()-1),[a,e]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const e=new Date,a=new Date;return a.setMonth(a.getMonth()-6),[a,e]}}],$={multiple:!0},y=u([["total","active_total"],["total","apparent_total"]]),N=u([{value:"total",label:"\u603B",children:[{value:"active_total",label:"\u603B\u6709\u529F\u529F\u7387"},{value:"apparent_total",label:"\u603B\u89C6\u5728\u529F\u7387"}]},{value:"A",label:"A\u8DEF",children:[{value:"active_a",label:"A\u8DEF\u6709\u529F\u529F\u7387"},{value:"apparent_a",label:"A\u8DEF\u89C6\u5728\u529F\u7387"}]},{value:"B",label:"B\u8DEF",children:[{value:"active_b",label:"B\u8DEF\u6709\u529F\u529F\u7387"},{value:"apparent_b",label:"B\u8DEF\u89C6\u5728\u529F\u7387"}]}]),C=u(["active_total","apparent_total","active_a","apparent_a","active_b","apparent_b"]),aa=e=>{let a=e.map(v=>v[v.length-1]),s=C.value.filter(v=>!a.includes(v));A.value.forEach(v=>{var b,k;for(const f of a)if((b=v.prop)!=null&&b.startsWith(f)){v.istrue=!0;break}for(const f of s)if((k=v.prop)!=null&&k.startsWith(f)){v.istrue=!1;break}})},ea=()=>{j()};ca(()=>l.granularity,e=>{e=="realtime"?(y.value=[["total","active_total"],["total","apparent_total"]],N.value=[{value:"total",label:"\u603B",children:[{value:"active_total",label:"\u603B\u6709\u529F\u529F\u7387"},{value:"apparent_total",label:"\u603B\u89C6\u5728\u529F\u7387"}]},{value:"A",label:"A\u8DEF",children:[{value:"active_a",label:"A\u8DEF\u6709\u529F\u529F\u7387"},{value:"apparent_a",label:"A\u8DEF\u89C6\u5728\u529F\u7387"}]},{value:"B",label:"B\u8DEF",children:[{value:"active_b",label:"B\u8DEF\u6709\u529F\u529F\u7387"},{value:"apparent_b",label:"B\u8DEF\u89C6\u5728\u529F\u7387"}]}],C.value=["active_total","apparent_total","active_a","apparent_a","active_b","apparent_b"],A.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",width:"250px",istrue:!0},{label:"\u65F6\u95F4",align:"center",prop:"create_time",formatter:o,width:"200px",istrue:!0},{label:"\u603B\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total",istrue:!0,formatter:t},{label:"\u603B\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total",istrue:!0,formatter:t},{label:"A\u8DEF\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_a",istrue:!1,formatter:t},{label:"A\u8DEF\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_a",istrue:!1,formatter:t},{label:"B\u8DEF\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_b",istrue:!1,formatter:t},{label:"B\u8DEF\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_b",istrue:!1,formatter:t},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0}],l.pageNo=1,l.pageSize=15,d()):(y.value=[["total","active_pow","active_total_avg_value"],["total","active_pow","active_total_max"],["total","active_pow","active_total_min"],["total","apparent_pow","apparent_total_avg_value"],["total","apparent_pow","apparent_total_max"],["total","apparent_pow","apparent_total_min"]],N.value=[{value:"total",label:"\u603B",children:[{value:"active_pow",label:"\u6709\u529F\u529F\u7387",children:[{value:"active_total_avg_value",label:"\u603B\u5E73\u5747\u6709\u529F\u529F\u7387"},{value:"active_total_max",label:"\u603B\u6700\u5927\u6709\u529F\u529F\u7387"},{value:"active_total_min",label:"\u603B\u6700\u5C0F\u6709\u529F\u529F\u7387"}]},{value:"apparent_pow",label:"\u89C6\u5728\u529F\u7387",children:[{value:"apparent_total_avg_value",label:"\u603B\u5E73\u5747\u89C6\u5728\u529F\u7387"},{value:"apparent_total_max",label:"\u603B\u6700\u5927\u89C6\u5728\u529F\u7387"},{value:"apparent_total_min",label:"\u603B\u6700\u5C0F\u89C6\u5728\u529F\u7387"}]}]},{value:"A",label:"A\u8DEF",children:[{value:"active_pow",label:"\u6709\u529F\u529F\u7387",children:[{value:"active_a_avg_value",label:"A\u8DEF\u5E73\u5747\u6709\u529F\u529F\u7387"},{value:"active_a_max",label:"A\u8DEF\u6700\u5927\u6709\u529F\u529F\u7387"},{value:"active_a_min",label:"A\u8DEF\u6700\u5C0F\u6709\u529F\u529F\u7387"}]},{value:"apparent_pow",label:"\u89C6\u5728\u529F\u7387",children:[{value:"apparent_a_avg_value",label:"A\u8DEF\u5E73\u5747\u89C6\u5728\u529F\u7387"},{value:"apparent_a_max",label:"A\u8DEF\u6700\u5927\u89C6\u5728\u529F\u7387"},{value:"apparent_a_min",label:"A\u8DEF\u6700\u5C0F\u89C6\u5728\u529F\u7387"}]}]},{value:"B",label:"B\u8DEF",children:[{value:"active_pow",label:"\u6709\u529F\u529F\u7387",children:[{value:"active_b_avg_value",label:"B\u8DEF\u5E73\u5747\u6709\u529F\u529F\u7387"},{value:"active_b_max",label:"B\u8DEF\u6700\u5927\u6709\u529F\u529F\u7387"},{value:"active_b_min",label:"B\u8DEF\u6700\u5C0F\u6709\u529F\u529F\u7387"}]},{value:"apparent_pow",label:"\u89C6\u5728\u529F\u7387",children:[{value:"apparent_b_avg_value",label:"B\u8DEF\u5E73\u5747\u89C6\u5728\u529F\u7387"},{value:"apparent_b_max",label:"B\u8DEF\u6700\u5927\u89C6\u5728\u529F\u7387"},{value:"apparent_b_min",label:"B\u8DEF\u6700\u5C0F\u89C6\u5728\u529F\u7387"}]}]}],C.value=["active_total_avg_value","active_total_max","active_total_min","apparent_total_avg_value","apparent_total_max","apparent_total_min","active_a_avg_value","active_a_max","active_a_min","apparent_a_avg_value","apparent_a_max","apparent_a_min","active_b_avg_value","active_b_max","active_b_min","apparent_b_avg_value","apparent_b_max","apparent_b_min"],A.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",width:"250px",istrue:!0},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",width:"200px",formatter:o,istrue:!0},{label:"\u603B\u5E73\u5747\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total_avg_value",istrue:!0,width:"180px",formatter:t},{label:"\u603B\u6700\u5927\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total_max_value",istrue:!0,width:"180px",formatter:t},{label:"\u603B\u6700\u5927\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_total_max_time",formatter:o,width:"200px",istrue:!0},{label:"\u603B\u6700\u5C0F\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total_min_value",istrue:!0,width:"180px",formatter:t},{label:"\u603B\u6700\u5C0F\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_total_min_time",formatter:o,width:"200px",istrue:!0},{label:"\u603B\u5E73\u5747\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total_avg_value",istrue:!0,width:"180px",formatter:t},{label:"\u603B\u6700\u5927\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total_max_value",istrue:!0,width:"180px",formatter:t},{label:"\u603B\u6700\u5927\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_total_max_time",formatter:o,width:"200px",istrue:!0},{label:"\u603B\u6700\u5C0F\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total_min_value",istrue:!0,width:"180px",formatter:t},{label:"\u603B\u6700\u5C0F\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_total_min_time",formatter:o,width:"200px",istrue:!0},{label:"A\u8DEF\u5E73\u5747\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_a_avg_value",istrue:!1,width:"180px",formatter:t},{label:"A\u8DEF\u6700\u5927\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_a_max_value",istrue:!1,width:"180px",formatter:t},{label:"A\u8DEF\u6700\u5927\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_a_max_time",formatter:o,width:"200px",istrue:!1},{label:"A\u8DEF\u6700\u5C0F\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_a_min_value",istrue:!1,width:"180px",formatter:t},{label:"A\u8DEF\u6700\u5C0F\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_a_min_time",formatter:o,width:"200px",istrue:!1},{label:"A\u8DEF\u5E73\u5747\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_a_avg_value",istrue:!1,width:"180px",formatter:t},{label:"A\u8DEF\u6700\u5927\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_a_max_value",istrue:!1,width:"180px",formatter:t},{label:"A\u8DEF\u6700\u5927\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_a_max_time",formatter:o,width:"200px",istrue:!1},{label:"A\u8DEF\u6700\u5C0F\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_a_min_value",istrue:!1,width:"180px",formatter:t},{label:"A\u8DEF\u6700\u5C0F\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_a_min_time",formatter:o,width:"200px",istrue:!1},{label:"B\u8DEF\u5E73\u5747\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_b_avg_value",istrue:!1,width:"180px",formatter:t},{label:"B\u8DEF\u6700\u5927\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_b_max_value",istrue:!1,width:"180px",formatter:t},{label:"B\u8DEF\u6700\u5927\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_b_max_time",formatter:o,width:"200px",istrue:!1},{label:"B\u8DEF\u6700\u5C0F\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_b_min_value",istrue:!1,width:"180px",formatter:t},{label:"B\u8DEF\u6700\u5C0F\u6709\u529F\u529F\u7387\u65F6\u95F4",align:"center",prop:"active_b_min_time",formatter:o,width:"200px",istrue:!1},{label:"B\u8DEF\u5E73\u5747\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_b_avg_value",istrue:!1,width:"180px",formatter:t},{label:"B\u8DEF\u6700\u5927\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_b_max_value",istrue:!1,width:"180px",formatter:t},{label:"B\u8DEF\u6700\u5927\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_b_max_time",formatter:o,width:"200px",istrue:!1},{label:"B\u8DEF\u6700\u5C0F\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_b_min_value",istrue:!1,width:"180px",formatter:t},{label:"B\u8DEF\u6700\u5C0F\u89C6\u5728\u529F\u7387\u65F6\u95F4",align:"center",prop:"apparent_b_min_time",formatter:o,width:"200px",istrue:!1},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0}],l.pageNo=1,l.pageSize=15,d())});const A=u([{label:"\u4F4D\u7F6E",align:"center",prop:"location",width:"250px",istrue:!0},{label:"\u65F6\u95F4",align:"center",prop:"create_time",formatter:o,width:"200px",istrue:!0},{label:"\u603B\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_total",istrue:!0,formatter:t},{label:"\u603B\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_total",istrue:!0,formatter:t},{label:"A\u8DEF\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_a",istrue:!1,formatter:t},{label:"A\u8DEF\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_a",istrue:!1,formatter:t},{label:"B\u8DEF\u6709\u529F\u529F\u7387(kW)",align:"center",prop:"active_b",istrue:!1,formatter:t},{label:"B\u8DEF\u89C6\u5728\u529F\u7387(kVA)",align:"center",prop:"apparent_b",istrue:!1,formatter:t},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0}]),d=async()=>{D.value=!0;try{const e=await U.getHistoryDataPage(l);S.value=e.list,I.value=e.total,e.total>1e4?g.value=1e4:g.value=e.total}finally{D.value=!1}};function t(e,a,s){return Number(s).toFixed(3)}const ta=ma(()=>{const e=Math.ceil(g.value/l.pageSize);return l.pageNo===e&&g.value>=1e4}),P=()=>{l.pageNo=1,d()},la=async e=>{let a=[];e.forEach(s=>{s.type==3&&a.push(s.id)}),a.length==0&&e.length!=0&&(a.push(0),xa({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),l.cabinetIds=a,P()},j=async()=>{const e=await U.getNavNewData(l.granularity);R.value=e.total},ra=async()=>{try{await O.exportConfirm(),l.pageNo=1,W.value=!0;const e={timeout:0},a=await U.exportHistoryData(l,e);await Ya.excel(a,"\u673A\u67DC\u7535\u529B\u5386\u53F2\u6570\u636E.xlsx")}catch{}finally{W.value=!1}};function o(e,a,s){return s?ba(s).format("YYYY-MM-DD HH:mm"):""}return ga(()=>{(async()=>{const e=await Ra.getRoomMenuAll({});Y.value=e})(),j(),d()}),(e,a)=>{const s=ha,v=wa,b=ya,k=Aa,f=ka,F=Ba,z=Va,ia=Da,L=Wa,na=Na,pa=Ua,oa=Ma,_a=Ca;return c(),H(oa,{dataList:Y.value,onCheck:la,navTitle:"\u673A\u67DC\u7535\u529B\u6570\u636E"},{NavInfo:n(()=>[Pa,x(),ja,p("div",Fa,[p("div",La,[p("div",Ta,[Ea,p("span",qa,M(R.value)+"\u6761",1)]),p("div",Ga,[_(l).granularity=="realtime"?(c(),h("div",Ja,Ka)):B("",!0),_(l).granularity=="hour"?(c(),h("div",Oa,Qa)):B("",!0),_(l).granularity=="day"?(c(),h("div",Xa,Za)):B("",!0),$a])])])]),ActionBar:n(()=>[i(ia,{class:"-mb-15px",model:_(l),ref_key:"queryFormRef",ref:X,inline:!0,"label-width":"auto"},{default:n(()=>[i(b,{label:"\u9897\u7C92\u5EA6",prop:"type"},{default:n(()=>[i(v,{modelValue:_(l).granularity,"onUpdate:modelValue":a[0]||(a[0]=r=>_(l).granularity=r),placeholder:"\u8BF7\u9009\u62E9\u5206\u949F/\u5C0F\u65F6/\u5929",onChange:ea,class:"!w-120px"},{default:n(()=>[i(s,{label:"\u5206\u949F",value:"realtime"}),i(s,{label:"\u5C0F\u65F6",value:"hour"}),i(s,{label:"\u5929",value:"day"})]),_:1},8,["modelValue"])]),_:1}),i(b,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:n(()=>[i(k,{"value-format":"YYYY-MM-DD HH:mm:ss",modelValue:_(l).timeRange,"onUpdate:modelValue":a[1]||(a[1]=r=>_(l).timeRange=r),type:"datetimerange",shortcuts:Z,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),i(b,{label:"\u7B5B\u9009\u5217"},{default:n(()=>[i(f,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=r=>y.value=r),options:N.value,props:$,"collapse-tags":"","collapse-tags-tooltip":"","show-all-levels":!1,onChange:aa,class:"!w-210px"},null,8,["modelValue","options"])]),_:1}),i(b,null,{default:n(()=>[i(z,{onClick:P},{default:n(()=>[i(F,{icon:"ep:search",class:"mr-5px"}),x(" \u641C\u7D22")]),_:1}),i(z,{type:"success",plain:"",onClick:ra,loading:W.value},{default:n(()=>[i(F,{icon:"ep:download",class:"mr-5px"}),x(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:n(()=>[da((c(),H(na,{data:S.value,stripe:!0,"show-overflow-tooltip":!0},G({default:n(()=>[i(L,{label:"\u5E8F\u53F7",align:"center",width:"60px"},{default:n(({$index:r})=>[x(M(r+1+(_(l).pageNo-1)*_(l).pageSize),1)]),_:1}),(c(!0),h(J,null,fa(A.value,r=>(c(),h(J,null,[r.istrue?(c(),H(L,{key:r.prop,label:r.label,align:r.align,prop:r.prop,formatter:r.formatter,width:r.width},G({_:2},[r.slot==="actions"?{name:"default",fn:n(({row:T})=>[i(z,{link:"",type:"primary",onClick:le=>{return E=T.cabinet_id,q=T.location,void K("/cabinet/record/historyLine?cabinetId="+E+"&location="+q);var E,q}},{default:n(()=>[x("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):B("",!0)],64))),256))]),_:2},[_(ta)?{name:"append",fn:n(()=>[ae]),key:"0"}:void 0]),1032,["data"])),[[_a,D.value]]),i(pa,{total:g.value,"page-size-arr":Q.value,layout:"sizes, prev, pager, next, jumper",page:_(l).pageNo,"onUpdate:page":a[3]||(a[3]=r=>_(l).pageNo=r),limit:_(l).pageSize,"onUpdate:limit":a[4]||(a[4]=r=>_(l).pageSize=r),onPagination:d},null,8,["total","page-size-arr","page","limit"]),p("div",ee,"\u5171 "+M(I.value)+" \u6761",1)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-03bb73d7"]]);export{te as default};
