import{d as De,e as l,an as xe,f as _e,aj as Ce,h as ke,T as ie,o as h,n as J,w as r,l as F,j as s,t as f,a as o,c as A,q as E,k as n,m as Q,s as Me,F as re,p as Te,aZ as Z,L as Ye,M as Fe,P as Ae,O as Ee,_ as Ie,A as Ue,Q as Pe,D as Ne,G as Se,R as Ve,J as qe,K as Le}from"./index-mcOGIq4g.js";import"./index-KYPw-eK3.js";import{C as Re}from"./index-JEsRnusb.js";import{f as k,g as We,c as D,e as ze,b as ue}from"./formatTime-f-_athMZ.js";import{E as de}from"./index-CRHHgC4s.js";import{P as I}from"./PDU-QxJ-Axz0.js";import{d as He}from"./download--D_IyRio.js";import Be from"./CommonMenu1-CLuzaOKt.js";import{u as Oe}from"./useMessage-CGTQbR_M.js";import{i as Ge}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as je}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./install-DiAPpr4Z.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";const b=M=>(qe("data-v-2e45738f"),M=M(),Le(),M),Je=b(()=>s("br",null,null,-1)),Qe=b(()=>s("br",null,null,-1)),Ze={class:"nav_data"},Ke={class:"nav_header"},$e={style:{"padding-top":"10px"}},Xe={class:"nav_content"},ea={class:"description-item"},aa=b(()=>s("span",{class:"label"},"\u603B\u8017\u7535\u91CF :",-1)),ta={class:"description-item"},la=b(()=>s("span",{class:"label"},"\u6700\u5927\u8017\u7535\u91CF :",-1)),na={key:0,class:"description-item"},sa=b(()=>s("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),oa={class:"value"},ia={class:"description-item"},ra=b(()=>s("span",{class:"label"},"\u6700\u5C0F\u8017\u7535\u91CF:",-1)),ua={key:1,class:"description-item"},da=b(()=>s("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ca={class:"value"},ma={style:{height:"58vh"}},pa=De({name:"ECDistribution",__name:"index",setup(M){const U=l(!1),ce=Oe(),P=l(!1),N=l([]),T=l(""),S=l(""),y=l("dayTabPane"),V=l("lineChart"),K=l([]),Y=l([]),$=xe(),u=l(L(14)),q=l(!1),d=_e({pageNo:1,pageSize:15,cabinetId:void 0,nowAddress:void 0,granularity:"day",timeRange:["",""]});function L(a){var e=new Date,t=new Date;return t.setDate(t.getDate()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}function R(a){var e=new Date,t=new Date;return t.setMonth(t.getMonth()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}l([{imgUrl:I},{imgUrl:I},{imgUrl:I},{imgUrl:I}]);const me=[{text:"\u6700\u8FD1\u4E24\u5468",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-336),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];Ce(()=>y.value,async a=>{a=="dayTabPane"?(d.granularity="day",u.value=L(14)):a=="weekTabPane"?(d.granularity="week",u.value=R(3)):(d.granularity="month",u.value=R(12)),j()});const X=l([]),x=l([]),ee=l([]),ae=l([]),_=l([]),te=l([]),W=l(0),z=l(0),H=l(),B=l(0),O=l(),le=async()=>{q.value=!0;try{d.timeRange[0]=k(We(D(u.value[0]))),d.timeRange[1]=k(ze(D(u.value[1])));const a=await de.getEQDataDetails(d);a!=null&&a.total!=0?(P.value=!0,W.value=0,X.value=a.list.map(e=>w(e.start_ele,1)),x.value=a.list.map(e=>k(e.start_time,"YYYY-MM-DD")),ee.value=a.list.map(e=>w(e.end_ele,1)),ae.value=a.list.map(e=>k(e.end_time,"YYYY-MM-DD")),_.value=a.list.map(e=>w(e.eq_value,1)),te.value=a.list.map(e=>k(e.create_time,"YYYY-MM-DD")),z.value=Math.max(..._.value),B.value=Math.min(..._.value),_.value.forEach(function(e,t){e==z.value&&(H.value=x.value[t]),e==B.value&&(O.value=x.value[t]),W.value+=Number(e)}),T.value=S.value):(P.value=!1,Z({message:"\u6682\u65E0\u6570\u636E",type:"warning"}))}finally{q.value=!1}},G=l(null);let m=null;const ne=()=>{m&&m.dispose(),G.value&&$&&(m=Ge(G.value),m.setOption({title:{text:"\u8017\u7535\u91CF\u8D8B\u52BF\u56FE",top:-4},tooltip:{trigger:"axis",formatter:pe},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:x.value},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"line",data:_.value}],dataZoom:[{type:"inside"}]}),$.appContext.config.globalProperties.lineChart=m,Y.value=m==null?void 0:m.getOption().series,(()=>{var t,g;const a=[],e=((g=(t=Y.value[0])==null?void 0:t.data)==null?void 0:g.length)||0;for(let i=0;i<e;i++){const c={};c.create_time=te.value[i],c.startEleData=X.value[i],c.startTimeData=x.value[i],c.endEleData=ee.value[i],c.endTimeData=ae.value[i];for(const C of Y.value)c[C.name]=C.data[i];a.push(c)}K.value=a})())};function w(a,e){return a===0?0:isNaN(a)?null:Number(a).toFixed(e)}function pe(a){var e="";return a.forEach(function(t){t.seriesName==="\u8017\u7535\u91CF"&&(e+=t.marker+" "+t.seriesName+": "+t.value+" kWh")}),e}const ve=()=>{y.value=="weekTabPane"&&ue(D(u.value[0]),D(u.value[1]))<7&&(u.value=L(7),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E7\u5929,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u5468",type:"warning"})),y.value=="monthTabPane"&&ue(D(u.value[0]),D(u.value[1]))<30&&(u.value=R(1),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E1\u4E2A\u6708,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u4E2A\u6708",type:"warning"}))},fe=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e};window.addEventListener("resize",function(){m==null||m.resize()});const ge=async a=>{a.type!=null&&a.type==3&&(d.cabinetId=a.id,se(N.value,a.unique,e=>{S.value=e}),j())};function se(a,e,t,g=""){for(let i of a){const c=g===""?i.name:g+"-"+i.name;i.unique===e&&t(c),i.children&&i.children.length>0&&se(i.children,e,t,c)}}const j=async()=>{await le(),ne()},he=async()=>{try{await ce.exportConfirm(),d.pageNo=1,d.nowAddress=T.value,U.value=!0;const a={timeout:0},e=await de.exportOutletsPageData(d,a);await He.excel(e,"\u673A\u67DC\u80FD\u8017\u6392\u540D.xlsx")}catch{}finally{U.value=!1}};return ke(async()=>{(async()=>{const t=await Re.getRoomMenuAll({});N.value=t})();const a=ie().query.cabinetId,e=ie().query.location;d.cabinetId=a?parseInt(a,10):void 0,d.cabinetId!=null&&(await le(),T.value=e,S.value=e,ne())}),(a,e)=>{const t=Ye,g=Fe,i=Ae,c=Ee,C=Ie,oe=Ue,be=Pe,v=Ne,ye=Se,we=Ve;return h(),J(Be,{dataList:o(N),onNodeClick:ge,navTitle:"\u673A\u67DC\u80FD\u8017\u5206\u6790",showCheckbox:!1},{NavInfo:r(()=>[Je,F(),Qe,s("div",Ze,[s("div",Ke,[s("span",null,f(o(T)),1),s("span",$e,f(o(u)[0])+"\u81F3"+f(o(u)[1]),1)]),s("div",Xe,[s("div",ea,[aa,s("span",null,f(w(o(W),1))+" kWh",1)]),s("div",ta,[la,s("span",null,f(w(o(z),1))+" kWh",1)]),o(H)?(h(),A("div",na,[sa,s("span",oa,f(o(H)),1)])):E("",!0),s("div",ia,[ra,s("span",null,f(w(o(B),1))+" kWh",1)]),o(O)?(h(),A("div",ua,[da,s("span",ca,f(o(O)),1)])):E("",!0)])])]),ActionBar:r(()=>[n(g,{modelValue:o(y),"onUpdate:modelValue":e[0]||(e[0]=p=>Q(y)?y.value=p:null)},{default:r(()=>[n(t,{label:"\u65E5\u6570\u636E",name:"dayTabPane"}),n(t,{label:"\u5468\u6570\u636E",name:"weekTabPane"}),n(t,{label:"\u6708\u6570\u636E",name:"monthTabPane"})]),_:1},8,["modelValue"]),n(be,{class:"-mb-15px",model:o(d),ref:"queryFormRef",inline:!0,"label-width":"auto"},{default:r(()=>[n(c,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:r(()=>[n(i,{"value-format":"YYYY-MM-DD",modelValue:o(u),"onUpdate:modelValue":e[1]||(e[1]=p=>Q(u)?u.value=p:null),type:"daterange",shortcuts:me,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":fe,class:"!w-350px",onChange:ve},null,8,["modelValue"])]),_:1}),n(c,null,{default:r(()=>[n(oe,{onClick:j},{default:r(()=>[n(C,{icon:"ep:search",class:"mr-5px"}),F(" \u641C\u7D22")]),_:1}),n(oe,{type:"success",plain:"",onClick:he,loading:o(U)},{default:r(()=>[n(C,{icon:"ep:download",class:"mr-5px"}),F(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:r(()=>[o(P)?(h(),J(g,{key:0,modelValue:o(V),"onUpdate:modelValue":e[2]||(e[2]=p=>Q(V)?V.value=p:null)},{default:r(()=>[n(t,{label:"\u56FE\u8868",name:"lineChart"},{default:r(()=>[Me(s("div",{ref_key:"chartContainer",ref:G,id:"chartContainer",style:{width:"70vw",height:"58vh"}},null,512),[[we,o(q)]])]),_:1}),n(t,{label:"\u6570\u636E",name:"lineChartData"},{default:r(()=>[s("div",ma,[n(ye,{border:!0,stripe:!0,data:o(K),style:{height:"67vh",width:"99.97%"},"header-cell-style":{backgroundColor:"#F5F7FA",color:"#909399",textAlign:"center",borderLeft:"1px #EDEEF2 solid",borderBottom:"1px #EDEEF2 solid",fontFamily:"Microsoft YaHei",fontWeight:"bold"},"cell-style":{color:"#606266",fontSize:"14px",textAlign:"center",borderBottom:"0.25px #F5F7FA solid",borderLeft:"0.25px #F5F7FA solid"},"row-style":{fontSize:"14px",textAlign:"center"},"empty-text":"\u6682\u65E0\u6570\u636E","max-height":"818"},{default:r(()=>[n(v,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:r(({$index:p})=>[F(f(p+1),1)]),_:1}),(h(!0),A(re,null,Te(o(Y),p=>(h(),A(re,{key:p.name},[n(v,{label:"\u5F00\u59CB\u7535\u80FD"},{default:r(()=>[n(v,{prop:"startEleData",label:"\u6570\u503C"}),n(v,{prop:"startTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:1}),n(v,{label:"\u7ED3\u675F\u7535\u80FD"},{default:r(()=>[n(v,{prop:"endEleData",label:"\u6570\u503C"}),n(v,{prop:"endTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:1}),p.name==="\u8017\u7535\u91CF"?(h(),J(v,{key:0,label:"\u8017\u7535\u91CF"},{default:r(()=>[n(v,{prop:p.name,label:"\u6570\u503C"},null,8,["prop"]),n(v,{prop:"create_time",label:"\u8BB0\u5F55\u65F6\u95F4"})]),_:2},1024)):E("",!0)],64))),128))]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"])):E("",!0)]),_:1},8,["dataList"])}}}),va=je(pa,[["__scopeId","data-v-2e45738f"]]);export{va as default};
