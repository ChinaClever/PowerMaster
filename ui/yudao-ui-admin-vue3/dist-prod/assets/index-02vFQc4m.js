import{d as _e,e as i,f as he,aj as we,g as xe,aX as A,h as De,o as v,n as z,w as u,l as D,j as r,t as _,a as t,k as o,m as O,s as ke,aY as Q,c as P,F as X,p as Ne,q as Ye,aZ as Me,S as ze,N as Ve,O as Se,P as Be,_ as Ce,A as Fe,Q as qe,D as He,G as Ie,B as Ue,R as Ae,J as Pe,K as Re}from"./index-mcOGIq4g.js";import{_ as We}from"./CommonMenu-CxUjeIT-.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ee}from"./download--D_IyRio.js";import{E as V}from"./index-U3-JpcYo.js";import{f as Z,e as $,c as ee,a as Te}from"./formatTime-f-_athMZ.js";import{I as Le}from"./index-Bla3Qadp.js";import{u as Ge}from"./useMessage-CGTQbR_M.js";import{_ as Je}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const f=k=>(Pe("data-v-a997a288"),k=k(),Re(),k),Ke=f(()=>r("br",null,null,-1)),Oe=f(()=>r("br",null,null,-1)),Qe={class:"nav_data"},Xe={class:"descriptions-container",style:{"font-size":"14px"}},Ze={class:"description-item"},$e=f(()=>r("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ea={class:"value"},aa={class:"description-item"},ta=f(()=>r("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),la={class:"value"},ra={class:"description-item"},sa=f(()=>r("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),na={class:"value"},oa=f(()=>r("div",null,[r("span",null,"\u5168\u90E8\u67DC\u5217\u65B0\u589E\u7535\u8D39\u7EDF\u8BA1"),r("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ia={key:1},ua=f(()=>r("tr",null,[r("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[r("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),pa={class:"realTotal"},da={style:{"font-size":"13px"}},ca=_e({name:"BillStatistics",__name:"index",setup(k){const R=i([]),W=i(0),j=i(0),E=i(0),N=i(!1),S=i([]),B=i(""),C=i(""),ae=Ge(),F=i(!0),T=i([]),h=i(0),L=i(0),m=i(void 0),s=he({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,aisleIds:[]}),te=i([15,30,50,100]),le=i(),q=i(!1),re=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}}];we(()=>s.granularity,()=>{s.granularity=="day"?H.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:Y,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:b},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:G},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:H.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u5F00\u59CB\u65E5\u671F",align:"center",prop:"start_time",formatter:Y,istrue:!0},{label:"\u7ED3\u675F\u65E5\u671F",align:"center",prop:"end_time",formatter:Y,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:b},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:b}],U()});const H=i([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:Y,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:b},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:G},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]),I=async()=>{F.value=!0;try{if(m.value!=null){const e=Z($(ee(m.value[0]))),l=864e5,p=Z($(Te(ee(m.value[1]),l)));s.timeRange=[e,p]}const a=await V.getBillDataPage(s);T.value=a.list,L.value=a.total,a.total>1e4?h.value=1e4:h.value=a.total}finally{F.value=!1}},se=xe(()=>{const a=Math.ceil(h.value/s.pageSize);return s.pageNo===a&&h.value>=1e4});function Y(a,e,l){return l?A(l).format("YYYY-MM-DD"):""}function b(a,e,l){return Number(l).toFixed(1)}function G(a,e,l){return Number(l).toFixed(1)}const ne=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},U=()=>{s.pageNo=1,I()},oe=async()=>{try{await ae.exportConfirm(),s.pageNo=1,q.value=!0;const a={timeout:0},e=await V.exportBillPageData(s,a);await Ee.excel(e,"\u67DC\u5217\u7535\u8D39\u7EDF\u8BA1.xlsx")}catch{}finally{q.value=!1}},ie=a=>{const{columns:e,data:l}=a,p=[];return e.forEach((w,c)=>{if(c===0)return void(p[c]="\u5408\u8BA1");const x=l.map(d=>Number(d[w.property]));x.every(d=>isNaN(d))?p[c]="N/A":(p[c]=x.reduce((d,M)=>{const g=Number(M);return isNaN(g)?d:d+M},0),p[c]=p[c].toFixed(1))}),p},ue=async a=>{let e=[];a.forEach(l=>{l.type==2&&e.push(l.id)}),e.length==0&&a.length!=0&&(e.push(0),Me({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),s.aisleIds=e,U()};return De(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1,23,59,59);m.value=[A(e).format("YYYY-MM-DD HH:mm:ss"),A(a).format("YYYY-MM-DD HH:mm:ss")],(async()=>{const l=await Le.getAisleMenu();R.value=l})(),(async()=>{const l=await V.getNavNewData({});W.value=l.day,j.value=l.week,E.value=l.month})(),I()}),(a,e)=>{const l=ze,p=Ve,w=Se,c=Be,x=Ce,d=Fe,M=qe,g=He,J=Ie,pe=je,de=Ue,ce=We,me=Ae;return v(),z(ce,{dataList:t(R),onCheck:ue,navTitle:"\u67DC\u5217\u7535\u8D39\u7EDF\u8BA1"},{NavInfo:u(()=>[Ke,D(),Oe,r("div",Qe,[r("div",Xe,[r("div",Ze,[$e,r("span",ea,_(t(W))+"\u6761",1)]),r("div",aa,[ta,r("span",la,_(t(j))+"\u6761",1)]),r("div",ra,[sa,r("span",na,_(t(E))+"\u6761",1)]),oa])])]),ActionBar:u(()=>[o(M,{class:"-mb-15px",model:t(s),ref_key:"queryFormRef",ref:le,inline:!0,"label-width":"auto"},{default:u(()=>[o(w,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:u(()=>[o(p,{modelValue:t(s).granularity,"onUpdate:modelValue":e[0]||(e[0]=n=>t(s).granularity=n),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:u(()=>[o(l,{label:"\u5929",value:"day"}),o(l,{label:"\u5468",value:"week"}),o(l,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:u(()=>[o(c,{"value-format":"YYYY-MM-DD",modelValue:t(m),"onUpdate:modelValue":e[1]||(e[1]=n=>O(m)?m.value=n:null),type:"daterange",shortcuts:re,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ne},null,8,["modelValue"])]),_:1}),o(w,null,{default:u(()=>[o(d,{onClick:U},{default:u(()=>[o(x,{icon:"ep:search",class:"mr-5px"}),D(" \u641C\u7D22")]),_:1}),o(d,{type:"success",plain:"",loading:t(q),onClick:oe},{default:u(()=>[o(x,{icon:"ep:download",class:"mr-5px"}),D(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:u(()=>[ke((v(),z(J,{data:t(T),stripe:!0,"show-overflow-tooltip":!0,border:!0},Q({default:u(()=>[o(g,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:u(({$index:n})=>[D(_(n+1+(t(s).pageNo-1)*t(s).pageSize),1)]),_:1}),(v(!0),P(X,null,Ne(t(H),n=>(v(),P(X,null,[n.istrue?(v(),z(g,{key:n.prop,label:n.label,align:n.align,prop:n.prop,formatter:n.formatter,width:n.width},Q({_:2},[n.slot==="actions"&&t(s).granularity=="day"?{name:"default",fn:u(({row:y})=>[y.bill_mode_real&&y.bill_mode_real==2?(v(),z(d,{key:0,link:"",type:"primary",onClick:ga=>(async(ge,K,ve,fe)=>{S.value=[],B.value="",C.value="";let be={aisleId:ge,startTime:K};const ye=await V.getSubBillDetails(be);S.value=ye.list,B.value=ve,C.value=K+" - "+fe,N.value=!0})(y.aisle_id,y.start_time,y.location,y.end_time)},{default:u(()=>[D("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):(v(),P("div",ia,"\u56FA\u5B9A\u8BA1\u8D39"))]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):Ye("",!0)],64))),256))]),_:2},[t(se)?{name:"append",fn:u(()=>[ua]),key:"0"}:void 0]),1032,["data"])),[[me,t(F)]]),o(pe,{total:t(h),"page-size-arr":t(te),layout:"sizes, prev, pager, next, jumper",page:t(s).pageNo,"onUpdate:page":e[2]||(e[2]=n=>t(s).pageNo=n),limit:t(s).pageSize,"onUpdate:limit":e[3]||(e[3]=n=>t(s).pageSize=n),onPagination:I},null,8,["total","page-size-arr","page","limit"]),r("div",pa,"\u5171 "+_(t(L))+" \u6761",1),o(de,{modelValue:t(N),"onUpdate:modelValue":e[4]||(e[4]=n=>O(N)?N.value=n:null),title:t(B),width:"600",draggable:""},{default:u(()=>[r("span",da,_(t(C)),1),o(J,{data:t(S),border:"","show-summary":"","summary-method":ie,style:{width:"100%"}},{default:u(()=>[o(g,{prop:"bill_period",label:"\u65F6\u95F4\u6BB5"}),o(g,{prop:"eq_value",label:"\u8017\u7535\u91CF(kWh)",formatter:b}),o(g,{prop:"bill_value",label:"\u7535\u8D39(\u5143)",formatter:b})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])]),_:1},8,["dataList"])}}}),ma=Je(ca,[["__scopeId","data-v-a997a288"]]);export{ma as default};
