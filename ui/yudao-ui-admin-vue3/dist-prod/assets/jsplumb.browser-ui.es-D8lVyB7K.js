function mt(r){return mt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},mt(r)}function M(r,i){if(!(r instanceof i))throw new TypeError("Cannot call a class as a function")}function Oi(r,i){for(var e=0;e<i.length;e++){var t=i[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function D(r,i,e){return i&&Oi(r.prototype,i),e&&Oi(r,e),r}function u(r,i,e){return i in r?Object.defineProperty(r,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[i]=e,r}function F(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(i&&i.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),i&&Tn(r,i)}function X(r){return X=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)},X(r)}function Tn(r,i){return Tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Tn(r,i)}function d(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function H(r){var i=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var e,t,n,o=X(r);if(i){var s=X(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return t=this,!(n=e)||typeof n!="object"&&typeof n!="function"?d(t):n}}function V(r,i,e){return V=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(t,n,o){var s=function(l,c){for(;!Object.prototype.hasOwnProperty.call(l,c)&&(l=X(l))!==null;);return l}(t,n);if(s){var a=Object.getOwnPropertyDescriptor(s,n);return a.get?a.get.call(o):a.value}},V(r,i,e||r)}function Vt(r,i){return function(e){if(Array.isArray(e))return e}(r)||function(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,s,a=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);l=!0);}catch(h){c=!0,s=h}finally{try{l||n.return==null||n.return()}finally{if(c)throw s}}return a}}(r,i)||Gi(r,i)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function $e(r){return function(i){if(Array.isArray(i))return In(i)}(r)||function(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}(r)||Gi(r)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Gi(r,i){if(r){if(typeof r=="string")return In(r,i);var e=Object.prototype.toString.call(r).slice(8,-1);return e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set"?Array.from(r):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?In(r,i):void 0}}function In(r,i){(i==null||i>r.length)&&(i=r.length);for(var e=0,t=new Array(i);e<i;e++)t[e]=r[e];return t}function Le(r,i,e){return r==="*"||(r.length>0?r.indexOf(i)!==-1:!e)}function A(r,i,e){var t,n=r=r||{},o=i=i||{};for(t in o)n[t]=o[t];return r}function On(r){return Object.prototype.toString.call(r)==="[object Number]"}function z(r){return typeof r=="string"}function Li(r){return typeof r=="boolean"}function Qe(r){return r!=null&&Object.prototype.toString.call(r)==="[object Object]"}function Fe(r){return Object.prototype.toString.call(r)==="[object Function]"}function Ut(r){if(z(r))return""+r;if(Li(r))return!!r;if(o=r,Object.prototype.toString.call(o)==="[object Date]")return new Date(r.getTime());if(Fe(r))return r;if(Array.isArray(r)){for(var i=[],e=0;e<r.length;e++)i.push(Ut(r[e]));return i}if(Qe(r)){var t={};for(var n in r)t[n]=Ut(r[n]);return t}return r;var o}function Wt(r,i,e,t){var n,o,s={},a={};for(e=e||[],t=t||[],o=0;o<e.length;o++)s[e[o]]=!0;for(o=0;o<t.length;o++)a[t[o]]=!0;var l=Ut(r);for(o in i)if(l[o]==null||a[o])l[o]=i[o];else if(s[o])(n=[]).push.apply(n,Array.isArray(l[o])?l[o]:[l[o]]),n.push(i[o]),l[o]=n;else if(z(i[o])||Li(i[o])||Fe(i[o])||On(i[o]))l[o]=i[o];else if(Array.isArray(i[o]))n=[],Array.isArray(l[o])&&n.push.apply(n,l[o]),n.push.apply(n,i[o]),l[o]=n;else if(Qe(i[o]))for(var c in Qe(l[o])||(l[o]={}),i[o])l[o][c]=i[o][c];return l}function Fi(r,i,e){for(var t=0;t<e.length;t++){var n=e[t][0][e[t][1]].apply(e[t][0],e[t][2]);if(n===i)return n}return r}function Fr(r,i,e,t){return function n(o){if(o!=null){if(z(o))return function(h){var p=h.match(/(\${.*?})/g);if(p!=null)for(var v=0;v<p.length;v++){var f=i[p[v].substring(2,p[v].length-1)]||"";f!=null&&(h=h.replace(p[v],f))}if((p=h.match(/({{.*?}})/g))!=null)for(var g=0;g<p.length;g++){var y=i[p[g].substring(2,p[g].length-2)]||"";y!=null&&(h=h.replace(p[g],y))}return h}(o);if(Fe(o)&&!t&&(o.name||"").indexOf(e)===0)return o(i);if(Array.isArray(o)){for(var s=[],a=0;a<o.length;a++)s.push(n(o[a]));return s}if(Qe(o)){var l={};for(var c in o)l[c]=n(o[c]);return l}return o}}(r)}function j(r,i){if(!r)return null;for(var e=0;e<r.length;e++)i(r[e])}function Ce(r,i){if(r){for(var e=0;e<r.length;e++)if(i(r[e]))return e}return-1}function Gn(r,i){var e=Ce(r,i);return e===-1?null:r[e]}function Hi(r,i){var e=null;return r.forEach(function(t){i(t)&&(e=t)}),e}function Z(r,i){var e=Ce(r,i);return e>-1&&r.splice(e,1),e!==-1}function qt(r){if(Array.fromArray!=null)return Array.from(r);var i=[];return Array.prototype.push.apply(i,r),i}function Ni(r,i){var e=r.indexOf(i);return e>-1&&r.splice(e,1),e!==-1}function Ri(r,i,e,t){var n=r[i];return n==null&&(n=[],r[i]=n),n[t?"unshift":"push"](e),n}function _t(r,i,e){return r.indexOf(i)===-1&&(r.push(i),!0)}for(var He,K=[],xt=0;xt<256;xt++)K[xt]=(xt<16?"0":"")+xt.toString(16);function W(){var r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0;return K[255&r]+K[r>>8&255]+K[r>>16&255]+K[r>>24&255]+"-"+K[255&i]+K[i>>8&255]+"-"+K[i>>16&15|64]+K[i>>24&255]+"-"+K[63&e|128]+K[e>>8&255]+"-"+K[e>>16&255]+K[e>>24&255]+K[255&t]+K[t>>8&255]+K[t>>16&255]+K[t>>24&255]}function Zt(r,i,e){var t=r.x-i.x,n=r.y-i.y,o=Math.cos(e/360*Math.PI*2),s=Math.sin(e/360*Math.PI*2);return{x:t*o-n*s+i.x,y:n*o+t*s+i.y,cr:o,sr:s}}function Ln(r){if(r==null)return null;for(var i=r.replace(/^\s\s*/,""),e=/\s/,t=i.length;e.test(i.charAt(--t)););return i.slice(0,t+1)}function Bi(r,i){for(var e=[],t=0;t<r.length;t++)e.push(i(r[t]));return e}function q(){for(var r=arguments.length,i=new Array(r),e=0;e<r;e++)i[e]=arguments[e];if(typeof console<"u")try{}catch{}}function Jt(r){return r<0?-1:r>0?1:0}function Kt(r,i,e){return function(){var t=null;try{i!=null&&(t=i.apply(this,arguments))}catch(n){q("jsPlumb function failed : "+n)}if(r!=null&&(e==null||t!==e))try{t=r.apply(this,arguments)}catch(n){q("wrapped function failed : "+n)}return t}}function Xi(r,i,e){return r.has(i)||r.set(i,e()),r.get(i)}function Yi(r,i){for(var e=r.__proto__;e!=null;){if(e instanceof i)return!0;e=e.__proto__}return!1}function Ne(r,i,e){for(var t=(e=e||r.parentNode).querySelectorAll(i),n=0;n<t.length;n++)if(t[n]===r)return!0;return!1}function kt(r,i){r.stopPropagation?r.stopPropagation():r.returnValue=!1,!i&&r.preventDefault&&r.preventDefault()}function ye(r,i,e,t){if(t&&Ne(r,i,e))return r;for(r=r.parentNode;r!=null&&r!==e;){if(Ne(r,i))return r;r=r.parentNode}}function ne(r){return r.srcElement||r.target}function Fn(r){return r.className!=null?r.className.baseVal===void 0?r.className:r.className.baseVal:""}function zi(r,i,e){var t=i==null?[]:Array.isArray(i)?i:i.split(/\s+/),n=e==null?[]:Array.isArray(e)?e:e.split(/\s+/),o=Fn(r).split(/\s+/),s=function(a,l){for(var c=0;c<l.length;c++)if(a)o.indexOf(l[c])===-1&&o.push(l[c]);else{var h=o.indexOf(l[c]);h!==-1&&o.splice(h,1)}};s(!0,t),s(!1,n),function(a,l,c){l=Ln(l),a.className.baseVal!==void 0?a.className.baseVal=l:a.className=l;try{var h=a.classList;if(h!=null){for(;h.length>0;)h.remove(h.item(0));for(var p=0;p<c.length;p++)c[p]&&h.add(c[p])}}catch(v){q("WARN: cannot set class list",v)}}(r,o.join(" "),o)}function bt(r){return!z(r)&&!Array.isArray(r)&&r.length!=null&&r.documentElement==null&&r.nodeType==null}function Re(r,i){var e=function(t,n){t!=null&&n!=null&&n.length>0&&(t.classList?j(Ln(n).split(/\s+/),function(o){t.classList.add(o)}):zi(t,n))};bt(r)?j(r,function(t){return e(t,i)}):e(r,i)}function Hn(r,i){var e=function(t,n){t!=null&&n!=null&&n.length>0&&(t.classList?Ln(n).split(/\s+/).forEach(function(o){t.classList.remove(o)}):zi(t,null,n))};bt(r)?j(r,function(t){return e(t,i)}):e(r,i)}function Vi(r,i,e,t){return Ui(null,r,i,e,t)}function Ui(r,i,e,t,n){var o,s=r==null?document.createElement(i):document.createElementNS(r,i);for(o in e=e||{})s.style[o]=e[o];for(o in t&&(s.className=t),n=n||{})s.setAttribute(o,""+n[o]);return s}function et(r){var i=r.getBoundingClientRect(),e=document.body,t=document.documentElement,n=window.pageYOffset||t.scrollTop||e.scrollTop,o=window.pageXOffset||t.scrollLeft||e.scrollLeft,s=t.clientTop||e.clientTop||0,a=t.clientLeft||e.clientLeft||0,l=i.top+n-s,c=i.left+o-a;return{x:Math.round(c),y:Math.round(l)}}function $t(r,i){var e=i.getContainer().getBoundingClientRect(),t=r.getBoundingClientRect(),n=i.currentZoom;return{x:(t.left-e.left)/n,y:(t.top-e.top)/n}}function Ct(r,i){var e=r.getBoundingClientRect(),t=i.currentZoom;return{w:e.width/t,h:e.height/t}}function Nn(r){return r instanceof SVGElement?He.SVG:He.HTML}function Be(){for(var r=arguments.length,i=new Array(r),e=0;e<r;e++)i[e]=arguments[e];return i.map(function(t){return"."+t}).join(",")}function Qt(){for(var r=arguments.length,i=new Array(r),e=0;e<r;e++)i[e]=arguments[e];return i.map(function(t){return"["+t+"]"}).join(",")}(function(r){r.SVG="SVG",r.HTML="HTML"})(He||(He={}));var Rn="source",Wi="target",Bn="block",tt="none",Et="absolute",qi="fixed",Zi="data-jtk-group",Ee="data-jtk-managed",en="data-jtk-not-draggable",Ji="tabindex",Ki="data-jtk-scope-",$i="checkCondition",Xn="jtk-connector",nt="jtk-endpoint",Yn="jtk-floating-endpoint",tn="jtk-group-collapsed",Pt="jtk-group-expanded",nn="jtk-overlay",Qi="connection",eo="internal.connection",to="connection:move",no="internal.endpoint:unregistered",zn="internal.connection:detached",io="element:manage",oo="maxConnections",ro="element:unmanage",so="zoom",it="isDetachAllowed",ao="beforeDrop",lo="beforeDetach",Y=Qt(Ee),uo={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},St="stroke-dasharray",Vn="dashstyle",Hr="fill",Nr="stroke",Rr="stroke-width",Br="strokeWidth",co="svg",Un="path",ho={svg:"http://www.w3.org/2000/svg"};function me(r,i){for(var e in i)r.setAttribute(e,""+i[e])}function _e(r,i){return(i=i||{}).version="1.1",i.xmlns=ho.svg,Ui(ho.svg,r,null,null,i)}function po(r){return"position:absolute;left:"+r[0]+"px;top:"+r[1]+"px"}function Wn(r,i,e){if(i.setAttribute(Hr,e.fill?e.fill:tt),i.setAttribute(Nr,e.stroke?e.stroke:tt),e.strokeWidth&&i.setAttribute(Rr,e.strokeWidth),e[Vn]&&e[Br]&&!e[St]){var t=e[Vn].indexOf(",")===-1?" ":",",n=e[Vn].split(t),o="";j(n,function(a){o+=Math.floor(a*e.strokeWidth)+t}),i.setAttribute(St,o)}else e[St]&&i.setAttribute(St,e[St]);for(var s in uo)e[s]&&i.setAttribute(uo[s],e[s])}function on(r,i,e){r.childNodes.length>e?r.insertBefore(i,r.childNodes[e]):r.appendChild(i)}function R(r,i,e){return[r,i].join(":")}var Pe,he,vo="data-jtk-container",rn="data-jtk-enabled",qn="data-jtk-scope",Xe="endpoint",de="element",pe="connection",ee="click",xe="contextmenu",ie="dblclick",ae="dbltap",O="mousedown",Zn="mouseenter",Jn="mouseexit",J="mousemove",G="mouseup",re="mouseout",se="mouseover",le="tap",sn="revert",fo="connection:drag",go=R(de,ee),Xr=R(de,ie),yo=R(de,ae),Yr=R(de,re),zr=R(de,se),Vr=R(de,J),Ur=R(de,G),Wr=R(de,O),qr=R(de,xe),mo=R(de,le),Zr=R(Xe,ee),Jr=R(Xe,ie),Kr=R(Xe,re),$r=R(Xe,se),Qr=R(Xe,G),es=R(Xe,O),ts=R(pe,ee),ns=R(pe,ie),is=R(pe,ae),os=R(pe,re),rs=R(pe,se),ss=R(pe,G),as=R(pe,O),ls=R(pe,xe),us=R(pe,le),_o="position",ue=Be(Xn),Ye=Be(nt),cs=Qt(Zi),hs=Qt("data-jtk-group-content"),ke=Be(nn);(function(r){r.Circle="Circle",r.Ellipse="Ellipse",r.Triangle="Triangle",r.Diamond="Diamond",r.Rectangle="Rectangle",r.Square="Square"})(Pe||(Pe={})),function(r){r.Assign="Assign",r.AutoDefault="AutoDefault",r.Bottom="Bottom",r.BottomLeft="BottomLeft",r.BottomRight="BottomRight",r.Center="Center",r.Continuous="Continuous",r.ContinuousBottom="ContinuousBottom",r.ContinuousLeft="ContinuousLeft",r.ContinuousRight="ContinuousRight",r.ContinuousTop="ContinuousTop",r.ContinuousLeftRight="ContinuousLeftRight",r.ContinuousTopBottom="ContinuousTopBottom",r.Left="Left",r.Perimeter="Perimeter",r.Right="Right",r.Top="Top",r.TopLeft="TopLeft",r.TopRight="TopRight"}(he||(he={}));var an,ln,Kn=function(){function r(i){M(this,r),this.params=i,u(this,"x1",void 0),u(this,"x2",void 0),u(this,"y1",void 0),u(this,"y2",void 0),u(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),u(this,"type",void 0),this.x1=i.x1,this.y1=i.y1,this.x2=i.x2,this.y2=i.y2}return D(r,[{key:"findClosestPointOnPath",value:function(i,e){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(i,e,t,n){return[]}},{key:"boxIntersection",value:function(i,e,t,n){var o=[];return o.push.apply(o,this.lineIntersection(i,e,i+t,e)),o.push.apply(o,this.lineIntersection(i+t,e,i+t,e+n)),o.push.apply(o,this.lineIntersection(i+t,e+n,i,e+n)),o.push.apply(o,this.lineIntersection(i,e+n,i,e)),o}},{key:"boundingBoxIntersection",value:function(i){return this.boxIntersection(i.x,i.y,i.w,i.h)}}]),r}(),xo="undefined",un="default",ko="true",ot="false",ze="*";function ds(r,i,e,t,n,o,s){return function(){var a=[];return a.push.apply(a,arguments),a.item=function(l){return this[l]},a}(function(a,l,c,h,p,v,f){return new Touch({target:a,identifier:W(),pageX:l,pageY:c,screenX:h,screenY:p,clientX:v||h,clientY:f||p})}(r,i,e,t,n,o,s))}function rt(r,i,e){for(var t=(e=e||r.parentNode).querySelectorAll(i),n=0;n<t.length;n++)if(t[n]===r)return!0;return!1}function wt(r){return r.srcElement||r.target}function $n(r,i,e,t){if(t){var n=r.composedPath?r.composedPath():r.path;if(n!==void 0&&n.indexOf)return{path:n,end:n.indexOf(e)};var o={path:[],end:-1};return function s(a){o.path.push(a),a===e?o.end=o.path.length-1:a.parentNode!=null&&s(a.parentNode)}(i),o}return{path:[i],end:1}}var ps=1;function Mt(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints!=null&&navigator.maxTouchPoints>0}function cn(){return"onmousedown"in document.documentElement}var be=(u(an={},O,"touchstart"),u(an,G,"touchend"),u(an,J,"touchmove"),an),vs="page";function Qn(r,i){if(r==null)return{x:0,y:0};var e=function(t,n){return t.item?t.item(n):t[n]}(bo(r),0);return{x:e[i+"X"],y:e[i+"Y"]}}function hn(r){return Qn(r,vs)}function bo(r){return r.touches&&r.touches.length>0?r.touches:r.changedTouches&&r.changedTouches.length>0?r.changedTouches:r.targetTouches&&r.targetTouches.length>0?r.targetTouches:[r]}function dn(r,i,e,t,n){if(Eo(r,i,e),t.__tauid=e.__tauid,r.addEventListener)r.addEventListener(i,e,!1,n);else if(r.attachEvent){var o=i+e.__tauid;r["e"+o]=e,r[o]=function(){r["e"+o]&&r["e"+o](window.event)},r.attachEvent("on"+i,r[o])}}function At(r,i,e){var t=this;e!=null&&Co(r,function(n){if(function(s,a,l){if(s.__ta&&s.__ta[a]&&delete s.__ta[a][l.__tauid],l.__taExtra){for(var c=0;c<l.__taExtra.length;c++)At(s,l.__taExtra[c][0],l.__taExtra[c][1]);l.__taExtra.length=0}l.__taUnstore&&l.__taUnstore()}(n,i,e),e.__tauid!=null){if(n.removeEventListener)n.removeEventListener(i,e,!1),Mt()&&be[i]&&n.removeEventListener(be[i],e,!1);else if(t.detachEvent){var o=i+e.__tauid;n[o]&&n.detachEvent("on"+i,n[o]),n[o]=null,n["e"+o]=null}}e.__taTouchProxy&&At(r,e.__taTouchProxy[1],e.__taTouchProxy[0])})}function Co(r,i){if(r!=null)for(var e=typeof r=="string"?document.querySelectorAll(r):r.length!=null?r:[r],t=0;t<e.length;t++)i(e[t])}function Eo(r,i,e){var t=ps++;return r.__ta=r.__ta||{},r.__ta[i]=r.__ta[i]||{},r.__ta[i][t]=e,e.__tauid=t,t}var fs=/:not\(([^)]+)\)/;function pn(r,i,e,t){if(r==null)return e;var n=r.split(","),o=[],s=[];j(n,function(l){var c=l.match(fs);c!=null?s.push(c[1]):o.push(l)}),s.length>0&&o.length===0&&o.push(ze);var a=function l(c){l.__tauid=e.__tauid;var h=wt(c),p=!1,v=h,f=$n(c,h,i,r!=null);if(f.end!=-1)for(var g=0;!p&&g<f.end;g++){v=f.path[g];for(var y=0;y<s.length;y++)if(rt(v,s[y],i))return;for(var m=0;!p&&m<o.length;m++)if(rt(v,o[m],i)){e.apply(v,[c,v]),p=!0;break}}};return function(l,c,h){l.__taExtra=l.__taExtra||[],l.__taExtra.push([c,h])}(e,t,a),a}var vn=function(r,i,e,t,n){if(Mt()&&be[i]){var o=pn(t,r,e,be[i]);dn(r,be[i],o,e,n)}i==="focus"&&r.getAttribute(Ji)==null&&r.setAttribute(Ji,"1"),dn(r,i,pn(t,r,e,i),e,n)},ei=(u(ln={},le,{touches:1,taps:1}),u(ln,ae,{touches:1,taps:2}),u(ln,xe,{touches:2,taps:1}),ln);function Po(r,i,e,t){for(var n in e.__tamee[r])e.__tamee[r].hasOwnProperty(n)&&e.__tamee[r][n].apply(t,[i])}var gs=function(){function r(){M(this,r)}return D(r,null,[{key:"generate",value:function(i,e){return function(t,n,o,s){if(n==xe&&cn())vn(t,n,o,s);else{if(t.__taTapHandler==null){var a=t.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},l=function(v){for(var f=wt(v),g=$n(v,f,t,s!=null),y=!1,m=0;m<g.end;m++){if(y)return;f=g.path[m];for(var _=0;_<a.downSelectors.length;_++)if(a.downSelectors[_]==null||rt(f,a.downSelectors[_],t)){a.down=!0,setTimeout(h,i),setTimeout(p,e),y=!0;break}}},c=function(v){if(a.down){var f,g,y=wt(v);a.taps++;var m=function(x){return bo(x).length}(v);for(var _ in ei)if(ei.hasOwnProperty(_)){var C=ei[_];if(C.touches===m&&(C.taps===1||C.taps===a.taps))for(var P=0;P<a[_].length;P++){g=$n(v,y,t,a[_][P][1]!=null);for(var b=0;b<g.end;b++)if(f=g.path[b],a[_][P][1]==null||rt(f,a[_][P][1],t)){a[_][P][0].apply(f,[v,f]);break}}}}},h=function(){a.down=!1},p=function(){a.taps=0};t.__taTapHandler.downHandler=l,t.__taTapHandler.upHandler=c,vn(t,O,l),vn(t,G,c)}t.__taTapHandler.downSelectors.push(s),t.__taTapHandler[n].push([o,s]),o.__taUnstore=function(){t.__taTapHandler!=null&&(Z(t.__taTapHandler.downSelectors,function(v){return v===s}),function(v,f){var g,y=0;for(y=0,g=v.length;y<g&&v[y][0]!==f;y++);y<v.length&&v.splice(y,1)}(t.__taTapHandler[n],o),t.__taTapHandler.downSelectors.length===0&&(At(t,O,t.__taTapHandler.downHandler),At(t,G,t.__taTapHandler.upHandler),delete t.__taTapHandler))}}}}}]),r}(),ys=function(){function r(){M(this,r)}return D(r,null,[{key:"generate",value:function(){var i=[];return function(e,t,n,o){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var s=function(l){var c=wt(l);(o==null&&c==e&&!e.__tamee.over||rt(c,o,e)&&(c.__tamee==null||!c.__tamee.over))&&(Po(Zn,l,e,c),c.__tamee=c.__tamee||{},c.__tamee.over=!0,i.push(c))},a=function(l){for(var c=wt(l),h=0;h<i.length;h++)c!=i[h]||rt(l.relatedTarget||l.toElement,"*",c)||(c.__tamee.over=!1,i.splice(h,1),Po(Jn,l,e,c))};dn(e,se,pn(o,e,s,se),s),dn(e,re,pn(o,e,a,re),a)}n.__taUnstore=function(){delete e.__tamee[t][n.__tauid]},Eo(e,t,n),e.__tamee[t][n.__tauid]=n}}}]),r}(),ti=function(){function r(i){M(this,r),u(this,"clickThreshold",void 0),u(this,"dblClickThreshold",void 0),u(this,"tapHandler",void 0),u(this,"mouseEnterExitHandler",void 0),i=i||{},this.clickThreshold=i.clickThreshold||250,this.dblClickThreshold=i.dblClickThreshold||450,this.mouseEnterExitHandler=ys.generate(),this.tapHandler=gs.generate(this.clickThreshold,this.dblClickThreshold)}return D(r,[{key:"_doBind",value:function(i,e,t,n,o){if(t!=null){var s=i;e===le||e===ae||e===xe?this.tapHandler(s,e,t,n,o):e===Zn||e==Jn?this.mouseEnterExitHandler(s,e,t,n,o):vn(s,e,t,n,o)}}},{key:"on",value:function(i,e,t,n,o){var s=n==null?null:t,a=n??t;return this._doBind(i,e,a,s,o),this}},{key:"off",value:function(i,e,t){return At(i,e,t),this}},{key:"trigger",value:function(i,e,t,n,o){var s=cn()&&(typeof MouseEvent>"u"||t==null||t.constructor===MouseEvent),a=Mt()&&!cn()&&be[e]?be[e]:e,l=!(Mt()&&!cn()&&be[e]),c=hn(t),h=Qn(t,"screen"),p=function(v){return Qn(v,"client")}(t);return Co(i,function(v){var f;t=t||{screenX:h.x,screenY:h.y,clientX:p.x,clientY:p.y};var g,y={TouchEvent:function(_){var C=ds(v,c.x,c.y,h.x,h.y,p.x,p.y);(_.initTouchEvent||_.initEvent)(a,!0,!0,window,null,h.x,h.y,p.x,p.y,!1,!1,!1,!1,C,C,C,1,0)},MouseEvents:function(_){_.initMouseEvent(a,!0,!0,window,o??1,h.x,h.y,p.x,p.y,!1,!1,!1,!1,1,v)}},m=!l&&!s&&Mt()&&be[e]?"TouchEvent":"MouseEvents";f=document.createEvent(m),y[m](f),g=f,n&&(g.payload=n),v.dispatchEvent(f)}),this}}]),r}(),ms=[null,[1,-1],[1,1],[-1,1],[-1,-1]],_s=[null,[-1,-1],[-1,1],[1,1],[1,-1]],Ve=2*Math.PI;function st(r,i){return i.x===r.x?i.y>r.y?1/0:-1/0:i.y===r.y?i.x>r.x?0:-0:(i.y-r.y)/(i.x-r.x)}function ni(r,i){return Math.sqrt(Math.pow(i.y-r.y,2)+Math.pow(i.x-r.x,2))}function ii(r,i){return i.x>r.x||i.x==r.x?i.y>r.y?2:1:i.y>r.y?3:4}function So(r,i){var e=r.x,t=r.x+r.w,n=r.y,o=r.y+r.h,s=i.x,a=i.x+i.w,l=i.y,c=i.y+i.h;return e<=s&&s<=t&&n<=l&&l<=o||e<=a&&a<=t&&n<=l&&l<=o||e<=s&&s<=t&&n<=c&&c<=o||e<=a&&s<=t&&n<=c&&c<=o||s<=e&&e<=a&&l<=n&&n<=c||s<=t&&t<=a&&l<=n&&n<=c||s<=e&&e<=a&&l<=o&&o<=c||s<=t&&e<=a&&l<=o&&o<=c}function Ue(r,i,e){var t=st(r,i),n=ii(r,i),o=e>0?ms[n]:_s[n],s=Math.atan(t),a=Math.abs(e*Math.sin(s))*o[1],l=Math.abs(e*Math.cos(s))*o[0];return{x:r.x+l,y:r.y+a}}function xs(r,i,e){if(Ne(i,e,r))return i;for(var t=i.parentNode;t!=null&&t!==r;){if(Ne(t,e,r))return t;t=t.parentNode}}function wo(r,i,e){var t=i.parentNode,n=r.getSize(t),o=r.getSize(i),s=e.x,a=s+o.w,l=e.y,c=l+o.h;return a>0&&s<n.w&&c>0&&l<n.h}var ce,Mo="start",Ao="beforeStart",jo="drag",Do="stop",ks="katavorio-draggable",oi=function(){return!0},bs=function(){return!1},Cs="katavorio-delegated-draggable",To="katavorio-drag-no-select",Es="katavorio-ghost-proxy",Ps="katavorio-clone-drag";(function(r){r.absolutePosition="absolutePosition",r.transform="transform",r.xyAttributes="xyAttributes"})(ce||(ce={}));var ri=new Map;ri.set(ce.absolutePosition,function(r,i){r.style.left="".concat(i.x,"px"),r.style.top="".concat(i.y,"px")}),ri.set(ce.xyAttributes,function(r,i){r.setAttribute("x","".concat(i.x)),r.setAttribute("y","".concat(i.y))});var si=new Map;si.set(ce.absolutePosition,function(r){return{x:r.offsetLeft,y:r.offsetTop}}),si.set(ce.xyAttributes,function(r){return{x:parseFloat(r.getAttribute("x")),y:parseFloat(r.getAttribute("y"))}});var ai=new Map;ai.set(ce.absolutePosition,function(r,i){r.style.width="".concat(i.w,"px"),r.style.height="".concat(i.h,"px")}),ai.set(ce.xyAttributes,function(r,i){r.setAttribute("width","".concat(i.w)),r.setAttribute("height","".concat(i.h))});var li=new Map;li.set(ce.absolutePosition,function(r){return{w:r.offsetWidth,h:r.offsetHeight}}),li.set(ce.xyAttributes,function(r){return{w:parseFloat(r.getAttribute("width")),h:parseFloat(r.getAttribute("height"))}});var jt,ui=[Do,Mo,jo,"drop","over","out",Ao],Ss=function(){},at=function(r,i){if(r!=null){r=z(r)||r.tagName!=null||r.length==null?[r]:r;for(var e=0;e<r.length;e++)i.apply(r[e],[r[e]])}},ws=function(){function r(i,e){M(this,r),this.el=i,this.manager=e,u(this,"_class",void 0),u(this,"uuid",W()),u(this,"enabled",!0),u(this,"scopes",[]),u(this,"eventManager",void 0),this.eventManager=e.eventManager}return D(r,[{key:"setEnabled",value:function(i){this.enabled=i}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(i){var e={};for(var t in at(this.scopes,function(n){e[n]=!0}),at(i?i.split(/\s+/):[],function(n){e[n]=!0}),this.scopes.length=0,e)this.scopes.push(t)}},{key:"removeScope",value:function(i){var e={};for(var t in at(this.scopes,function(n){e[n]=!0}),at(i?i.split(/\s+/):[],function(n){delete e[n]}),this.scopes.length=0,e)this.scopes.push(t)}},{key:"toggleScope",value:function(i){var e={};for(var t in at(this.scopes,function(n){e[n]=!0}),at(i?i.split(/\s+/):[],function(n){e[n]?delete e[n]:e[n]=!0}),this.scopes.length=0,e)this.scopes.push(t)}}]),r}();(function(r){r.notNegative="notNegative",r.parent="parent",r.parentEnclosed="parentEnclosed"})(jt||(jt={}));var Ms=function(){F(i,ws);var r=H(i);function i(e,t,n){var o;if(M(this,i),u(d(o=r.call(this,e,n)),"_class",void 0),u(d(o),"rightButtonCanDrag",void 0),u(d(o),"consumeStartEvent",void 0),u(d(o),"clone",void 0),u(d(o),"scroll",void 0),u(d(o),"trackScroll",void 0),u(d(o),"_downAt",void 0),u(d(o),"_posAtDown",void 0),u(d(o),"_pagePosAtDown",void 0),u(d(o),"_pageDelta",{x:0,y:0}),u(d(o),"_moving",void 0),u(d(o),"_lastPosition",void 0),u(d(o),"_lastScrollValues",{x:0,y:0}),u(d(o),"_initialScroll",{x:0,y:0}),u(d(o),"_size",void 0),u(d(o),"_currentParentPosition",void 0),u(d(o),"_ghostParentPosition",void 0),u(d(o),"_dragEl",void 0),u(d(o),"_multipleDrop",void 0),u(d(o),"_ghostProxyOffsets",void 0),u(d(o),"_ghostDx",void 0),u(d(o),"_ghostDy",void 0),u(d(o),"_isConstrained",!1),u(d(o),"_ghostProxyParent",void 0),u(d(o),"_useGhostProxy",void 0),u(d(o),"_ghostProxyFunction",void 0),u(d(o),"_activeSelectorParams",void 0),u(d(o),"_availableSelectors",[]),u(d(o),"_canDrag",void 0),u(d(o),"_consumeFilteredEvents",void 0),u(d(o),"_parent",void 0),u(d(o),"_ignoreZoom",void 0),u(d(o),"_filters",{}),u(d(o),"_constrainRect",void 0),u(d(o),"_elementToDrag",void 0),u(d(o),"downListener",void 0),u(d(o),"moveListener",void 0),u(d(o),"upListener",void 0),u(d(o),"scrollTracker",void 0),u(d(o),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),o._class=o.manager.css.draggable,Re(o.el,o._class),o.downListener=o._downListener.bind(d(o)),o.upListener=o._upListener.bind(d(o)),o.moveListener=o._moveListener.bind(d(o)),o.rightButtonCanDrag=t.rightButtonCanDrag===!0,o.consumeStartEvent=t.consumeStartEvent!==!1,o._dragEl=o.el,o.clone=t.clone===!0,o.scroll=t.scroll===!0,o.trackScroll=t.trackScroll!==!1,o._multipleDrop=t.multipleDrop!==!1,o._canDrag=t.canDrag||oi,o._consumeFilteredEvents=t.consumeFilteredEvents,o._parent=t.parent,o._ignoreZoom=t.ignoreZoom===!0,o._ghostProxyParent=t.ghostProxyParent,o.trackScroll&&(o.scrollTracker=o._trackScroll.bind(d(o)),document.addEventListener("scroll",o.scrollTracker)),t.ghostProxy===!0?o._useGhostProxy=oi:t.ghostProxy&&typeof t.ghostProxy=="function"?o._useGhostProxy=t.ghostProxy:o._useGhostProxy=function(a,l){return!(!o._activeSelectorParams||!o._activeSelectorParams.useGhostProxy)&&o._activeSelectorParams.useGhostProxy(a,l)},t.makeGhostProxy?o._ghostProxyFunction=t.makeGhostProxy:o._ghostProxyFunction=function(a){return o._activeSelectorParams&&o._activeSelectorParams.makeGhostProxy?o._activeSelectorParams.makeGhostProxy(a):a.cloneNode(!0)},t.selector){var s=o.el.getAttribute(ks);s==null&&(s=""+new Date().getTime(),o.el.setAttribute("katavorio-draggable",s)),o._availableSelectors.push(t)}return o.eventManager.on(o.el,O,o.downListener),o}return D(i,[{key:"_trackScroll",value:function(e){if(this._moving){var t={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=t.x-this._lastScrollValues.x,o=t.y-this._lastScrollValues.y,s={x:n+this._lastPosition.x,y:o+this._lastPosition.y},a=s.x-this._downAt.x,l=s.y-this._downAt.y,c=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(a+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,l+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),a/=c,l/=c,this.moveBy(a,l,e),this._lastPosition=s,this._lastScrollValues=t}}},{key:"on",value:function(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(this.listeners[e]){for(var n=[],o=0;o<this.listeners[e].length;o++)this.listeners[e][o]!==t&&n.push(this.listeners[e][o]);this.listeners[e]=n}}},{key:"_upListener",value:function(e){this._downAt&&(this._downAt=null,this.eventManager.off(document,J,this.moveListener),this.eventManager.off(document,G,this.upListener),Hn(document.body,To),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))===!0&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch(sn,this._dragEl)))}},{key:"_downListener",value:function(e){if(!e.defaultPrevented&&(this.rightButtonCanDrag||e.which!==3&&e.button!==2)&&this.isEnabled()&&this._canDrag()){var t=this._testFilter(e)&&function(c,h,p){return!Ne(c.srcElement||c.target,p.getInputFilterSelector(),h)}(e,this.el,this.manager);if(t){this._activeSelectorParams=null,this._elementToDrag=null,this._availableSelectors.length;var n=e.target||e.srcElement,o=function(c,h,p){for(var v=null,f=h.getAttribute("katavorio-draggable"),g=f!=null?"[katavorio-draggable='"+f+"'] ":"",y=0;y<c.length;y++)if((v=xs(h,p,g+c[y].selector))!=null){if(c[y].filter){var m=Ne(p,c[y].filter,v);if(c[y].filterExclude===!0&&!m||m)return null}return[c[y],v]}return null}(this._availableSelectors,this.el,n);if(o!=null&&(this._activeSelectorParams=o[0],this._elementToDrag=o[1]),this._activeSelectorParams==null||this._elementToDrag==null)return;var s=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,e):null;if(s!=null&&(this._elementToDrag=s),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),Re(this._dragEl,Ps),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",this._parent!=null){var a=this.manager.getPosition(this.el);this._dragEl.style.left=a.x+"px",this._dragEl.style.top=a.y+"px",this._parent.appendChild(this._dragEl)}else{var l=et(this._elementToDrag);this._dragEl.style.left=l.x+"px",this._dragEl.style.top=l.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&kt(e),this._downAt=hn(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=et(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,J,this.moveListener),this.eventManager.on(document,G,this.upListener),Re(document.body,To),this._dispatch(Ao,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size})}else this._consumeFilteredEvents&&kt(e)}}},{key:"_moveListener",value:function(e){if(this._downAt){if(!this._moving){var t=this._dispatch(Mo,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size});if(t!==!1){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var n=hn(e),o=n.x-this._downAt.x,s=n.y-this._downAt.y,a=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(o+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,s+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),o/=a,s/=a,this.moveBy(o,s,e)}}}},{key:"getDragDelta",value:function(){return this._posAtDown!=null&&this._downAt!=null?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(e){var t;this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=et(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),Re(this._dragEl,this.manager.css.drag),this._constrainRect={w:(t=this._dragEl).parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,Hn(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(e,t,n){var o=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),s=this._doConstrain(o,this._dragEl,this._constrainRect,this._size,n);if(s!=null){if(this._useGhostProxy(this.el,this._dragEl))if(o.x!==s.x||o.y!==s.y){if(!this._isConstrained){var a=this._ghostProxyFunction(this._elementToDrag);Re(a,Es),this._ghostProxyParent?(this._ghostProxyParent.appendChild(a),this._currentParentPosition=et(this._elementToDrag.parentNode),this._ghostParentPosition=et(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(a),this._dragEl=a,this._isConstrained=!0}s=o}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:s.x+this._ghostDx,y:s.y+this._ghostDy}),this._dispatch(jo,{el:this.el,pos:s,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){this._downAt!=null&&this._upListener()}},{key:"getDragElement",value:function(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(e,t){if(t||this._moving){var n=[],o=this.manager.getPosition(this._dragEl);n.push([this._dragEl,o,this,this._size]),this._dispatch(Do,{el:this._dragEl,pos:this._ghostProxyOffsets||o,finalPos:o,e,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(e,t){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])n=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var o=0;o<this.listeners[e].length;o++)try{var s=this.listeners[e][o](t);s!=null&&(n=s)}catch{}return n}},{key:"resolveGrid",value:function(){var e={grid:null,thresholdX:5,thresholdY:5};return this._activeSelectorParams!=null&&this._activeSelectorParams.grid!=null&&(e.grid=this._activeSelectorParams.grid,this._activeSelectorParams.snapThreshold!=null&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function(e){var t=this.resolveGrid(),n=t.grid,o=t.thresholdX,s=t.thresholdY;return n==null?e:function(a,l,c,h){c=c??(l.thresholdX==null?l.w/2:l.thresholdX),h=h??(l.thresholdY==null?l.h/2:l.thresholdY);var p=Math.floor(a.x/l.w),v=l.w*p,f=v+l.w,g=Math.abs(a.x-v)<=c?v:Math.abs(f-a.x)<=c?f:a.x,y=Math.floor(a.y/l.h),m=l.h*y,_=m+l.h;return{x:g,y:Math.abs(a.y-m)<=h?m:Math.abs(_-a.y)<=h?_:a.y}}(e,n,n?n.w/2:o,n?n.h/2:s)}},{key:"setUseGhostProxy",value:function(e){this._useGhostProxy=e?oi:bs}},{key:"_doConstrain",value:function(e,t,n,o,s){return this._activeSelectorParams!=null&&this._activeSelectorParams.constrainFunction&&typeof this._activeSelectorParams.constrainFunction=="function"?this._activeSelectorParams.constrainFunction(e,t,n,o,s):e}},{key:"_testFilter",value:function(e){for(var t in this._filters){var n=this._filters[t],o=n[0](e);if(n[1]&&(o=!o),!o)return!1}return!0}},{key:"addFilter",value:function(e,t){var n,o=this;if(e){var s=typeof(n=e)=="function"?(n._katavorioId=W(),n._katavorioId):n;this._filters[s]=[function(a){var l,c=a.srcElement||a.target;return z(e)?l=Ne(c,e,o.el):typeof e=="function"&&(l=e(a,o.el)),l},t!==!1]}}},{key:"removeFilter",value:function(e){var t=typeof e=="function"?e._katavorioId:e;delete this._filters[t]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function(){this.eventManager.off(this.el,O,this.downListener),this.eventManager.off(document,J,this.moveListener),this.eventManager.off(document,G,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,this.scrollTracker!=null&&document.removeEventListener("scroll",this.scrollTracker)}}]),i}(),As=["input","textarea","select","button","option"].join(","),js=function(){function r(i){M(this,r),u(this,"eventManager",void 0),u(this,"zoom",1),u(this,"css",{}),u(this,"inputFilterSelector",void 0),u(this,"positioningStrategy",void 0),u(this,"_positionSetter",void 0),u(this,"_positionGetter",void 0),u(this,"_sizeSetter",void 0),u(this,"_sizeGetter",void 0),i=i||{},this.inputFilterSelector=i.inputFilterSelector||As,this.eventManager=new ti,this.zoom=i.zoom||1,this.positioningStrategy=i.positioningStrategy||ce.absolutePosition,this._positionGetter=si.get(this.positioningStrategy),this._positionSetter=ri.get(this.positioningStrategy),this._sizeGetter=li.get(this.positioningStrategy),this._sizeSetter=ai.get(this.positioningStrategy);var e=i.css||{};A(this.css,e)}return D(r,[{key:"getPosition",value:function(i){return this._positionGetter(i)}},{key:"setPosition",value:function(i,e){this._positionSetter(i,e)}},{key:"getSize",value:function(i){return this._sizeGetter(i)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(i){this.zoom=i}},{key:"_prepareParams",value:function(i){i=i||{};var e,t={events:{}};for(e in i)t[e]=i[e];for(e=0;e<ui.length;e++)t.events[ui[e]]=i[ui[e]]||Ss;return t}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(i){return this.inputFilterSelector=i,this}},{key:"draggable",value:function(i,e){if(i._katavorioDrag==null){var t=this._prepareParams(e),n=new Ms(i,t,this);return Re(i,Cs),i._katavorioDrag=n,n}return i._katavorioDrag}},{key:"destroyDraggable",value:function(i){i._katavorioDrag&&(i._katavorioDrag.destroy(),delete i._katavorioDrag)}}]),r}(),fn="jtk-drag-selected",Ds=function(){function r(i){M(this,r),this.instance=i,u(this,"_dragSelection",[]),u(this,"_dragSizes",new Map),u(this,"_dragElements",new Map),u(this,"_dragElementStartPositions",new Map),u(this,"_dragElementPositions",new Map),u(this,"__activeSet",void 0)}return D(r,[{key:"_activeSet",get:function(){return this.__activeSet==null?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(i){var e=this;this.__activeSet=[],j(this._dragSelection,function(t){i(t)&&e.__activeSet.push(t)})}},{key:"clear",value:function(){var i=this;this.reset(),j(this._dragSelection,function(e){return i.instance.removeClass(e.jel,fn)}),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var i=this;j(this._activeSet,function(e){var t=i.instance.viewport.getPosition(e.id),n={x:parseInt(""+e.jel.offsetLeft,10),y:parseInt(""+e.jel.offsetTop,10)};i._dragElementStartPositions.set(e.id,n),i._dragElementPositions.set(e.id,n),i._dragSizes.set(e.id,{w:t.w,h:t.h})})}},{key:"updatePositions",value:function(i,e,t){var n=this,o=i.x-e.x,s=i.y-e.y;j(this._activeSet,function(a){var l=n._dragElementStartPositions.get(a.id);if(l){var c=l.x+o,h=l.y+s,p=n._dragSizes.get(a.id),v={x:c,y:h,w:p.w,h:p.h};if(a.jel._jsPlumbParentGroup&&a.jel._jsPlumbParentGroup.constrain){var f={w:a.jel.parentNode.offsetWidth+a.jel.parentNode.scrollLeft,h:a.jel.parentNode.offsetHeight+a.jel.parentNode.scrollTop};v.x=Math.max(v.x,0),v.y=Math.max(v.y,0),v.x=Math.min(v.x,f.w-p.w),v.y=Math.min(v.y,f.h-p.h)}n._dragElementPositions.set(a.id,{x:c,y:h}),a.jel.style.left=v.x+"px",a.jel.style.top=v.y+"px",t(a.jel,a.id,p,v)}})}},{key:"each",value:function(i){var e=this;j(this._activeSet,function(t){var n=e._dragSizes.get(t.id),o=e._dragElementPositions.get(t.id),s=e._dragElementStartPositions.get(t.id);i(t.jel,t.id,o,n,s)})}},{key:"add",value:function(i,e){var t=i;e=e||this.instance.getId(t),Ce(this._dragSelection,function(n){return n.id===e})===-1&&(this.instance.addClass(i,fn),this._dragSelection.push({id:e,jel:t}))}},{key:"remove",value:function(i){var e=this,t=i;this._dragSelection=this._dragSelection.filter(function(n){var o=n.jel!==t;return o||e.instance.removeClass(n.jel,fn),o})}},{key:"toggle",value:function(i){var e=i;Ce(this._dragSelection,function(t){return t.jel===e})!==-1?this.remove(e):this.add(i)}}]),r}(),Se="jtk-drag-active",we="jtk-drag-hover",Ts=function(){function r(i,e,t){var n=this;M(this,r),this.instance=i,this.dragSelection=e,u(this,"collicat",void 0),u(this,"drag",void 0),u(this,"_draggables",{}),u(this,"_dlist",[]),u(this,"_elementsWithEndpoints",{}),u(this,"_draggablesForElements",{}),u(this,"handlers",[]),u(this,"_trackScroll",void 0),u(this,"_filtersToAdd",[]),this.collicat=new js({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:fn,active:Se,hover:we,ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind(so,function(o){n.collicat.setZoom(o)}),t=t||{},this._trackScroll=t.trackScroll!==!1}return D(r,[{key:"addHandler",value:function(i,e){var t=this,n=A({selector:i.selector},e||{});n.start=Kt(n.start,function(a){return i.onStart(a)},!1),n.drag=Kt(n.drag,function(a){return i.onDrag(a)}),n.stop=Kt(n.stop,function(a){return i.onStop(a)});var o=(i.onBeforeStart||function(a){}).bind(i);if(n.beforeStart=Kt(n.beforeStart,function(a){return o(a)}),n.dragInit=function(a,l){return i.onDragInit(a,l)},n.dragAbort=function(a){return i.onDragAbort(a)},i.useGhostProxy&&(n.useGhostProxy=i.useGhostProxy,n.makeGhostProxy=i.makeGhostProxy),n.constrainFunction==null&&n.containment!=null)switch(n.containment){case jt.notNegative:n.constrainFunction=function(a,l,c,h){return{x:Math.max(0,Math.min(a.x)),y:Math.max(0,Math.min(a.y))}};break;case jt.parent:var s=n.containmentPadding||5;n.constrainFunction=function(a,l,c,h){return{x:a.x<0?0:a.x>c.w-s?c.w-s:a.x,y:a.y<0?0:a.y>c.h-s?c.h-s:a.y}};break;case jt.parentEnclosed:n.constrainFunction=function(a,l,c,h){return{x:a.x<0?0:a.x+h.w>c.w?c.w-h.w:a.x,y:a.y<0?0:a.y+h.h>c.h?c.h-h.h:a.y}}}this.drag==null?(n.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),n),j(this._filtersToAdd,function(a){return t.drag.addFilter(a[0],a[1])}),this.drag.on(sn,function(a){t.instance.revalidate(a)})):this.drag.addSelector(n),this.handlers.push({handler:i,options:n}),i.init(this.drag)}},{key:"addSelector",value:function(i,e){this.drag&&this.drag.addSelector(i,e)}},{key:"addFilter",value:function(i,e){this.drag==null?this._filtersToAdd.push([i,e===!0]):this.drag.addFilter(i,e)}},{key:"removeFilter",value:function(i){this.drag!=null&&this.drag.removeFilter(i)}},{key:"setFilters",value:function(i){var e=this;j(i,function(t){e.drag.addFilter(t[0],t[1])})}},{key:"reset",value:function(){var i=[];if(j(this.handlers,function(n){n.handler.reset()}),this.handlers.length=0,this.drag!=null){var e=this.drag._filters;for(var t in e)i.push([t,e[t][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,i}},{key:"setOption",value:function(i,e){var t=Gn(this.handlers,function(n){return n.handler===i});t!=null&&A(t.options,e||{})}}]),r}(),Dt,Tt,It,lt,ci=function(){function r(i,e){M(this,r),this.instance=i,this._dragSelection=e,u(this,"selector","> "+Y+":not("+Be(nn)+")"),u(this,"_dragOffset",null),u(this,"_groupLocations",[]),u(this,"_intersectingGroups",[]),u(this,"_currentDragParentGroup",null),u(this,"_dragGroupByElementIdMap",{}),u(this,"_dragGroupMap",{}),u(this,"_currentDragGroup",null),u(this,"_currentDragGroupOffsets",new Map),u(this,"_currentDragGroupSizes",new Map),u(this,"_currentDragGroupOriginalPositions",new Map),u(this,"_dragPayload",null),u(this,"drag",void 0),u(this,"originalPosition",void 0)}return D(r,[{key:"onDragInit",value:function(i){return null}},{key:"onDragAbort",value:function(i){return null}},{key:"getDropGroup",value:function(){var i=null;if(this._intersectingGroups.length>0){var e=this._intersectingGroups[0].groupLoc.group,t=this._intersectingGroups[0].intersectingElement,n=t._jsPlumbParentGroup;n!==e&&(n!=null&&n.overrideDrop(t,e)||(i=this._intersectingGroups[0]))}return i}},{key:"onStop",value:function(i){var e,t=this,n=i.drag.getDragElement(),o=this.getDropGroup(),s=[];function a(f,g,y,m,_){var C=y.x,P=y.y;if(f._jsPlumbParentGroup&&f._jsPlumbParentGroup.constrain){var b={w:f.parentNode.offsetWidth+f.parentNode.scrollLeft,h:f.parentNode.offsetHeight+f.parentNode.scrollTop};C=Math.max(C,0),P=Math.max(P,0),C=Math.min(C,b.w-m.w),P=Math.min(P,b.h-m.h),y.x=C,y.y=P}s.push({el:f,id:g,pos:y,originalPos:_,originalGroup:f._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:o==null?void 0:o.groupLoc.group})}if(s.push({el:n,id:this.instance.getId(n),pos:i.finalPos,originalGroup:n._jsPlumbParentGroup,redrawResult:null,originalPos:i.originalPos,reverted:!1,dropGroup:o!=null?o.groupLoc.group:null}),this._dragSelection.each(function(f,g,y,m,_){f!==i.el&&a(f,g,{x:y.x,y:y.y},m,_)}),(e=this._currentDragGroup)===null||e===void 0||e.members.forEach(function(f){if(f.el!==i.el){var g=t._currentDragGroupOffsets.get(f.elId),y=t._currentDragGroupSizes.get(f.elId),m={x:i.finalPos.x+g[0].x,y:i.finalPos.y+g[0].y};a(f.el,f.elId,m,y,t._currentDragGroupOriginalPositions.get(f.elId))}}),j(s,function(f){var g=f.originalGroup!=null,y=g&&wo(t.instance,f.el,f.pos),m={x:0,y:0};if(g&&!y){if(o==null){var _=t._pruneOrOrphan(f,!0,!0);_.pos!=null?f.pos=_.pos.pos:!_.pruned&&f.originalGroup.revert&&(f.pos=f.originalPos,f.reverted=!0)}}else g&&y&&(m=t._computeOffsetByParentGroup(f.originalGroup));o==null||y?f.dropGroup=null:t.instance.groupManager.addToGroup(o.groupLoc.group,!1,f.el),f.reverted&&t.instance.setPosition(f.el,f.pos),f.redrawResult=t.instance.setElementPosition(f.el,f.pos.x+m.x,f.pos.y+m.y),t.instance.removeClass(f.el,"jtk-dragged"),t.instance.select({source:f.el}).removeClass(t.instance.elementDraggingClass+" "+t.instance.sourceElementDraggingClass,!0),t.instance.select({target:f.el}).removeClass(t.instance.elementDraggingClass+" "+t.instance.targetElementDraggingClass,!0)}),s[0].originalGroup!=null){var l=n._jsPlumbParentGroup;if(l!==s[0].originalGroup){var c=i.drag.getDragElement(!0);if(s[0].originalGroup.ghost){var h=this.instance.getPosition(this.instance.getGroupContentArea(l)),p=this.instance.getPosition(this.instance.getGroupContentArea(s[0].originalGroup)),v={x:p.x+i.pos.x-h.x,y:p.y+i.pos.y-h.y};c.style.left=v.x+"px",c.style.top=v.y+"px",this.instance.revalidate(c)}}}this.instance.fire("drag:stop",{elements:s,e:i.e,el:n,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var i=this;j(this._groupLocations,function(e){i.instance.removeClass(e.el,Se),i.instance.removeClass(e.el,we)}),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(i){this.drag=i}},{key:"onDrag",value:function(i){var e=this,t=i.drag.getDragElement(),n=this.instance.getId(t),o=i.pos,s=this.instance.viewport.getPosition(n),a={x:o.x,y:o.y};this._intersectingGroups.length=0,this._dragOffset!=null&&(a.x+=this._dragOffset.x,a.y+=this._dragOffset.y);var l=function(h,p,v){if(v){var f=new Set;j(e._groupLocations,function(g){!f.has(g.group.id)&&So(p,g.r)?(g.group!==e._currentDragParentGroup&&e.instance.addClass(g.el,we),e._intersectingGroups.push({groupLoc:g,intersectingElement:i.drag.getDragElement(!0),d:0}),j(e.instance.groupManager.getAncestors(g.group),function(y){return f.add(y.id)})):e.instance.removeClass(g.el,we)})}e.instance.setElementPosition(h,p.x,p.y),e.instance.fire("drag:move",{el:h,e:i.e,pos:{x:p.x,y:p.y},originalPosition:e.originalPosition,payload:e._dragPayload})},c={x:a.x,y:a.y,w:s.w,h:s.h};l(t,c,!0),this._dragSelection.updatePositions(o,this.originalPosition,function(h,p,v,f){l(h,f,!1)}),this._currentDragGroupOffsets.forEach(function(h,p){var v=e._currentDragGroupSizes.get(p),f={x:c.x+h[0].x,y:c.y+h[0].y,w:v.w,h:v.h};h[1].style.left=f.x+"px",h[1].style.top=f.y+"px",l(h[1],f,!1)})}},{key:"_computeOffsetByParentGroup",value:function(i){var e=this.instance.getPosition(i.el),t=i.contentArea;if(t!==i.el){var n=this.instance.getPosition(t);e.x+=n.x,e.y+=n.y}if(i.el._jsPlumbParentGroup){var o=this._computeOffsetByParentGroup(i.el._jsPlumbParentGroup);e.x+=o.x,e.y+=o.y}return e}},{key:"onStart",value:function(i){var e=this,t=i.drag.getDragElement(),n=this.instance.getPosition(t);this.originalPosition={x:i.pos.x,y:i.pos.y},t._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(t._jsPlumbParentGroup),this._currentDragParentGroup=t._jsPlumbParentGroup);var o=!0,s=t.getAttribute(en);if((this.instance.elementsDraggable===!1||s!=null&&s!==ot)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var a=i.drag.getDragElement(!0),l=a.querySelectorAll(Y),c=function(g){for(var y=[],m=g._jsPlumbParentGroup;m!=null;)y.push(m.el),m=m.group;return y}(a),h=[];Array.prototype.push.apply(h,l),Array.prototype.push.apply(h,c),this._dragSelection.filterActiveSet(function(g){return h.indexOf(g.jel)===-1}),this._dragSelection.initialisePositions();var p=function(g,y,m){if(!g._isJsPlumbGroup||e.instance.allowNestedGroups){var _=!g._jsPlumbParentGroup,C=_||g._jsPlumbParentGroup.dropOverride!==!0,P=!_&&(g._jsPlumbParentGroup.ghost||g._jsPlumbParentGroup.constrain!==!0);(_||C&&P)&&(j(e.instance.groupManager.getGroups(),function(b){var x=g._jsPlumbGroup;if(b.droppable!==!1&&b.enabled!==!1&&g._jsPlumbGroup!==b&&!e.instance.groupManager.isDescendant(b,x)){var E=b.el,S=e.instance.getId(E),w=e.instance.viewport.getPosition(S),k={el:E,r:{x:w.x,y:w.y,w:w.w,h:w.h},group:b};e._groupLocations.push(k),b!==e._currentDragParentGroup&&e.instance.addClass(E,Se)}}),e._groupLocations.sort(function(b,x){return e.instance.groupManager.isDescendant(b.group,x.group)?-1:e.instance.groupManager.isAncestor(x.group,b.group)?1:0}))}return e.instance.select({source:g}).addClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:g}).addClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0),e.instance.fire("drag:start",{el:g,e:i.e,originalPosition:e.originalPosition,pos:e.originalPosition,dragGroup:y,dragGroupMemberSpec:m})},v=this.instance.getId(t);this._currentDragGroup=this._dragGroupByElementIdMap[v],this._currentDragGroup&&!function(g,y){var m=Hi(g.members,function(_){return _.el===y});return m!==null&&m.active===!0}(this._currentDragGroup,t)&&(this._currentDragGroup=null);var f=p(t);if(f===!1)return this._cleanup(),!1;this._dragPayload=f,this._currentDragGroup!=null&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach(function(g){var y=e.instance.viewport.getPosition(g.elId);e._currentDragGroupOffsets.set(g.elId,[{x:y.x-n.x,y:y.y-n.y},g.el]),e._currentDragGroupSizes.set(g.elId,y),e._currentDragGroupOriginalPositions.set(g.elId,{x:y.x,y:y.y}),p(g.el,e._currentDragGroup,g)}))}return o}},{key:"addToDragGroup",value:function(i){var e=this,t=function(l,c){return z(c)?{id:c,active:!0}:{id:c.id,active:c.active}}(this.instance,i),n=this._dragGroupMap[t.id];n==null&&(n={id:t.id,members:new Set},this._dragGroupMap[t.id]=n);for(var o=arguments.length,s=new Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];this.removeFromDragGroup.apply(this,s),j(s,function(l){var c=e.instance.getId(l);n.members.add({elId:c,el:l,active:t.active}),e._dragGroupByElementIdMap[c]=n})}},{key:"removeFromDragGroup",value:function(){for(var i=this,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];j(t,function(o){var s=i.instance.getId(o),a=i._dragGroupByElementIdMap[s];if(a!=null){var l=new Set;a.members.forEach(function(c){c.el!==o&&l.add(c)}),a.members=l,delete i._dragGroupByElementIdMap[s]}})}},{key:"setDragGroupState",value:function(i){for(var e=this,t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];j(n.map(function(s){return e.instance.getId(s)}),function(s){var a=e._dragGroupByElementIdMap[s];if(a!=null){var l=Hi(a.members,function(c){return c.elId===s});l!=null&&(l.active=i)}})}},{key:"clearDragGroup",value:function(i){var e=this,t=this._dragGroupMap[i];t!=null&&(t.members.forEach(function(n){delete e._dragGroupByElementIdMap[n.elId]}),t.members.clear())}},{key:"_pruneOrOrphan",value:function(i,e,t){var n=i.el,o={pruned:!1,pos:null};if(t||!wo(this.instance,n,i.pos)){var s=n._jsPlumbParentGroup;s.prune?(n._isJsPlumbGroup?this.instance.removeGroup(n._jsPlumbGroup):s.remove(i.el,!0),o.pruned=!0):s.orphan&&(o.pos=this.instance.groupManager.orphan(i.el,e),n._isJsPlumbGroup?s.removeGroup(n._jsPlumbGroup):s.remove(i.el))}return o}}]),r}(),Io={},Oo={},Go={},Me={get:function(r,i,e){var t=Io[i];if(t)return new t(r,e);throw{message:"jsPlumb: unknown endpoint type '"+i+"'"}},clone:function(r){var i=Go[r.type];return Me.get(r.endpoint,r.type,i.getParams(r))},compute:function(r,i,e,t){var n=Oo[r.type];if(n!=null)return n(r,i,e,t);q("jsPlumb: cannot find endpoint calculator for endpoint of type ",r.type)},registerHandler:function(r){Go[r.type]=r,Io[r.type]=r.cls,Oo[r.type]=r.compute}},ut=function(){function r(i,e){M(this,r),this.endpoint=i,u(this,"typeId",void 0),u(this,"x",void 0),u(this,"y",void 0),u(this,"w",void 0),u(this,"h",void 0),u(this,"computedValue",void 0),u(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),u(this,"classes",[]),u(this,"instance",void 0),u(this,"type",void 0),e=e||{},this.instance=i.instance,i.cssClass&&this.classes.push(i.cssClass),e.cssClass&&this.classes.push(e.cssClass)}return D(r,[{key:"addClass",value:function(i){this.classes.push(i),this.instance.addEndpointClass(this.endpoint,i)}},{key:"removeClass",value:function(i){this.classes=this.classes.filter(function(e){return e!==i}),this.instance.removeEndpointClass(this.endpoint,i)}},{key:"compute",value:function(i,e,t){this.computedValue=Me.compute(this,i,e,t),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(i){this.instance.setEndpointVisible(this.endpoint,i)}}]),r}();(function(r){r.top="top",r.left="left",r.right="right",r.bottom="bottom"})(lt||(lt={}));var U=lt.top,Q=lt.left,$=lt.right,te=lt.bottom,Is=[Q,$],Os=[U,te],Gs=function(){function r(i,e,t){M(this,r),this.instance=i,this.element=e,u(this,"isFloating",!0),u(this,"isContinuous",void 0),u(this,"isDynamic",void 0),u(this,"locations",[]),u(this,"currentLocation",0),u(this,"locked",!1),u(this,"cssClass",""),u(this,"timestamp",null),u(this,"type","Floating"),u(this,"id",W()),u(this,"orientation",[0,0]),u(this,"size",void 0),this.size=i.viewport.getPosition(t),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return D(r,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(i){this.orientation=this.instance.router.getEndpointOrientation(i),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),r}(),Lo=(u(Dt={},U,te),u(Dt,$,Q),u(Dt,Q,$),u(Dt,te,U),Dt),Fo=(u(Tt={},U,$),u(Tt,$,te),u(Tt,Q,U),u(Tt,te,Q),Tt),Ho=(u(It={},U,Q),u(It,$,U),u(It,Q,te),u(It,te,$),It);function Ls(r){return r.faces.length===0?U:r.faces[0]}function Ot(r,i){return r.faces.indexOf(i)!==-1}function No(r,i){return r.lockedAxis==null?r.lockedFace==null?Ot(r,i)===!0:r.lockedFace===i:r.lockedAxis.indexOf(i)!==-1}function Fs(r,i){if(Ot(r,i))return i;if(Ot(r,Lo[i]))return Lo[i];var e=function(n,o){return(n.clockwise?Fo:Ho)[o]}(r,i);if(Ot(r,e))return e;var t=function(n,o){return(n.clockwise?Ho:Fo)[o]}(r,i);return Ot(r,t)?t:i}var Ro={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},Bo={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Xo={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},Yo={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},zo={Top:[Ro],Bottom:[Bo],Left:[Xo],Right:[Yo],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[Ro,Xo,Bo,Yo]},Hs={Continuous:{faces:[U,Q,te,$]},ContinuousTop:{faces:[U]},ContinuousRight:{faces:[$]},ContinuousBottom:{faces:[te]},ContinuousLeft:{faces:[Q]},ContinuousLeftRight:{faces:[Q,$]},ContinuousTopBottom:{faces:[U,te]}};function Vo(r,i){if(i=i||{},r===he.Perimeter)return function(t){t=t||{};var n=t.anchorCount||60,o=t.shape;if(!o)throw new Error("no shape supplied to Perimeter Anchor type");if(!Ae.has(o))throw new Error("Shape ["+o+"] is unknown by Perimeter Anchor type");var s=Ae.get(o)(n);t.rotation&&(s=function(c,h){for(var p=[],v=h/180*Math.PI,f=0;f<c.length;f++){var g=c[f].x-.5,y=c[f].y-.5;p.push({x:g*Math.cos(v)-y*Math.sin(v)+.5,y:g*Math.sin(v)+y*Math.cos(v)+.5,ox:c[f].ox,oy:c[f].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return p}(s,t.rotation));var a=gn(he.Perimeter,s,t),l=A(a,{shape:o});return l}(i);var e=zo[r];if(e!=null)return gn(r,Bi(e,function(t){return A({iox:t.ox,ioy:t.oy},t)}),i);if((e=Hs[r])!=null)return function(t,n,o){var s={type:t,locations:[],currentLocation:0,locked:!1,id:W(),cssClass:o.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:o.faces||n,lockedFace:null,lockedAxis:null,clockwise:o.clockwise!==!1,__currentFace:null};return Object.defineProperty(s,Ns,{get:function(){return this.__currentFace},set:function(a){this.__currentFace=Fs(this,a)}}),s}(r,e.faces,i);throw{message:"jsPlumb: unknown anchor type '"+r+"'"}}function gn(r,i,e){return{type:r,locations:i,currentLocation:0,locked:!1,id:W(),isFloating:!1,isContinuous:!1,isDynamic:i.length>1,timestamp:null,cssClass:e.cssClass||""}}var Ns="currentFace";function Uo(r){return r.length<7&&r.every(On)||r.length===7&&r.slice(0,5).every(On)&&z(r[6])}function Gt(r){if(z(r))return Vo(r,null);if(Array.isArray(r)){if(Uo(r)){var i=r;return gn(null,[{x:i[0],y:i[1],ox:i[2],oy:i[3],offx:i[4]==null?0:i[4],offy:i[5]==null?0:i[5],iox:i[2],ioy:i[3],cls:i[6]||""}],{cssClass:i[6]||""})}return gn("Dynamic",Bi(r,function(t){if(z(t)){var n=zo[t];return n!=null?A({iox:n[0].ox,ioy:n[0].oy,cls:""},n[0]):null}if(Uo(t))return{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:t[4]==null?0:t[4],offy:t[5]==null?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}}).filter(function(t){return t!=null}),{})}var e=r;return Vo(e.type,e.options)}function Wo(r){for(var i=.5,e=2*Math.PI/r,t=[],n=0,o=0;o<r;o++){var s=i+i*Math.sin(n),a=i+i*Math.cos(n);t.push({x:s,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),n+=e}return t}function hi(r,i){for(var e=[],t=0;t<r.length;t++)e.push([r[t][0],r[t][1],r[t][2],r[t][3],1/r.length,r[t][4],r[t][5]]);return function(n,o){for(var s=o/n.length,a=[],l=function(h,p,v,f,g,y,m){for(var _=(v-h)/(s=o*g),C=(f-p)/s,P=0;P<s;P++)a.push({x:h+_*P,y:p+C*P,ox:y??0,oy:m??0,offx:0,offy:0,iox:0,ioy:0,cls:""})},c=0;c<n.length;c++)l.apply(null,n[c]);return a}(e,i)}function qo(r){return hi([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],r)}var Ae=new Map;Ae.set(Pe.Circle,Wo),Ae.set(Pe.Ellipse,Wo),Ae.set(Pe.Rectangle,qo),Ae.set(Pe.Square,qo),Ae.set(Pe.Diamond,function(r){return hi([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],r)}),Ae.set(Pe.Triangle,function(r){return hi([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],r)});var Zo=function(){function r(i,e){var t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];M(this,r),this.selector=i,this.def=e,this.exclude=t,u(this,"id",void 0),u(this,"redrop",void 0),this.id=W(),this.redrop=e.def.redrop||Jo}return D(r,[{key:"setEnabled",value:function(i){this.def.enabled=i}},{key:"isEnabled",value:function(){return this.def.enabled!==!1}}]),r}(),Jo="strict";function Rs(r,i,e,t,n,o){var s=function(c,h,p){return new Gs(c,h,p)}(o,t,n),a={paintStyle:r.getPaintStyle(),preparedAnchor:s,element:t,scope:r.scope,cssClass:[Yn,r.cssClass].join(" ")};i!=null&&(Yi(i,ut)?a.existingEndpoint=i:a.endpoint=i);var l=o._internal_newEndpoint(a);return o._paintEndpoint(l,{}),l}function Bs(r,i,e,t,n){for(var o=r.target||r.srcElement,s=!1,a=t.getSelector(i,e),l=0;l<a.length;l++)if(a[l]===o){s=!0;break}return n?!s:s}var Xs=Be(Se,we),Ko="sourceSelectorEndpoint",$o=function(){function r(i){M(this,r),this.instance=i,u(this,"jpc",void 0),u(this,"existingJpc",void 0),u(this,"_originalAnchorSpec",void 0),u(this,"ep",void 0),u(this,"endpointRepresentation",void 0),u(this,"canvasElement",void 0),u(this,"_activeDefinition",void 0),u(this,"placeholderInfo",{id:null,element:null}),u(this,"floatingIndex",void 0),u(this,"floatingId",void 0),u(this,"floatingElement",void 0),u(this,"floatingEndpoint",void 0),u(this,"floatingAnchor",void 0),u(this,"_stopped",void 0),u(this,"inPlaceCopy",void 0),u(this,"endpointDropTargets",[]),u(this,"currentDropTarget",null),u(this,"payload",void 0),u(this,"floatingConnections",{}),u(this,"_forceReattach",void 0),u(this,"_forceDetach",void 0),u(this,"mousedownHandler",void 0),u(this,"mouseupHandler",void 0),u(this,"selector",Be(nt));var e=i.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),i.on(e,O,Y,this.mousedownHandler),i.on(e,G,[Y,Be(nt)].join(","),this.mouseupHandler)}return D(r,[{key:"_resolveDragParent",value:function(i,e){var t=this.instance.getContainer(),n=ye(e,Y,t,!0);if(i.parentSelector!=null){var o=ye(e,i.parentSelector,t,!0);return o!=null&&(n=ye(o.parentNode,Y,t,!1)),o||n}return n}},{key:"_mousedownHandler",value:function(i){var e,t;if(i.which!==3&&i.button!==2){var n=i.target||i.srcElement;if(((t=this._getSourceDefinition(i))==null||(e=this._resolveDragParent(t.def.def,n))!=null&&e.getAttribute(rn)!==ot)&&t){var o,s=i.currentTarget;if(n.getAttribute(rn)!==ot){if(kt(i),this._activeDefinition=t,(o=t.def.def).canAcceptNewConnection!=null&&!o.canAcceptNewConnection(e,i))return!1;var a=_r(i,e,this.instance.currentZoom),l={element:e};if(A(l,o),l.isTemporarySource=!0,o.scope)l.scope=o.scope;else{var c=n.getAttribute(qn);c!=null&&(l.scope=c)}if((l=Wt(l,o.parameterExtractor?o.parameterExtractor(e,n,i):{})).maxConnections!=null&&l.maxConnections>=0&&this.instance.select({source:e}).length>=l.maxConnections)return kt(i),o.onMaxConnections&&o.onMaxConnections({element:e,maxConnections:l.maxConnections},i),i.stopImmediatePropagation&&i.stopImmediatePropagation(),!1;if(o.anchorPositionFinder){var h=o.anchorPositionFinder(e,a,o,i);h!=null&&(l.anchor=h)}this._originalAnchorSpec=l.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var p=this.instance.router.prepareAnchor(this._originalAnchorSpec),v=[a.x,a.y,0,0];if(p.locations.length>0)v[2]=p.locations[0].ox,v[3]=p.locations[0].oy;else if(p.isContinuous){var f=a.x<.5?a.x:1-a.x,g=a.y<.5?a.y:1-a.y;v[2]=f<g?a.x<.5?-1:1:0,v[3]=g<f?a.y<.5?-1:1:0}l.anchor=v,l.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(l);var y={};if(o.extract){for(var m in o.extract){var _=n.getAttribute(m);_&&(y[o.extract[m]]=_)}this.ep.mergeParameters(y)}if(l.uniqueEndpoint){var C=this.ep.elementId,P=this.instance.getManagedData(C,Ko,t.id);P==null?(this.instance.setManagedData(C,Ko,t.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=P}s._jsPlumbOrphanedEndpoints=s._jsPlumbOrphanedEndpoints||[],s._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,O,i,y)}}}}},{key:"_mouseupHandler",value:function(i){var e=i.currentTarget||i.srcElement;e._jsPlumbOrphanedEndpoints&&(function(t,n){t=t.length==null||typeof t=="string"?[t]:t;for(var o=0;o<t.length;o++)n(t[o])}(e._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),e._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(i){var e=$t(i,this.instance),t=Ct(i,this.instance);return this._makeDraggablePlaceholder(e,t),this.placeholderInfo.element.jtk=i.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(i){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(i,e){this.placeholderInfo=this.placeholderInfo||{};var t=Vi("div",{position:"absolute"});this.instance._appendElementToContainer(t);var n=this.instance.getId(t);return this.instance.setPosition(t,i),t.style.width=e.w+"px",t.style.height=e.h+"px",this.instance.manage(t),this.placeholderInfo.id=n,this.placeholderInfo.element=t,t}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var i=this.instance.getContainer();this.instance.off(i,G,this.mouseupHandler),this.instance.off(i,O,this.mousedownHandler)}},{key:"init",value:function(i){}},{key:"startNewConnectionDrag",value:function(i,e){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:i,data:e}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(fo,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var i=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(fo,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[i].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,i),this.jpc.suspendedEndpoint=this.jpc.endpoints[i],this.jpc.suspendedElement=this.jpc.endpoints[i].element,this.jpc.suspendedElementId=this.jpc.endpoints[i].elementId,this.jpc.suspendedElementType=i===0?Rn:Wi,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[i]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=i,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var i=!0;this.ep.enabled||(i=!1),this.jpc!=null||this.ep.isSource||this.ep.isTemporarySource||(i=!1),!this.ep.isSource||!this.ep.isFull()||this.jpc!=null&&this.ep.dragAllowedWhenFull||(i=!1),this.jpc==null||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?i=!1:this.jpc=null);var e={},t=this.instance.checkCondition(this.jpc==null?"beforeDrag":"beforeStartDetach",{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return t===!1?i=!1:mt(t)==="object"?A(e=t,this.payload||{}):e=this.payload||{},[i,e]}},{key:"_createFloatingEndpoint",value:function(i){var e=this.ep.endpoint;this.ep.edgeType!=null&&(e=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]),this.floatingEndpoint=Rs(this.ep,e,0,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(i,e){var t,n,o,s=this,a=this.jpc&&this.jpc.endpoints[0]===this.ep;if(j(this.instance.getContainer().querySelectorAll([".",nt,"[",Ki,this.ep.scope,"]:not(.",Yn,")"].join("")),function(h){if(!(s.jpc==null&&h===i||h===s.floatingElement||s.jpc==null&&h.jtk.endpoint.isFull())&&(a&&h.jtk.endpoint.isSource||!a&&h.jtk.endpoint.isTarget)){var p=$t(h,s.instance),v=Ct(h,s.instance);t={x:p.x,y:p.y,w:v.w,h:v.h},s.endpointDropTargets.push({el:h,targetEl:h,r:t,endpoint:h.jtk.endpoint,def:null}),s.instance.addClass(h,Se)}}),a){var l=Gn(this.instance.sourceSelectors,function(h){return h.isEnabled()&&(h.def.def.scope==null||h.def.def.scope===s.ep.scope)});l!=null&&j(this._findTargetZones(l),function(h){if(h.getAttribute(rn)!==ot){var p=h.getAttribute(qn);if(p!=null&&p!==s.ep.scope)return;var v={r:null,el:h};v.targetEl=ye(h,Y,s.instance.getContainer(),!0);var f=$t(v.el,s.instance),g=Ct(v.el,s.instance);v.r={x:f.x,y:f.y,w:g.w,h:g.h},l.def.def.rank!=null&&(v.rank=l.def.def.rank),v.def=l.def,s.endpointDropTargets.push(v),s.instance.addClass(v.targetEl,Se)}})}else{var c=(n=this.instance.targetSelectors,o=function(h,p){var v=[];if(h)for(var f=0;f<h.length;f++)p(h[f])&&v.push(f);return v}(n,function(h){return h.isEnabled()}),o.map(function(h){return n[h]}));c.forEach(function(h){j(s._findTargetZones(h),function(p){if(p.getAttribute(rn)!==ot){var v=p.getAttribute(qn);if(v!=null&&v!==s.ep.scope)return;var f={r:null,el:p};if(h.def.def.parentSelector!=null&&(f.targetEl=ye(p,h.def.def.parentSelector,s.instance.getContainer(),!0)),f.targetEl==null&&(f.targetEl=ye(p,Y,s.instance.getContainer(),!0)),(h.def.def.allowLoopback===!1||s._activeDefinition&&s._activeDefinition.def.def.allowLoopback===!1)&&f.targetEl===s.ep.element||h.def.def.canAcceptNewConnection!=null&&!h.def.def.canAcceptNewConnection(f.targetEl,e))return;var g=h.def.def.maxConnections;if(g!=null&&g!==-1&&s.instance.select({target:f.targetEl}).length>=g)return;var y=$t(p,s.instance),m=Ct(p,s.instance);f.r={x:y.x,y:y.y,w:m.w,h:m.h},f.def=h.def,h.def.def.rank!=null&&(f.rank=h.def.def.rank),s.endpointDropTargets.push(f),s.instance.addClass(f.targetEl,Se)}})})}this.endpointDropTargets.sort(function(h,p){if(h.targetEl._isJsPlumbGroup&&!p.targetEl._isJsPlumbGroup)return 1;if(!h.targetEl._isJsPlumbGroup&&p.targetEl._isJsPlumbGroup)return-1;if(h.targetEl._isJsPlumbGroup&&p.targetEl._isJsPlumbGroup){if(s.instance.groupManager.isAncestor(h.targetEl._jsPlumbGroup,p.targetEl._jsPlumbGroup))return-1;if(s.instance.groupManager.isAncestor(p.targetEl._jsPlumbGroup,h.targetEl._jsPlumbGroup))return 1}else{if(h.rank==null||p.rank==null)return 0;if(h.rank>p.rank)return-1;if(h.rank<p.rank)return 1}})}},{key:"_findTargetZones",value:function(i){var e;if(i.redrop==="any"){var t=this.instance.targetSelectors.map(function(o){return o.selector});t.push.apply(t,$e(this.instance.sourceSelectors.map(function(o){return o.selector}))),t.push(Y),e=t.join(",")}else if(i.redrop===Jo)e=i.selector;else if(i.redrop==="anySource")e=this.instance.sourceSelectors.map(function(o){return o.selector}).join(",");else if(i.redrop==="anyTarget")e=this.instance.targetSelectors.map(function(o){return o.selector}).join(",");else if(i.redrop==="anySourceOrTarget"){var n=this.instance.targetSelectors.map(function(o){return o.selector});n.push.apply(n,$e(this.instance.sourceSelectors.map(function(o){return o.selector}))),e=n.join(",")}return this.instance.getContainer().querySelectorAll(e)}},{key:"onStart",value:function(i){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var e=i.drag.getDragElement();if(this.ep=e.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var t=Vt(this._shouldStartDrag(),2),n=t[0],o=t[1];if(n===!1)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,i.e),this.jpc==null?this.startNewConnectionDrag(this.ep.scope,o):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(i){this.payload=i.e.payload||{}}},{key:"onDrag",value:function(i){if(this._stopped)return!0;if(this.placeholderInfo.element){var e=Ct(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,i.pos.x,i.pos.y);for(var t,n,o={x:i.pos.x,y:i.pos.y,w:e.w,h:e.h},s=0;s<this.endpointDropTargets.length;s++)if(So(o,this.endpointDropTargets[s].r)){t=this.endpointDropTargets[s];break}t!==this.currentDropTarget&&this.currentDropTarget!=null&&(n=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,we),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),t!=null&&(this.instance.addClass(t.el,we),n=this._getFloatingAnchorIndex(),t.endpoint!=null&&(t.endpoint.isSource&&n===0||t.endpoint.isTarget&&n!==0||this.jpc.suspendedEndpoint&&t.endpoint.referenceEndpoint&&t.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id?(this.instance.checkCondition("checkDropAllowed",{sourceEndpoint:this.jpc.endpoints[n],targetEndpoint:t.endpoint.endpoint,connection:this.jpc})?(t.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(t.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(t.endpoint),this.instance._paintConnection(this.jpc)):t=null)),this.currentDropTarget=t}}},{key:"_maybeCleanup",value:function(i){i._mtNew&&i.connections.length===0?this.instance.deleteEndpoint(i):delete i._mtNew}},{key:"_reattachOrDiscard",value:function(i){var e=this.jpc.suspendedEndpoint!=null,t=this._getFloatingAnchorIndex();return e&&this._shouldReattach()?(t===0?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(t),!0):(this._discard(t,i),!1)}},{key:"onStop",value:function(i){var e=this,t=i.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var n=function(){for(var h=arguments.length,p=new Array(h),v=0;v<h;v++)p[v]=arguments[v];return p.join(" ")}(we,Se);if(j(this.instance.getContainer().querySelectorAll(Xs),function(h){e.instance.removeClass(h,n)}),this.jpc&&this.jpc.endpoints!=null){var o,s=this.jpc.suspendedEndpoint!=null,a=this._getFloatingAnchorIndex(),l=this.jpc.suspendedEndpoint;if(this.currentDropTarget!=null)if((o=this._getDropEndpoint(i,this.jpc))==null)this._reattachOrDiscard(i.e);else if(l&&l.id===o.id)this._doForceReattach(a);else if(o.enabled)if(o.isFull())o.fire(oo,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},t),this._reattachOrDiscard(i.e);else{a===0?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var c=!0;s&&this.jpc.suspendedEndpoint.id!==o.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[a].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(c=!1)),(c=c&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,a,t,c):this._reattachOrDiscard(i.e)}else this._reattachOrDiscard(i.e);else this._reattachOrDiscard(i.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,o!=null&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(i){for(var e,t=this.instance.getContainer(),n=0;n<this.instance.sourceSelectors.length;n++)if((e=this.instance.sourceSelectors[n]).isEnabled()&&Bs(i,t,e.selector,this.instance,e.exclude)!==!1)return e}},{key:"_getDropEndpoint",value:function(i,e){var t;if(this.currentDropTarget.endpoint==null){var n=this.currentDropTarget.def,o=i.e.target||i.e.srcElement;if(n==null)return null;var s=this.currentDropTarget.targetEl,a=_r(i.e,s,this.instance.currentZoom),l=this.instance._deriveEndpointAndAnchorSpec(e.getType().join(" "),!0),c=l.endpoints?A(i,{endpoint:n.def.endpoint||l.endpoints[1],cssClass:n.def.cssClass||"",source:n.def.source===!0,target:n.def.target===!0}):i,h=this.instance.validAnchorsSpec(l.anchors)?l.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,p=n.def.anchor,v=n.def.anchorPositionFinder?n.def.anchorPositionFinder(s,a,n.def,i.e):null,f=v??p??(h!=null&&h[1]!=null?h[1]:null);if(f!=null&&(c=A(c,{anchor:f})),n.def.portId!=null&&(c.portId=n.def.portId),(c=Wt(c,n.def.parameterExtractor?n.def.parameterExtractor(this.currentDropTarget.el,o,i.e):{})).element=s,(t=this.instance._internal_newEndpoint(c))._mtNew=!0,t.deleteOnEmpty=!0,n.def.parameters&&t.mergeParameters(n.def.parameters),n.def.extract){var g={};for(var y in n.def.extract){var m=this.currentDropTarget.el.getAttribute(y);m&&(g[n.def.extract[y]]=m)}t.mergeParameters(g)}}else t=this.currentDropTarget.endpoint;return t&&(t.removeClass(this.instance.endpointDropAllowedClass),t.removeClass(this.instance.endpointDropForbiddenClass)),t}},{key:"_doForceReattach",value:function(i){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[i]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,i),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var i=this.jpc.suspendedEndpoint,e=this.jpc.suspendedElementType==Rn?1:0,t=this.jpc.endpoints[e];return!Fi(!0,!1,[[i,it,[this.jpc]],[t,it,[this.jpc]],[this.jpc,it,[this.jpc]],[this.instance,$i,[lo,this.jpc]]])}},{key:"_discard",value:function(i,e){this.jpc.pending?this.instance.fire("connection:abort",this.jpc,e):(i===0?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[i]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:e,force:!0})}},{key:"_drop",value:function(i,e,t,n){if(this.jpc.endpoints[e].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[e]=i,i.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:e,originalSourceId:e===0?o:this.jpc.sourceId,newSourceId:e===0?i.elementId:this.jpc.sourceId,originalTargetId:e===1?o:this.jpc.targetId,newTargetId:e===1?i.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:i},t)}e===1?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)),Qe(n)&&this.jpc.mergeData(n),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,t),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(i,e){this.floatingConnections[i.id]=e}},{key:"_getFloatingAnchorIndex",value:function(){return this.floatingIndex==null?1:this.floatingIndex}}]),r}(),Qo=function(){F(i,ci);var r=H(i);function i(e,t){var n;return M(this,i),(n=r.call(this,e,t)).instance=e,n.dragSelection=t,u(d(n),"selector",[">",cs,Y].join(" ")),u(d(n),"doRevalidate",void 0),n.doRevalidate=n._revalidate.bind(d(n)),n}return D(i,[{key:"reset",value:function(){this.drag.off(sn,this.doRevalidate)}},{key:"_revalidate",value:function(e){this.instance.revalidate(e)}},{key:"init",value:function(e){this.drag=e,e.on(sn,this.doRevalidate)}},{key:"useGhostProxy",value:function(e,t){var n=t._jsPlumbParentGroup;return n!=null&&n.ghost===!0}},{key:"makeGhostProxy",value:function(e){var t=e,n=t.cloneNode(!0);return n._jsPlumbParentGroup=t._jsPlumbParentGroup,n}}]),i}(),di=function(){function r(i,e){M(this,r),this.instance=i,this.overlay=e,u(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=e}return D(r,null,[{key:"getElement",value:function(i,e,t){if(i.canvas==null){if(t&&e){i.canvas=t(e);var n=i.instance.overlayClass+" "+(i.cssClass?i.cssClass:"");i.instance.addClass(i.canvas,n)}else i.canvas=Vi("div",{},i.instance.overlayClass+" "+(i.cssClass?i.cssClass:""));for(var o in i.instance.setAttribute(i.canvas,"jtk-overlay-id",i.id),i.attributes)i.instance.setAttribute(i.canvas,o,i.attributes[o]);i.canvas.style.position=Et,i.instance._appendElement(i.canvas,i.instance.getContainer()),i.instance.getId(i.canvas);var s="translate(-50%, -50%)";i.canvas.style.webkitTransform=s,i.canvas.style.mozTransform=s,i.canvas.style.msTransform=s,i.canvas.style.oTransform=s,i.canvas.style.transform=s,i.isVisible()||(i.canvas.style.display=tt),i.canvas.jtk={overlay:i}}return i.canvas}},{key:"destroy",value:function(i){i.canvas&&i.canvas.parentNode&&i.canvas.parentNode.removeChild(i.canvas),delete i.canvas,delete i.cachedDimensions}},{key:"_getDimensions",value:function(i,e){return(i.cachedDimensions==null||e)&&(i.cachedDimensions={w:1,h:1}),i.cachedDimensions}}]),r}(),Lt=function(){function r(){M(this,r),u(this,"_listeners",{}),u(this,"eventsSuspended",!1),u(this,"tick",!1),u(this,"eventsToDieOn",{ready:!0}),u(this,"queue",[])}return D(r,[{key:"fire",value:function(i,e,t){var n=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[i]){var o=this._listeners[i].length,s=0,a=!1;if(!this.shouldFireEvent||this.shouldFireEvent(i,e,t))for(;!a&&s<o&&n!==!1;){if(this.eventsToDieOn[i])this._listeners[i][s](e,t);else try{n=this._listeners[i][s](e,t)}catch(l){q("jsPlumb: fire failed for event "+i+" : "+(l.message||l))}s++,this._listeners!=null&&this._listeners[i]!=null||(a=!0)}}this.tick=!1,this._drain()}return n}},{key:"_drain",value:function(){var i=this.queue.pop();i&&this.fire.apply(this,i)}},{key:"unbind",value:function(i,e){if(arguments.length===0)this._listeners={};else if(arguments.length===1){if(typeof i=="string")delete this._listeners[i];else if(i.__jsPlumb){var t;for(var n in i.__jsPlumb)t=i.__jsPlumb[n],Ni(this._listeners[t]||[],i)}}else arguments.length===2&&Ni(this._listeners[i]||[],e);return this}},{key:"getListener",value:function(i){return this._listeners[i]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(i){this.eventsSuspended=i}},{key:"bind",value:function(i,e,t){var n=this,o=function(a){Ri(n._listeners,a,e,t),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[W()]=a};if(typeof i=="string")o(i);else if(i.length!=null)for(var s=0;s<i.length;s++)o(i[s]);return this}},{key:"silently",value:function(i){this.setSuspendEvents(!0);try{i()}catch(e){q("Cannot execute silent function "+e)}this.setSuspendEvents(!1)}}]),r}();function pi(r){var i=null;return(i=z(r)?{type:r,options:{}}:r).options.id=i.options.id||W(),i}(function(){F(i,Lt);var r=H(i);function i(){return M(this,i),r.apply(this,arguments)}D(i,[{key:"shouldFireEvent",value:function(e,t,n){return!0}}])})();var yn=function(){F(i,Lt);var r=H(i);function i(e,t,n){var o;for(var s in M(this,i),(o=r.call(this)).instance=e,o.component=t,u(d(o),"id",void 0),u(d(o),"type",void 0),u(d(o),"cssClass",void 0),u(d(o),"visible",!0),u(d(o),"location",void 0),u(d(o),"events",void 0),u(d(o),"attributes",void 0),n=n||{},o.id=n.id||W(),o.cssClass=n.cssClass||"",o.setLocation(n.location),o.events=n.events||{},o.attributes=n.attributes||{},o.events)o.bind(s,o.events[s]);return o}return D(i,[{key:"setLocation",value:function(e){var t=this.location==null?.5:this.location;if(e!=null)try{var n=typeof e=="string"?parseFloat(e):e;isNaN(n)||(t=n)}catch{}this.location=t}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"setVisible",value:function(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function(){return this.visible}}]),i}(),er={},tr=function(r,i,e,t){var n=er[i];if(n)return new n(r,e,t);throw{message:"jsPlumb: unknown overlay type '"+i+"'"}},Ft=function(r,i){er[r]=i},We=function(){F(i,yn);var r=H(i);function i(e,t,n){var o;return M(this,i),(o=r.call(this,e,t,n)).instance=e,o.component=t,u(d(o),"label",void 0),u(d(o),"labelText",void 0),u(d(o),"type",i.type),u(d(o),"cachedDimensions",void 0),n=n||{label:""},o.setLabel(n.label),o}return D(i,[{key:"getLabel",value:function(){return Fe(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(e){e.label!=null&&this.setLabel(e.label),e.location!=null&&(this.setLocation(e.location),this.instance.updateLabel(this))}}]),i}();function je(r){return r.type===We.type}function mn(r){return r==null?null:r.split(" ").filter(function(i){return i!=null&&i.length>0})}function nr(r,i,e){for(var t in i)r[t]=e}u(We,"type","Label"),Ft(We.type,We);var ir="__default",Ht="__label",or="overlay",rr="remove";function ct(r,i){if(r.getDefaultType){var e=r.getTypeDescriptor(),t={},n=r.getDefaultType(),o=A({},n);nr(t,n,ir),r._types.forEach(function(s){if(s!==ir){var a=r.instance.getType(s,e);if(a!=null){var l=new Set(["connector","anchor","anchors"]);if(a.mergeStrategy==="override")for(var c in a)l.add(c);o=Wt(o,a,["cssClass"],(h=[],l.forEach(function(p){h.push(p)}),h)),nr(t,a,s)}}var h}),i&&(o=Fr(o,i,"_")),r.applyType(o,t)}}function vi(r,i){var e=r.instance.getType(i,r.getTypeDescriptor());e!=null&&e.cssClass&&r.removeClass(e.cssClass)}function sr(r){if(r.paintStyle&&r.hoverPaintStyle){var i={};A(i,r.paintStyle),A(i,r.hoverPaintStyle),r.hoverPaintStyle=i}}var ar=function(){F(i,Lt);var r=H(i);function i(e,t){var n;if(M(this,i),(n=r.call(this)).instance=e,u(d(n),"defaultLabelLocation",.5),u(d(n),"overlays",{}),u(d(n),"overlayPositions",{}),u(d(n),"overlayPlacements",{}),u(d(n),"clone",void 0),u(d(n),"deleted",void 0),u(d(n),"segment",void 0),u(d(n),"x",void 0),u(d(n),"y",void 0),u(d(n),"w",void 0),u(d(n),"h",void 0),u(d(n),"id",void 0),u(d(n),"visible",!0),u(d(n),"typeId",void 0),u(d(n),"params",{}),u(d(n),"paintStyle",void 0),u(d(n),"hoverPaintStyle",void 0),u(d(n),"paintStyleInUse",void 0),u(d(n),"_hover",!1),u(d(n),"lastPaintedAt",void 0),u(d(n),"data",void 0),u(d(n),"_defaultType",void 0),u(d(n),"events",void 0),u(d(n),"parameters",void 0),u(d(n),"_types",void 0),u(d(n),"_typeCache",void 0),u(d(n),"cssClass",void 0),u(d(n),"hoverClass",void 0),u(d(n),"beforeDetach",void 0),u(d(n),"beforeDrop",void 0),t=t||{},n.cssClass=t.cssClass||"",n.hoverClass=t.hoverClass||e.defaults.hoverClass,n.beforeDetach=t.beforeDetach,n.beforeDrop=t.beforeDrop,n._types=new Set,n._typeCache={},n.parameters=Ut(t.parameters||{}),n.id=t.id||n.getIdPrefix()+new Date().getTime(),n._defaultType={parameters:n.parameters,scope:t.scope||n.instance.defaultScope,overlays:{}},t.events)for(var o in t.events)n.bind(o,t.events[o]);n.clone=function(){var v=Object.create(n.constructor.prototype);return n.constructor.apply(v,[e,t]),v},n.overlays={},n.overlayPositions={};var s=t.overlays||[],a={},l=n.getDefaultOverlayKey();if(l){var c=n.instance.defaults[l];c&&s.push.apply(s,$e(c));for(var h=0;h<s.length;h++){var p=pi(s[h]);a[p.options.id]=p}}return n._defaultType.overlays=a,t.label&&(n.getDefaultType().overlays[Ht]={type:We.type,options:{label:t.label,location:t.labelLocation||n.defaultLabelLocation,id:Ht,cssClass:"jtk-default-label"}}),n}return D(i,[{key:"isDetachAllowed",value:function(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(n){q("jsPlumb: beforeDetach callback failed",n)}return t}},{key:"isDropAllowed",value:function(e,t,n,o,s){var a,l={sourceId:e,targetId:t,scope:n,connection:o,dropEndpoint:s};if(this.beforeDrop)try{a=this.beforeDrop(l)}catch(c){q("jsPlumb: beforeDrop callback failed",c)}else a=this.instance.checkCondition(ao,l);return a}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(e,t,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][e]=t}},{key:"getCachedTypeItem",value:function(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function(e,t){this.clearTypes(),(mn(e)||[]).forEach(this._types.add,this._types),ct(this,t)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(e){ct(this,e)}},{key:"hasType",value:function(e){return this._types.has(e)}},{key:"addType",value:function(e,t){var n=mn(e),o=!1;if(n!=null){for(var s=0,a=n.length;s<a;s++)this._types.has(n[s])||(this._types.add(n[s]),o=!0);o&&ct(this,t)}}},{key:"removeType",value:function(e,t){var n,o=this,s=mn(e),a=!1;if(s!=null){for(var l=0,c=s.length;l<c;l++)n=s[l],a=!!o._types.has(n)&&(vi(o,n),o._types.delete(n),!0)||a;a&&ct(this,t)}}},{key:"clearTypes",value:function(e){var t=this;this._types.forEach(function(n){vi(t,n)}),this._types.clear(),ct(this,e)}},{key:"toggleType",value:function(e,t){var n=mn(e);if(n!=null){for(var o=0,s=n.length;o<s;o++)this._types.has(n[o])?(vi(this,n[o]),this._types.delete(n[o])):this._types.add(n[o]);ct(this,t)}}},{key:"applyType",value:function(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var n,o={};for(n in e.overlays){var s=this.overlays[e.overlays[n].options.id];if(s)s.updateFrom(e.overlays[n].options),o[e.overlays[n].options.id]=!0,this.instance.reattachOverlay(s,this);else{var a=this.getCachedTypeItem(or,e.overlays[n].options.id);a!=null?(this.instance.reattachOverlay(a,this),a.setVisible(!0),a.updateFrom(e.overlays[n].options),this.overlays[a.id]=a):a=this.addOverlay(e.overlays[n]),o[a.id]=!0}}for(n in this.overlays)o[this.overlays[n].id]==null&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,sr(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(e){this.hoverPaintStyle=e,sr(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(e){e!=null&&A(this.parameters,e)}},{key:"setVisible",value:function(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function(e,t){for(var n in this.overlays)e==="add"?this.instance.addOverlayClass(this.overlays[n],t):e===rr&&this.instance.removeOverlayClass(this.overlays[n],t)}},{key:"addClass",value:function(e,t){var n=(this.cssClass||"").split(" ");n.push(e),this.cssClass=n.join(" "),this._clazzManip("add",e)}},{key:"removeClass",value:function(e,t){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter(function(o){return o!==e}).join(" "),this._clazzManip(rr,e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(e){this.data=e||{}}},{key:"mergeData",value:function(e){this.data=A(this.data,e)}},{key:"addOverlay",value:function(e){var t=function(a,l){var c=null;if(z(l))c=tr(a.instance,l,a,{});else if(l.type!=null&&l.options!=null){var h=l,p=A({},h.options);c=tr(a.instance,h.type,a,p)}else c=l;return c.id=c.id||W(),a.cacheTypeItem(or,c,c.id),a.overlays[c.id]=c,c}(this,e);if(this.getData&&t.type===We.type&&!z(e)){var n=this.getData(),o=e.options;if(n){var s=n[o.labelLocationAttribute||"labelLocation"];s&&(t.location=s)}}return t}},{key:"getOverlay",value:function(e){return this.overlays[e]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var o in t=t||[],this.overlays)t.length!==0&&t.indexOf(o)===-1||this.overlays[o].setVisible(!1)}},{key:"showOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var o in t=t||[],this.overlays)t.length!==0&&t.indexOf(o)===-1||this.overlays[o].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(e,t){var n=this.overlays[e];n&&(n.setVisible(!1),t||this.instance.destroyOverlay(n),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var o=0,s=t.length;o<s;o++)this.removeOverlay(arguments[o])}},{key:"getLabel",value:function(){var e=this.getLabelOverlay();return e!=null?e.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(Ht)}},{key:"setLabel",value:function(e){var t,n,o,s=this.getLabelOverlay();if(s)if(z(e)||Fe(e))s.setLabel(e);else{var a=e;a.label&&s.setLabel(a.label),a.location&&(s.location=a.location)}else{var l=z(e)||Fe(e)?{label:e}:e;t=this,o=A({cssClass:(n=l).cssClass,id:Ht,component:t},n),s=new We(t.instance,t,o),this.overlays[Ht]=s}}}]),i}(),Ys=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],ht=function(){F(i,ar);var r=H(i);function i(e,t){var n;M(this,i),(n=r.call(this,e,t)).instance=e,u(d(n),"connections",[]),u(d(n),"endpoint",void 0),u(d(n),"element",void 0),u(d(n),"elementId",void 0),u(d(n),"dragAllowedWhenFull",!0),u(d(n),"timestamp",void 0),u(d(n),"portId",void 0),u(d(n),"maxConnections",void 0),u(d(n),"proxiedBy",void 0),u(d(n),"connectorClass",void 0),u(d(n),"connectorHoverClass",void 0),u(d(n),"finalEndpoint",void 0),u(d(n),"enabled",!0),u(d(n),"isSource",void 0),u(d(n),"isTarget",void 0),u(d(n),"isTemporarySource",void 0),u(d(n),"connectionCost",1),u(d(n),"connectionsDirected",void 0),u(d(n),"connectionsDetachable",void 0),u(d(n),"reattachConnections",void 0),u(d(n),"currentAnchorClass",void 0),u(d(n),"referenceEndpoint",void 0),u(d(n),"edgeType",void 0),u(d(n),"connector",void 0),u(d(n),"connectorOverlays",void 0),u(d(n),"connectorStyle",void 0),u(d(n),"connectorHoverStyle",void 0),u(d(n),"deleteOnEmpty",void 0),u(d(n),"uuid",void 0),u(d(n),"scope",void 0),u(d(n),"_anchor",void 0),u(d(n),"defaultLabelLocation",[.5,.5]),n.appendToDefaultType({edgeType:t.edgeType,maxConnections:t.maxConnections==null?n.instance.defaults.maxConnections:t.maxConnections,paintStyle:t.paintStyle||n.instance.defaults.endpointStyle,hoverPaintStyle:t.hoverPaintStyle||n.instance.defaults.endpointHoverStyle,connectorStyle:t.connectorStyle,connectorHoverStyle:t.connectorHoverStyle,connectorClass:t.connectorClass,connectorHoverClass:t.connectorHoverClass,connectorOverlays:t.connectorOverlays,connector:t.connector}),n.enabled=t.enabled!==!1,n.visible=!0,n.element=t.element,n.uuid=t.uuid,n.portId=t.portId,n.elementId=t.elementId,n.connectionCost=t.connectionCost==null?1:t.connectionCost,n.connectionsDirected=t.connectionsDirected,n.currentAnchorClass="",n.events={},n.connectorOverlays=t.connectorOverlays,n.connectorStyle=t.connectorStyle,n.connectorHoverStyle=t.connectorHoverStyle,n.connector=t.connector,n.edgeType=t.edgeType,n.connectorClass=t.connectorClass,n.connectorHoverClass=t.connectorHoverClass,n.deleteOnEmpty=t.deleteOnEmpty===!0,n.isSource=t.source||!1,n.isTemporarySource=t.isTemporarySource||!1,n.isTarget=t.target||!1,n.connections=t.connections||[],n.scope=t.scope||e.defaultScope,n.timestamp=null,n.reattachConnections=t.reattachConnections||e.defaults.reattachConnections,n.connectionsDetachable=e.defaults.connectionsDetachable,t.connectionsDetachable===!1&&(n.connectionsDetachable=!1),n.dragAllowedWhenFull=t.dragAllowedWhenFull!==!1,t.onMaxConnections&&n.bind(oo,t.onMaxConnections);var o=t.endpoint||t.existingEndpoint||e.defaults.endpoint;if(n.setEndpoint(o),t.preparedAnchor!=null)n.setPreparedAnchor(t.preparedAnchor);else{var s=t.anchor?t.anchor:t.anchors?t.anchors:e.defaults.anchor||he.Top;n.setAnchor(s)}var a=[un,t.type||""].join(" ");return n.addType(a,t.data),n}return D(i,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var e=this._anchor&&this._anchor.cssClass;if(e!=null&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==n&&(this.removeClass(t),this.addClass(n),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(e){this.fire("anchor:changed",{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function(e){var t=this.instance.router.prepareAnchor(e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(e){this.connections.push(e),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(e,t,n){(t=t??this.connections.indexOf(e))>=0&&(this.connections.splice(t,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&this.connections.length===0&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(e){for(var t=this.connections.length,n=0;n<t;n++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function(e){for(var t=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==e&&this.connections[n].endpoints[0]!==e||t.push(this.connections[n]);for(var o=0,s=t.length;o<s;o++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function(e,t,n){if(V(X(i.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t){for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(e),!n){var s=this===this.connections[o].endpoints[0]?1:0;this.connections[o].endpoints[s].connections.length===1&&this.connections[o].endpoints[s].setVisible(e,!0,!0)}}}},{key:"applyType",value:function(e,t){V(X(i.prototype),"applyType",this).call(this,e,t),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,e.maxConnections!=null&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),A(e,Ys),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function(){V(X(i.prototype),"destroy",this).call(this),this.deleted=!0,this.endpoint!=null&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return this.maxConnections===0||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(e){var t=!1;if(e){for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===e||this.connections[n].endpoints[0]===e){t=!0;break}}return t}},{key:"setDragAllowedWhenFull",value:function(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(e,t){var n,o={cssClass:this.cssClass,endpoint:this};if(Yi(e,ut)){var s=e;(n=Me.clone(s)).classes=o.cssClass.split(" ")}else if(z(e))n=Me.get(this,e,o);else{var a=e;A(o,a.options||{}),n=Me.get(this,a.type,o)}return n.typeId=t,n}},{key:"setEndpoint",value:function(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(e){this.endpoint!=null&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function(e,t){V(X(i.prototype),"addClass",this).call(this,e,t),this.endpoint!=null&&this.endpoint.addClass(e)}},{key:"removeClass",value:function(e,t){V(X(i.prototype),"removeClass",this).call(this,e,t),this.endpoint!=null&&this.endpoint.removeClass(e)}}]),i}(),_n="anchors",fi="connector";function lr(r,i,e,t,n,o,s){var a;if(i)r.endpoints[e]=i,i.addConnection(r);else{var l=s||r.endpointSpec||r.endpointsSpec[e]||r.instance.defaults.endpoints[e]||r.instance.defaults.endpoint,c=r.endpointStyles[e]||r.endpointStyle||r.instance.defaults.endpointStyles[e]||r.instance.defaults.endpointStyle;c.fill==null&&r.paintStyle!=null&&(c.fill=r.paintStyle.stroke),c.outlineStroke==null&&r.paintStyle!=null&&(c.outlineStroke=r.paintStyle.outlineStroke),c.outlineWidth==null&&r.paintStyle!=null&&(c.outlineWidth=r.paintStyle.outlineWidth);var h=r.endpointHoverStyles[e]||r.endpointHoverStyle||r.endpointHoverStyle||r.instance.defaults.endpointHoverStyles[e]||r.instance.defaults.endpointHoverStyle;r.hoverPaintStyle!=null&&(h==null&&(h={}),h.fill==null&&(h.fill=r.hoverPaintStyle.stroke));var p=r.uuids?r.uuids[e]:null;t=t??(r.instance.defaults.anchors!=null?r.instance.defaults.anchors[e]:r.instance.defaults.anchor),a=r.instance._internal_newEndpoint({paintStyle:c,hoverPaintStyle:h,endpoint:l,connections:[r],uuid:p,element:n,scope:r.scope,anchor:t,reattachConnections:r.reattach||r.instance.defaults.reattachConnections,connectionsDetachable:r.detachable||r.instance.defaults.connectionsDetachable}),r.instance._refreshEndpoint(a),i==null&&(a.deleteOnEmpty=!0),r.endpoints[e]=a}return a}var Nt=function(){F(i,ar);var r=H(i);function i(e,t){var n;M(this,i),(n=r.call(this,e,t)).instance=e,u(d(n),"connector",void 0),u(d(n),"defaultLabelLocation",.5),u(d(n),"scope",void 0),u(d(n),"typeId","_jsplumb_connection"),u(d(n),"previousConnection",void 0),u(d(n),"sourceId",void 0),u(d(n),"targetId",void 0),u(d(n),"source",void 0),u(d(n),"target",void 0),u(d(n),"detachable",!0),u(d(n),"reattach",!1),u(d(n),"uuids",void 0),u(d(n),"cost",1),u(d(n),"directed",void 0),u(d(n),"endpoints",[null,null]),u(d(n),"endpointStyles",void 0),u(d(n),"endpointSpec",void 0),u(d(n),"endpointsSpec",void 0),u(d(n),"endpointStyle",{}),u(d(n),"endpointHoverStyle",{}),u(d(n),"endpointHoverStyles",void 0),u(d(n),"suspendedEndpoint",void 0),u(d(n),"suspendedIndex",void 0),u(d(n),"suspendedElement",void 0),u(d(n),"suspendedElementId",void 0),u(d(n),"suspendedElementType",void 0),u(d(n),"_forceReattach",void 0),u(d(n),"_forceDetach",void 0),u(d(n),"proxies",[]),u(d(n),"pending",!1),n.id=t.id,n.previousConnection=t.previousConnection,n.source=t.source,n.target=t.target,t.sourceEndpoint?(n.source=t.sourceEndpoint.element,n.sourceId=t.sourceEndpoint.elementId):n.sourceId=e.getId(n.source),t.targetEndpoint?(n.target=t.targetEndpoint.element,n.targetId=t.targetEndpoint.elementId):n.targetId=e.getId(n.target),n.scope=t.scope;var o=t.anchors?t.anchors[0]:t.anchor,s=t.anchors?t.anchors[1]:t.anchor;e.manage(n.source),e.manage(n.target),n.visible=!0,n.params={cssClass:t.cssClass,hoverClass:t.hoverClass,"pointer-events":t["pointer-events"],overlays:t.overlays},n.lastPaintedAt=null,t.type&&(t.endpoints=t.endpoints||n.instance._deriveEndpointAndAnchorSpec(t.type).endpoints),n.endpointSpec=t.endpoint,n.endpointsSpec=t.endpoints||[null,null],n.endpointStyle=t.endpointStyle,n.endpointHoverStyle=t.endpointHoverStyle,n.endpointStyles=t.endpointStyles||[null,null],n.endpointHoverStyles=t.endpointHoverStyles||[null,null],n.paintStyle=t.paintStyle,n.hoverPaintStyle=t.hoverPaintStyle,n.uuids=t.uuids,n.makeEndpoint(!0,n.source,n.sourceId,o,t.sourceEndpoint),n.makeEndpoint(!1,n.target,n.targetId,s,t.targetEndpoint),n.scope||(n.scope=n.endpoints[0].scope),t.deleteEndpointsOnEmpty!=null&&(n.endpoints[0].deleteOnEmpty=t.deleteEndpointsOnEmpty,n.endpoints[1].deleteOnEmpty=t.deleteEndpointsOnEmpty);var a=n.instance.defaults.connectionsDetachable;t.detachable===!1&&(a=!1),n.endpoints[0].connectionsDetachable===!1&&(a=!1),n.endpoints[1].connectionsDetachable===!1&&(a=!1),n.endpointsSpec=t.endpoints||[null,null],n.endpointSpec=t.endpoint||null;var l=t.reattach||n.endpoints[0].reattachConnections||n.endpoints[1].reattachConnections||n.instance.defaults.reattachConnections,c=A({},n.endpoints[0].connectorStyle||n.endpoints[1].connectorStyle||t.paintStyle||n.instance.defaults.paintStyle);if(n.appendToDefaultType({detachable:a,reattach:l,paintStyle:c,hoverPaintStyle:A({},n.endpoints[0].connectorHoverStyle||n.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||n.instance.defaults.hoverPaintStyle)}),t.outlineWidth&&(c.outlineWidth=t.outlineWidth),t.outlineColor&&(c.outlineStroke=t.outlineColor),t.lineWidth&&(c.strokeWidth=t.lineWidth),t.color&&(c.stroke=t.color),!n.instance._suspendDrawing){var h=n.instance._suspendedAt||W();n.instance._paintEndpoint(n.endpoints[0],{timestamp:h}),n.instance._paintEndpoint(n.endpoints[1],{timestamp:h})}n.cost=t.cost||n.endpoints[0].connectionCost,n.directed=t.directed,t.directed==null&&(n.directed=n.endpoints[0].connectionsDirected);var p=A({},n.endpoints[1].parameters);A(p,n.endpoints[0].parameters),A(p,n.parameters),n.parameters=p,n.paintStyleInUse=n.getPaintStyle()||{},n._setConnector(n.endpoints[0].connector||n.endpoints[1].connector||t.connector||n.instance.defaults.connector,!0);var v=t.data!=null&&Qe(t.data)?t.data:{};n.setData(v);var f=[un,n.endpoints[0].edgeType,n.endpoints[1].edgeType,t.type].join(" ");return/[^\s]/.test(f)&&n.addType(f,t.data),n}return D(i,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(e,t,n,o,s){return n=n||this.instance.getId(t),lr(this,s,e?0:1,o,t)}},{key:"getTypeDescriptor",value:function(){return i.type}},{key:"isDetachable",value:function(e){return this.detachable!==!1&&(e!=null?e.connectionsDetachable===!0:this.detachable===!0)}},{key:"setDetachable",value:function(e){this.detachable=e===!0}},{key:"isReattach",value:function(){return this.reattach===!0||this.endpoints[0].reattachConnections===!0||this.endpoints[1].reattachConnections===!0}},{key:"setReattach",value:function(e){this.reattach=e===!0}},{key:"applyType",value:function(e,t){var n=null;e.connector!=null&&((n=this.getCachedTypeItem(fi,t.connector))==null&&(n=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(fi,n,t.connector)),this.setPreparedConnector(n)),V(X(i.prototype),"applyType",this).call(this,e,t),e.detachable!=null&&this.setDetachable(e.detachable),e.reattach!=null&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var o=null;e.anchor?(o=this.getCachedTypeItem(_n,t.anchor))==null&&(o=[Gt(e.anchor),Gt(e.anchor)],this.cacheTypeItem(_n,o,t.anchor)):e.anchors&&(o=this.getCachedTypeItem(_n,t.anchors))==null&&(o=[Gt(e.anchors[0]),Gt(e.anchors[1])],this.cacheTypeItem(_n,o,t.anchors)),o!=null&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function(e,t){V(X(i.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function(e,t){V(X(i.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function(e){V(X(i.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance._paintConnection(this)}},{key:"destroy",value:function(){V(X(i.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(e,t){var n,o={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(z(e))n=this.instance._makeConnector(this,e,o);else{var s=e;n=this.instance._makeConnector(this,s.type,Wt(s.options||{},o))}return t!=null&&(n.typeId=t),n}},{key:"setPreparedConnector",value:function(e,t,n,o){if(this.connector!==e){var s,a="";if(this.connector!=null&&(s=this.connector,a=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,o&&this.cacheTypeItem(fi,e,o),this.addClass(a),s!=null){var l=this.getOverlays();for(var c in l)this.instance.reattachOverlay(l[c],this)}t||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(e,t,n,o){var s=this.prepareConnector(e,o);this.setPreparedConnector(s,t,n,o)}},{key:"replaceEndpoint",value:function(e,t){var n=this.endpoints[e],o=(n.elementId,this.instance.getEndpoints(n.element)),s=o.indexOf(n),a=lr(this,null,e,null,n.element,0,t);this.endpoints[e]=a,o.splice(s,1,a),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire("endpoint:replaced",{previous:n,current:a})}}]),i}();function Rt(r){if(r.path==null){var i=A({"jtk-overlay-id":r.id},r.attributes);r.path=_e(Un,i);var e=r.instance.overlayClass+" "+(r.cssClass?r.cssClass:"");r.instance.addClass(r.path,e),r.path.jtk={overlay:r}}var t=r.path.parentNode;if(t==null){if(r.component instanceof Nt){var n=r.component.connector;t=n!=null?n.canvas:null}else if(r.component instanceof ht){var o=r.component.endpoint;t=o!=null?o.canvas:o}t!=null&&on(t,r.path,1)}return r.path}u(Nt,"type","connection"),function(){F(i,yn);var r=H(i);function i(){var e;M(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(d(e=r.call.apply(r,[this].concat(n))),"path",void 0),e}}();var ur=function(){function r(){M(this,r)}return D(r,null,[{key:"paint",value:function(i,e,t,n){if(t!=null){var o=[i.x,i.y],s=[i.w,i.h];if(n!=null&&(n.xmin<0&&(o[0]+=n.xmin),n.ymin<0&&(o[1]+=n.ymin),s[0]=n.xmax+(n.xmin<0?-n.xmin:0),s[1]=n.ymax+(n.ymin<0?-n.ymin:0)),isFinite(s[0])&&isFinite(s[1])){var a={width:""+(s[0]||0),height:""+(s[1]||0)};e.containerType===He.HTML?me(i.canvas,A(a,{style:po([o[0],o[1]])})):me(i.canvas,A(a,{x:o[0],y:o[1]}))}}}}]),r}();function zs(r,i,e,t){(function(h,p){if(p.canvas!=null)return p.canvas;var v=_e(co,{style:"",width:"0",height:"0","pointer-events":tt,position:Et});p.canvas=v,h._appendElement(p.canvas,h.getContainer()),p.cssClass!=null&&h.addClass(v,p.cssClass),h.addClass(v,h.connectorClass),v.jtk=v.jtk||{},v.jtk.connector=p})(r,i),ur.paint(i,r,e,t);var n=[0,0];if(t.xmin<0&&(n[0]=-t.xmin),t.ymin<0&&(n[1]=-t.ymin),i.segments.length>0){var o={d:r.getPathData(i),transform:"translate("+n[0]+","+n[1]+")","pointer-events":"visibleStroke"},s=null;if(e.outlineStroke){var a=e.outlineWidth||1,l=e.strokeWidth+2*a;(s=A({},e)).stroke=e.outlineStroke,s.strokeWidth=l,i.bgPath==null?(i.bgPath=_e(Un,o),r.addClass(i.bgPath,r.connectorOutlineClass),on(i.canvas,i.bgPath,0)):me(i.bgPath,o),Wn(i.canvas,i.bgPath,s)}var c=i;c.path==null?(c.path=_e(Un,o),on(c.canvas,c.path,e.outlineStroke?1:0)):(c.path.parentNode!==c.canvas&&on(c.canvas,c.path,e.outlineStroke?1:0),me(i.path,o)),Wn(i.canvas,i.path,e)}}var Vs=function(){function r(){M(this,r)}return D(r,null,[{key:"getEndpointElement",value:function(i){if(i.canvas!=null)return i.canvas;var e=_e(co,{style:"",width:"0",height:"0","pointer-events":"all",position:Et});i.canvas=e;var t=i.classes.join(" ");i.instance.addClass(e,t);for(var n=i.endpoint.scope.split(/\s/),o=0;o<n.length;o++)i.instance.setAttribute(e,Ki+n[o],ko);return i.instance._appendElementToContainer(e),i.cssClass!=null&&i.instance.addClass(e,i.cssClass),i.instance.addClass(e,i.instance.endpointClass),e.jtk=e.jtk||{},e.jtk.endpoint=i.endpoint,e.style.display=i.endpoint.visible!==!1?Bn:tt,e}},{key:"paint",value:function(i,e,t){if(i.endpoint.deleted!==!0){this.getEndpointElement(i),ur.paint(i,i.instance,t);var n=A({},t);n.outlineStroke&&(n.stroke=n.outlineStroke),i.node==null?(i.node=e.makeNode(i,n),i.canvas.appendChild(i.node)):e.updateNode!=null&&e.updateNode(i,i.node),Wn(i.canvas,i.node,n)}}}]),r}(),xn=function(){function r(i,e){M(this,r),this.connection=i,u(this,"type",void 0),u(this,"edited",!1),u(this,"stub",void 0),u(this,"sourceStub",void 0),u(this,"targetStub",void 0),u(this,"maxStub",void 0),u(this,"typeId",void 0),u(this,"gap",void 0),u(this,"sourceGap",void 0),u(this,"targetGap",void 0),u(this,"segments",[]),u(this,"totalLength",0),u(this,"segmentProportions",[]),u(this,"segmentProportionalLengths",[]),u(this,"paintInfo",null),u(this,"strokeWidth",void 0),u(this,"x",void 0),u(this,"y",void 0),u(this,"w",void 0),u(this,"h",void 0),u(this,"segment",void 0),u(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),u(this,"cssClass",void 0),u(this,"hoverClass",void 0),u(this,"geometry",void 0),this.stub=e.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=e.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=e.cssClass||"",this.hoverClass=e.hoverClass||""}return D(r,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(i,e){this.geometry=i,this.edited=i!=null&&!e}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(i){return this.geometry=i,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(i,e,t){return{x:i.x,y:i.y,ox:i.ox,oy:i.oy,curX:i.curX+e,curY:i.curY+t}}},{key:"resetBounds",value:function(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function(i,e){for(var t={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},n=0;n<this.segments.length;n++){var o=this.segments[n].findClosestPointOnPath(i,e);o.d<t.d&&(t.d=o.d,t.l=o.l,t.x=o.x,t.y=o.y,t.s=this.segments[n],t.x1=o.x1,t.x2=o.x2,t.y1=o.y1,t.y2=o.y2,t.index=n,t.connectorLocation=this.segmentProportions[n][0]+o.l*(this.segmentProportions[n][1]-this.segmentProportions[n][0]))}return t}},{key:"lineIntersection",value:function(i,e,t,n){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].lineIntersection(i,e,t,n));return o}},{key:"boxIntersection",value:function(i,e,t,n){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].boxIntersection(i,e,t,n));return o}},{key:"boundingBoxIntersection",value:function(i){for(var e=[],t=0;t<this.segments.length;t++)e.push.apply(e,this.segments[t].boundingBoxIntersection(i));return e}},{key:"_updateSegmentProportions",value:function(){for(var i=0,e=0;e<this.segments.length;e++){var t=this.segments[e].getLength();this.segmentProportionalLengths[e]=t/this.totalLength,this.segmentProportions[e]=[i,i+=t/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(i,e){var t,n,o;if(e&&(i=i>0?i/this.totalLength:(this.totalLength+i)/this.totalLength),i===1)t=this.segments.length-1,o=1;else if(i===0)o=0,t=0;else if(i>=.5){for(t=0,o=0,n=this.segmentProportions.length-1;n>-1;n--)if(this.segmentProportions[n][1]>=i&&this.segmentProportions[n][0]<=i){t=n,o=(i-this.segmentProportions[n][0])/this.segmentProportionalLengths[n];break}}else for(t=this.segmentProportions.length-1,o=1,n=0;n<this.segmentProportions.length;n++)if(this.segmentProportions[n][1]>=i){t=n,o=(i-this.segmentProportions[n][0])/this.segmentProportionalLengths[n];break}return{segment:this.segments[t],proportion:o,index:t}}},{key:"_addSegment",value:function(i,e){if(e.x1!==e.x2||e.y1!==e.y2){var t=new i(e);this.segments.push(t),this.totalLength+=t.getLength(),this.updateBounds(t)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(i){this.strokeWidth=i.strokeWidth;var e=i.sourcePos.curX,t=i.targetPos.curX,n=i.sourcePos.curY,o=i.targetPos.curY,s=ii({x:e,y:n},{x:t,y:o}),a=t<e,l=o<n,c=[i.sourcePos.ox,i.sourcePos.oy],h=[i.targetPos.ox,i.targetPos.oy],p=a?t:e,v=l?o:n,f=Math.abs(t-e),g=Math.abs(o-n),y=c[0]===0&&c[1]===0,m=h[0]===0&&h[1]===0;if(y||m){var _=f>g?0:1,C=[1,0][_],P=_===0?e:n,b=_===0?t:o;y&&(c[_]=P>b?-1:1,c[C]=0),m&&(h[_]=P>b?1:-1,h[C]=0)}var x=a?f+this.sourceGap*c[0]:this.sourceGap*c[0],E=l?g+this.sourceGap*c[1]:this.sourceGap*c[1],S=a?this.targetGap*h[0]:f+this.targetGap*h[0],w=l?this.targetGap*h[1]:g+this.targetGap*h[1],k=c[0]*h[0]+c[1]*h[1],I={sx:x,sy:E,tx:S,ty:w,xSpan:Math.abs(S-x),ySpan:Math.abs(w-E),mx:(x+S)/2,my:(E+w)/2,so:c,to:h,x:p,y:v,w:f,h:g,segment:s,startStubX:x+c[0]*this.sourceStub,startStubY:E+c[1]*this.sourceStub,endStubX:S+h[0]*this.targetStub,endStubY:w+h[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(x-S)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(E-w)>this.sourceStub+this.targetStub,opposite:k===-1,perpendicular:k===0,orthogonal:k===1,sourceAxis:c[0]===0?"y":"x",points:[p,v,f,g,x,E,S,w],stubs:[this.sourceStub,this.targetStub]};return I.anchorOrientation=I.opposite?"opposite":I.orthogonal?"orthogonal":"perpendicular",I}},{key:"updateBounds",value:function(i){var e=i.extents;this.bounds.xmin=Math.min(this.bounds.xmin,e.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,e.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,e.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,e.ymax)}},{key:"dumpSegmentsToConsole",value:function(){q("SEGMENTS:");for(var i=0;i<this.segments.length;i++)q(this.segments[i].type,""+this.segments[i].getLength(),""+this.segmentProportions[i])}},{key:"pointOnPath",value:function(i,e){var t=this._findSegmentForLocation(i,e);return t.segment&&t.segment.pointOnPath(t.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(i,e){var t=this._findSegmentForLocation(i,e);return t.segment&&t.segment.gradientAtPoint(t.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(i,e,t){var n=this._findSegmentForLocation(i,t);return n.segment&&n.segment.pointAlongPathFrom(n.proportion,e,!1)||{x:0,y:0}}},{key:"compute",value:function(i){this.paintInfo=this._prepareCompute(i),this._clearSegments(),this._compute(this.paintInfo,i),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(i,e){}}]),r}(),dt=function(){F(i,yn);var r=H(i);function i(e,t,n){var o;return M(this,i),(o=r.call(this,e,t,n)).instance=e,o.component=t,u(d(o),"width",void 0),u(d(o),"length",void 0),u(d(o),"foldback",void 0),u(d(o),"direction",void 0),u(d(o),"location",.5),u(d(o),"paintStyle",void 0),u(d(o),"type",i.type),u(d(o),"cachedDimensions",void 0),n=n||{},o.width=n.width||20,o.length=n.length||20,o.direction=(n.direction||1)<0?-1:1,o.foldback=n.foldback||.623,o.paintStyle=n.paintStyle||{strokeWidth:1},o.location=n.location==null?o.location:Array.isArray(n.location)?n.location[0]:n.location,o}return D(i,[{key:"draw",value:function(e,t,n){if(e instanceof xn){var o,s,a,l=e;if(this.location>1||this.location<0){var c=this.location<0?1:0;s=Ue(o=l.pointAlongPathFrom(c,this.location,!1),l.pointAlongPathFrom(c,this.location-this.direction*this.length/2,!1),this.length)}else if(this.location===1){if(s=Ue(o=l.pointOnPath(this.location),l.pointAlongPathFrom(this.location,-this.length),this.length),this.direction===-1){var h=s;s=o,o=h}}else if(this.location===0){if(o=Ue(s=l.pointOnPath(this.location),l.pointAlongPathFrom(this.location,this.length),this.length),this.direction===-1){var p=s;s=o,o=p}}else s=Ue(o=l.pointAlongPathFrom(this.location,this.direction*this.length/2),l.pointOnPath(this.location),this.length);var v={hxy:o,tail:a=function(y,m,_){var C=st(y,m),P=Math.atan(-1/C),b=_/2*Math.sin(P),x=_/2*Math.cos(P);return[{x:m.x+x,y:m.y+b},{x:m.x-x,y:m.y-b}]}(o,s,this.width),cxy:Ue(o,s,this.foldback*this.length)},f=this.paintStyle.stroke||t.stroke,g=this.paintStyle.fill||t.stroke;return{component:e,d:v,"stroke-width":this.paintStyle.strokeWidth||t.strokeWidth,stroke:f,fill:g,xmin:Math.min(o.x,a[0].x,a[1].x),xmax:Math.max(o.x,a[0].x,a[1].x),ymin:Math.min(o.y,a[0].y,a[1].y),ymax:Math.max(o.y,a[0].y,a[1].y)}}}},{key:"updateFrom",value:function(e){}}]),i}();function gi(r){return r.type===dt.type}u(dt,"type","Arrow"),Ft(dt.type,dt);var kn=function(){F(i,dt);var r=H(i);function i(e,t,n){var o;return M(this,i),(o=r.call(this,e,t,n)).instance=e,u(d(o),"type",i.type),o.length=o.length/2,o.foldback=2,o}return i}();function yi(r){return r.type===kn.type}u(kn,"type","Diamond"),Ft(kn.type,kn);var mi=function(){F(i,dt);var r=H(i);function i(e,t,n){var o;return M(this,i),(o=r.call(this,e,t,n)).instance=e,u(d(o),"type",i.type),o.foldback=1,o}return i}();function _i(r){return r.type===mi.type}u(mi,"type","PlainArrow"),Ft("PlainArrow",mi);var bn=function(){F(i,yn);var r=H(i);function i(e,t,n){var o;return M(this,i),(o=r.call(this,e,t,n)).instance=e,o.component=t,u(d(o),"create",void 0),u(d(o),"type",i.type),o.create=n.create,o}return D(i,[{key:"updateFrom",value:function(e){}}]),i}();function De(r){return r.type===bn.type}u(bn,"type","Custom"),Ft(bn.type,bn);var pt="paintStyle",vt=function(){F(i,ut);var r=H(i);function i(e,t){var n;return M(this,i),u(d(n=r.call(this,e,t)),"radius",void 0),u(d(n),"defaultOffset",void 0),u(d(n),"defaultInnerRadius",void 0),u(d(n),"type",i.type),t=t||{},n.radius=t.radius||5,n.defaultOffset=.5*n.radius,n.defaultInnerRadius=n.radius/3,n}return i}();u(vt,"type","Dot");var Us={type:vt.type,cls:vt,compute:function(r,i,e,t){var n=i.curX-r.radius,o=i.curY-r.radius,s=2*r.radius,a=2*r.radius;if(t&&t.stroke){var l=t.strokeWidth||1;n-=l,o-=l,s+=2*l,a+=2*l}return r.x=n,r.y=o,r.w=s,r.h=a,[n,o,s,a,r.radius]},getParams:function(r){return{radius:r.radius}}},xi=function r(i,e){M(this,r),this.instance=i,this.el=e,u(this,"group",void 0)},Ws=function(){F(i,xi);var r=H(i);function i(e,t,n){var o;M(this,i),(o=r.call(this,e,t)).instance=e,u(d(o),"children",[]),u(d(o),"collapsed",!1),u(d(o),"droppable",void 0),u(d(o),"enabled",void 0),u(d(o),"orphan",void 0),u(d(o),"constrain",void 0),u(d(o),"proxied",void 0),u(d(o),"ghost",void 0),u(d(o),"revert",void 0),u(d(o),"prune",void 0),u(d(o),"dropOverride",void 0),u(d(o),"anchor",void 0),u(d(o),"endpoint",void 0),u(d(o),"connections",{source:[],target:[],internal:[]}),u(d(o),"manager",void 0),u(d(o),"id",void 0),u(d(o),"elId",void 0);var s=o.el;return s._isJsPlumbGroup=!0,s._jsPlumbGroup=d(o),o.elId=e.getId(t),o.orphan=n.orphan===!0,o.revert=o.orphan!==!0&&n.revert!==!1,o.droppable=n.droppable!==!1,o.ghost=n.ghost===!0,o.enabled=n.enabled!==!1,o.prune=o.orphan!==!0&&n.prune===!0,o.constrain=o.ghost||n.constrain===!0,o.proxied=n.proxied!==!1,o.id=n.id||W(),o.dropOverride=n.dropOverride===!0,o.anchor=n.anchor,o.endpoint=n.endpoint,o.anchor=n.anchor,e.setAttribute(t,Zi,""),o}return D(i,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(e,t){return this.endpoint||{type:vt.type,options:{radius:10}}}},{key:"add",value:function(e,t){var n=this.instance.getGroupContentArea(this),o=e;if(o._jsPlumbParentGroup!=null){if(o._jsPlumbParentGroup===this)return;o._jsPlumbParentGroup.remove(e,!0,t,!1)}o._jsPlumbParentGroup=this,this.children.push(new xi(this.instance,e)),this.instance._appendElement(o,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return e==null?null:Gn(this.children,function(t){return t.el===e})}},{key:"remove",value:function(e,t,n,o,s){var a=this.resolveNode(e);a!=null&&this._doRemove(a,t,n,o,s)}},{key:"_doRemove",value:function(e,t,n,o,s){var a=e.el;if(delete a._jsPlumbParentGroup,Z(this.children,function(c){return c===e}),t)try{this.instance.getGroupContentArea(this).removeChild(a)}catch(c){q("Could not remove element from Group "+c)}if(!n){var l={group:this,el:a};s&&(l.targetGroup=s),this.instance.fire("group:member:removed",l)}o||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(e,t){for(var n=0,o=this.children.length;n<o;n++){var s=this.children[0];this._doRemove(s,e,t,!0),this.instance.unmanage(s.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var e={},t=0;t<this.children.length;t++){var n=this.manager.orphan(this.children[t].el,!1);e[n.id]=n.pos}return this.children.length=0,e}},{key:"addGroup",value:function(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;e.group!=null&&e.group.removeGroup(e);var t=this.instance.getId(e.el);this.instance.getManagedElements()[t].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(e.el),o=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElementToGroup(this,e.el),e.group=this;var s={x:n.x-o.x,y:n.y-o.y};return this.instance.setPosition(e.el,s),this.instance.fire("group:nested:added",{parent:this,child:e}),!0}return!1}},{key:"removeGroup",value:function(e){if(e.group===this){var t=e.el,n=this.instance.getGroupContentArea(this);n===t.parentNode&&n.removeChild(e.el);var o=this.instance.getId(e.el),s=this.instance.getManagedElements()[o];s&&delete s.group,this.children=this.children.filter(function(a){return a.id!==e.id}),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:e})}}},{key:"getGroups",value:function(){return this.children.filter(function(e){return e.constructor===i})}},{key:"getNodes",value:function(){return this.children.filter(function(e){return e.constructor===xi})}},{key:"collapseParent",get:function(){var e=null;if(this.group==null)return null;for(var t=this.group;t!=null;)t.collapsed&&(e=t),t=t.group;return e}}]),i}(),qs=function(){function r(i){var e=this;M(this,r),this.instance=i,u(this,"groupMap",{}),u(this,"_connectionSourceMap",{}),u(this,"_connectionTargetMap",{}),i.bind(eo,function(t){var n=e.getGroupFor(t.source),o=e.getGroupFor(t.target);n!=null&&o!=null&&n===o?(e._connectionSourceMap[t.connection.id]=n,e._connectionTargetMap[t.connection.id]=n,_t(n.connections.internal,t.connection)):(n!=null&&(t.target._jsPlumbGroup===n?_t(n.connections.internal,t.connection):_t(n.connections.source,t.connection),e._connectionSourceMap[t.connection.id]=n),o!=null&&(t.source._jsPlumbGroup===o?_t(o.connections.internal,t.connection):_t(o.connections.target,t.connection),e._connectionTargetMap[t.connection.id]=o))}),i.bind(zn,function(t){e._cleanupDetachedConnection(t.connection)}),i.bind(to,function(t){var n=t.originalEndpoint.element,o=e.getGroupFor(n),s=t.connection.endpoints[t.index].element,a=e.getGroupFor(s),l=t.index===0?e._connectionSourceMap:e._connectionTargetMap,c=t.index===0?e._connectionTargetMap:e._connectionSourceMap;a!=null?(l[t.connection.id]=a,t.connection.source===t.connection.target&&(c[t.connection.id]=a)):(delete l[t.connection.id],t.connection.source===t.connection.target&&delete c[t.connection.id]),o!=null&&e._updateConnectionsForGroup(o),a!=null&&e._updateConnectionsForGroup(a)})}return D(r,[{key:"_cleanupDetachedConnection",value:function(i){i.proxies.length=0;var e,t=this._connectionSourceMap[i.id];t!=null&&(e=function(n){return n.id===i.id},Z(t.connections.source,e),Z(t.connections.target,e),Z(t.connections.internal,e),delete this._connectionSourceMap[i.id]),(t=this._connectionTargetMap[i.id])!=null&&(e=function(n){return n.id===i.id},Z(t.connections.source,e),Z(t.connections.target,e),Z(t.connections.internal,e),delete this._connectionTargetMap[i.id])}},{key:"addGroup",value:function(i){var e=i.el;if(this.groupMap[i.id]!=null)throw new Error("cannot create Group ["+i.id+"]; a Group with that ID exists");if(e._isJsPlumbGroup!=null)throw new Error("cannot create Group ["+i.id+"]; the given element is already a Group");var t=new Ws(this.instance,i.el,i);return this.groupMap[t.id]=t,i.collapsed&&this.collapseGroup(t),this.instance.manage(t.el),this.instance.addClass(t.el,Pt),t.manager=this,this._updateConnectionsForGroup(t),this.instance.fire("group:added",{group:t}),t}},{key:"getGroup",value:function(i){var e=i;if(z(i)&&(e=this.groupMap[i])==null)throw new Error("No such group ["+i+"]");return e}},{key:"getGroupFor",value:function(i){for(var e=i,t=this.instance.getContainer(),n=!1,o=null;!n;)e==null||e===t?n=!0:e._jsPlumbParentGroup?(o=e._jsPlumbParentGroup,n=!0):e=e.parentNode;return o}},{key:"getGroups",value:function(){var i=[];for(var e in this.groupMap)i.push(this.groupMap[e]);return i}},{key:"removeGroup",value:function(i,e,t,n){var o=this,s=this.getGroup(i);this.expandGroup(s,!0);var a={};return j(s.children,function(l){var c=o.instance.getManagedElements()[o.instance.getId(l.el)];c&&delete c.group}),e?(j(s.getGroups(),function(l){return o.removeGroup(l,e,t)}),s.removeAll(t,n)):(s.group&&j(s.children,function(l){return s.group.add(l.el)}),a=s.orphanAll()),s.group&&s.group.removeGroup(s),this.instance.unmanage(s.el,!0),delete this.groupMap[s.id],this.instance.fire("group:removed",{group:s}),a}},{key:"removeAllGroups",value:function(i,e,t){for(var n in this.groupMap)this.removeGroup(this.groupMap[n],i,e,t)}},{key:"forEach",value:function(i){for(var e in this.groupMap)i(this.groupMap[e])}},{key:"orphan",value:function(i,e){var t=i;if(t._jsPlumbParentGroup){var n=t._jsPlumbParentGroup,o=this.instance.getId(t),s=this.instance.getOffset(i);return e!==!0&&n.group?this.instance._appendElementToGroup(n.group,i):this.instance._appendElementToContainer(i),this.instance.setPosition(i,s),delete t._jsPlumbParentGroup,{id:o,pos:s}}}},{key:"_updateConnectionsForGroup",value:function(i){var e=this;i.connections.source.length=0,i.connections.target.length=0,i.connections.internal.length=0;var t=i.children.slice().map(function(p){return p.el}),n=[];if(j(t,function(p){Array.prototype.push.apply(n,e.instance.getSelector(p,Y))}),Array.prototype.push.apply(t,n),t.length>0){var o,s,a=this.instance.getConnections({source:t,scope:ze},!0),l=this.instance.getConnections({target:t,scope:ze},!0),c={},h=function(p){for(var v=0;v<p.length;v++)c[p[v].id]||(c[p[v].id]=!0,o=e.getGroupFor(p[v].source),s=e.getGroupFor(p[v].target),p[v].source===i.el&&s===i||p[v].target===i.el&&o===i?i.connections.internal.push(p[v]):o===i?(s!==i?i.connections.source.push(p[v]):i.connections.internal.push(p[v]),e._connectionSourceMap[p[v].id]=i):s===i&&(i.connections.target.push(p[v]),e._connectionTargetMap[p[v].id]=i))};h(a),h(l)}}},{key:"_collapseConnection",value:function(i,e,t){var n=i.endpoints[e===0?1:0].element;if(n._jsPlumbParentGroup&&!n._jsPlumbParentGroup.proxied&&n._jsPlumbParentGroup.collapsed)return!1;var o=i.endpoints[0].element._jsPlumbParentGroup,s=o!=null?o.collapseParent||o:null,a=i.endpoints[1].element._jsPlumbParentGroup,l=a!=null?a.collapseParent||a:null;if(s==null||l==null||s.id!==l.id){var c=t.el;return this.instance.getId(c),this.instance.proxyConnection(i,e,c,function(h,p){return t.getEndpoint(h,p)},function(h,p){return t.getAnchor(h,p)}),!0}return!1}},{key:"_expandConnection",value:function(i,e,t){this.instance.unproxyConnection(i,e)}},{key:"isElementDescendant",value:function(i,e){for(var t=this.instance.getContainer();;){if(i==null||i===t)return!1;if(i===e)return!0;i=i.parentNode}}},{key:"collapseGroup",value:function(i){var e=this,t=this.getGroup(i);if(t!=null&&!t.collapsed){var n=t.el;if(t.collapseParent==null){if(this.instance.setGroupVisible(t,!1),t.collapsed=!0,this.instance.removeClass(n,Pt),this.instance.addClass(n,tn),t.proxied){var o=new Set,s=function(a,l){for(var c=0;c<a.length;c++){var h=a[c];e._collapseConnection(h,l,t)===!0&&o.add(h.id)}};s(t.connections.source,0),s(t.connections.target,1),j(t.getGroups(),function(a){e.cascadeCollapse(t,a,o)})}this.instance.revalidate(n),this.repaintGroup(t),this.instance.fire("group:collapse",{group:t})}else t.collapsed=!0,this.instance.removeClass(n,Pt),this.instance.addClass(n,tn)}}},{key:"cascadeCollapse",value:function(i,e,t){var n=this;if(i.proxied){var o=function(s,a){for(var l=0;l<s.length;l++){var c=s[l];t.has(c.id)||n._collapseConnection(c,a,i)===!0&&t.add(c.id)}};o(e.connections.source,0),o(e.connections.target,1)}j(e.getGroups(),function(s){n.cascadeCollapse(i,s,t)})}},{key:"expandGroup",value:function(i,e){var t=this,n=this.getGroup(i);if(n!=null){var o=n.el;if(n.collapseParent==null){if(this.instance.setGroupVisible(n,!0),n.collapsed=!1,this.instance.addClass(o,Pt),this.instance.removeClass(o,tn),n.proxied){var s=function(a,l){for(var c=0;c<a.length;c++){var h=a[c];t._expandConnection(h,l,n)}};s(n.connections.source,0),s(n.connections.target,1),j(n.getGroups(),function a(l,c){if(c||l.collapsed){var h=function(p,v){for(var f=0;f<p.length;f++){var g=p[f];t._collapseConnection(g,v,l.collapseParent||l)}};h(l.connections.source,0),h(l.connections.target,1),j(l.connections.internal,function(p){return p.setVisible(!1)}),j(l.getGroups(),function(p){return a(p,!0)})}else t.expandGroup(l,!0)})}this.instance.revalidate(o),this.repaintGroup(n),e||this.instance.fire("group:expand",{group:n})}else n.collapsed=!1,this.instance.addClass(o,Pt),this.instance.removeClass(o,tn)}}},{key:"toggleGroup",value:function(i){(i=this.getGroup(i))!=null&&(i.collapsed?this.expandGroup(i):this.collapseGroup(i))}},{key:"repaintGroup",value:function(i){for(var e=this.getGroup(i).children,t=0;t<e.length;t++)this.instance.revalidate(e[t].el)}},{key:"addToGroup",value:function(i,e){var t=this,n=this.getGroup(i);if(n){for(var o=n.el,s=arguments.length,a=new Array(s>2?s-2:0),l=2;l<s;l++)a[l-2]=arguments[l];j(a,function(c){var h=c,p=h._isJsPlumbGroup!=null,v=h._jsPlumbGroup,f=h._jsPlumbParentGroup;if(f!==n){var g=t.instance.manage(c),y=t.instance.getOffset(c),m=n.collapsed?t.instance.getOffsetRelativeToRoot(o):t.instance.getOffset(t.instance.getGroupContentArea(n));g.group=n.elId,f!=null&&(f.remove(c,!1,e,!1,n),t._updateConnectionsForGroup(f)),p?n.addGroup(v):n.add(c,e);var _=function(b,x){var E=x===0?1:0;b.each(function(S){S.setVisible(!1),S.endpoints[E].element._jsPlumbGroup===n?(S.endpoints[E].setVisible(!1),t._expandConnection(S,E,n)):(S.endpoints[x].setVisible(!1),t._collapseConnection(S,x,n))})};n.collapsed&&(_(t.instance.select({source:c}),0),_(t.instance.select({target:c}),1)),t.instance.getId(c);var C={x:y.x-m.x,y:y.y-m.y};if(t.instance.setPosition(c,C),t._updateConnectionsForGroup(n),t.instance.revalidate(c),!e){var P={group:n,el:c,pos:C};f&&(P.sourceGroup=f),t.instance.fire("group:member:added",P)}}})}}},{key:"removeFromGroup",value:function(i,e){var t=this,n=this.getGroup(i);if(n){for(var o=arguments.length,s=new Array(o>2?o-2:0),a=2;a<o;a++)s[a-2]=arguments[a];j(s,function(l){if(n.collapsed){var c=function(p,v){for(var f=0;f<p.length;f++){var g=p[f];if(g.proxies){for(var y=0;y<g.proxies.length;y++)if(g.proxies[y]!=null){var m=g.proxies[y].originalEp.element;(m===l||t.isElementDescendant(m,l))&&t._expandConnection(g,v,n)}}}};c(n.connections.source.slice(),0),c(n.connections.target.slice(),1)}n.remove(l,null,e);var h=t.instance.getManagedElements()[t.instance.getId(l)];h&&delete h.group})}}},{key:"getAncestors",value:function(i){for(var e=[],t=i.group;t!=null;)e.push(t),t=t.group;return e}},{key:"isAncestor",value:function(i,e){return i!=null&&e!=null&&this.getAncestors(i).indexOf(e)!==-1}},{key:"getDescendants",value:function(i){var e=[];return function t(n){var o=n.getGroups();e.push.apply(e,$e(o)),j(o,t)}(i),e}},{key:"isDescendant",value:function(i,e){return i!=null&&e!=null&&this.getDescendants(e).indexOf(i)!==-1}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),r}(),cr=function(){function r(i,e){M(this,r),this.instance=i,this.entries=e}return D(r,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(i){return j(this.entries,function(e){return i(e)}),this}},{key:"get",value:function(i){return this.entries[i]}},{key:"addClass",value:function(i,e){return this.each(function(t){return t.addClass(i,e)}),this}},{key:"removeClass",value:function(i,e){return this.each(function(t){return t.removeClass(i,e)}),this}},{key:"removeAllOverlays",value:function(){return this.each(function(i){return i.removeAllOverlays()}),this}},{key:"setLabel",value:function(i){return this.each(function(e){return e.setLabel(i)}),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(i){var e=[];return this.each(function(t){return e.push(i(t))}),e}},{key:"addOverlay",value:function(i){return this.each(function(e){return e.addOverlay(i)}),this}},{key:"removeOverlay",value:function(i){return this.each(function(e){return e.removeOverlay(i)}),this}},{key:"removeOverlays",value:function(){return this.each(function(i){return i.removeOverlays()}),this}},{key:"showOverlay",value:function(i){return this.each(function(e){return e.showOverlay(i)}),this}},{key:"hideOverlay",value:function(i){return this.each(function(e){return e.hideOverlay(i)}),this}},{key:"setPaintStyle",value:function(i){return this.each(function(e){return e.setPaintStyle(i)}),this}},{key:"setHoverPaintStyle",value:function(i){return this.each(function(e){return e.setHoverPaintStyle(i)}),this}},{key:"setSuspendEvents",value:function(i){return this.each(function(e){return e.setSuspendEvents(i)}),this}},{key:"setParameter",value:function(i,e){return this.each(function(t){return t.parameters[i]=e}),this}},{key:"setParameters",value:function(i){return this.each(function(e){return e.parameters=i}),this}},{key:"setVisible",value:function(i){return this.each(function(e){return e.setVisible(i)}),this}},{key:"addType",value:function(i){return this.each(function(e){return e.addType(i)}),this}},{key:"toggleType",value:function(i){return this.each(function(e){return e.toggleType(i)}),this}},{key:"removeType",value:function(i){return this.each(function(e){return e.removeType(i)}),this}},{key:"bind",value:function(i,e){return this.each(function(t){return t.bind(i,e)}),this}},{key:"unbind",value:function(i,e){return this.each(function(t){return t.unbind(i,e)}),this}},{key:"setHover",value:function(i){var e=this;return this.each(function(t){return e.instance.setHover(t,i)}),this}}]),r}(),Zs=function(){F(i,cr);var r=H(i);function i(){return M(this,i),r.apply(this,arguments)}return D(i,[{key:"setEnabled",value:function(e){return this.each(function(t){return t.enabled=e}),this}},{key:"setAnchor",value:function(e){return this.each(function(t){return t.setAnchor(e)}),this}},{key:"deleteEveryConnection",value:function(){return this.each(function(e){return e.deleteEveryConnection()}),this}},{key:"deleteAll",value:function(){var e=this;return this.each(function(t){return e.instance.deleteEndpoint(t)}),this.clear(),this}}]),i}(),Js=function(){F(i,cr);var r=H(i);function i(){return M(this,i),r.apply(this,arguments)}return D(i,[{key:"setDetachable",value:function(e){return this.each(function(t){return t.setDetachable(e)}),this}},{key:"setReattach",value:function(e){return this.each(function(t){return t.setReattach(e)}),this}},{key:"setConnector",value:function(e){return this.each(function(t){return t._setConnector(e)}),this}},{key:"deleteAll",value:function(){var e=this;this.each(function(t){return e.instance.deleteConnection(t)}),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each(function(t){return e.instance._paintConnection(t)}),this}}]),i}(),Ks=function r(){M(this,r),u(this,"affectedElements",new Set)};function hr(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var Cn=function(r,i){var e=0;return i[1]>r[1]?e=-1:i[1]<r[1]&&(e=1),e},dr=function(r,i){return-1*Cn(r,i)};function En(r,i,e,t){(function(n,o,s,a){if(o.length===0)o.push(n);else{for(var l=a?-1:1,c=0,h=o.length,p=Math.floor((c+h)/2);h>c;)s(n,o[p])*l<0?h=p:c=p+1,p=Math.floor((c+h)/2);o.splice(p,0,n)}})([r,i],e,Cn,t)}function Te(r,i){var e=Ce(i,function(t){return t[0]===r});e>-1&&i.splice(e,1)}var Bt,$s=function(){F(i,Lt);var r=H(i);function i(e){var t;return M(this,i),(t=r.call(this)).instance=e,u(d(t),"_currentTransaction",null),u(d(t),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),u(d(t),"_elementMap",new Map),u(d(t),"_transformedElementMap",new Map),u(d(t),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),t}return D(i,[{key:"_updateBounds",value:function(e,t,n){t!=null&&(Te(e,this._sortedElements.xmin),Te(e,this._sortedElements.xmax),Te(e,this._sortedElements.ymin),Te(e,this._sortedElements.ymax),En(e,t.t.x,this._sortedElements.xmin,!1),En(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),En(e,t.t.y,this._sortedElements.ymin,!1),En(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),n!==!0&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach(function(t,n){e._sortedElements.xmin.push([n,t.t.x]),e._sortedElements.xmax.push([n,t.t.x+t.t.w]),e._sortedElements.ymin.push([n,t.t.y]),e._sortedElements.ymax.push([n,t.t.y+t.t.h])}),this._sortedElements.xmin.sort(Cn),this._sortedElements.ymin.sort(Cn),this._sortedElements.xmax.sort(dr),this._sortedElements.ymax.sort(dr),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(e,t,n){var o,s,a,l,c,h,p,v,f,g,y,m,_,C,P,b,x,E,S;t.t=(o=t.x,s=t.y,a=t.w,l=t.h,c=t.r,h=o+a/2,p=s+l/2,v=Math.cos(c/360*Math.PI*2),f=Math.sin(c/360*Math.PI*2),g=function(w,k){return{x:h+Math.round((w-h)*v-(k-p)*f),y:p+Math.round((k-p)*v-(w-h)*f)}},y=g(o,s),m=g(o+a,s),_=g(o+a,s+l),C=g(o,s+l),P=g(o+a/2,s+l/2),b=Math.min(y.x,m.x,_.x,C.x),x=Math.max(y.x,m.x,_.x,C.x),E=Math.min(y.y,m.y,_.y,C.y),S=Math.max(y.y,m.y,_.y,C.y),{x:b,y:E,w:x-b,h:S-E,c:P,r:c,x2:x,y2:S,cr:v,sr:f}),this._transformedElementMap.set(e,t.t),n!==!0&&this._updateBounds(e,t,n)}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"startTransaction",value:function(){if(this._currentTransaction!=null)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new Ks}},{key:"endTransaction",value:function(){var e=this;this._currentTransaction!=null&&(this._currentTransaction.affectedElements.forEach(function(t){var n=e.getPosition(t);e._finaliseUpdate(t,n,!0)}),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(e){var t=this;j(e,function(n){return t.updateElement(n.id,n.x,n.y,n.width,n.height,n.rotation)})}},{key:"updateElement",value:function(e,t,n,o,s,a,l){var c=Xi(this._elementMap,e,hr);return c.dirty=t==null&&c.x==null||n==null&&c.y==null||o==null&&c.w==null||s==null&&c.h==null,t!=null&&(c.x=t),n!=null&&(c.y=n),o!=null&&(c.w=o),s!=null&&(c.h=s),a!=null&&(c.r=a||0),c.c.x=c.x+c.w/2,c.c.y=c.y+c.h/2,c.x2=c.x+c.w,c.y2=c.y+c.h,this._currentTransaction==null?this._finaliseUpdate(e,c,l):this._currentTransaction.affectedElements.add(e),c}},{key:"refreshElement",value:function(e,t){var n=this.instance.getManagedElements(),o=n[e]?n[e].el:null;if(o!=null){var s=this.getSize(o),a=this.getOffset(o);return this.updateElement(e,a.x,a.y,s.w,s.h,null,t)}return null}},{key:"getSize",value:function(e){return this.instance.getSize(e)}},{key:"getOffset",value:function(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function(e,t,n,o,s,a){return this.updateElement(e,t,n,o,s,a)}},{key:"rotateElement",value:function(e,t){var n=Xi(this._elementMap,e,hr);return n.r=t||0,this._finaliseUpdate(e,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,n,null)}},{key:"setPosition",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,t,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(e){Te(e,this._sortedElements.xmin),Te(e,this._sortedElements.xmax),Te(e,this._sortedElements.ymin),Te(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function(e){return this._elementMap.get(e)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return this._elementMap.size===0}}]),i}();function pr(r,i){return i.theta-r.theta}function vr(r,i){return(r.theta<0?-Math.PI-r.theta:Math.PI-r.theta)-(i.theta<0?-Math.PI-i.theta:Math.PI-i.theta)}var Qs=(u(Bt={},U,vr),u(Bt,$,pr),u(Bt,te,pr),u(Bt,Q,vr),Bt);function Ie(r){return r.isContinuous===!0}function fr(r){return r.isContinuous===!0}function ea(r){return r.locations.length>1}function gr(r){return[r.currentLocation,r.locations[r.currentLocation]]}var ta=function(){function r(i){var e=this;M(this,r),this.instance=i,u(this,"anchorLists",new Map),u(this,"anchorLocations",new Map),i.bind(zn,function(t){t.sourceEndpoint._anchor.isContinuous&&e._removeEndpointFromAnchorLists(t.sourceEndpoint),t.targetEndpoint._anchor.isContinuous&&e._removeEndpointFromAnchorLists(t.targetEndpoint)}),i.bind(no,function(t){e._removeEndpointFromAnchorLists(t)})}return D(r,[{key:"getAnchorOrientation",value:function(i){var e=this.anchorLocations.get(i.id);return e?[e.ox,e.oy]:[0,0]}},{key:"_distance",value:function(i,e,t,n,o,s,a){var l=n.x+i.x*o.w,c=n.y+i.y*o.h,h=n.x+o.w/2,p=n.y+o.h/2;if(s!=null&&s.length>0){var v=this.instance._applyRotations([l,c,0,0],s);l=v.x,c=v.y}return Math.sqrt(Math.pow(e-l,2)+Math.pow(t-c,2))+Math.sqrt(Math.pow(h-l,2)+Math.pow(p-c,2))}},{key:"_anchorSelector",value:function(i,e,t,n,o,s,a){for(var l=t.x+n.w/2,c=t.y+n.h/2,h=-1,p=1/0,v=0;v<a.length;v++){var f=this._distance(a[v],l,c,i,e,o,s);f<p&&(h=v+0,p=f)}return[h,a[h]]}},{key:"_floatingAnchorCompute",value:function(i,e){var t=e.xy,n={curX:t.x+i.size.w/2,curY:t.y+i.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(i,n)}},{key:"_setComputedPosition",value:function(i,e,t){return this.anchorLocations.set(i.id,e),i.computedPosition=e,t&&(i.timestamp=t),e}},{key:"_computeSingleLocation",value:function(i,e,t,n){var o,s=n.rotation,a={curX:e.x+i.x*t.w+i.offx,curY:e.y+i.y*t.h+i.offy,x:i.x,y:i.y,ox:0,oy:0};if(s!=null&&s.length>0){var l=[i.iox,i.ioy],c={x:a.curX,y:a.curY,cr:0,sr:0};j(s,function(h){c=Zt(c,h.c,h.r);var p=[Math.round(l[0]*c.cr-l[1]*c.sr),Math.round(l[1]*c.cr+l[0]*c.sr)];l=p.slice()}),i.ox=l[0],i.oy=l[1],o={curX:c.x,curY:c.y,x:i.x,y:i.y,ox:l[0],oy:l[1]}}else i.ox=i.iox,i.oy=i.ioy,o=A({ox:i.iox,oy:i.ioy},a);return o}},{key:"_singleAnchorCompute",value:function(i,e){var t=e.xy,n=e.wh,o=e.timestamp,s=this.anchorLocations.get(i.id);if(s!=null&&o&&o===i.timestamp)return s;var a=Vt(gr(i),2);a[0];var l=a[1];return s=this._computeSingleLocation(l,t,n,e),this._setComputedPosition(i,s,o)}},{key:"_defaultAnchorCompute",value:function(i,e){var t;if(i.locations.length===1)return this._singleAnchorCompute(i,e);var n=e.xy,o=e.wh,s=e.txy,a=e.twh,l=Vt(gr(i),2),c=l[0],h=l[1];if(i.locked||s==null||a==null)t=this._computeSingleLocation(h,n,o,e);else{var p=Vt(this._anchorSelector(n,o,s,a,e.rotation,e.tRotation,i.locations),2),v=p[0],f=p[1];i.currentLocation=v,v!==c&&(i.cssClass=f.cls||i.cssClass,e.element._anchorLocationChanged(i)),t=this._computeSingleLocation(f,n,o,e)}return this._setComputedPosition(i,t,e.timestamp)}},{key:"_placeAnchors",value:function(i,e){var t=this,n=this.instance.viewport.getPosition(i),o=function(s,a,l,c,h,p){if(l.length>0)for(var v=l.sort(Qs[s]),f=function(_,C,P,b,x){for(var E=P?_.w:_.h,S=P?_.h:_.w,w=[],k=E/(C.length+1),I=0;I<C.length;I++){var T=(I+1)*k,L=b*S;x&&(T=E-T);var N=P?T:L,B=_.x+N,oe=N/_.w,Ke=P?L:T,Oe=_.y+Ke,yt=Ke/_.h;if(_.r!==0&&_.r!=null){var zt=Zt({x:B,y:Oe},_.c,_.r);B=zt.x,Oe=zt.y}w.push({x:B,y:Oe,xLoc:oe,yLoc:yt,c:C[I].c})}return w}(n,v,c,h,s===$||s===U),g=0;g<f.length;g++){var y=f[g].c,m=y.endpoints[0].elementId===i?y.endpoints[0]:y.endpoints[1];t._setComputedPosition(m._anchor,{curX:f[g].x,curY:f[g].y,x:f[g].xLoc,y:f[g].yLoc,ox:p[0],oy:p[1]})}};o(te,0,e.bottom,!0,1,[0,1]),o(U,0,e.top,!0,0,[0,-1]),o(Q,0,e.left,!1,0,[-1,0]),o($,0,e.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(i,e,t,n,o,s,a,l,c,h,p){var v,f=n.endpoints[a],g=f.id,y=[1,0][a],m={theta:e,order:t,c:n,b:o,elId:s,epId:g},_=i[c],C=f._continuousAnchorEdge?i[f._continuousAnchorEdge]:null;if(C){var P=Ce(C,function(S){return S.epId===g});if(P!==-1){C.splice(P,1);for(var b=0;b<C.length;b++)(v=C[b].c).placeholder!==!0&&h.add(v),p.add(C[b].c.endpoints[a]),p.add(C[b].c.endpoints[y])}}for(var x=0;x<_.length;x++)(v=_[x].c).placeholder!==!0&&h.add(v),p.add(_[x].c.endpoints[a]),p.add(_[x].c.endpoints[y]);var E=l?0:_.length;_.splice(E,0,m),f._continuousAnchorEdge=c}},{key:"_removeEndpointFromAnchorLists",value:function(i){var e=this.anchorLists.get(i.elementId),t=0;(function(n,o){if(n){var s=function(a){return a.epId===o};Z(n.top,s),Z(n.left,s),Z(n.bottom,s),Z(n.right,s),t+=n.top.length,t+=n.left.length,t+=n.bottom.length,t+=n.right.length}})(e,i.id),t===0&&this.anchorLists.delete(i.elementId),this.anchorLocations.delete(i._anchor.id)}},{key:"computeAnchorLocation",value:function(i,e){var t;return t=Ie(i)?this.anchorLocations.get(i.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:fr(i)?this._floatingAnchorCompute(i,e):this._defaultAnchorCompute(i,e),i.timestamp=e.timestamp,t}},{key:"computePath",value:function(i,e){var t=this.instance.viewport.getPosition(i.sourceId),n=this.instance.viewport.getPosition(i.targetId),o=i.endpoints[0],s=i.endpoints[1],a=this.getEndpointLocation(o,{xy:t,wh:t,element:o,timestamp:e,rotation:this.instance._getRotations(i.sourceId)}),l=this.getEndpointLocation(s,{xy:n,wh:n,element:s,timestamp:e,rotation:this.instance._getRotations(i.targetId)});i.connector.resetBounds(),i.connector.compute({sourcePos:a,targetPos:l,sourceEndpoint:i.endpoints[0],targetEndpoint:i.endpoints[1],strokeWidth:i.paintStyleInUse.strokeWidth,sourceInfo:t,targetInfo:n})}},{key:"getEndpointLocation",value:function(i,e){e=e||{};var t=i._anchor,n=this.anchorLocations.get(t.id);return(n==null||e.timestamp!=null&&t.timestamp!==e.timestamp)&&(n=this.computeAnchorLocation(t,e),this._setComputedPosition(t,n,e.timestamp)),n}},{key:"getEndpointOrientation",value:function(i){return i._anchor?this.getAnchorOrientation(i._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(i,e){var t=this.anchorLocations.get(i.id);t!=null&&(t.ox=e[0],t.oy=e[1])}},{key:"isDynamicAnchor",value:function(i){return!!i._anchor&&!Ie(i._anchor)&&i._anchor.locations.length>1}},{key:"isFloating",value:function(i){return!!i._anchor&&fr(i._anchor)}},{key:"prepareAnchor",value:function(i){return Gt(i)}},{key:"redraw",value:function(i,e,t){var n=this,o=new Set,s=new Set,a=new Set;if(!this.instance._suspendDrawing){var l=this.instance.endpointsByElement[i]||[];e=e||W();for(var c,h,p={},v=0;v<l.length;v++)if((h=l[v]).visible!==!1)if(s.add(h),c=h._anchor,h.connections.length===0)Ie(c)&&(this.anchorLists.has(i)||this.anchorLists.set(i,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(i),-Math.PI/2,0,{endpoints:[h,h],placeholder:!0},!1,i,0,!1,Ls(c),o,s),a.add(i));else for(var f=0;f<h.connections.length;f++){var g=h.connections[f],y=g.sourceId,m=g.targetId,_=Ie(g.endpoints[0]._anchor),C=Ie(g.endpoints[1]._anchor);if(_||C){var P=[y,(g.endpoints[0]._anchor.faces||[]).join("-"),m,(g.endpoints[1]._anchor.faces||[]).join("-")].join("-"),b=p[P],x=g.sourceId===i?1:0;_&&!this.anchorLists.has(y)&&this.anchorLists.set(y,{top:[],right:[],bottom:[],left:[]}),C&&!this.anchorLists.has(m)&&this.anchorLists.set(m,{top:[],right:[],bottom:[],left:[]});var E=this.instance.viewport.getPosition(m),S=this.instance.viewport.getPosition(y);if(m===y&&(_||C))this._updateAnchorList(this.anchorLists.get(y),-Math.PI/2,0,g,!1,m,0,!1,U,o,s),this._updateAnchorList(this.anchorLists.get(m),-Math.PI/2,0,g,!1,y,1,!1,U,o,s);else{var w=this.instance._getRotations(y),k=this.instance._getRotations(m);b||(b=this._calculateOrientation(y,m,S,E,g.endpoints[0]._anchor,g.endpoints[1]._anchor,w,k),p[P]=b),_&&this._updateAnchorList(this.anchorLists.get(y),b.theta,0,g,!1,m,0,!1,b.a[0],o,s),C&&this._updateAnchorList(this.anchorLists.get(m),b.theta2,-1,g,!0,y,1,!0,b.a[1],o,s)}_&&a.add(y),C&&a.add(m),o.add(g),(_&&x===0||C&&x===1)&&s.add(g.endpoints[x])}else{var I=h.connections[f].endpoints[g.sourceId===i?1:0];if(ea(I._anchor)){this.instance._paintEndpoint(I,{elementWithPrecedence:i,timestamp:e}),o.add(h.connections[f]);for(var T=0;T<I.connections.length;T++)I.connections[T]!==h.connections[f]&&o.add(I.connections[T])}else o.add(h.connections[f])}}a.forEach(function(L){n._placeAnchors(L,n.anchorLists.get(L))}),s.forEach(function(L){var N=n.instance.viewport.getPosition(L.elementId);n.instance._paintEndpoint(L,{timestamp:e,offset:N})}),o.forEach(function(L){n.instance._paintConnection(L,{timestamp:e})})}return{c:o,e:s}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(i,e){e!=null&&(i._anchor=e)}},{key:"setConnectionAnchors",value:function(i,e){i.endpoints[0]._anchor=e[0],i.endpoints[1]._anchor=e[1]}},{key:"_calculateOrientation",value:function(i,e,t,n,o,s,a,l){var c=this;if(i===e)return{orientation:"identity",a:[U,U]};var h=Math.atan2(n.c.y-t.c.y,n.c.x-t.c.x),p=Math.atan2(t.c.y-n.c.y,t.c.x-n.c.x),v=[],f={};(function(b,x){for(var E=0;E<b.length;E++){var S;if(f[b[E]]=(u(S={},Q,{x:x[E][0].x,y:x[E][0].c.y}),u(S,$,{x:x[E][0].x+x[E][0].w,y:x[E][0].c.y}),u(S,U,{x:x[E][0].c.x,y:x[E][0].y}),u(S,te,{x:x[E][0].c.x,y:x[E][0].y+x[E][0].h}),S),x[E][1]!=null&&x[E][1].length>0)for(var w in f[b[E]])f[b[E]][w]=c.instance._applyRotationsXY(f[b[E]][w],x[E][1])}})([Rn,Wi],[[t,a],[n,l]]);for(var g=[U,Q,$,te],y=0;y<g.length;y++)for(var m=0;m<g.length;m++)v.push({source:g[y],target:g[m],dist:ni(f.source[g[y]],f.target[g[m]])});v.sort(function(b,x){if(b.dist<x.dist)return-1;if(x.dist<b.dist)return 1;var E,S=(u(E={},Q,0),u(E,U,1),u(E,$,2),u(E,te,3),E),w=S[b.source],k=S[x.source],I=S[b.target],T=S[x.target];return w<k?-1:k<w?1:I<T?-1:T<I?1:0});for(var _=v[0].source,C=v[0].target,P=0;P<v.length&&(_=Ie(o)&&o.locked?o.currentFace:!o.isContinuous||No(o,v[P].source)?v[P].source:null,C=s.isContinuous&&s.locked?s.currentFace:!s.isContinuous||No(s,v[P].target)?v[P].target:null,_==null||C==null);P++);return o.isContinuous&&this.setCurrentFace(o,_),s.isContinuous&&this.setCurrentFace(s,C),{a:[_,C],theta:h,theta2:p}}},{key:"setCurrentFace",value:function(i,e,t){i.currentFace=e,t&&i.lockedFace!=null&&(i.lockedFace=i.currentFace)}},{key:"lock",value:function(i){i.locked=!0,Ie(i)&&(i.lockedFace=i.currentFace)}},{key:"unlock",value:function(i){i.locked=!1,Ie(i)&&(i.lockedFace=null)}},{key:"selectAnchorLocation",value:function(i,e){var t=Ce(i.locations,function(n){return n.x===e.x&&n.y===e.y});return t!==-1&&(i.currentLocation=t,!0)}},{key:"lockCurrentAxis",value:function(i){i.currentFace!=null&&(i.lockedAxis=i.currentFace===Q||i.currentFace===$?Is:Os)}},{key:"unlockCurrentAxis",value:function(i){i.lockedAxis=null}},{key:"anchorsEqual",value:function(i,e){if(!i||!e)return!1;var t=i.locations[i.currentLocation],n=e.locations[e.currentLocation];return t.x===n.x&&t.y===n.y&&t.offx===n.offx&&t.offy===n.offy&&t.ox===n.ox&&t.oy===n.oy}}]),r}(),yr={},na=function(r,i,e){var t=yr[i];if(t)return new t(r,e);throw{message:"jsPlumb: unknown connector type '"+i+"'"}},Pn=function(r,i){yr[r]=i},qe=function(){F(i,Kn);var r=H(i);function i(e){var t;return M(this,i),u(d(t=r.call(this,e)),"length",void 0),u(d(t),"m",void 0),u(d(t),"m2",void 0),u(d(t),"type",i.segmentType),t._setCoordinates({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),t}return D(i,[{key:"getPath",value:function(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=st({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function(e,t){if(e!==0||t){if(e!==1||t){var n=t?e>0?e:this.length+e:e*this.length;return Ue({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(e,t){return this.m}},{key:"pointAlongPathFrom",value:function(e,t,n){var o=this.pointOnPath(e,n),s=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),Ue(o,s,t)}},{key:"within",value:function(e,t,n){return n>=Math.min(e,t)&&n<=Math.max(e,t)}},{key:"closest",value:function(e,t,n){return Math.abs(n-e)<Math.abs(n-t)?e:t}},{key:"findClosestPointOnPath",value:function(e,t){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(this.m===0)n.y=this.y1,n.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var o=this.y1-this.m*this.x1,s=(t-this.m2*e-o)/(this.m-this.m2),a=this.m*s+o;n.x=this.within(this.x1,this.x2,s)?s:this.closest(this.x1,this.x2,s),n.y=this.within(this.y1,this.y2,a)?a:this.closest(this.y1,this.y2,a)}var l=ni({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=ni({x:e,y:t},n),n.l=l/length,n}},{key:"_pointLiesBetween",value:function(e,t,n){return n>t?t<=e&&e<=n:t>=e&&e>=n}},{key:"lineIntersection",value:function(e,t,n,o){var s=Math.abs(st({x:e,y:t},{x:n,y:o})),a=Math.abs(this.m),l=a===1/0?this.x1:this.y1-a*this.x1,c=[],h=s===1/0?e:t-s*e;if(s!==a)if(s===1/0&&a===0)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,o)&&c.push({x:e,y:this.y1});else if(s===0&&a===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,n)&&c.push({x:this.x1,y:t});else{var p,v;s===1/0?(p=e,this._pointLiesBetween(p,this.x1,this.x2)&&(v=a*e+l,this._pointLiesBetween(v,t,o)&&c.push({x:p,y:v}))):s===0?(v=t,this._pointLiesBetween(v,this.y1,this.y2)&&(p=(t-l)/a,this._pointLiesBetween(p,e,n)&&c.push({x:p,y:v}))):(v=a*(p=(h-l)/(a-s))+l,this._pointLiesBetween(p,this.x1,this.x2)&&this._pointLiesBetween(v,this.y1,this.y2)&&c.push({x:p,y:v}))}return c}},{key:"boxIntersection",value:function(e,t,n,o){var s=[];return s.push.apply(s,this.lineIntersection(e,t,e+n,t)),s.push.apply(s,this.lineIntersection(e+n,t,e+n,t+o)),s.push.apply(s,this.lineIntersection(e+n,t+o,e,t+o)),s.push.apply(s,this.lineIntersection(e,t+o,e,t)),s}}]),i}();u(qe,"segmentType","Straight");var Sn=function(){F(i,xn);var r=H(i);function i(){var e;M(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return u(d(e=r.call.apply(r,[this].concat(n))),"type",i.type),e}return D(i,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){this._addSegment(qe,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(qe,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(qe,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}},{key:"transformGeometry",value:function(e,t,n){return{source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}}]),i}();function Ze(r,i,e){var t=[],n=function(s){return z(s)?s:r.getId(s)};if(i)if(typeof i=="string"){if(i==="*")return i;t.push(i)}else{var o;e?t=i:i.length!=null?(o=t).push.apply(o,$e($e(i).map(n))):t.push(n(i))}return t}function wn(r,i,e){i!=null&&(i.connections.push(r),i.connections.length===1&&r.instance.addClass(r.source,r.instance.connectedClass)),e!=null&&(i!=null&&r.sourceId===r.targetId||(e.connections.push(r),e.connections.length===1&&r.instance.addClass(r.target,r.instance.connectedClass)))}function Mn(r,i,e){if(i!=null){var t=i.connections.length;Z(i.connections,function(o){return r.id===o.id}),t>0&&i.connections.length===0&&r.instance.removeClass(r.source,r.instance.connectedClass)}if(e!=null){var n=e.connections.length;i!=null&&r.sourceId===r.targetId||Z(e.connections,function(o){return r.id===o.id}),n>0&&e.connections.length===0&&r.instance.removeClass(r.target,r.instance.connectedClass)}}u(Sn,"type","Straight");var ia=function(){F(i,Lt);var r=H(i);function i(e,t){var n;return M(this,i),(n=r.call(this))._instanceIndex=e,u(d(n),"defaults",void 0),u(d(n),"_initialDefaults",{}),u(d(n),"isConnectionBeingDragged",!1),u(d(n),"currentlyDragging",!1),u(d(n),"hoverSuspended",!1),u(d(n),"_suspendDrawing",!1),u(d(n),"_suspendedAt",null),u(d(n),"connectorClass",Xn),u(d(n),"connectorOutlineClass","jtk-connector-outline"),u(d(n),"connectedClass","jtk-connected"),u(d(n),"endpointClass",nt),u(d(n),"endpointConnectedClass","jtk-endpoint-connected"),u(d(n),"endpointFullClass","jtk-endpoint-full"),u(d(n),"endpointFloatingClass",Yn),u(d(n),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),u(d(n),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),u(d(n),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),u(d(n),"overlayClass",nn),u(d(n),"connections",[]),u(d(n),"endpointsByElement",{}),u(d(n),"endpointsByUUID",new Map),u(d(n),"sourceSelectors",[]),u(d(n),"targetSelectors",[]),u(d(n),"allowNestedGroups",void 0),u(d(n),"_curIdStamp",1),u(d(n),"viewport",new $s(d(n))),u(d(n),"router",void 0),u(d(n),"groupManager",void 0),u(d(n),"_connectionTypes",new Map),u(d(n),"_endpointTypes",new Map),u(d(n),"_container",void 0),u(d(n),"_managedElements",{}),u(d(n),"DEFAULT_SCOPE",void 0),u(d(n),"_zoom",1),n.defaults={anchor:he.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:Sn.type,container:null,endpoint:vt.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},t&&A(n.defaults,t),A(n._initialDefaults,n.defaults),n._initialDefaults[pt]!=null&&(n._initialDefaults[pt].strokeWidth=n._initialDefaults[pt].strokeWidth||2),n.DEFAULT_SCOPE=n.defaults.scope,n.allowNestedGroups=n._initialDefaults.allowNestedGroups!==!1,n.router=new ta(d(n)),n.groupManager=new qs(d(n)),n.setContainer(n._initialDefaults.container),n}return D(i,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(e){return e!=null&&e[0]!=null&&e[1]!=null}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(e,t){return this._zoom=e,this.fire(so,this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var n=this.getListener(e),o=!0;if(n&&n.length>0){var s=Array.prototype.slice.call(arguments,1);try{for(var a=0,l=n.length;a<l;a++)o=o&&n[a].apply(n[a],s)}catch(c){q("cannot check condition ["+e+"]"+c)}}return o}},{key:"getId",value:function(e,t){if(e==null)return null;var n=this.getAttribute(e,Ee);return n&&n!=="undefined"||(arguments.length===2&&arguments[1]!==void 0?n=t:(arguments.length===1||arguments.length===3&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,Ee,n)),n}},{key:"getConnections",value:function(e,t){e?e.constructor===String&&(e={scope:e}):e={};for(var n=Ze(this,e.scope||this.defaultScope,!0),o=Ze(this,e.source),s=Ze(this,e.target),a=!t&&n.length>1?{}:[],l=function(g,y){if(!t&&n.length>1){var m=a[g];m==null&&(m=a[g]=[]),m.push(y)}else a.push(y)},c=0,h=this.connections.length;c<h;c++){var p=this.connections[c],v=p.proxies&&p.proxies[0]?p.proxies[0].originalEp.elementId:p.sourceId,f=p.proxies&&p.proxies[1]?p.proxies[1].originalEp.elementId:p.targetId;Le(n,p.scope)&&Le(o,v)&&Le(s,f)&&l(p.scope,p)}return a}},{key:"select",value:function(e){return(e=e||{}).scope=e.scope||"*",new Js(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function(e){(e=e||{}).scope=e.scope||ze;var t=!e.element&&!e.source&&!e.target,n=t?ze:Ze(this,e.element),o=t?ze:Ze(this,e.source),s=t?ze:Ze(this,e.target),a=Ze(this,e.scope,!0),l=[];for(var c in this.endpointsByElement){var h=Le(n,c,!0),p=Le(o,c,!0),v=o!=="*",f=Le(s,c,!0),g=s!=="*";if(h||p||f)e:for(var y=0,m=this.endpointsByElement[c].length;y<m;y++){var _=this.endpointsByElement[c][y];if(Le(a,_.scope,!0)){var C=v&&o.length>0&&!_.isSource,P=g&&s.length>0&&!_.isTarget;if(C||P)continue e;l.push(_)}}}return new Zs(this,l)}},{key:"setContainer",value:function(e){this._container=e,this.fire("container:change",this._container)}},{key:"_set",value:function(e,t,n){var o,s,a=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],l=e[a.elId],c=e.endpoints[n],h={index:n,originalEndpoint:c,originalSourceId:n===0?l:e.sourceId,newSourceId:e.sourceId,originalTargetId:n===1?l:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:c};return t instanceof ht?(o=t).addConnection(e):o=(s=this.getId(t))===e[a.elId]?null:e.makeEndpoint(n===0,t,s),o!=null&&(h.newEndpoint=o,c.detachFromConnection(e),e.endpoints[n]=o,e[a.el]=o.element,e[a.elId]=o.elementId,h[n===0?"newSourceId":"newTargetId"]=o.elementId,this.fireMoveEvent(h),this._paintConnection(e)),h}},{key:"setSource",value:function(e,t){Mn(e,this._managedElements[e.sourceId]);var n=this._set(e,t,0);wn(e,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(e,t){Mn(e,this._managedElements[e.targetId]);var n=this._set(e,t,1);wn(e,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function(e,t,n){e.setType(t,n),this._paintConnection(e)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(e,t){var n=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+new Date().getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(e,t){var n=this._suspendDrawing===!0;n||this.setSuspendDrawing(!0),e(),n||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function(e,t){if(e!=null){if(e.length!=null)for(var n=0;n<e.length;n++)t(e[n]);else t(e);return this}}},{key:"updateOffset",value:function(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function(e,t){if(e!=null&&e.deleted!==!0&&((t=t||{}).force||Fi(!0,!1,[[e.endpoints[0],it,[e]],[e.endpoints[1],it,[e]],[e,it,[e]],[this,$i,[lo,e]]]))){Mn(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&t.fireEvent!==!1,t.originalEvent);var n=e.endpoints[0],o=e.endpoints[1];return n!==t.endpointToIgnore&&n.detachFromConnection(e,null,!0),o!==t.endpointToIgnore&&o.detachFromConnection(e,null,!0),Z(this.connections,function(s){return e.id===s.id}),e.destroy(),n!==t.endpointToIgnore&&n.deleteOnEmpty&&n.connections.length===0&&this.deleteEndpoint(n),o!==t.endpointToIgnore&&o.deleteOnEmpty&&o.connections.length===0&&this.deleteEndpoint(o),!0}return!1}},{key:"deleteEveryConnection",value:function(e){var t=this;e=e||{};var n=this.connections.length,o=0;return this.batch(function(){for(var s=0;s<n;s++)o+=t.deleteConnection(t.connections[0],e)?1:0}),o}},{key:"deleteConnectionsForElement",value:function(e,t){var n=this.getId(e),o=this._managedElements[n];if(o)for(var s=o.connections.length,a=0;a<s;a++)this.deleteConnection(o.connections[0],t);return this}},{key:"fireDetachEvent",value:function(e,t,n){var o=e.id!=null?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire("connection:detach",o,n),this.fire(zn,o,n)}},{key:"fireMoveEvent",value:function(e,t){this.fire(to,e,t)}},{key:"manageAll",value:function(e,t){for(var n=z(e)?this.getSelector(this.getContainer(),e):e,o=0;o<n.length;o++)this.manage(n[o],null,t)}},{key:"manage",value:function(e,t,n){this.getAttribute(e,Ee)==null&&(t=t||this.getAttribute(e,"id")||W(),this.setAttribute(e,Ee,t));var o=this.getId(e);if(this._managedElements[o])n&&(this._managedElements[o].viewportElement=this.updateOffset({elId:o,timestamp:null,recalc:!0}));else{var s={el:e,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[o]=s,this._suspendDrawing?s.viewportElement=this.viewport.registerElement(o,!0):s.viewportElement=this.updateOffset({elId:o,recalc:!0}),this.fire(io,{el:e})}return this._managedElements[o]}},{key:"getManagedData",value:function(e,t,n){if(this._managedElements[e]){var o=this._managedElements[e].data[t];return o!=null?o[n]:null}}},{key:"setManagedData",value:function(e,t,n,o){this._managedElements[e]&&(this._managedElements[e].data[t]=this._managedElements[e].data[t]||{},this._managedElements[e].data[t][n]=o)}},{key:"getManagedElement",value:function(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function(e,t){var n=this;this.removeAllEndpoints(e,!0);var o=function(s){var a=n.getId(s);n.removeAttribute(s,Ee),delete n._managedElements[a],n.viewport.remove(a),n.fire(ro,{el:s,id:a}),s&&t&&n._removeElement(s)};this._getAssociatedElements(e).map(o),o(e)}},{key:"rotate",value:function(e,t,n){var o=this.getId(e);return this._managedElements[o]&&(this._managedElements[o].rotation=t,this.viewport.rotateElement(o,t),n!==!0)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(e){var t=this._managedElements[e];return t!=null&&t.rotation||0}},{key:"_getRotations",value:function(e){var t=this,n=[],o=this._managedElements[e];return o!=null&&(n.push({r:o.viewportElement.r||0,c:o.viewportElement.c}),function s(a){if(a.group!=null){var l=t._managedElements[a.group];l!=null&&(n.push({r:l.viewportElement.r,c:l.viewportElement.c}),s(l))}}(o)),n}},{key:"_applyRotations",value:function(e,t){var n=e.slice(),o={x:n[0],y:n[1],cr:0,sr:0};return j(t,function(s){o=Zt(o,s.c,s.r)}),o}},{key:"_applyRotationsXY",value:function(e,t){return j(t,function(n){e=Zt(e,n.c,n.r)}),e}},{key:"_internal_newEndpoint",value:function(e){var t=A({},e),n=this.manage(t.element);t.elementId=this.getId(t.element),t.id="ep_"+this._idstamp();var o=new ht(this,t);return function(s,a){s!=null&&s.endpoints.push(a)}(n,o),e.uuid&&this.endpointsByUUID.set(e.uuid,o),Ri(this.endpointsByElement,o.elementId,o),this._suspendDrawing||this._paintEndpoint(o,{timestamp:this._suspendedAt}),o}},{key:"_deriveEndpointAndAnchorSpec",value:function(e,t){for(var n=((t?"":"default ")+e).split(/[\s]/),o=null,s=null,a=null,l=null,c=0;c<n.length;c++){var h=this.getConnectionType(n[c]);h&&(h.endpoints&&(o=h.endpoints),h.endpoint&&(s=h.endpoint),h.anchors&&(l=h.anchors),h.anchor&&(a=h.anchor))}return{endpoints:o||[s,s],anchors:l||[a,a]}}},{key:"revalidate",value:function(e,t){var n=this.getId(e);return this.updateOffset({elId:n,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function(){var e,t=W();for(e in this._managedElements)this.viewport.refreshElement(e,!0);for(e in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[e].el,t,!0);return this}},{key:"setElementPosition",value:function(e,t,n){var o=this.getId(e);return this.viewport.setPosition(o,t,n),this.repaint(e)}},{key:"repaint",value:function(e,t,n){var o={c:new Set,e:new Set},s=function(p){p.c.forEach(function(v){return o.c.add(v)}),p.e.forEach(function(v){return o.e.add(v)})};if(!this._suspendDrawing){var a=this.getId(e);if(e!=null){var l=this._getAssociatedElements(e);if(t==null&&(t=W()),!n)for(var c=0;c<l.length;c++)this.updateOffset({elId:this.getId(l[c]),recalc:!0,timestamp:t});if(s(this.router.redraw(a,t,null)),l.length>0)for(var h=0;h<l.length;h++)s(this.router.redraw(this.getId(l[h]),t,null))}}return o}},{key:"unregisterEndpoint",value:function(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),function(o,s){o!=null&&Z(o.endpoints,function(a){return a===s})}(this._managedElements[e.elementId],e);var n=this.endpointsByElement[e.elementId];n!=null&&(this.endpointsByElement[e.elementId]=n.filter(function(o){return o!==e})),this.fire(no,e)}},{key:"_maybePruneEndpoint",value:function(e){return!(!e.deleteOnEmpty||e.connections.length!==0)&&(this.deleteEndpoint(e),!0)}},{key:"deleteEndpoint",value:function(e){var t=this,n=typeof e=="string"?this.endpointsByUUID.get(e):e;if(n){var o=n.proxiedBy,s=n.connections.slice();j(s,function(a){n.detachFromConnection(a,null,!0)}),this.unregisterEndpoint(n),n.destroy(),j(s,function(a){t.deleteConnection(a,{force:!0,endpointToIgnore:n})}),o!=null&&this.deleteEndpoint(o)}return this}},{key:"addEndpoint",value:function(e,t,n){var o=A({},n=n||{});A(o,t||{});var s=A({element:e},o);return this._internal_newEndpoint(s)}},{key:"addEndpoints",value:function(e,t,n){for(var o=[],s=0,a=t.length;s<a;s++)o.push(this.addEndpoint(e,t[s],n));return o}},{key:"reset",value:function(){var e=this;this.silently(function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0})}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function(e,t){try{var n=this._prepareConnectionParams(e,t),o=this._newConnection(n);return this._finaliseConnection(o,n),o}catch(s){return void q(s)}}},{key:"_prepareConnectionParams",value:function(e,t){var n=A({},e);t&&A(n,t);var o=n;if(o.source&&o.source.endpoint&&(o.sourceEndpoint=o.source),o.target&&o.target.endpoint&&(o.targetEndpoint=o.target),e.uuids&&(o.sourceEndpoint=this.getEndpoint(e.uuids[0]),o.targetEndpoint=this.getEndpoint(e.uuids[1])),o.sourceEndpoint!=null){if(o.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(o.type||(o.type=o.sourceEndpoint.edgeType),o.sourceEndpoint.connectorOverlays){o.overlays=o.overlays||[];for(var s=0,a=o.sourceEndpoint.connectorOverlays.length;s<a;s++)o.overlays.push(o.sourceEndpoint.connectorOverlays[s])}o.sourceEndpoint.scope&&(o.scope=o.sourceEndpoint.scope)}else if(o.source==null)throw"Cannot establish connection: source does not exist";if(o.targetEndpoint!=null){if(o.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(o.target==null)throw"Cannot establish connection: target does not exist";if(o.sourceEndpoint&&o.targetEndpoint&&!function(l,c){for(var h=l.scope.split(/\s/),p=c.scope.split(/\s/),v=0;v<h.length;v++)for(var f=0;f<p.length;f++)if(p[f]===h[v])return!0;return!1}(o.sourceEndpoint,o.targetEndpoint))throw"Cannot establish connection: scopes do not match";return o}},{key:"_newConnection",value:function(e){e.id="con_"+this._idstamp();var t=new Nt(this,e);return wn(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function(e,t,n){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var o={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(eo,o,n),t.doNotFireConnectionEvent||t.fireEvent===!1||this.fire(Qi,o,n)}},{key:"removeAllEndpoints",value:function(e,t){var n=this,o=function(s){var a,l,c=n.getId(s),h=n.endpointsByElement[c];if(h)for(a=0,l=h.length;a<l;a++)n.deleteEndpoint(h[a]);delete n.endpointsByElement[c]};return t&&this._getAssociatedElements(e).map(o),o(e),this}},{key:"_createSourceDefinition",value:function(e,t){var n=A({},t);A(n,e),n.edgeType=n.edgeType||un;var o=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||o.endpoints[0],n.anchor=n.anchor||o.anchors[0];var s=n.maxConnections||-1;return{def:A({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:s,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=this._createSourceDefinition(t),s=new Zo(e,o,n);return this.sourceSelectors.push(s),s}},{key:"removeSourceSelector",value:function(e){Z(this.sourceSelectors,function(t){return t===e})}},{key:"removeTargetSelector",value:function(e){Z(this.targetSelectors,function(t){return t===e})}},{key:"addTargetSelector",value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=this._createTargetDefinition(t),s=new Zo(e,o,n);return this.targetSelectors.push(s),s}},{key:"_createTargetDefinition",value:function(e,t){var n=A({},t);A(n,e),n.edgeType=n.edgeType||un;var o=n.maxConnections||-1;return{def:A({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"show",value:function(e,t){return this._setVisible(e,Bn,t)}},{key:"hide",value:function(e,t){return this._setVisible(e,tt,t)}},{key:"_setVisible",value:function(e,t,n){var o=t===Bn,s=null;n&&(s=function(l){l.setVisible(o,!0,!0)});var a=this.getId(e);return this._operation(e,function(l){if(o&&n){var c=l.sourceId===a?1:0;l.endpoints[c].isVisible()&&l.setVisible(!0)}else l.setVisible(o)},s),this}},{key:"toggleVisible",value:function(e,t){var n=null;t&&(n=function(o){var s=o.isVisible();o.setVisible(!s)}),this._operation(e,function(o){var s=o.isVisible();o.setVisible(!s)},n)}},{key:"_operation",value:function(e,t,n){var o=this.getId(e),s=this.endpointsByElement[o];if(s&&s.length)for(var a=0,l=s.length;a<l;a++){for(var c=0,h=s[a].connections.length;c<h;c++)if(t(s[a].connections[c]))return;n&&n(s[a])}}},{key:"registerConnectionType",value:function(e,t){if(this._connectionTypes.set(e,A({},t)),t.overlays){for(var n={},o=0;o<t.overlays.length;o++){var s=pi(t.overlays[o]);n[s.options.id]=s}this._connectionTypes.get(e).overlays=n}}},{key:"registerConnectionTypes",value:function(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function(e,t){if(this._endpointTypes.set(e,A({},t)),t.overlays){for(var n={},o=0;o<t.overlays.length;o++){var s=pi(t.overlays[o]);n[s.options.id]=s}this._endpointTypes.get(e).overlays=n}}},{key:"registerEndpointTypes",value:function(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function(e,t){return t==="connection"?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function(e){for(var t in e)this.defaults[t]=e[t];return this.defaults[pt]!=null&&(this.defaults[pt].strokeWidth=this.defaults[pt].strokeWidth||2),e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=A({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(e,t,n,o,s){var a,l=e.proxies[t]!=null,c=l?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,h=l?e.proxies[t].originalEp:e.endpoints[t],p=this.getId(n);e.proxies[t]?e.proxies[t].ep.elementId===p?a=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),a=this._internal_newEndpoint({element:n,endpoint:o(e,t),anchor:s(e,t),parameters:{isProxyEndpoint:!0}})):a=this._internal_newEndpoint({element:n,endpoint:o(e,t),anchor:s(e,t),parameters:{isProxyEndpoint:!0}}),a.deleteOnEmpty=!0,e.proxies[t]={ep:a,originalEp:h},this.sourceOrTargetChanged(c,p,e,n,t),h.detachFromConnection(e,null,!0),a.connections=[e],e.endpoints[t]=a,h.proxiedBy=a,h.setVisible(!1),e.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(e,t){if(e.proxies!=null&&e.proxies[t]!=null){var n=e.proxies[t].originalEp.element,o=e.proxies[t].originalEp.elementId,s=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(s,o,e,n,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,Ce(e.proxies,function(a){return a!=null})===-1&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(e,t,n,o,s){e!==t&&(s===0?(n.sourceId=t,n.source=o):s===1&&(n.targetId=t,n.target=o),Mn(n,this._managedElements[e]),wn(n,this._managedElements[t]))}},{key:"getGroup",value:function(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(o))}},{key:"collapseGroup",value:function(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function(e,t,n,o){return this.groupManager.removeGroup(e,t,n,o)}},{key:"removeAllGroups",value:function(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function(e,t,n){this.groupManager.removeFromGroup(e,n,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"_paintEndpoint",value:function(e,t){var n=(t=t||{}).timestamp,o=t.recalc!==!1;if(!n||e.timestamp!==n){var s=this.viewport.getPosition(e.elementId),a=t.offset?{x:t.offset.x,y:t.offset.y}:{x:s.x,y:s.y};if(a!=null){var l=t.anchorLoc;if(l==null){var c={xy:a,wh:s,element:e,timestamp:n};if(o&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var h=function(m){var _=0;if(t.elementWithPrecedence!=null){for(var C=0;C<m.connections.length;C++)if(m.connections[C].sourceId===t.elementWithPrecedence||m.connections[C].targetId===t.elementWithPrecedence){_=C;break}}return m.connections[_]}(e),p=h.endpoints[0]===e?1:0,v=p===0?h.sourceId:h.targetId,f=this.viewport.getPosition(v);c.index=p===0?1:0,c.connection=h,c.txy=f,c.twh=f,c.tElement=h.endpoints[p],c.tRotation=this._getRotations(v)}else e.connections.length>0&&(c.connection=e.connections[0]);c.rotation=this._getRotations(e.elementId),l=this.router.computeAnchorLocation(e._anchor,c)}for(var g in e.endpoint.compute(l,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=n,e.overlays)if(e.overlays.hasOwnProperty(g)){var y=e.overlays[g];y.isVisible()&&(e.overlayPlacements[g]=this.drawOverlay(y,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(y)),this._paintOverlay(y,e.overlayPlacements[g],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(e,t){if(!this._suspendDrawing&&e.visible!==!1){var n=(t=t||{}).timestamp;if(n!=null&&n===e.lastPaintedAt)return;if(n==null||n!==e.lastPaintedAt){this.router.computePath(e,n);var o={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var s in e.overlays)if(e.overlays.hasOwnProperty(s)){var a=e.overlays[s];a.isVisible()&&(e.overlayPlacements[s]=this.drawOverlay(a,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(a)),o.xmin=Math.min(o.xmin,e.overlayPlacements[s].xmin),o.xmax=Math.max(o.xmax,e.overlayPlacements[s].xmax),o.ymin=Math.min(o.ymin,e.overlayPlacements[s].ymin),o.ymax=Math.max(o.ymax,e.overlayPlacements[s].ymax))}var l=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,c=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),h={xmin:Math.min(e.connector.bounds.xmin-(l+c),o.xmin),ymin:Math.min(e.connector.bounds.ymin-(l+c),o.ymin),xmax:Math.max(e.connector.bounds.xmax+(l+c),o.xmax),ymax:Math.max(e.connector.bounds.ymax+(l+c),o.ymax)};for(var p in this.paintConnector(e.connector,e.paintStyleInUse,h),e.overlays)if(e.overlays.hasOwnProperty(p)){var v=e.overlays[p];v.isVisible()&&this._paintOverlay(v,e.overlayPlacements[p],h)}}e.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(e){e._anchor.isFloating||(e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass))}},{key:"_makeConnector",value:function(e,t,n){return na(e,t,n)}},{key:"addOverlay",value:function(e,t,n){if(e.addOverlay(t),!n){var o=e instanceof ht?e.element:e.source;this.revalidate(o)}}},{key:"removeOverlay",value:function(e,t){e.removeOverlay(t);var n=e instanceof ht?e.element:e.source;this.revalidate(n)}},{key:"setOutlineColor",value:function(e,t){e.paintStyleInUse.outlineStroke=t,this._paintConnection(e)}},{key:"setOutlineWidth",value:function(e,t){e.paintStyleInUse.outlineWidth=t,this._paintConnection(e)}},{key:"setColor",value:function(e,t){e.paintStyleInUse.stroke=t,this._paintConnection(e)}},{key:"setLineWidth",value:function(e,t){e.paintStyleInUse.strokeWidth=t,this._paintConnection(e)}},{key:"setLineStyle",value:function(e,t){t.lineWidth!=null&&(e.paintStyleInUse.strokeWidth=t.lineWidth),t.outlineWidth!=null&&(e.paintStyleInUse.outlineWidth=t.outlineWidth),t.color!=null&&(e.paintStyleInUse.stroke=t.color),t.outlineColor!=null&&(e.paintStyleInUse.outlineStroke=t.outlineColor),this._paintConnection(e)}},{key:"getPathData",value:function(e){for(var t="",n=0;n<e.segments.length;n++)t+=e.segments[n].getPath(n===0),t+=" ";return t}}]),i}(),mr={};function ki(r,i){mr[r]=i}function _r(r,i,e){var t=i,n=mt(i.getBoundingClientRect)!==xo?i.getBoundingClientRect():{left:0,top:0,width:0,height:0},o=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||o.scrollTop,l=window.pageXOffset||s.scrollLeft||o.scrollLeft,c=s.clientTop||o.clientTop||0,h=s.clientLeft||o.clientLeft||0,p=n.top+a-c+0*e,v=n.left+l-h+0*e,f=hn(r),g=n.width||t.offsetWidth*e,y=n.height||t.offsetHeight*e;return{x:(f.x-v)/g,y:(f.y-p)/y}}function ft(r){return gi(r)||yi(r)||_i(r)}function xr(r,i){r.canvas&&(r.canvas.style.display=i?"block":"none")}function kr(r){r.canvas&&r.canvas.parentNode.removeChild(r.canvas),delete r.canvas}function Xt(r){return r.canvas}function ve(r){return di.getElement(r)}function Je(r){return di.getElement(r,r.component,function(i){var e=r.create(i);return r.instance.addClass(e,r.instance.overlayClass),e})}function oa(r,i,e,t){var n=r.x,o=r.y;return i._jsPlumbParentGroup&&i._jsPlumbParentGroup.constrain&&(n=Math.max(r.x,0),o=Math.max(r.y,0),n=Math.min(n,e.w-t.w),o=Math.min(o,e.h-t.h)),{x:n,y:o}}var ra=function(){F(i,ia);var r=H(i);function i(e,t){var n;if(M(this,i),(n=r.call(this,e,t))._instanceIndex=e,u(d(n),"containerType",null),u(d(n),"dragSelection",void 0),u(d(n),"dragManager",void 0),u(d(n),"_connectorClick",void 0),u(d(n),"_connectorDblClick",void 0),u(d(n),"_connectorTap",void 0),u(d(n),"_connectorDblTap",void 0),u(d(n),"_endpointClick",void 0),u(d(n),"_endpointDblClick",void 0),u(d(n),"_overlayClick",void 0),u(d(n),"_overlayDblClick",void 0),u(d(n),"_overlayTap",void 0),u(d(n),"_overlayDblTap",void 0),u(d(n),"_connectorMouseover",void 0),u(d(n),"_connectorMouseout",void 0),u(d(n),"_endpointMouseover",void 0),u(d(n),"_endpointMouseout",void 0),u(d(n),"_connectorContextmenu",void 0),u(d(n),"_connectorMousedown",void 0),u(d(n),"_connectorMouseup",void 0),u(d(n),"_endpointMousedown",void 0),u(d(n),"_endpointMouseup",void 0),u(d(n),"_overlayMouseover",void 0),u(d(n),"_overlayMouseout",void 0),u(d(n),"_elementClick",void 0),u(d(n),"_elementTap",void 0),u(d(n),"_elementDblTap",void 0),u(d(n),"_elementMouseenter",void 0),u(d(n),"_elementMouseexit",void 0),u(d(n),"_elementMousemove",void 0),u(d(n),"_elementMouseup",void 0),u(d(n),"_elementMousedown",void 0),u(d(n),"_elementContextmenu",void 0),u(d(n),"_resizeObserver",void 0),u(d(n),"eventManager",void 0),u(d(n),"draggingClass","jtk-dragging"),u(d(n),"elementDraggingClass","jtk-element-dragging"),u(d(n),"hoverClass","jtk-hover"),u(d(n),"sourceElementDraggingClass","jtk-source-element-dragging"),u(d(n),"targetElementDraggingClass","jtk-target-element-dragging"),u(d(n),"hoverSourceClass","jtk-source-hover"),u(d(n),"hoverTargetClass","jtk-target-hover"),u(d(n),"dragSelectClass","jtk-drag-select"),u(d(n),"managedElementsSelector",void 0),u(d(n),"elementsDraggable",void 0),u(d(n),"elementDragHandler",void 0),u(d(n),"groupDragOptions",void 0),u(d(n),"elementDragOptions",void 0),u(d(n),"svg",{node:function(o,s){return _e(o,s)},attr:function(o,s){return me(o,s)},pos:function(o){return po(o)}}),t=t||{},n.containerType=Nn(n.getContainer()),n.elementsDraggable=t&&t.elementsDraggable!==!1,n.managedElementsSelector=t&&t.managedElementsSelector||Y,n.eventManager=new ti,n.dragSelection=new Ds(d(n)),n.dragManager=new Ts(d(n),n.dragSelection),n.dragManager.addHandler(new $o(d(n))),n.groupDragOptions={constrainFunction:oa},n.dragManager.addHandler(new Qo(d(n),n.dragSelection),n.groupDragOptions),n.elementDragHandler=new ci(d(n),n.dragSelection),n.elementDragOptions=t&&t.dragOptions||{},n.dragManager.addHandler(n.elementDragHandler,n.elementDragOptions),t&&t.dragOptions&&t.dragOptions.filter&&n.dragManager.addFilter(t.dragOptions.filter),n._createEventListeners(),n._attachEventDelegates(),t.resizeObserver!==!1)try{n._resizeObserver=new ResizeObserver(function(o){o.filter(function(s){var a=n.getAttribute(s.target,Ee);if(a!=null){var l=n.viewport._elementMap.get(a);return!!l&&(l.w!==s.contentRect.width||l.h!==s.contentRect.height)}return!1}).forEach(function(s){return n.revalidate(s.target)})})}catch{q("WARN: ResizeObserver could not be attached.")}return n}return D(i,[{key:"fireOverlayMethod",value:function(e,t,n){var o=R(e.component instanceof Nt?pe:Xe,t);n._jsPlumbOverlay=e,e.fire(t,{e:n,overlay:e}),this.fire(o,e.component,n)}},{key:"addDragFilter",value:function(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"setDragConstrainFunction",value:function(e){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:e})}},{key:"_removeElement",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function(e,t){t&&t.appendChild(e)}},{key:"_appendElementToGroup",value:function(e,t){this.getGroupContentArea(e).appendChild(t)}},{key:"_appendElementToContainer",value:function(e){this._appendElement(e,this.getContainer())}},{key:"_getAssociatedElements",value:function(e){var t=[];if(e.nodeType!==3&&e.nodeType!==8){var n=e.querySelectorAll(Y);Array.prototype.push.apply(t,n)}return t.filter(function(o){return o.nodeType!==3&&o.nodeType!==8})}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getClass",value:function(e){return function(t){return Fn(t)}(e)}},{key:"addClass",value:function(e,t){Re(e,t)}},{key:"hasClass",value:function(e,t){return function(n,o){return n.classList?n.classList.contains(o):Fn(n).indexOf(o)!==-1}(e,t)}},{key:"removeClass",value:function(e,t){Hn(e,t)}},{key:"toggleClass",value:function(e,t){(function(n,o){var s=this,a=function(l,c){l!=null&&c!=null&&c.length>0&&(l.classList?l.classList.toggle(c):s.hasClass(l,c)?s.removeClass(l,c):s.addClass(l,c))};bt(n)?j(n,function(l){return a(l,o)}):a(n,o)})(e,t)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"removeAttribute",value:function(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function(e,t,n,o){var s=this,a=function(l){o==null?s.eventManager.on(l,t,n):s.eventManager.on(l,t,n,o)};return bt(e)?j(e,function(l){return a(l)}):a(e),this}},{key:"off",value:function(e,t,n){var o=this;return bt(e)?j(e,function(s){return o.eventManager.off(s,t,n)}):this.eventManager.off(e,t,n),this}},{key:"trigger",value:function(e,t,n,o,s){this.eventManager.trigger(e,t,n,o,s)}},{key:"getOffsetRelativeToRoot",value:function(e){return et(e)}},{key:"getOffset",value:function(e){for(var t,n=e,o=this.getContainer(),s=this.getPosition(n),a=e!==o&&n.offsetParent!==o?n.offsetParent:null;a!=null;)s.x+=a.offsetLeft,s.y+=a.offsetTop,(t=a)!=null&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(s.x-=t.scrollLeft,s.y-=t.scrollTop),a=a.offsetParent===o?null:a.offsetParent;if(o!=null&&(o.scrollTop>0||o.scrollLeft>0)){var l=n.offsetParent!=null?this.getStyle(n.offsetParent,_o):"static",c=this.getStyle(n,_o);c!==Et&&c!==qi&&l!==Et&&l!==qi&&(s.x-=o.scrollLeft,s.y-=o.scrollTop)}return s}},{key:"getSize",value:function(e){var t=e;return t.offsetWidth!=null?function(n){return{w:n.offsetWidth,h:n.offsetHeight}}(e):t.width&&t.width.baseVal?function(n){try{return{w:parseFloat(n.width.baseVal.value),h:parseFloat(n.height.baseVal.value)}}catch{return{w:0,h:0}}}(t):void 0}},{key:"getPosition",value:function(e){var t=e;return t.offsetLeft!=null?{x:parseFloat(t.offsetLeft),y:parseFloat(t.offsetTop)}:t.x&&t.x.baseVal?function(n){try{return{x:parseFloat(n.x.baseVal.value),y:parseFloat(n.y.baseVal.value)}}catch{return{x:0,y:0}}}(t):void 0}},{key:"getStyle",value:function(e,t){return mt(window.getComputedStyle)!==xo?getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]}},{key:"getGroupContentArea",value:function(e){var t=this.getSelector(e.el,hs);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function(e,t){var n=null;if(arguments.length===1){if(!z(e)){var o=document.createDocumentFragment();return o.appendChild(e),qt(o.childNodes)}n=qt(document.querySelectorAll(e))}else n=qt(e.querySelectorAll(t));return n}},{key:"setPosition",value:function(e,t){var n=e;n.style.left=t.x+"px",n.style.top=t.y+"px"}},{key:"setDraggable",value:function(e,t){t?this.removeAttribute(e,en):this.setAttribute(e,en,ko)}},{key:"isDraggable",value:function(e){var t=this.getAttribute(e,en);return t==null||t===ot}},{key:"toggleDraggable",value:function(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_createEventListeners",value:function(){var e=function(p,v){if(!v.defaultPrevented&&v._jsPlumbOverlay==null){var f=ye(ne(v),ue,this.getContainer(),!0);this.fire(p,f.jtk.connector.connection,v)}};this._connectorClick=e.bind(this,ts),this._connectorDblClick=e.bind(this,ns),this._connectorTap=e.bind(this,us),this._connectorDblTap=e.bind(this,is);var t=function(p,v){var f=ne(v).parentNode;if(f.jtk&&f.jtk.connector){var g=f.jtk.connector,y=g.connection;this.setConnectorHover(g,p),p?(this.addClass(y.source,this.hoverSourceClass),this.addClass(y.target,this.hoverTargetClass)):(this.removeClass(y.source,this.hoverSourceClass),this.removeClass(y.target,this.hoverTargetClass)),this.fire(p?rs:os,f.jtk.connector.connection,v)}};this._connectorMouseover=t.bind(this,!0),this._connectorMouseout=t.bind(this,!1);var n=function(p,v){var f=ne(v).parentNode;f.jtk&&f.jtk.connector&&this.fire(p?ss:as,f.jtk.connector.connection,v)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=(function(p){var v=ne(p).parentNode;v.jtk&&v.jtk.connector&&this.fire(ls,v.jtk.connector.connection,p)}).bind(this);var o=function(p,v,f){v.defaultPrevented||v._jsPlumbOverlay!=null||this.fire(p,f.jtk.endpoint,v)};this._endpointClick=o.bind(this,Zr),this._endpointDblClick=o.bind(this,Jr);var s=function(p,v){var f=ne(v);f.jtk&&f.jtk.endpoint&&(this.setEndpointHover(f.jtk.endpoint,p),this.fire(p?$r:Kr,f.jtk.endpoint,v))};this._endpointMouseover=s.bind(this,!0),this._endpointMouseout=s.bind(this,!1);var a=function(p,v){var f=ne(v);f.jtk&&f.jtk.endpoint&&this.fire(p?Qr:es,f.jtk.endpoint,v)};this._endpointMouseup=a.bind(this,!0),this._endpointMousedown=a.bind(this,!1);var l=(function(p,v){var f=ye(ne(v),ke,this.getContainer(),!0).jtk.overlay;f&&this.fireOverlayMethod(f,p,v)}).bind(this);this._overlayClick=l.bind(this,ee),this._overlayDblClick=l.bind(this,ie),this._overlayTap=l.bind(this,le),this._overlayDblTap=l.bind(this,ae);var c=function(p,v){var f=ye(ne(v),ke,this.getContainer(),!0).jtk.overlay;f&&this.setOverlayHover(f,p)};this._overlayMouseover=c.bind(this,!0),this._overlayMouseout=c.bind(this,!1),this._elementClick=(function(p,v,f){v.defaultPrevented||this.fire(v.detail===1?go:Xr,f,v)}).bind(this,go),this._elementTap=(function(p,v,f){v.defaultPrevented||this.fire(mo,f,v)}).bind(this,mo),this._elementDblTap=(function(p,v,f){v.defaultPrevented||this.fire(yo,f,v)}).bind(this,yo);var h=function(p,v){this.fire(p?zr:Yr,ne(v),v)};this._elementMouseenter=h.bind(this,!0),this._elementMouseexit=h.bind(this,!1),this._elementMousemove=(function(p){this.fire(Vr,ne(p),p)}).bind(this),this._elementMouseup=(function(p){this.fire(Ur,ne(p),p)}).bind(this),this._elementMousedown=(function(p){this.fire(Wr,ne(p),p)}).bind(this),this._elementContextmenu=(function(p){this.fire(qr,ne(p),p)}).bind(this)}},{key:"_attachEventDelegates",value:function(){var e=this.getContainer();this.eventManager.on(e,ee,ke,this._overlayClick),this.eventManager.on(e,ie,ke,this._overlayDblClick),this.eventManager.on(e,le,ke,this._overlayTap),this.eventManager.on(e,ae,ke,this._overlayDblTap),this.eventManager.on(e,ee,ue,this._connectorClick),this.eventManager.on(e,ie,ue,this._connectorDblClick),this.eventManager.on(e,le,ue,this._connectorTap),this.eventManager.on(e,ae,ue,this._connectorDblTap),this.eventManager.on(e,ee,Ye,this._endpointClick),this.eventManager.on(e,ie,Ye,this._endpointDblClick),this.eventManager.on(e,ee,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,le,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,ae,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,se,ue,this._connectorMouseover),this.eventManager.on(e,re,ue,this._connectorMouseout),this.eventManager.on(e,xe,ue,this._connectorContextmenu),this.eventManager.on(e,G,ue,this._connectorMouseup),this.eventManager.on(e,O,ue,this._connectorMousedown),this.eventManager.on(e,se,Ye,this._endpointMouseover),this.eventManager.on(e,re,Ye,this._endpointMouseout),this.eventManager.on(e,G,Ye,this._endpointMouseup),this.eventManager.on(e,O,Ye,this._endpointMousedown),this.eventManager.on(e,se,ke,this._overlayMouseover),this.eventManager.on(e,re,ke,this._overlayMouseout),this.eventManager.on(e,se,Y,this._elementMouseenter),this.eventManager.on(e,re,Y,this._elementMouseexit),this.eventManager.on(e,J,Y,this._elementMousemove),this.eventManager.on(e,G,Y,this._elementMouseup),this.eventManager.on(e,O,Y,this._elementMousedown),this.eventManager.on(e,xe,Y,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var e=this.getContainer();e&&(this.eventManager.off(e,ee,this._connectorClick),this.eventManager.off(e,ie,this._connectorDblClick),this.eventManager.off(e,le,this._connectorTap),this.eventManager.off(e,ae,this._connectorDblTap),this.eventManager.off(e,ee,this._endpointClick),this.eventManager.off(e,ie,this._endpointDblClick),this.eventManager.off(e,ee,this._overlayClick),this.eventManager.off(e,ie,this._overlayDblClick),this.eventManager.off(e,le,this._overlayTap),this.eventManager.off(e,ae,this._overlayDblTap),this.eventManager.off(e,ee,this._elementClick),this.eventManager.off(e,le,this._elementTap),this.eventManager.off(e,ae,this._elementDblTap),this.eventManager.off(e,se,this._connectorMouseover),this.eventManager.off(e,re,this._connectorMouseout),this.eventManager.off(e,xe,this._connectorContextmenu),this.eventManager.off(e,G,this._connectorMouseup),this.eventManager.off(e,O,this._connectorMousedown),this.eventManager.off(e,se,this._endpointMouseover),this.eventManager.off(e,re,this._endpointMouseout),this.eventManager.off(e,G,this._endpointMouseup),this.eventManager.off(e,O,this._endpointMousedown),this.eventManager.off(e,se,this._overlayMouseover),this.eventManager.off(e,re,this._overlayMouseout),this.eventManager.off(e,Zn,this._elementMouseenter),this.eventManager.off(e,Jn,this._elementMouseexit),this.eventManager.off(e,J,this._elementMousemove),this.eventManager.off(e,G,this._elementMouseup),this.eventManager.off(e,O,this._elementMousedown),this.eventManager.off(e,xe,this._elementContextmenu))}},{key:"setContainer",value:function(e){var t,n=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),this.dragManager!=null&&(t=this.dragManager.reset()),this.setAttribute(e,vo,W().replace("-",""));var o=this.getContainer();o!=null&&(o.removeAttribute(vo),j(qt(o.childNodes).filter(function(s){return s!=null&&(n.hasClass(s,Xn)||n.hasClass(s,nt)||n.hasClass(s,nn)||s.getAttribute&&s.getAttribute(Ee)!=null)}),function(s){e.appendChild(s)})),V(X(i.prototype),"setContainer",this).call(this,e),this.containerType=Nn(e),this.eventManager!=null&&this._attachEventDelegates(),this.dragManager!=null&&(this.dragManager.addHandler(new $o(this)),this.dragManager.addHandler(new Qo(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new ci(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),t!=null&&this.dragManager.setFilters(t))}},{key:"reset",value:function(){V(X(i.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect(),j(this.getContainer().querySelectorAll([Y,Ye,ue,ke].join(",")),function(e){return e.parentNode&&e.parentNode.removeChild(e)})}},{key:"destroy",value:function(){this._detachEventDelegates(),this.dragManager!=null&&this.dragManager.reset(),this.clearDragSelection(),V(X(i.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(e,t){this._resizeObserver!=null&&this._resizeObserver.unobserve(e),this.removeFromDragSelection(e),V(X(i.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];j(n,function(s){return e.dragSelection.add(s)})}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];j(n,function(s){return e.dragSelection.remove(s)})}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];j(n,function(s){return e.dragSelection.toggle(s)})}},{key:"addToDragGroup",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(o))}},{key:"removeFromDragGroup",value:function(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(o))}},{key:"clearDragGroup",value:function(e){this.elementDragHandler.clearDragGroup(e)}},{key:"consume",value:function(e,t){kt(e,t)}},{key:"rotate",value:function(e,t,n){var o=this.getId(e);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+t+"deg)",this._managedElements[o].el.style.transformOrigin="center center",V(X(i.prototype),"rotate",this).call(this,e,t,n)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(e,t){if(je(e))e.instance.addClass(ve(e),t);else if(ft(e))e.instance.addClass(Rt(e),t);else{if(!De(e))throw"Could not add class to overlay of type ["+e.type+"]";e.instance.addClass(Je(e),t)}}},{key:"removeOverlayClass",value:function(e,t){if(je(e))e.instance.removeClass(ve(e),t);else if(ft(e))e.instance.removeClass(Rt(e),t);else{if(!De(e))throw"Could not remove class from overlay of type ["+e.type+"]";e.instance.removeClass(Je(e),t)}}},{key:"_paintOverlay",value:function(e,t,n){if(je(e)){ve(e);var o=e.component.getXY();e.canvas.style.left=o.x+t.d.minx+"px",e.canvas.style.top=o.y+t.d.miny+"px"}else if(ft(e))(function(a,l,c,h){Rt(a);var p=[0,0];h.xmin<0&&(p[0]=-h.xmin),h.ymin<0&&(p[1]=-h.ymin);var v={d:l,stroke:c.stroke?c.stroke:null,fill:c.fill?c.fill:null,transform:"translate("+p[0]+","+p[1]+")","pointer-events":"visibleStroke"};me(a.path,v)})(e,isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" Z",t,n);else{if(!De(e))throw"Could not paint overlay of type ["+e.type+"]";Je(e);var s=e.component.getXY();e.canvas.style.left=s.x+t.d.minx+"px",e.canvas.style.top=s.y+t.d.miny+"px"}}},{key:"setOverlayVisible",value:function(e,t){var n=t?"block":"none";function o(s){s!=null&&(s.style.display=n)}je(e)?o(ve(e)):De(e)?o(Je(e)):ft(e)&&o(e.path)}},{key:"reattachOverlay",value:function(e,t){je(e)?e.instance._appendElement(ve(e),this.getContainer()):De(e)?e.instance._appendElement(Je(e),this.getContainer()):ft(e)&&this._appendElement(Rt(e),t.connector.canvas)}},{key:"setOverlayHover",value:function(e,t){var n;je(e)?n=ve(e):De(e)?n=Je(e):ft(e)&&(n=Rt(e)),n!=null&&(this.hoverClass!=null&&(t?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function(e){if(je(e)){var t=ve(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(gi(e)||yi(e)||_i(e))(function(o){var s=o;s.path!=null&&s.path.parentNode!=null&&s.path.parentNode.removeChild(s.path),s.bgPath!=null&&s.bgPath.parentNode!=null&&s.bgPath.parentNode.removeChild(s.bgPath),delete s.path,delete s.bgPath})(e);else if(De(e)){var n=Je(e);n.parentNode.removeChild(n),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function(e,t,n,o){if(je(e)||De(e)){var s=di._getDimensions(e);if(s!=null&&s.w!=null&&s.h!=null){var a={x:0,y:0};if(o)a={x:o.x,y:o.y};else if(t instanceof ut){var l=Array.isArray(e.location)?e.location:[e.location,e.location];a={x:l[0]*t.w,y:l[1]*t.h}}else{var c=e.location,h=!1;(z(e.location)||e.location<0||e.location>1)&&(c=parseInt(""+e.location,10),h=!0),a=t.pointOnPath(c,h)}var p=a.x-s.w/2,v=a.y-s.h/2;return{component:e,d:{minx:p,miny:v,td:s,cxy:a},xmin:p,xmax:p+s.w,ymin:v,ymax:v+s.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(gi(e)||yi(e)||_i(e))return e.draw(t,n,o);throw"Could not draw overlay of type ["+e.type+"]"}},{key:"updateLabel",value:function(e){if(Fe(e.label)){var t=e.label(this);ve(e).innerText=t??""}else e.labelText==null&&(e.labelText=e.label,e.labelText!=null?ve(e).innerText=e.labelText:ve(e).innerText="")}},{key:"setHover",value:function(e,t){e._hover=t,e instanceof ht&&e.endpoint!=null?this.setEndpointHover(e,t,-1):e instanceof Nt&&e.connector!=null&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function(e,t,n){zs(this,e,t,n)}},{key:"setConnectorHover",value:function(e,t,n){if(t===!1||!this.currentlyDragging&&!this.isHoverSuspended()){var o=e.canvas;o!=null&&(e.hoverClass!=null&&(t?this.addClass(o,e.hoverClass):this.removeClass(o,e.hoverClass)),t?this.addClass(o,this.hoverClass):this.removeClass(o,this.hoverClass)),e.connection.hoverPaintStyle!=null&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this._paintConnection(e.connection)),e.connection.endpoints[0]!==n&&this.setEndpointHover(e.connection.endpoints[0],t,0,!0),e.connection.endpoints[1]!==n&&this.setEndpointHover(e.connection.endpoints[1],t,1,!0)}}},{key:"destroyConnector",value:function(e){e.connector!=null&&kr(e.connector)}},{key:"addConnectorClass",value:function(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(e,t){xr(e,t)}},{key:"applyConnectorType",value:function(e,t){if(e.canvas&&t.cssClass){var n=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(e,t){var n=Xt(e.endpoint);n!=null&&this.addClass(n,t)}},{key:"applyEndpointType",value:function(e,t){if(t.cssClass){var n=Xt(e.endpoint);if(n){var o=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(n,o.join(" "))}}}},{key:"destroyEndpoint",value:function(e){var t=this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"");this.removeClass(e.element,t),kr(e.endpoint)}},{key:"renderEndpoint",value:function(e,t){var n=mr[e.endpoint.type];n!=null?Vs.paint(e.endpoint,n,t):q("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(e,t){var n=Xt(e.endpoint);n!=null&&this.removeClass(n,t)}},{key:"getEndpointClass",value:function(e){var t=Xt(e.endpoint);return t!=null?t.className:""}},{key:"setEndpointHover",value:function(e,t,n,o){if(e!=null&&(t===!1||!this.currentlyDragging&&!this.isHoverSuspended())){var s=Xt(e.endpoint);if(s!=null&&(e.hoverClass!=null&&(t?this.addClass(s,e.hoverClass):this.removeClass(s,e.hoverClass)),n===0||n===1)){var a=n===0?this.hoverSourceClass:this.hoverTargetClass;t?this.addClass(s,a):this.removeClass(s,a)}if(e.hoverPaintStyle!=null&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!o)for(var l=0;l<e.connections.length;l++)this.setConnectorHover(e.connections[l].connector,t,e)}}},{key:"setEndpointVisible",value:function(e,t){xr(e.endpoint,t)}},{key:"setGroupVisible",value:function(e,t){for(var n=e.el.querySelectorAll(Y),o=0;o<n.length;o++)t?this.show(n[o],!0):this.hide(n[o],!0)}},{key:"deleteConnection",value:function(e,t){return e!=null&&e.deleted!==!0&&(e.endpoints[0].deleted!==!0&&this.setEndpointHover(e.endpoints[0],!1,0,!0),e.endpoints[1].deleted!==!0&&this.setEndpointHover(e.endpoints[1],!1,1,!0),V(X(i.prototype),"deleteConnection",this).call(this,e,t))}},{key:"addSourceSelector",value:function(e,t,n){return this.addDragFilter(e),V(X(i.prototype),"addSourceSelector",this).call(this,e,t,n)}},{key:"removeSourceSelector",value:function(e){this.removeDragFilter(e.selector),V(X(i.prototype),"removeSourceSelector",this).call(this,e)}},{key:"manage",value:function(e,t,n){if(this.containerType===He.SVG&&Nn(e)!==He.SVG)throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var o=V(X(i.prototype),"manage",this).call(this,e,t,n);return o!=null&&this._resizeObserver!=null&&this._resizeObserver.observe(o.el),o}}]),i}(),An=function(){F(i,ut);var r=H(i);function i(e,t){var n;return M(this,i),u(d(n=r.call(this,e,t)),"width",void 0),u(d(n),"height",void 0),u(d(n),"type",i.type),t=t||{},n.width=t.width||10,n.height=t.height||10,n}return D(i,null,[{key:"_getParams",value:function(e){return{width:e.width,height:e.height}}}]),i}();u(An,"type","Rectangle");var sa={type:An.type,cls:An,compute:function(r,i,e,t){var n=t.width||r.width,o=t.height||r.height,s=i.curX-n/2,a=i.curY-o/2;return r.x=s,r.y=a,r.w=n,r.h=o,[s,a,n,o]},getParams:function(r){return{width:r.width,height:r.height}}},jn=function(){F(i,ut);var r=H(i);function i(e,t){var n;return M(this,i),u(d(n=r.call(this,e,t)),"type",i.type),n}return i}();u(jn,"type","Blank");var fe,aa={type:jn.type,cls:jn,compute:function(r,i,e,t){return r.x=i.curX,r.y=i.curY,r.w=10,r.h=0,[i.curX,i.curY,10,0]},getParams:function(r){return{}}},br={width:10,height:0,fill:"transparent",stroke:"transparent"};ki(vt.type,{makeNode:function(r,i){return _e("circle",{cx:r.w/2,cy:r.h/2,r:r.radius})},updateNode:function(r,i){me(i,{cx:""+r.w/2,cy:""+r.h/2,r:""+r.radius})}}),ki(jn.type,{makeNode:function(r,i){return _e("rect",br)},updateNode:function(r,i){me(i,br)}}),ki(An.type,{makeNode:function(r,i){return _e("rect",{width:r.w,height:r.h})},updateNode:function(r,i){me(i,{width:r.w,height:r.h})}}),function(r){r[r.top=0]="top",r[r.bottom=1]="bottom"}(fe||(fe={}));var bi=new Map;bi.set(fe.top,[he.TopRight,he.TopLeft]),bi.set(fe.bottom,[he.BottomRight,he.BottomLeft]);var la={deriveAnchor:function(r,i,e,t){return bi.get(r)[i]}},Ci="jtk-scrollable-list",ua=Qt(Ci),Cr="scroll";(function(){function r(i,e){var t=this;M(this,r),this.instance=i,u(this,"options",void 0),u(this,"count",void 0),u(this,"lists",void 0),this.count=0,this.lists={},this.options=e||{},this.instance.bind(io,function(n){for(var o=t.instance.getSelector(n.el,ua),s=0;s<o.length;s++)t.addList(o[s])}),this.instance.bind(ro,function(n){t.removeList(n.el)}),this.instance.bind(Qi,function(n,o){if(o==null){var s=t.findParentList(n.target);s!=null&&s.newConnection(n.connection,n.target,1);var a=t.findParentList(n.source);a!=null&&a.newConnection(n.connection,n.source,0)}}),this.instance.bind(ao,function(n){var o=n.dropEndpoint.element,s=t.findParentList(o);return s==null||o.offsetTop>=s.domElement.scrollTop&&o.offsetTop+o.offsetHeight<=s.domElement.scrollTop+s.domElement.offsetHeight})}D(r,[{key:"addList",value:function(i,e){var t=A({},la);A(t,this.options),e=A(t,e||{});var n=[this.instance._instanceIndex,this.count++].join("_");return this.lists[n]=new ca(this.instance,i,e,n),this.lists[n]}},{key:"getList",value:function(i){var e=this.instance.getAttribute(i,Ci);if(e!=null)return this.lists[e]}},{key:"removeList",value:function(i){var e=this.getList(i);e&&(e.destroy(),delete this.lists[e.id])}},{key:"findParentList",value:function(i){for(var e,t=i.parentNode,n=this.instance.getContainer();t!=null&&t!==n&&t!==document;){if((e=this.getList(t))!=null)return e;t=t.parentNode}}}])})();var ca=function(){function r(i,e,t,n){M(this,r),this.instance=i,this.el=e,this.options=t,this.id=n,u(this,"_scrollHandler",void 0),u(this,"domElement",void 0),u(this,"elId",void 0),this.domElement=e,this.elId=this.instance.getId(e),i.setAttribute(e,Ci,n),this._scrollHandler=this.scrollHandler.bind(this),this.domElement._jsPlumbScrollHandler=this._scrollHandler,i.on(e,Cr,this._scrollHandler),this._scrollHandler()}return D(r,[{key:"deriveAnchor",value:function(i,e,t,n){return this.options.anchor?this.options.anchor:this.options.deriveAnchor(i,e,t,n)}},{key:"deriveEndpoint",value:function(i,e,t,n){return this.options.deriveEndpoint?this.options.deriveEndpoint(i,e,t,n):this.options.endpoint?this.options.endpoint:t.endpoint.type}},{key:"newConnection",value:function(i,e,t){e.offsetTop<this.el.scrollTop?this._proxyConnection(e,i,t,fe.top):e.offsetTop+e.offsetHeight>this.el.scrollTop+this.domElement.offsetHeight&&this._proxyConnection(e,i,t,fe.bottom)}},{key:"scrollHandler",value:function(){for(var i=this,e=this.instance.getSelector(this.el,Y),t=function(o){if(e[o].offsetTop<i.el.scrollTop)e[o]._jsPlumbProxies=e[o]._jsPlumbProxies||[],i.instance.select({source:e[o]}).each(function(a){i._proxyConnection(e[o],a,0,fe.top)}),i.instance.select({target:e[o]}).each(function(a){i._proxyConnection(e[o],a,1,fe.top)});else if(e[o].offsetTop+e[o].offsetHeight>i.el.scrollTop+i.domElement.offsetHeight)e[o]._jsPlumbProxies=e[o]._jsPlumbProxies||[],i.instance.select({source:e[o]}).each(function(a){i._proxyConnection(e[o],a,0,fe.bottom)}),i.instance.select({target:e[o]}).each(function(a){i._proxyConnection(e[o],a,1,fe.bottom)});else if(e[o]._jsPlumbProxies){for(var s=0;s<e[o]._jsPlumbProxies.length;s++)i.instance.unproxyConnection(e[o]._jsPlumbProxies[s][0],e[o]._jsPlumbProxies[s][1]);delete e[o]._jsPlumbProxies}i.instance.revalidate(e[o])},n=0;n<e.length;n++)t(n)}},{key:"_proxyConnection",value:function(i,e,t,n){var o=this;this.instance.proxyConnection(e,t,this.domElement,function(s,a){return o.deriveEndpoint(n,a,e.endpoints[a],e)},function(s,a){return o.deriveAnchor(n,a,e.endpoints[a],e)}),i._jsPlumbProxies=i._jsPlumbProxies||[],i._jsPlumbProxies.push([e,t])}},{key:"destroy",value:function(){this.instance.off(this.el,Cr,this._scrollHandler),delete this.domElement._jsPlumbScrollHandler;for(var i=this.instance.getSelector(this.el,Y),e=0;e<i.length;e++)if(i[e]._jsPlumbProxies){for(var t=0;t<i[e]._jsPlumbProxies.length;t++)this.instance.unproxyConnection(i[e]._jsPlumbProxies[t][0],i[e]._jsPlumbProxies[t][1]);delete i[e]._jsPlumbProxies}}}]),r}();function Er(r){var i=Math.floor(r),e=Math.ceil(r);return r-i<1e-10?i:e-r<1e-10?e:r}var Ei=function(){F(i,Kn);var r=H(i);function i(e){var t;M(this,i),u(d(t=r.call(this,e)),"type",i.segmentType),u(d(t),"cx",void 0),u(d(t),"cy",void 0),u(d(t),"radius",void 0),u(d(t),"anticlockwise",void 0),u(d(t),"startAngle",void 0),u(d(t),"endAngle",void 0),u(d(t),"sweep",void 0),u(d(t),"length",void 0),u(d(t),"circumference",void 0),u(d(t),"frac",void 0),t.cx=e.cx,t.cy=e.cy,t.radius=e.r,t.anticlockwise=e.ac,e.startAngle&&e.endAngle?(t.startAngle=e.startAngle,t.endAngle=e.endAngle,t.x1=t.cx+t.radius*Math.cos(t.startAngle),t.y1=t.cy+t.radius*Math.sin(t.startAngle),t.x2=t.cx+t.radius*Math.cos(t.endAngle),t.y2=t.cy+t.radius*Math.sin(t.endAngle)):(t.startAngle=t._calcAngle(t.x1,t.y1),t.endAngle=t._calcAngle(t.x2,t.y2)),t.endAngle<0&&(t.endAngle+=Ve),t.startAngle<0&&(t.startAngle+=Ve);var n=t.endAngle<t.startAngle?t.endAngle+Ve:t.endAngle;return t.sweep=Math.abs(n-t.startAngle),t.anticlockwise&&(t.sweep=Ve-t.sweep),t.circumference=2*Math.PI*t.radius,t.frac=t.sweep/Ve,t.length=t.circumference*t.frac,t.extents={xmin:t.cx-t.radius,xmax:t.cx+t.radius,ymin:t.cy-t.radius,ymax:t.cy+t.radius},t}return D(i,[{key:"_calcAngle",value:function(e,t){return n={x:this.cx,y:this.cy},s=st(n,o={x:e,y:t}),a=Math.atan(s),(l=ii(n,o))!=4&&l!=3||(a+=Math.PI),a<0&&(a+=2*Math.PI),a;var n,o,s,a,l}},{key:"_calcAngleForLocation",value:function(e,t){if(e.anticlockwise){var n=e.startAngle<e.endAngle?e.startAngle+Ve:e.startAngle;return n-Math.abs(n-e.endAngle)*t}var o=e.endAngle<e.startAngle?e.endAngle+Ve:e.endAngle,s=Math.abs(o-e.startAngle);return e.startAngle+s*t}},{key:"getPath",value:function(e){var t=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(e,t){if(e===0)return{x:this.x1,y:this.y1,theta:this.startAngle};if(e===1)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e/=length);var n=this._calcAngleForLocation(this,e),o=this.cx+this.radius*Math.cos(n),s=this.cy+this.radius*Math.sin(n);return{x:Er(o),y:Er(s),theta:n}}},{key:"gradientAtPoint",value:function(e,t){var n=this.pointOnPath(e,t),o=-1/st({x:this.cx,y:this.cy},n);return this.anticlockwise||o!==1/0&&o!==-1/0||(o*=-1),o}},{key:"pointAlongPathFrom",value:function(e,t,n){var o=this.pointOnPath(e,n),s=t/this.circumference*2*Math.PI,a=this.anticlockwise?-1:1,l=o.theta+a*s;return{x:this.cx+this.radius*Math.cos(l),y:this.cy+this.radius*Math.sin(l)}}}]),i}();u(Ei,"segmentType","Arc");var Pr=function(){F(i,xn);var r=H(i);function i(e,t){var n;return M(this,i),(n=r.call(this,e,t)).connection=e,u(d(n),"showLoopback",void 0),u(d(n),"curviness",void 0),u(d(n),"margin",void 0),u(d(n),"proximityLimit",void 0),u(d(n),"orientation",void 0),u(d(n),"loopbackRadius",void 0),u(d(n),"clockwise",void 0),u(d(n),"isLoopbackCurrently",void 0),u(d(n),"geometry",null),t=t||{},n.showLoopback=t.showLoopback!==!1,n.curviness=t.curviness||10,n.margin=t.margin||5,n.proximityLimit=t.proximityLimit||80,n.clockwise=t.orientation&&t.orientation==="clockwise",n.loopbackRadius=t.loopbackRadius||25,n.isLoopbackCurrently=!1,n}return D(i,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){var n=t.sourcePos,o=t.targetPos,s=Math.abs(n.curX-o.curX),a=Math.abs(n.curY-o.curY);if(this.showLoopback&&t.sourceEndpoint.elementId===t.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var l=t.sourcePos.curX,c=t.sourcePos.curY-this.margin,h=l,p=c-this.loopbackRadius,v=h-this.loopbackRadius,f=p-this.loopbackRadius;s=2*this.loopbackRadius,a=2*this.loopbackRadius,e.points[0]=v,e.points[1]=f,e.points[2]=s,e.points[3]=a,this._addSegment(Ei,{loopback:!0,x1:l-v+4,y1:c-f,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:l-v-4,y2:c-f,cx:h-v,cy:p-f})}else this.isLoopbackCurrently=!1,this._computeBezier(e,t,n,o,s,a)}},{key:"exportGeometry",value:function(){return this.geometry==null?null:{controlPoints:[A({},this.geometry.controlPoints[0]),A({},this.geometry.controlPoints[1])],source:A({},this.geometry.source),target:A({},this.geometry.target)}}},{key:"transformGeometry",value:function(e,t,n){return{controlPoints:[{x:e.controlPoints[0].x+t,y:e.controlPoints[0].y+n},{x:e.controlPoints[1].x+t,y:e.controlPoints[1].y+n}],source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}},{key:"importGeometry",value:function(e){return e!=null&&(e.controlPoints==null||e.controlPoints.length!=2?(q("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):e.controlPoints[0].x==null||e.controlPoints[0].y==null||e.controlPoints[1].x==null||e.controlPoints[1].y==null?(q("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):e.source==null||e.source.curX==null||e.source.curY==null?(q("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):e.target==null||e.target.curX==null||e.target.curY==null?(q("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(e,!1),!0))}}]),i}(),ge={subtract:function(r,i){return{x:r.x-i.x,y:r.y-i.y}},dotProduct:function(r,i){return r.x*i.x+r.y*i.y},square:function(r){return Math.sqrt(r.x*r.x+r.y*r.y)},scale:function(r,i){return{x:r.x*i,y:r.y*i}}},Sr=64,ha=Math.pow(2,-Sr-1);function da(r,i){for(var e,t=[],n=function(p,v){for(var f=v.length-1,g=2*f-1,y=[],m=[],_=[],C=[],P=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],b=0;b<=f;b++)y[b]=ge.subtract(v[b],p);for(var x=0;x<=f-1;x++)m[x]=ge.subtract(v[x+1],v[x]),m[x]=ge.scale(m[x],3);for(var E=0;E<=f-1;E++)for(var S=0;S<=f;S++)_[E]||(_[E]=[]),_[E][S]=ge.dotProduct(m[E],y[S]);for(var w=0;w<=g;w++)C[w]||(C[w]=[]),C[w].y=0,C[w].x=parseFloat(""+w)/g;for(var k=f,I=f-1,T=0;T<=k+I;T++)for(var L=Math.max(0,T-I),N=Math.min(T,k),B=L;B<=N;B++){var oe=T-B;C[B+oe].y+=_[oe][B]*P[oe][B]}return C}(r,i),o=i.length-1,s=Pi(n,2*o-1,t,0),a=ge.subtract(r,i[0]),l=ge.square(a),c=0,h=0;h<s;h++)a=ge.subtract(r,Si(i,o,t[h],null,null)),(e=ge.square(a))<l&&(l=e,c=t[h]);return a=ge.subtract(r,i[o]),(e=ge.square(a))<l&&(l=e,c=1),{location:c,distance:l}}function Pi(r,i,e,t){var n,o,s=[],a=[],l=[],c=[];switch(function(v,f){var g,y,m=0;g=y=Jt(v[0].y);for(var _=1;_<=f;_++)(g=Jt(v[_].y))!=y&&m++,y=g;return m}(r,i)){case 0:return 0;case 1:if(t>=Sr)return e[0]=(r[0].x+r[i].x)/2,1;if(function(v,f){var g,y,m,_,C,P,b,x,E,S,w,k,I;C=v[0].y-v[f].y,P=v[f].x-v[0].x,b=v[0].x*v[f].y-v[f].x*v[0].y,k=I=0;for(var T=1;T<f;T++){var L=C*v[T].x+P*v[T].y+b;L>k?k=L:L<I&&(I=L)}return g=((E=1)*(b-k)-(w=P)*(S=0))*(1/((x=0)*w-C*E)),y=(E*(b-I)-(w=P)*S)*(1/(x*w-C*E)),m=Math.min(g,y),_=Math.max(g,y),_-m<ha?1:0}(r,i))return e[0]=function(v,f){var g=1,y=0,m=v[f].x-v[0].x,_=v[f].y-v[0].y,C=v[0].x-0,P=v[0].y-0;return 0+g*(1/(m*y-_*g)*(m*P-_*C))}(r,i),1}Si(r,i,.5,s,a),n=Pi(s,i,l,t+1),o=Pi(a,i,c,t+1);for(var h=0;h<n;h++)e[h]=l[h];for(var p=0;p<o;p++)e[p+n]=c[p];return n+o}function Si(r,i,e,t,n){for(var o=[[]],s=0;s<=i;s++)o[0][s]=r[s];for(var a=1;a<=i;a++)for(var l=0;l<=i-a;l++)o[a]||(o[a]=[]),o[a][l]||(o[a][l]={}),o[a][l].x=(1-e)*o[a-1][l].x+e*o[a-1][l+1].x,o[a][l].y=(1-e)*o[a-1][l].y+e*o[a-1][l+1].y;if(t!=null)for(var c=0;c<=i;c++)t[c]=o[c][0];if(n!=null)for(var h=0;h<=i;h++)n[h]=o[i-h][h];return o[i][0]}function pa(r,i){var e={x:0,y:0};if(r===0)return i[0];var t=i.length-1;if(r===1)return i[t];var n=i,o=1-r;if(t===0)return i[0];if(t===1)return{x:o*n[0].x+r*n[1].x,y:o*n[0].y+r*n[1].y};if(4>t){var s,a,l,c=o*o,h=r*r,p=0;return t===2?(n=[n[0],n[1],n[2],e],s=c,a=o*r*2,l=h):t===3&&(s=c*o,a=c*r*3,l=o*h*3,p=r*h),{x:s*n[0].x+a*n[1].x+l*n[2].x+p*n[3].x,y:s*n[0].y+a*n[1].y+l*n[2].y+p*n[3].y}}return e}function va(r){var i=0;if(!Ar(r))for(var e=function(n,o){var s=[];n--;for(var a=0;a<=n;a++)s.push(pa(a/n,o));return s}(16,r),t=0;t<15;t++)i+=Mr(e[t],e[t+1]);return i}var wr=new Map;function Yt(r,i){for(var e=function(s){var a=wr.get(s);if(!a){var l=function(g){return function(y){return g}},c=function(g){return function(y){for(var m=1,_=0;_<g.length;_++)m*=g[_](y);return m}};(a=[]).push(function(g){return Math.pow(g,s)});for(var h=1;h<s;h++){for(var p=[l(s)],v=0;v<s-h;v++)p.push(function(g){return g});for(var f=0;f<h;f++)p.push(function(g){return 1-g});a.push(c(p))}a.push(function(g){return Math.pow(1-g,s)}),wr.set(s,a)}return a}(r.length-1),t=0,n=0,o=0;o<r.length;o++)t+=r[o].x*e[o](i),n+=r[o].y*e[o](i);return{x:t,y:n}}function Mr(r,i){return Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2))}function Ar(r){return r[0].x===r[1].x&&r[0].y===r[1].y}function jr(r,i,e){if(Ar(r))return{point:r[0],location:i};for(var t=Yt(r,i),n=0,o=i,s=e>0?1:-1,a=null;n<Math.abs(e);)n+=Mr(a=Yt(r,o+=.005*s),t),t=a;return{point:a,location:o}}function fa(r,i,e,t,n){var o=t-i,s=r-e,a=r*(i-t)+i*(e-r),l=function(C){return[Dr(C,"x"),Dr(C,"y")]}(n),c=[o*l[0][0]+s*l[1][0],o*l[0][1]+s*l[1][1],o*l[0][2]+s*l[1][2],o*l[0][3]+s*l[1][3]+a],h=ga.apply(null,c),p=[];if(h!=null)for(var v=0;v<3;v++){var f=h[v],g=Math.pow(f,2),y=Math.pow(f,3),m={x:l[0][0]*y+l[0][1]*g+l[0][2]*f+l[0][3],y:l[1][0]*y+l[1][1]*g+l[1][2]*f+l[1][3]},_=void 0;_=e-r!=0?(m[0]-r)/(e-r):(m[1]-i)/(t-i),f>=0&&f<=1&&_>=0&&_<=1&&p.push(m)}return p}function Dr(r,i){return[-r[0][i]+3*r[1][i]+-3*r[2][i]+r[3][i],3*r[0][i]-6*r[1][i]+3*r[2][i],-3*r[0][i]+3*r[1][i],r[0][i]]}function ga(r,i,e,t){var n,o,s=i/r,a=e/r,l=t/r,c=(3*a-Math.pow(s,2))/9,h=(9*s*a-27*l-2*Math.pow(s,3))/54,p=Math.pow(c,3)+Math.pow(h,2),v=[0,0,0];if(p>=0)n=Jt(h+Math.sqrt(p))*Math.pow(Math.abs(h+Math.sqrt(p)),1/3),o=Jt(h-Math.sqrt(p))*Math.pow(Math.abs(h-Math.sqrt(p)),1/3),v[0]=-s/3+(n+o),v[1]=-s/3-(n+o)/2,v[2]=-s/3-(n+o)/2,Math.abs(Math.sqrt(3)*(n-o)/2)!==0&&(v[1]=-1,v[2]=-1);else{var f=Math.acos(h/Math.sqrt(-Math.pow(c,3)));v[0]=2*Math.sqrt(-c)*Math.cos(f/3)-s/3,v[1]=2*Math.sqrt(-c)*Math.cos((f+2*Math.PI)/3)-s/3,v[2]=2*Math.sqrt(-c)*Math.cos((f+4*Math.PI)/3)-s/3}for(var g=0;g<3;g++)(v[g]<0||v[g]>1)&&(v[g]=-1);return v}var wi=function(){F(i,Kn);var r=H(i);function i(e){var t;return M(this,i),u(d(t=r.call(this,e)),"curve",void 0),u(d(t),"cp1x",void 0),u(d(t),"cp1y",void 0),u(d(t),"cp2x",void 0),u(d(t),"cp2y",void 0),u(d(t),"length",0),u(d(t),"type",i.segmentType),t.cp1x=e.cp1x,t.cp1y=e.cp1y,t.cp2x=e.cp2x,t.cp2y=e.cp2y,t.x1=e.x1,t.x2=e.x2,t.y1=e.y1,t.y2=e.y2,t.curve=[{x:t.x1,y:t.y1},{x:t.cp1x,y:t.cp1y},{x:t.cp2x,y:t.cp2y},{x:t.x2,y:t.y2}],t.extents={xmin:Math.min(t.x1,t.x2,t.cp1x,t.cp2x),ymin:Math.min(t.y1,t.y2,t.cp1y,t.cp2y),xmax:Math.max(t.x1,t.x2,t.cp1x,t.cp2x),ymax:Math.max(t.y1,t.y2,t.cp1y,t.cp2y)},t}return D(i,[{key:"getPath",value:function(e){return(e?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(e,t){return e=i._translateLocation(this.curve,e,t),Yt(this.curve,e)}},{key:"gradientAtPoint",value:function(e,t){return e=i._translateLocation(this.curve,e,t),function(n,o){var s=Yt(n,o),a=Yt(n.slice(0,n.length-1),o),l=a.y-s.y,c=a.x-s.x;return l===0?1/0:Math.atan(l/c)}(this.curve,e)}},{key:"pointAlongPathFrom",value:function(e,t,n){return e=i._translateLocation(this.curve,e,n),function(o,s,a){return jr(o,s,a).point}(this.curve,e,t)}},{key:"getLength",value:function(){return this.length!=null&&this.length!==0||(this.length=va(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(e,t){var n,o,s,a=(n={x:e,y:t},o=this.curve,s=da(n,o),{point:Si(o,o.length-1,s.location,null,null),location:s.location});return{d:Math.sqrt(Math.pow(a.point.x-e,2)+Math.pow(a.point.y-t,2)),x:a.point.x,y:a.point.y,l:1-a.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(e,t,n,o){return fa(e,t,n,o,this.curve)}}],[{key:"_translateLocation",value:function(e,t,n){return n&&(t=function(o,s,a){return jr(o,s,a).location}(e,t>0?0:1,t)),t}}]),i}();u(wi,"segmentType","Bezier");var Mi=function(){F(i,Pr);var r=H(i);function i(e,t){var n;return M(this,i),(n=r.call(this,e,t)).connection=e,u(d(n),"type",i.type),u(d(n),"majorAnchor",void 0),u(d(n),"minorAnchor",void 0),t=t||{},n.majorAnchor=t.curviness||150,n.minorAnchor=10,n}return D(i,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(e,t,n,o,s){var a={x:0,y:0};return o[0]!==s[0]||o[1]===s[1]?(s[0]===0?a.x=n.curX<t.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:a.x=e.x+this.majorAnchor*s[0],s[1]===0?a.y=n.curY<t.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:a.y=e.y+this.majorAnchor*o[1]):(o[0]===0?a.x=t.curX<n.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:a.x=e.x-this.majorAnchor*o[0],o[1]===0?a.y=t.curY<n.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:a.y=e.y+this.majorAnchor*s[1]),a}},{key:"_computeBezier",value:function(e,t,n,o,s,a){var l,c,h=n.curX<o.curX?s:0,p=n.curY<o.curY?a:0,v=n.curX<o.curX?0:s,f=n.curY<o.curY?0:a;this.edited!==!0?(l=this._findControlPoint({x:h,y:p},n,o,e.so,e.to),c=this._findControlPoint({x:v,y:f},o,n,e.to,e.so)):(l=this.geometry.controlPoints[0],c=this.geometry.controlPoints[1]),this.geometry={controlPoints:[l,c],source:t.sourcePos,target:t.targetPos},this._addSegment(wi,{x1:h,y1:p,x2:v,y2:f,cp1x:l.x,cp1y:l.y,cp2x:c.x,cp2y:c.y})}}]),i}();u(Mi,"type","Bezier");var Ai=function(){F(i,Pr);var r=H(i);function i(e,t){var n;return M(this,i),(n=r.call(this,e,t)).connection=e,u(d(n),"type",i.type),u(d(n),"_controlPoint",void 0),n.curviness=t.curviness||10,n.margin=t.margin||5,n.proximityLimit=t.proximityLimit||80,n.clockwise=t.orientation&&t.orientation==="clockwise",n}return D(i,[{key:"_computeBezier",value:function(e,t,n,o,s,a){var l,c,h,p,v,f,g,y,m=n.curX<o.curX?0:s,_=n.curY<o.curY?0:a,C=n.curX<o.curX?s:0,P=n.curY<o.curY?a:0;if(n.x===0&&(m-=this.margin),n.x===1&&(m+=this.margin),n.y===0&&(_-=this.margin),n.y===1&&(_+=this.margin),o.x===0&&(C-=this.margin),o.x===1&&(C+=this.margin),o.y===0&&(P-=this.margin),o.y===1&&(P+=this.margin),this.edited!==!0){var b=(m+C)/2,x=(_+P)/2,E=(c=_,p=P,(l=m)<=(h=C)&&p<=c?1:l<=h&&c<=p?2:h<=l&&p>=c?3:4),S=Math.sqrt(Math.pow(C-m,2)+Math.pow(P-_,2));this._controlPoint=function(w,k,I,T,L,N,B,oe,Ke){return oe<=Ke?{x:w,y:k}:I===1?T.curY<=0&&L.curY>=1?{x:w+(T.x<.5?-1*N:N),y:k}:T.curX>=1&&L.curX<=0?{x:w,y:k+(T.y<.5?-1*B:B)}:{x:w+-1*N,y:k+-1*B}:I===2?T.curY>=1&&L.curY<=0?{x:w+(T.x<.5?-1*N:N),y:k}:T.curX>=1&&L.curX<=0?{x:w,y:k+(T.y<.5?-1*B:B)}:{x:w+N,y:k+-1*B}:I===3?T.curY>=1&&L.curY<=0?{x:w+(T.x<.5?-1*N:N),y:k}:T.curX<=0&&L.curX>=1?{x:w,y:k+(T.y<.5?-1*B:B)}:{x:w+-1*N,y:k+-1*B}:I===4?T.curY<=0&&L.curY>=1?{x:w+(T.x<.5?-1*N:N),y:k}:T.curX<=0&&L.curX>=1?{x:w,y:k+(T.y<.5?-1*B:B)}:{x:w+N,y:k+-1*B}:void 0}(b,x,E,t.sourcePos,t.targetPos,this.curviness,this.curviness,S,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];v=this._controlPoint.x,f=this._controlPoint.x,g=this._controlPoint.y,y=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:t.sourcePos,target:t.targetPos},this._addSegment(wi,{x1:C,y1:P,x2:m,y2:_,cp1x:v,cp1y:g,cp2x:f,cp2y:y})}}]),i}();function Tr(r){return r<0?-1:r===0?0:1}function Ir(r){return[Tr(r[2]-r[0]),Tr(r[3]-r[1])]}function Or(r){return Math.sqrt(Math.pow(r[0]-r[2],2)+Math.pow(r[1]-r[3],2))}function Gr(r){var i=[];return i.push.apply(i,r),i}u(Ai,"type","StateMachine"),Pn(Mi.type,Mi),Pn(Ai.type,Ai);var ji=function(){F(i,xn);var r=H(i);function i(e,t){var n;return M(this,i),(n=r.call(this,e,t)).connection=e,u(d(n),"type",i.type),u(d(n),"internalSegments",[]),u(d(n),"midpoint",void 0),u(d(n),"alwaysRespectStubs",void 0),u(d(n),"cornerRadius",void 0),u(d(n),"lastx",void 0),u(d(n),"lasty",void 0),u(d(n),"lastOrientation",void 0),u(d(n),"loopbackRadius",void 0),u(d(n),"isLoopbackCurrently",void 0),n.midpoint=t.midpoint==null||isNaN(t.midpoint)?.5:t.midpoint,n.cornerRadius=t.cornerRadius!=null?t.cornerRadius:0,n.alwaysRespectStubs=t.alwaysRespectStubs===!0,n.lastx=null,n.lasty=null,n.lastOrientation=null,n.loopbackRadius=t.loopbackRadius||25,n.isLoopbackCurrently=!1,n}return D(i,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(e,t,n){if(this.lastx!==e||this.lasty!==t){var o=this.lastx==null?n.sx:this.lastx,s=this.lasty==null?n.sy:this.lasty,a=o===e?"v":"h";this.lastx=e,this.lasty=t,this.internalSegments.push([o,s,e,t,a])}}},{key:"writeSegments",value:function(e){for(var t,n,o,s=null,a=0;a<this.internalSegments.length-1;a++){if(s=s||Gr(this.internalSegments[a]),t=Gr(this.internalSegments[a+1]),n=Ir(s),o=Ir(t),this.cornerRadius>0&&s[4]!==t[4]){var l=Math.min(Or(s),Or(t)),c=Math.min(this.cornerRadius,l/2);s[2]-=n[0]*c,s[3]-=n[1]*c,t[0]+=o[0]*c,t[1]+=o[1]*c;var h=n[1]===o[0]&&o[0]===1||n[1]===o[0]&&o[0]===0&&n[0]!==o[1]||n[1]===o[0]&&o[0]===-1,p=(t[1]>s[3]?1:-1)==(t[0]>s[2]?1:-1),v=p&&h||!p&&!h?t[0]:s[2],f=p&&h||!p&&!h?s[3]:t[1];this._addSegment(qe,{x1:s[0],y1:s[1],x2:s[2],y2:s[3]}),this._addSegment(Ei,{r:c,x1:s[2],y1:s[3],x2:t[0],y2:t[1],cx:v,cy:f,ac:h})}else this._addSegment(qe,{x1:s[0],y1:s[1],x2:s[2],y2:s[3]});s=t}t!=null&&this._addSegment(qe,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]})}},{key:"_compute",value:function(e,t){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var o=function(b){return[e.startStubX,e.startStubY,e.endStubX,e.endStubY]},s={perpendicular:o,orthogonal:o,opposite:function(b){var x=e,E=b==="x"?0:1,S={x:function(){return x.so[E]===1&&(x.startStubX>x.endStubX&&x.tx>x.startStubX||x.sx>x.endStubX&&x.tx>x.sx)||x.so[E]===-1&&(x.startStubX<x.endStubX&&x.tx<x.startStubX||x.sx<x.endStubX&&x.tx<x.sx)},y:function(){return x.so[E]===1&&(x.startStubY>x.endStubY&&x.ty>x.startStubY||x.sy>x.endStubY&&x.ty>x.sy)||x.so[E]===-1&&(x.startStubY<x.endStubY&&x.ty<x.startStubY||x.sy<x.endStubY&&x.ty<x.sy)}};return!n.alwaysRespectStubs&&S[b]()?{x:[(e.sx+e.tx)/2,e.startStubY,(e.sx+e.tx)/2,e.endStubY],y:[e.startStubX,(e.sy+e.ty)/2,e.endStubX,(e.sy+e.ty)/2]}[b]:[e.startStubX,e.startStubY,e.endStubX,e.endStubY]}},a=s[e.anchorOrientation](e.sourceAxis),l=e.sourceAxis==="x"?0:1,c=e.sourceAxis==="x"?1:0,h=a[l],p=a[c],v=a[l+2],f=a[c+2];this.addASegment(a[0],a[1],e);var g=e.startStubX+(e.endStubX-e.startStubX)*this.midpoint,y=e.startStubY+(e.endStubY-e.startStubY)*this.midpoint,m={x:[0,1],y:[1,0]},_={perpendicular:function(b,x,E,S,w){var k=e,I={x:[[k.startStubX,k.endStubX],null,[k.endStubX,k.startStubX]],y:[[k.startStubY,k.endStubY],null,[k.endStubY,k.startStubY]]},T={x:[[g,k.startStubY],[g,k.endStubY]],y:[[k.startStubX,y],[k.endStubX,y]]},L={x:[[k.endStubX,k.startStubY]],y:[[k.startStubX,k.endStubY]]},N={x:[[k.startStubX,k.endStubY],[k.endStubX,k.endStubY]],y:[[k.endStubX,k.startStubY],[k.endStubX,k.endStubY]]},B={x:[[k.startStubX,y],[k.endStubX,y],[k.endStubX,k.endStubY]],y:[[g,k.startStubY],[g,k.endStubY],[k.endStubX,k.endStubY]]},oe={x:[k.startStubY,k.endStubY],y:[k.startStubX,k.endStubX]},Ke=m[b][0],Oe=m[b][1],yt=k.so[Ke]+1,zt=k.to[Oe]+1,Dn=k.to[Oe]===-1&&oe[b][1]<oe[b][0]||k.to[Oe]===1&&oe[b][1]>oe[b][0],Ti=I[b][yt][0],Ii=I[b][yt][1],Ge={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[b][yt][zt];return k.segment===Ge[3]||k.segment===Ge[2]&&Dn?T[b]:k.segment===Ge[2]&&Ii<Ti?L[b]:k.segment===Ge[2]&&Ii>=Ti||k.segment===Ge[1]&&!Dn?B[b]:k.segment===Ge[0]||k.segment===Ge[1]&&Dn?N[b]:void 0},orthogonal:function(b,x,E,S,w){var k=e,I={x:k.so[0]===-1?Math.min(x,S):Math.max(x,S),y:k.so[1]===-1?Math.min(x,S):Math.max(x,S)}[b];return{x:[[I,E],[I,w],[S,w]],y:[[E,I],[w,I],[w,S]]}[b]},opposite:function(b,x,E,S,w){var k=e,I={x:"y",y:"x"}[b],T={x:"h",y:"w"}[b],L=k["is"+b.toUpperCase()+"GreaterThanStubTimes2"];if(t.sourceEndpoint.elementId===t.targetEndpoint.elementId){var N=E+(1-t.sourceEndpoint._anchor.computedPosition[I])*t.sourceInfo[T]+n.maxStub;return{x:[[x,N],[S,N]],y:[[N,x],[N,S]]}[b]}return!L||k.so[l]===1&&x>S||k.so[l]===-1&&x<S?{x:[[x,y],[S,y]],y:[[g,x],[g,S]]}[b]:k.so[l]===1&&x<S||k.so[l]===-1&&x>S?{x:[[g,k.sy],[g,k.ty]],y:[[k.sx,y],[k.tx,y]]}[b]:void 0}},C=_[e.anchorOrientation](e.sourceAxis,h,p,v,f);if(C)for(var P=0;P<C.length;P++)this.addASegment(C[P][0],C[P][1],e);this.addASegment(a[2],a[3],e),this.addASegment(e.tx,e.ty,e),this.writeSegments(e)}},{key:"transformGeometry",value:function(e,t,n){return e}}]),i}();u(ji,"type","Flowchart"),Pn(ji.type,ji),Me.registerHandler(Us),Me.registerHandler(sa),Me.registerHandler(aa),Pn(Sn.type,Sn);for(var gt={clientX:5e4,clientY:5e4,screenX:5e4,screenY:5e4,pageX:5e4,pageY:5e4},Di=0;Di<256;Di++)Di.toString(16);(function(){function r(i,e,t){M(this,r),this._jsPlumb=i,this.ok=e,this.equal=t,u(this,"_divs",[]),u(this,"mottle",void 0),this.mottle=new ti}D(r,[{key:"_t",value:function(i,e,t,n){this.mottle.trigger(i,e,{pageX:t,pageY:n,screenX:t,screenY:n,clientX:t,clientY:n})}},{key:"addDiv",value:function(i,e,t,n,o,s,a){var l=document.createElement("div");return l.style.position="absolute",l.innerHTML=i,e?e.appendChild(l):this._jsPlumb.getContainer().appendChild(l),l.setAttribute("id",i),l.style.left=(n??Math.floor(1e3*Math.random()))+"px",l.style.top=(o??Math.floor(1e3*Math.random()))+"px",t&&(l.className=t),s&&(l.style.width=s+"px"),a&&(l.style.height=a+"px"),this._divs.push(i),l}},{key:"addDivs",value:function(i,e){for(var t=0;t<i.length;t++)this.addDiv(i[t],e)}},{key:"assertEndpointCount",value:function(i,e){var t=this._jsPlumb.getEndpoints(i),n=t?t.length:0;this.equal(n,e,i.getAttribute("data-jtk-managed")+" has "+e+(e>1||e==0?" endpoints":" endpoint"))}},{key:"_assertManagedEndpointCount",value:function(i,e){var t=this._jsPlumb.getId(i),n=this._jsPlumb._managedElements[t];this.equal(n.endpoints.length,e,t+" has "+e+" endpoints in managed record")}},{key:"_assertManagedConnectionCount",value:function(i,e){var t=this._jsPlumb.getId(i),n=this._jsPlumb._managedElements[t];this.equal(n.connections.length,e,t+" has "+e+" connections in managed record")}},{key:"_registerDiv",value:function(i){this._divs.push(i)}},{key:"makeDragStartEvt",value:function(i){var e=this.makeEvent(i),t=this._jsPlumb.getContainer();return e.clientX+=t.offsetLeft,e.screenX+=t.offsetLeft,e.pageX+=t.offsetLeft,e.clientY+=t.offsetTop,e.screenY+=t.offsetTop,e.pageY+=t.offsetTop,e}},{key:"getAttribute",value:function(i,e){return i.getAttribute(e)}},{key:"dragNodeBy",value:function(i,e,t,n){(n=n||{}).before&&n.before();var o=this.makeEvent(i);this._jsPlumb.trigger(i,O,o),n.beforeMouseMove&&n.beforeMouseMove(),this._t(document,J,o.pageX+e,o.pageY+t),n.beforeMouseUp&&n.beforeMouseUp(),this.mottle.trigger(document,G,null),n.after&&n.after()}},{key:"dragNodeTo",value:function(i,e,t,n){n=n||{};var o=this._jsPlumb.viewport.getPosition(this._jsPlumb.getId(i));n.before&&n.before();var s=this.makeEvent(i);this._jsPlumb.trigger(i,O,s);var a=this._jsPlumb.getContainer().getBoundingClientRect();n.beforeMouseMove&&n.beforeMouseMove(),this._t(document,J,a.x+e+o.w/2,a.y+t+o.h/2),n.beforeMouseUp&&n.beforeMouseUp(),this.mottle.trigger(document,G,null),n.after&&n.after()}},{key:"dragToGroup",value:function(i,e,t){var n=this._jsPlumb.getGroup(e),o=this._jsPlumb.viewport.getPosition(n.elId),s=o.x+o.w/2,a=o.y+o.h/2;this.dragNodeTo(i,s,a,t)}},{key:"aSyncDragNodeBy",value:function(i,e,t,n){var o=this;(n=n||{}).before&&n.before();var s=this.makeEvent(i);this._jsPlumb.trigger(i,O,s),n.beforeMouseMove&&n.beforeMouseMove(),setTimeout(function(){o._t(document,J,s.pageX+e,s.pageY+t),n.beforeMouseUp&&n.beforeMouseUp(),setTimeout(function(){o.mottle.trigger(document,G,null),n.after&&n.after()},45)},45)}},{key:"dragANodeAround",value:function(i,e,t){this._jsPlumb.trigger(i,O,this.makeEvent(i));for(var n,o,s=50*Math.random(),a=0;a<s;a++){var l=(n=void 0,o=void 0,n=Math.floor(2e3*Math.random()),o=Math.floor(2e3*Math.random()),{clientX:n,clientY:o,screenX:n,screenY:o,pageX:n,pageY:o});i.style.left=l.screenX+"px",i.style.top=l.screenY+"px",this._jsPlumb.trigger(document,J,l)}e&&this.ok(e(),t||"while dragging assert"),this._jsPlumb.trigger(document,G,gt)}},{key:"dragConnection",value:function(i,e,t,n){var o=this.getCanvas(i),s=this.getCanvas(e),a=this.makeEvent(o),l=this.makeEvent(s);n=n||{};var c=this._jsPlumb.select().length;return this._jsPlumb.trigger(o,O,a),n.beforeMouseMove&&n.beforeMouseMove(),this._jsPlumb.trigger(t?s:document,J,l),n.beforeMouseUp&&n.beforeMouseUp(),this._jsPlumb.trigger(t?s:document,G,l),this._jsPlumb.select().get(c)}},{key:"aSyncDragConnection",value:function(i,e,t){var n=this;t=t||{};var o=this.getCanvas(i),s=this.getCanvas(e),a=this.makeEvent(o),l=this.makeEvent(s),c=this._jsPlumb.select().length;this._jsPlumb.trigger(o,O,a),setTimeout(function(){t.beforeMouseMove&&t.beforeMouseMove(),n._jsPlumb.trigger(document,J,l),setTimeout(function(){t.beforeMouseUp&&t.beforeMouseUp(),n._jsPlumb.trigger(s,G,l),t.after&&t.after(n._jsPlumb.select().get(c))},5)},5)}},{key:"dragAndAbortConnection",value:function(i){var e=this.getCanvas(i),t=this.makeEvent(e);this._jsPlumb.trigger(e,O,t),this._jsPlumb.trigger(document,J,gt),this._jsPlumb.trigger(document,G,gt)}},{key:"detachConnection",value:function(i,e){e=e||{};var t=this.getEndpointCanvas(i),n=this.makeEvent(t);e.before&&e.before(),this._jsPlumb.trigger(t,O,n),e.beforeMouseMove&&e.beforeMouseMove(),this._jsPlumb.trigger(document,J,gt),e.beforeMouseUp&&e.beforeMouseUp(),this._jsPlumb.trigger(document,G,gt),e.after&&e.after()}},{key:"detachAndReattachConnection",value:function(i,e){e=e||{};var t=this.getEndpointCanvas(i),n=this.makeEvent(t);e.before&&e.before(),this._jsPlumb.trigger(t,O,n),e.beforeMouseMove&&e.beforeMouseMove(),this._jsPlumb.trigger(document,J,gt),this._jsPlumb.trigger(document,J,n),e.beforeMouseUp&&e.beforeMouseUp(),this._jsPlumb.trigger(document,G,n),e.after&&e.after()}},{key:"detachConnectionByTarget",value:function(i,e){this.detachConnection(i.endpoints[1],e)}},{key:"relocateTarget",value:function(i,e,t){this.relocate(i,1,e,t)}},{key:"relocate",value:function(i,e,t,n){n=n||{},t=this.getCanvas(t);var o=this.getEndpointCanvas(i.endpoints[e]),s=this.makeEvent(o),a=this.makeEvent(t);n.before&&n.before(),this._jsPlumb.trigger(o,O,s),n.beforeMouseMove&&n.beforeMouseMove(),this._jsPlumb.trigger(document,J,a),n.beforeMouseUp&&n.beforeMouseUp(),this._jsPlumb.trigger(t,G,a),n.after&&n.after()}},{key:"relocateSource",value:function(i,e,t){this.relocate(i,0,e,t)}},{key:"makeEvent",value:function(i){var e=i.getBoundingClientRect(),t=e.x+e.width/2,n=e.y+e.height/2;return{clientX:t,clientY:n,screenX:t,screenY:n,pageX:t,pageY:n}}},{key:"getCanvas",value:function(i){return i.endpoint?this.getEndpointCanvas(i):i}},{key:"getEndpointCanvas",value:function(i){return i.endpoint.canvas}},{key:"getConnectionCanvas",value:function(i){return i.connector.canvas}},{key:"getEndpointCanvasPosition",value:function(i){var e=this.getEndpointCanvas(i);return{x:parseInt(e.style.left,10),y:parseInt(e.style.top,10),w:e.getAttribute("width"),h:e.getAttribute("height")}}},{key:"within",value:function(i,e,t){this.ok(Math.abs(i-e)<1e-11,t+"[expected: "+e+" got "+i+"] [diff:"+Math.abs(i-e)+"]")}},{key:"assertManagedEndpointCount",value:function(i,e){var t=this._jsPlumb.getId(i),n=this._jsPlumb._managedElements[t];this.equal(n.endpoints.length,e,t+" has "+e+" endpoints in managed record")}},{key:"assertManagedConnectionCount",value:function(i,e){var t=this._jsPlumb.getId(i),n=this._jsPlumb._managedElements[t];this.equal(n.connections.length,e,t+" has "+e+" connections in managed record")}},{key:"fireEventOnEndpoint",value:function(i){for(var e=this.getEndpointCanvas(i),t=0;t<(arguments.length<=1?0:arguments.length-1);t++)this._jsPlumb.trigger(e,t+1<1||arguments.length<=t+1?void 0:arguments[t+1])}},{key:"fireEventOnElement",value:function(i){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++)this._jsPlumb.trigger(i,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}},{key:"fireEventOnConnection",value:function(i){for(var e=this.getConnectionCanvas(i),t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.fireEventOnElement.apply(this,[e].concat(n))}},{key:"clickOnConnection",value:function(i){this.fireEventOnConnection(i,ee)}},{key:"dblClickOnConnection",value:function(i){this.fireEventOnConnection(i,ie)}},{key:"tapOnConnection",value:function(i){this.fireEventOnConnection(i,O),this.fireEventOnConnection(i,G)}},{key:"dblTapOnConnection",value:function(i){this.fireEventOnConnection(i,O),this.fireEventOnConnection(i,G),this.fireEventOnConnection(i,O),this.fireEventOnConnection(i,G)}},{key:"clickOnElement",value:function(i,e){this._jsPlumb.trigger(i,ee,null,null,e??1)}},{key:"dblClickOnElement",value:function(i){this._jsPlumb.trigger(i,ie)}},{key:"tapOnElement",value:function(i){this._jsPlumb.trigger(i,O),this._jsPlumb.trigger(i,G)}},{key:"dblTapOnElement",value:function(i){this._jsPlumb.trigger(i,O),this._jsPlumb.trigger(i,G),this._jsPlumb.trigger(i,O),this._jsPlumb.trigger(i,G)}},{key:"getOverlayCanvas",value:function(i){return i.canvas||i.path}},{key:"fireEventOnOverlay",value:function(i,e,t){var n=i.getOverlay(e),o=this.getOverlayCanvas(n);this._jsPlumb.trigger(o,t)}},{key:"clickOnOverlay",value:function(i,e){this.fireEventOnOverlay(i,e,ee)}},{key:"dblClickOnOverlay",value:function(i,e){this.fireEventOnOverlay(i,e,ie)}},{key:"tapOnOverlay",value:function(i,e){this.fireEventOnOverlay(i,e,O),this.fireEventOnOverlay(i,e,G)}},{key:"dblTapOnOverlay",value:function(i,e){this.fireEventOnOverlay(i,e,O),this.fireEventOnOverlay(i,e,G),this.fireEventOnOverlay(i,e,O),this.fireEventOnOverlay(i,e,G)}},{key:"cleanup",value:function(){var i=this._jsPlumb.getContainer();for(var e in this._jsPlumb.destroy(),this._divs){var t=document.getElementById(this._divs[e]);t&&t.parentNode.removeChild(t)}this._divs.length=0;var n=this._jsPlumb.select().length,o=this._jsPlumb.selectEndpoints().length,s=i.querySelectorAll(".jtk-endpoint").length,a=i.querySelectorAll(".jtk-connector").length;for(var l in i.__ta)for(var c in i.__ta[l])throw"Container event bindings not empty for key "+l;if(n>0)throw"there are connections in the data model!";if(o>0)throw"there are endpoints in the data model!";if(s>0)throw"there are "+s+" endpoints left in the dom!";if(a>0)throw"there are "+a+" connections left in the dom!"}},{key:"makeContent",value:function(i){var e=document.createElement("div");return e.innerHTML=i,e.firstChild}},{key:"length",value:function(i){var e=0;for(var t in i)i.hasOwnProperty(t)&&e++;return e}},{key:"head",value:function(i){for(var e in i)return i[e]}},{key:"uuid",value:function(){return W()}}])})();var Lr=0;function ya(r){return new ra(function(){var i=Lr+1;return Lr++,i}(),r)}function ma(r){(function i(){/complete|loaded|interactive/.test(document.readyState)&&document.body!==void 0&&document.body!=null?r():setTimeout(i,9)})()}export{ya as n,ma as r};
