import{d as K,x as Q,e as u,f as X,o as f,n as y,w as d,k as s,a,l as c,s as Y,t as C,c as j,F as z,p as B,m as h,q as G,bX as H,O as L,S as W,N as Z,Q as $,ba as ee,dd as ae,A as le,R as te}from"./index-mcOGIq4g.js";import{_ as oe}from"./Dialog.vue_vue_type_style_index_0_lang-BHwm1lq5.js";import{E as de}from"./el-card-FPJq94NZ.js";import{a as se,D as ue}from"./dict-Cu4dALpk.js";import{d as ne,h as ce}from"./tree-Cts6wVCK.js";import{c as D}from"./constants-D0aoFN3l.js";import{a as me}from"./index-DaJ-UTR5.js";import{b as pe}from"./index-DyyrZzBm.js";import{u as ie}from"./useMessage-CGTQbR_M.js";const re=K({name:"SystemRoleDataPermissionForm",__name:"RoleDataPermissionForm",emits:["success"],setup(ve,{expose:w,emit:T}){const{t:U}=Q(),E=ie(),m=u(!1),S=u(!1),o=X({id:0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]}),V=u(),x=u([]),p=u(!0),i=u(),r=u(!1),v=u(!0);w({open:async l=>{var e;m.value=!0,I(),x.value=ce(await me()),o.id=l.id,o.name=l.name,o.code=l.code,o.dataScope=l.dataScope,(e=l.dataScopeDeptIds)==null||e.forEach(n=>{i.value.setChecked(n,!0,!1)})}});const P=T,R=async()=>{S.value=!0;try{const l={roleId:o.id,dataScope:o.dataScope,dataScopeDeptIds:o.dataScope!==D.DEPT_CUSTOM?[]:i.value.getCheckedKeys(!1)};await pe(l),E.success(U("common.updateSuccess")),m.value=!1,P("success")}finally{S.value=!1}},I=()=>{var l,e;r.value=!1,p.value=!0,v.value=!0,o.value={id:0,name:"",code:"",dataScope:void 0,dataScopeDeptIds:[]},(l=i.value)==null||l.setCheckedNodes([]),(e=V.value)==null||e.resetFields()},M=()=>{var e;const l=(e=i.value)==null?void 0:e.store.nodesMap;for(let n in l)l[n].expanded!==p.value&&(l[n].expanded=p.value)};return(l,e)=>{const n=H,_=L,O=W,A=Z,F=$,k=ee,N=ae,g=de,b=le,q=oe,J=te;return f(),y(q,{modelValue:a(m),"onUpdate:modelValue":e[6]||(e[6]=t=>h(m)?m.value=t:null),title:"\u83DC\u5355\u6743\u9650",width:"800"},{footer:d(()=>[s(b,{disabled:a(S),type:"primary",onClick:R},{default:d(()=>[c("\u786E \u5B9A")]),_:1},8,["disabled"]),s(b,{onClick:e[5]||(e[5]=t=>m.value=!1)},{default:d(()=>[c("\u53D6 \u6D88")]),_:1})]),default:d(()=>[Y((f(),y(F,{ref_key:"formRef",ref:V,model:a(o),"label-width":"80px"},{default:d(()=>[s(_,{label:"\u89D2\u8272\u540D\u79F0"},{default:d(()=>[s(n,null,{default:d(()=>[c(C(a(o).name),1)]),_:1})]),_:1}),s(_,{label:"\u89D2\u8272\u6807\u8BC6"},{default:d(()=>[s(n,null,{default:d(()=>[c(C(a(o).code),1)]),_:1})]),_:1}),s(_,{label:"\u6743\u9650\u8303\u56F4"},{default:d(()=>[s(A,{modelValue:a(o).dataScope,"onUpdate:modelValue":e[0]||(e[0]=t=>a(o).dataScope=t)},{default:d(()=>[(f(!0),j(z,null,B(a(se)(a(ue).SYSTEM_DATA_SCOPE),t=>(f(),y(O,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[J,a(S)]]),a(o).dataScope===a(D).DEPT_CUSTOM?(f(),y(_,{key:0,label:"\u6743\u9650\u8303\u56F4",style:{display:"flex"}},{default:d(()=>[s(g,{class:"card",shadow:"never"},{header:d(()=>[c(" \u5168\u9009/\u5168\u4E0D\u9009: "),s(k,{modelValue:a(r),"onUpdate:modelValue":e[1]||(e[1]=t=>h(r)?r.value=t:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":"",onChange:e[2]||(e[2]=t=>{i.value.setCheckedNodes(r.value?x.value:[])})},null,8,["modelValue"]),c(" \u5168\u90E8\u5C55\u5F00/\u6298\u53E0: "),s(k,{modelValue:a(p),"onUpdate:modelValue":e[3]||(e[3]=t=>h(p)?p.value=t:null),"active-text":"\u5C55\u5F00","inactive-text":"\u6298\u53E0","inline-prompt":"",onChange:M},null,8,["modelValue"]),c(" \u7236\u5B50\u8054\u52A8(\u9009\u4E2D\u7236\u8282\u70B9\uFF0C\u81EA\u52A8\u9009\u62E9\u5B50\u8282\u70B9): "),s(k,{modelValue:a(v),"onUpdate:modelValue":e[4]||(e[4]=t=>h(v)?v.value=t:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":""},null,8,["modelValue"])]),default:d(()=>[s(N,{ref_key:"treeRef",ref:i,"check-strictly":!a(v),data:a(x),props:a(ne),"default-expand-all":"","empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E","node-key":"id","show-checkbox":""},null,8,["check-strictly","data","props"])]),_:1})]),_:1})):G("",!0)]),_:1},8,["modelValue"])}}});export{re as _};
