import{d as ue,e as s,f as ce,g as de,aX as ve,h as ge,o as v,n as F,w as u,l as R,j as r,a as l,c as b,t as y,q as I,k as c,m as q,s as me,aY as fe,F as A,p as be,aZ as ye,c5 as he,O as _e,P as xe,_ as we,A as ke,Q as De,D as Ie,G as Se,R as Me,J as Re,K as Ye}from"./index-mcOGIq4g.js";import{_ as $e}from"./CommonMenu-CxUjeIT-.js";import{_ as Ne}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as He}from"./download--D_IyRio.js";import{E as V}from"./index-5UHMZISN.js";import{g as ze,c as Q,e as Ce}from"./formatTime-f-_athMZ.js";import{I as Fe}from"./index-D-gmWooi.js";import{u as Ve}from"./useMessage-CGTQbR_M.js";import{_ as Te}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const g=S=>(Re("data-v-34e50b51"),S=S(),Ye(),S),Be=g(()=>r("br",null,null,-1)),Pe=g(()=>r("br",null,null,-1)),We={class:"nav_data"},Ue={class:"descriptions-container",style:{"font-size":"14px"}},Ee=g(()=>r("div",null,[r("span",null,"\u63D2\u63A5\u7BB1\u65B0\u589E\u7535\u80FD\u8BB0\u5F55")],-1)),Le={key:0,class:"description-item"},je=g(()=>r("span",{class:"label"},"\u7535\u80FD :",-1)),qe={class:"value"},Ae={key:1,class:"description-item"},Qe=g(()=>r("span",{class:"label"},"\u76F8\u7535\u80FD :",-1)),Oe={class:"value"},Ge={key:2,class:"description-item"},Je=g(()=>r("span",{class:"label"},"\u56DE\u8DEF\u7535\u80FD :",-1)),Ke={class:"value"},Xe={key:3,class:"description-item"},Ze=g(()=>r("span",{class:"label"},"\u8F93\u51FA\u4F4D\u7535\u80FD :",-1)),ea={class:"value"},aa=g(()=>r("div",{class:"line",style:{"margin-top":"10px"}},null,-1)),ta=g(()=>r("tr",null,[r("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[r("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),la={class:"realTotal"},oa=Te(ue({name:"PowerRecords",__name:"box",setup(S){const T=s([]),B=s(0),P=s(0),h=s(0),Y=s(0),$=s(!0),O=Ve(),W=s([]),_=s(0),f=s("day"),U=s(0),d=s(void 0),t=ce({pageNo:1,pageSize:15,timeRange:void 0,devkeys:[],lineId:void 0,loopId:void 0,outletId:void 0,type:"total",ipArray:[]}),G=s([15,30,50,100]),J=s(),N=s(!1),K=[{text:"\u6700\u8FD1\u4E00\u5929",value:async()=>{const e=new Date,a=new Date;return a.setHours(a.getHours()-24),f.value="day",[a,e]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const e=new Date,a=new Date;return a.setMonth(a.getMonth()-1),f.value="month",[a,e]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const e=new Date,a=new Date;return a.setMonth(a.getMonth()-6),f.value="sixMonths",[a,e]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const e=new Date,a=new Date;return a.setFullYear(a.getFullYear()-1),f.value="year",[a,e]}}];function X(e,a,o){return"L"+o}function Z(e,a,o){return"C"+o}const H=s(["total"]),E=s([]),ee=e=>{switch(t.type=e[0],e[0]){case"line":x.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"locations",istrue:!0},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"dev_key",istrue:!0},{label:"\u76F8",align:"center",prop:"line_id",istrue:!0,formatter:X},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",formatter:k,istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"ele_active",istrue:!0,formatter:w}],t.lineId=e[1],t.loopId=void 0,t.outletId=void 0;break;case"loop":x.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"dev_key",istrue:!0},{label:"\u56DE\u8DEF",align:"center",prop:"loop_id",istrue:!0,formatter:Z},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",formatter:k,istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"ele_active",istrue:!0,formatter:w}],t.loopId=e[1],t.lineId=void 0,t.outletId=void 0;break;case"outlet":x.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"dev_key",istrue:!0},{label:"\u8F93\u51FA\u4F4D",align:"center",prop:"outlet_id",istrue:!0},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",formatter:k,istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"ele_active",istrue:!0,formatter:w}],t.outletId=e[1],t.loopId=void 0,t.lineId=void 0;break;case"total":x.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"dev_key",istrue:!0},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",formatter:k,istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"ele_active",istrue:!0,formatter:w}],t.lineId=void 0,t.loopId=void 0,t.outletId=void 0}C()},x=s([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",formatter:k,istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"ele_active",istrue:!0,formatter:w}]),z=async()=>{$.value=!0;try{if(d.value==null)return void alert("\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4");if(d.value!=null){const a=M(ze(Q(d.value[0]))),o=M(Ce(Q(d.value[1])));t.timeRange=[a,o]}d.value==null&&(t.timeRange=void 0);const e=await V.getBoxRealtimeEQDataPage(t);W.value=e.list,U.value=e.total,e.total>1e4?_.value=1e4:_.value=e.total}finally{$.value=!1}},ae=de(()=>{const e=Math.ceil(_.value/t.pageSize);return t.pageNo===e&&_.value>=1e4});function w(e,a,o){var m;return(m=Number(o))==null?void 0:m.toFixed(1)}const te=e=>{const a=new Date;return a.setHours(0,0,0,0),e.setHours(0,0,0,0),e>a};function k(e,a,o){return o?ve(o).format("YYYY-MM-DD HH:mm"):""}const le=async e=>{let a=[];e.forEach(o=>{o.type==7&&a.push(o.unique)}),a.length==0&&e.length!=0&&(a.push(0),ye({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),t.devkeys=a,C()},oe=async()=>{try{await O.exportConfirm(),t.pageNo=1,N.value=!0;const e={timeout:0},a=await V.exportBoxRealtimeEQPageData(t,e);await He.excel(a,"\u6BCD\u7EBF\u63D2\u63A5\u7BB1\u7535\u80FD\u8BB0\u5F55.xlsx")}catch{}finally{N.value=!1}},L=async e=>{var a={timeRangeType:e.value,oldTime:t.timeRange[0],newTime:t.timeRange[1]};const o=await V.getBoxNavOneDayData(a);B.value=o.total,P.value=o.line,h.value=o.loop,Y.value=o.outlet},C=()=>{z(),t.pageNo=1,L(f)};ge(()=>{(async()=>{const D=await Fe.getBoxMenu();T.value=D})();const e=new Date,a=new Date(e.getFullYear(),e.getMonth(),1),o=M(a),m=M(e);d.value=[o,m],(async()=>{const D=[{value:"total",label:"\u603B"},{value:"line",label:"\u76F8",children:(()=>{const p=[];p.push({value:void 0,label:"\u5168\u90E8"});for(let n=1;n<=3;n++)p.push({value:`${n}`,label:`L${n}`});return p})()},{value:"loop",label:"\u56DE\u8DEF",children:(()=>{const p=[];p.push({value:void 0,label:"\u5168\u90E8"});for(let n=1;n<=9;n++)p.push({value:`${n}`,label:`C${n}`});return p})()},{value:"outlet",label:"\u8F93\u51FA\u4F4D",children:(()=>{const p=[];p.push({value:void 0,label:"\u5168\u90E8"});for(let n=1;n<=3;n++)p.push({value:`${n}`,label:`${n}`});return p})()}];E.value=D})(),z(),L(f)});const M=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`;return(e,a)=>{const o=he,m=_e,D=xe,p=we,n=ke,re=De,j=Ie,ne=Se,se=Ne,ie=$e,pe=Me;return v(),F(ie,{dataList:l(T),onCheck:le,navTitle:"\u63D2\u63A5\u7BB1\u7535\u80FD\u8BB0\u5F55"},{NavInfo:u(()=>[Be,R(),Pe,r("div",We,[r("div",Ue,[Ee,l(h)?(v(),b("div",Le,[je,r("span",qe,y(l(B))+"\u6761",1)])):I("",!0),l(h)?(v(),b("div",Ae,[Qe,r("span",Oe,y(l(P))+"\u6761",1)])):I("",!0),l(h)?(v(),b("div",Ge,[Je,r("span",Ke,y(l(h))+"\u6761",1)])):I("",!0),l(Y)?(v(),b("div",Xe,[Ze,r("span",ea,y(l(Y))+"\u6761",1)])):I("",!0),aa])])]),ActionBar:u(()=>[c(re,{class:"-mb-15px",model:l(t),ref_key:"queryFormRef",ref:J,inline:!0,"label-width":"auto"},{default:u(()=>[c(m,{label:"\u53C2\u6570\u7C7B\u578B",prop:"type"},{default:u(()=>[c(o,{modelValue:l(H),"onUpdate:modelValue":a[0]||(a[0]=i=>q(H)?H.value=i:null),"collapse-tags":"",options:l(E),"collapse-tags-tooltip":"","show-all-levels":!0,onChange:ee,class:"!w-140px"},null,8,["modelValue","options"])]),_:1}),c(m,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:u(()=>[c(D,{"value-format":"YYYY-MM-DD HH:mm:ss",modelValue:l(d),"onUpdate:modelValue":a[1]||(a[1]=i=>q(d)?d.value=i:null),type:"daterange",shortcuts:K,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":te},null,8,["modelValue"])]),_:1}),c(m,null,{default:u(()=>[c(n,{onClick:C},{default:u(()=>[c(p,{icon:"ep:search",class:"mr-5px"}),R(" \u641C\u7D22")]),_:1}),c(n,{type:"success",plain:"",loading:l(N),onClick:oe},{default:u(()=>[c(p,{icon:"ep:download",class:"mr-5px"}),R(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:u(()=>[me((v(),F(ne,{data:l(W),stripe:!0,"show-overflow-tooltip":!0},fe({default:u(()=>[c(j,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:u(({$index:i})=>[R(y(i+1+(l(t).pageNo-1)*l(t).pageSize),1)]),_:1}),(v(!0),b(A,null,be(l(x),i=>(v(),b(A,null,[i.istrue?(v(),F(j,{key:i.prop,label:i.label,align:i.align,prop:i.prop,formatter:i.formatter},null,8,["label","align","prop","formatter"])):I("",!0)],64))),256))]),_:2},[l(ae)?{name:"append",fn:u(()=>[ta]),key:"0"}:void 0]),1032,["data"])),[[pe,l($)]]),c(se,{total:l(_),"page-size-arr":l(G),layout:"sizes, prev, pager, next, jumper",page:l(t).pageNo,"onUpdate:page":a[2]||(a[2]=i=>l(t).pageNo=i),limit:l(t).pageSize,"onUpdate:limit":a[3]||(a[3]=i=>l(t).pageSize=i),onPagination:z},null,8,["total","page-size-arr","page","limit"]),r("div",la,"\u5171 "+y(l(U))+" \u6761",1)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-34e50b51"]]);export{oa as default};
