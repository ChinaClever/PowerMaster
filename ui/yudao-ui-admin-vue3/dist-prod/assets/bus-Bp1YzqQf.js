import{d as we,e as i,f as ye,aj as _e,g as he,aX as J,h as xe,o as c,n as _,w as o,l as v,j as n,t as f,a as t,k as u,m as De,s as ke,aY as G,c as S,F as K,p as Ye,q as Me,aZ as Ne,S as ze,N as Be,O as Fe,P as Se,_ as Ue,A as Ce,Q as qe,D as Ve,G as Pe,R as Ie,J as Re,K as je}from"./index-mcOGIq4g.js";import{_ as Te}from"./CommonMenu-CxUjeIT-.js";import{_ as We}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ae}from"./download--D_IyRio.js";import{E as h}from"./index-5UHMZISN.js";import{f as O,e as Q,c as X,a as Ee}from"./formatTime-f-_athMZ.js";import{I as Le}from"./index-D-gmWooi.js";import{P as x}from"./PDU-QxJ-Axz0.js";import{u as He}from"./useMessage-CGTQbR_M.js";import{_ as Je}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const d=b=>(Re("data-v-6cfa4cc7"),b=b(),je(),b),Ge=d(()=>n("br",null,null,-1)),Ke=d(()=>n("br",null,null,-1)),Oe={class:"nav_data"},Qe={class:"descriptions-container",style:{"font-size":"14px"}},Xe={class:"description-item"},Ze=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),$e={class:"value"},ea={class:"description-item"},aa=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),ta={class:"value"},la={class:"description-item"},ra=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),na={class:"value"},sa=d(()=>n("div",null,[n("span",null,"\u5168\u90E8\u59CB\u7AEF\u7BB1\u65B0\u589E\u7535\u8D39\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ia={key:1},oa=d(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ua={class:"realTotal"},pa=Je(we({name:"BillStatistics",__name:"bus",setup(b){const U=i([]),C=i(0),q=i(0),V=i(0),Z=i(!1),P=i([]),I=i(""),R=i(""),$=He(),D=i(!0),j=i([]),g=i(0),T=i(0),p=i(),r=ye({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,devkeys:[]}),ee=i([15,30,50,100]),ae=i(),k=i(!1);i([{imgUrl:x},{imgUrl:x},{imgUrl:x},{imgUrl:x}]);const te=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];_e(()=>r.granularity,()=>{r.granularity=="day"?Y.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"400%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"200%"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"100%"},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:w,width:"150px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:W},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:Y.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"300%"},{label:"\u5F00\u59CB\u65E5\u671F",align:"center",prop:"start_time",formatter:w,istrue:!0},{label:"\u7ED3\u675F\u65E5\u671F",align:"center",prop:"end_time",formatter:w,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:y}],N()});const Y=i([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"250px"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"150px"},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:w,width:"150px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,width:"150px",formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,width:"100px",formatter:W},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0,width:"100px"}]),M=async()=>{D.value=!0;try{if(p.value!=null){const e=O(Q(X(p.value[0]))),l=864e5,z=O(Q(Ee(X(p.value[1]),l)));r.timeRange=[e,z]}const a=await h.getBillDataPage(r);j.value=a.list,T.value=a.total,a.total>1e4?g.value=1e4:g.value=a.total}finally{D.value=!1}},le=he(()=>{const a=Math.ceil(g.value/r.pageSize);return r.pageNo===a&&g.value>=1e4});function w(a,e,l){return l?J(l).format("YYYY-MM-DD"):""}function y(a,e,l){return Number(l).toFixed(1)}function W(a,e,l){return Number(l).toFixed(1)}const re=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},N=()=>{r.pageNo=1,M()},ne=async()=>{try{await $.exportConfirm(),r.pageNo=1,k.value=!0;const a={timeout:0},e=await h.exportBillPageData(r,a);await Ae.excel(e,"\u59CB\u7AEF\u7BB1\u7535\u8D39\u7EDF\u8BA1.xlsx")}catch{}finally{k.value=!1}},se=async a=>{let e=[];a.forEach(l=>{l.type==6&&e.push(l.unique)}),e.length==0&&a.length!=0&&(e.push(0),Ne({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),r.devkeys=e,N()},A=a=>J(a).format("YYYY-MM-DD");return xe(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);p.value=[A(e),A(a)],(async()=>{const l=await Le.getBusMenu();U.value=l})(),(async()=>{const l=await h.getNavNewData({});C.value=l.day,q.value=l.week,V.value=l.month})(),M()}),(a,e)=>{const l=ze,z=Be,B=Fe,ie=Se,E=Ue,F=Ce,oe=qe,L=Ve,ue=Pe,pe=We,ce=Te,de=Ie;return c(),_(ce,{dataList:t(U),onCheck:se,navTitle:"\u59CB\u7AEF\u7BB1\u7535\u8D39\u7EDF\u8BA1"},{NavInfo:o(()=>[Ge,v(),Ke,n("div",Oe,[n("div",Qe,[n("div",Xe,[Ze,n("span",$e,f(t(C))+"\u6761",1)]),n("div",ea,[aa,n("span",ta,f(t(q))+"\u6761",1)]),n("div",la,[ra,n("span",na,f(t(V))+"\u6761",1)]),sa])])]),ActionBar:o(()=>[u(oe,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:ae,inline:!0,"label-width":"auto"},{default:o(()=>[u(B,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:o(()=>[u(z,{modelValue:t(r).granularity,"onUpdate:modelValue":e[0]||(e[0]=s=>t(r).granularity=s),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:o(()=>[u(l,{label:"\u5929",value:"day"}),u(l,{label:"\u5468",value:"week"}),u(l,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),u(B,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[u(ie,{"value-format":"YYYY-MM-DD",modelValue:t(p),"onUpdate:modelValue":e[1]||(e[1]=s=>De(p)?p.value=s:null),type:"daterange",shortcuts:te,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":re},null,8,["modelValue"])]),_:1}),u(B,null,{default:o(()=>[u(F,{onClick:N},{default:o(()=>[u(E,{icon:"ep:search",class:"mr-5px"}),v(" \u641C\u7D22")]),_:1}),u(F,{type:"success",plain:"",loading:t(k),onClick:ne},{default:o(()=>[u(E,{icon:"ep:download",class:"mr-5px"}),v(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:o(()=>[ke((c(),_(ue,{data:t(j),stripe:!0,"show-overflow-tooltip":!0},G({default:o(()=>[u(L,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:o(({$index:s})=>[v(f(s+1+(t(r).pageNo-1)*t(r).pageSize),1)]),_:1}),(c(!0),S(K,null,Ye(t(Y),s=>(c(),S(K,null,[s.istrue?(c(),_(L,{key:s.prop,label:s.label,align:s.align,prop:s.prop,formatter:s.formatter,width:s.width},G({_:2},[s.slot==="actions"&&t(r).granularity=="day"?{name:"default",fn:o(({row:m})=>[m.bill_mode_real&&m.bill_mode_real==2?(c(),_(F,{key:0,link:"",type:"primary",onClick:ca=>(async(me,H,ge,ve)=>{P.value=[],I.value="",R.value="";let fe={busId:me,startTime:H};const be=await h.getBusSubBillDetails(fe);P.value=be.list,I.value=ge,R.value=H+" - "+ve,Z.value=!0})(m.bus_id,m.start_time,m.location,m.end_time)},{default:o(()=>[v("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):(c(),S("div",ia,"\u56FA\u5B9A\u8BA1\u8D39"))]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):Me("",!0)],64))),256))]),_:2},[t(le)?{name:"append",fn:o(()=>[oa]),key:"0"}:void 0]),1032,["data"])),[[de,t(D)]]),u(pe,{total:t(g),"page-size-arr":t(ee),layout:"sizes, prev, pager, next, jumper",page:t(r).pageNo,"onUpdate:page":e[2]||(e[2]=s=>t(r).pageNo=s),limit:t(r).pageSize,"onUpdate:limit":e[3]||(e[3]=s=>t(r).pageSize=s),onPagination:M},null,8,["total","page-size-arr","page","limit"]),n("div",ua,"\u5171 "+f(t(T))+" \u6761",1)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-6cfa4cc7"]]);export{pa as default};
