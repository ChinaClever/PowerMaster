import{d as Me,u as Se,e as s,an as Ae,f as qe,aj as Ve,g as Ye,aX as ne,h as Re,T as W,o as g,n as x,w as u,l as h,j as o,t as w,a as n,k as p,m as re,s as ie,aY as F,c as k,F as A,p as oe,q as T,aZ as Le,c5 as We,O as Fe,S as Te,N as je,P as He,_ as Qe,A as $e,Q as Oe,D as Ze,G as Be,R as Ee,J as Ge,K as Je}from"./index-mcOGIq4g.js";import{_ as Ke}from"./CommonMenu-CxUjeIT-.js";import{_ as Xe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as ea}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{E as j}from"./index-83lIWP6s.js";import{H as aa}from"./index-BJx6voQi.js";import{f as se,e as ue,c as pe,a as la}from"./formatTime-f-_athMZ.js";import{C as ta}from"./index-JEsRnusb.js";import"./index-KYPw-eK3.js";import{P as q}from"./PDU-QxJ-Axz0.js";import{d as na}from"./download--D_IyRio.js";import{u as ra}from"./useMessage-CGTQbR_M.js";import{i as ia}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as oa}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const d=D=>(Ge("data-v-dde85f3d"),D=D(),Je(),D),sa=d(()=>o("br",null,null,-1)),ua=d(()=>o("br",null,null,-1)),pa={class:"nav_data"},da={class:"descriptions-container",style:{"font-size":"14px"}},ca={class:"description-item"},ma=d(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ga={class:"value"},va={class:"description-item"},fa=d(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),ha={class:"value"},ya={class:"description-item"},ba=d(()=>o("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),_a={class:"value"},xa=d(()=>o("br",null,null,-1)),wa=d(()=>o("div",null,[o("span",null,"\u5168\u90E8PDU\u65B0\u589E\u80FD\u8017\u8BB0\u5F55"),o("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ka=d(()=>o("tr",null,[o("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[o("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),Da={key:0,class:"realTotal"},Na=d(()=>o("br",null,null,-1)),Ca=d(()=>o("br",null,null,-1)),za=d(()=>o("br",null,null,-1)),Ua=d(()=>o("br",null,null,-1)),Ia=oa(Me({name:"PowerAnalysis",__name:"index",setup(D){const{push:de}=Se(),H=s([]),Q=s(0),$=s(0),O=s(0),Z=Ae(),N=s(!0),ce=ra(),m=s([]),b=s(0),B=s(0),y=s();s([{imgUrl:q},{imgUrl:q},{imgUrl:q},{imgUrl:q}]);const t=qe({pageNo:1,pageSize:15,ipAddr:void 0,cascadeAddr:0,outletId:void 0,type:"total",granularity:"day",timeRange:void 0,ipArray:void 0}),me=s([15,30,50,100]),ge=s(),V=s(!1),ve=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}}],Y=s(["total"]),E=s([]),fe=a=>{if(t.type=a[0],a[0]==="outlet"){if(t.outletId=a[1],!C.value.some(e=>e.label==="\u8F93\u51FA\u4F4D")){const e={label:"\u8F93\u51FA\u4F4D",align:"center",prop:"outlet_id",istrue:!0};C.value.splice(2,1,e)}}else C.value.splice(1,1);I()},he=a=>{const e=(a-1)*t.pageSize+1,l=a*t.pageSize,r=[];for(let f=e;f<=l;f++)r.push("\u5E8F\u53F7"+f);return r},R=s(null);let v=null;const G=s([]),ye=()=>{if(R.value&&Z){const e=(l=>{const r=(l-1)*t.pageSize+1;return l*t.pageSize-r+1})(t.pageNo);v=ia(R.value),v.setOption({title:{text:"\u5404PDU\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:be},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:he(t.pageNo),axisLabel:{interval:0,formatter:function(l,r){return e>30?"":l}}},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:G.value.map(l=>X(l,1)),label:{show:e<=30,position:"top"}}]}),Z.appContext.config.globalProperties.rankChart=v}};window.addEventListener("resize",function(){v==null||v.resize()}),Ve(()=>t.granularity,()=>{I()});const C=s([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"address",istrue:!0},{label:"\u7F51\u7EDC\u5730\u5740",align:"center",prop:"location",istrue:!0,width:"150px"},{label:"\u8BB0\u5F55\u65E5\u671F",align:"center",prop:"create_time",formatter:z,width:"150px",istrue:!0},{label:"\u5F00\u59CB\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"start_ele",istrue:!0,formatter:U,width:"130px"},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"start_time",formatter:K,width:"130px",istrue:!0}]},{label:"\u7ED3\u675F\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"end_ele",istrue:!0,formatter:U,width:"130px"},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"end_time",formatter:K,width:"130px",istrue:!0}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:function(a,e,l){let r;return t.granularity=="day"?(r=a.end_ele-a.start_ele,r<0&&(r=a.end_ele)):r=a.end_ele-a.start_ele,Number(r).toFixed(1)},width:"130px"},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),J=async()=>{N.value=!0;try{if(_.value!=""&&_.value!=null){const e=se(ue(pe(_.value))),l=864e5,r=se(ue(la(pe(ae.value),l)));y.value=[e,r],t.timeRange=[e,r]}_.value==null&&(t.timeRange=void 0),t.ipArray=[P.value];const a=await j.getEQDataPage(t);G.value=a.list.map(e=>X(e.eq_value,1)),m.value=a.list,B.value=a.total,a.total>1e4?b.value=1e4:b.value=a.total}finally{ye(),N.value=!1}};function be(a){var e="",l=a[0];return e+="\u7F51\u7EDC\u5730\u5740\uFF1A"+m.value[l.dataIndex].location+"  ",t.type=="outlet"&&(e+="\u8F93\u51FA\u4F4D\uFF1A"+m.value[l.dataIndex].outlet_id),e+="<br/>"+l.marker+"\u8BB0\u5F55\u65E5\u671F\uFF1A"+z(null,null,m.value[l.dataIndex].create_time)+" "+l.seriesName+": "+l.value+"kWh <br/>"+l.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+z(null,null,m.value[l.dataIndex].end_time)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+U(null,null,m.value[l.dataIndex].end_ele)+"kWh <br/>"+l.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+z(null,null,m.value[l.dataIndex].start_time)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+U(null,null,m.value[l.dataIndex].start_ele)+"kWh <br/>"}const _e=Ye(()=>{const a=Math.ceil(b.value/t.pageSize);return t.pageNo===a&&b.value>=1e4});function z(a,e,l){return l?ne(l).format("YYYY-MM-DD"):""}function K(a,e,l){return l?ne(l).format("MM-DD"):""}function U(a,e,l){return Number(l).toFixed(1)}function X(a,e){return isNaN(a)?null:Number(a).toFixed(e)}const xe=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},I=()=>{t.pageNo=1,J()},we=async a=>{let e=[];a.forEach(l=>{l.type==4&&e.push(l.unique)}),P.value!=null&&(e=[P]),e.length==0&&a.length!=0&&(e.push(0),v==null||v.clear(),Le({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),t.ipArray=e,I()},ee=(a,e,l,r)=>{de("/pdu/nenghao/ecdistribution?pduId="+a+"&address="+e+"&start="+l+"&end="+r)},ke=async()=>{try{await ce.exportConfirm(),t.pageNo=1,V.value=!0;const a={timeout:0},e=await j.exportEQPageData(t,a);await na.excel(e,"PDU\u80FD\u8017\u7EDF\u8BA1.xlsx")}catch{}finally{V.value=!1}},_=s(""),ae=s(""),P=s("");return Re(()=>{(async()=>{let a=[];var e=await ta.getRoomPDUList();a=a.concat(e),H.value=a})(),(async()=>{const a=await j.getNavNewData({});Q.value=a.day,$.value=a.week,O.value=a.month})(),(async()=>{const a=(await aa.getTypeMaxValue()).outlet_id_max_value,e=[{value:"total",label:"\u603B"},{value:"outlet",label:"\u8F93\u51FA\u4F4D",children:(()=>{const l=[];l.push({value:void 0,label:"\u5168\u90E8"});for(let r=1;r<=a;r++)l.push({value:`${r}`,label:`${r}`});return l})()}];E.value=e})(),_.value=W().query.start,ae.value=W().query.end,P.value=W().query.ip,J()}),(a,e)=>{const l=We,r=Fe,f=Te,De=je,Ne=He,le=Qe,M=$e,Ce=Oe,S=Ze,ze=Be,Ue=ea,Ie=Xe,Pe=Ke,te=Ee;return g(),x(Pe,{dataList:n(H),onCheck:we,navTitle:"PDU\u80FD\u8017\u6570\u636E",placeholder:"\u5982:192.168.1.96-0"},{NavInfo:u(()=>[sa,h(),ua,o("div",pa,[o("div",da,[o("div",ca,[ma,o("span",ga,w(n(Q))+"\u6761",1)]),o("div",va,[fa,o("span",ha,w(n($))+"\u6761",1)]),o("div",ya,[ba,o("span",_a,w(n(O))+"\u6761",1)]),h(),xa,wa])])]),ActionBar:u(()=>[p(Ce,{class:"-mb-15px",model:n(t),ref_key:"queryFormRef",ref:ge,inline:!0,"label-width":"auto"},{default:u(()=>[p(r,{label:"\u53C2\u6570\u7C7B\u578B",prop:"type"},{default:u(()=>[p(l,{modelValue:n(Y),"onUpdate:modelValue":e[0]||(e[0]=i=>re(Y)?Y.value=i:null),"collapse-tags":"",options:n(E),"collapse-tags-tooltip":"","show-all-levels":!0,onChange:fe,class:"!w-140px"},null,8,["modelValue","options"])]),_:1}),p(r,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:u(()=>[p(De,{modelValue:n(t).granularity,"onUpdate:modelValue":e[1]||(e[1]=i=>n(t).granularity=i),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:u(()=>[p(f,{label:"\u5929",value:"day"}),p(f,{label:"\u5468",value:"week"}),p(f,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),p(r,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:u(()=>[p(Ne,{"value-format":"YYYY-MM-DD",modelValue:n(y),"onUpdate:modelValue":e[2]||(e[2]=i=>re(y)?y.value=i:null),type:"daterange",shortcuts:ve,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":xe},null,8,["modelValue"])]),_:1}),p(r,null,{default:u(()=>[p(M,{onClick:I},{default:u(()=>[p(le,{icon:"ep:search",class:"mr-5px"}),h(" \u641C\u7D22")]),_:1})]),_:1}),p(M,{type:"success",plain:"",onClick:ke,loading:n(V),style:{float:"right","margin-right":"10px"}},{default:u(()=>[p(le,{icon:"ep:download",class:"mr-5px"}),h(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1},8,["model"])]),Content:u(()=>[ie((g(),x(ze,{data:n(m),"show-overflow-tooltip":!0,"header-cell-style":{background:"#f7f7f7",color:"#606266"}},F({default:u(()=>[p(S,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:u(({$index:i})=>[h(w(i+1+(n(t).pageNo-1)*n(t).pageSize),1)]),_:1}),(g(!0),k(A,null,oe(n(C),i=>(g(),k(A,{key:i.label},[!i.children&&i.istrue?(g(),x(S,{key:i.prop,label:i.label,align:i.align,prop:i.prop,formatter:i.formatter,width:i.width},F({_:2},[i.slot==="actions"?{name:"default",fn:u(({row:c})=>[p(M,{link:"",type:"primary",onClick:L=>ee(c.pdu_id,c.address,String(n(y)[0]),String(n(y)[1]))},{default:u(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):i.istrue?(g(),x(S,{key:1,label:i.label,align:i.align},{default:u(()=>[(g(!0),k(A,null,oe(i.children,c=>(g(),k(A,{key:c.prop},[c.istrue?(g(),x(S,{key:0,label:c.label,align:c.align,prop:c.prop,formatter:c.formatter,width:c.width},F({_:2},[c.slot==="actions"?{name:"default",fn:u(({row:L})=>[p(M,{link:"",type:"primary",onClick:Pa=>ee(L.pdu_id,L.address)},{default:u(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):T("",!0)],64))),128))]),_:2},1032,["label","align"])):T("",!0)],64))),128))]),_:2},[n(_e)?{name:"append",fn:u(()=>[ka]),key:"0"}:void 0]),1032,["data"])),[[te,n(N)]]),p(Ue,{total:n(b),"page-size-arr":n(me),layout:"sizes, prev, pager, next, jumper",page:n(t).pageNo,"onUpdate:page":e[3]||(e[3]=i=>n(t).pageNo=i),limit:n(t).pageSize,"onUpdate:limit":e[4]||(e[4]=i=>n(t).pageSize=i),onPagination:a.getList1},null,8,["total","page-size-arr","page","limit","onPagination"]),n(m).length!=0?(g(),k("div",Da,"\u5171 "+w(n(B))+" \u6761",1)):T("",!0),Na,Ca,za,Ua,p(Ie,null,{default:u(()=>[ie(o("div",{ref_key:"rankChartContainer",ref:R,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[te,n(N)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-dde85f3d"]]);export{Ia as default};
