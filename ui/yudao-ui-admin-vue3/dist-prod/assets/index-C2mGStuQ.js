import{d as be,u as ye,e as o,an as we,f as ke,aj as _e,g as De,aX as q,h as Me,o as g,n as w,w as i,l as b,k as u,a as r,m as Ce,s as B,aY as U,t as H,c as S,F as Y,p as G,q as J,j as s,aZ as Se,P as Ye,O as Ae,_ as Ie,A as Ne,Q as ze,D as Te,G as Re,R as Ue,J as We,K as Ee}from"./index-mcOGIq4g.js";import{_ as Fe}from"./CommonMenu-CxUjeIT-.js";import{_ as Pe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as $e}from"./download--D_IyRio.js";import{E as W}from"./index-CRHHgC4s.js";import{f as K,e as Q,c as X}from"./formatTime-f-_athMZ.js";import{C as Le}from"./index-JEsRnusb.js";import"./index-KYPw-eK3.js";import{P as A}from"./PDU-QxJ-Axz0.js";import{u as Oe}from"./useMessage-CGTQbR_M.js";import{i as Ve}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as qe}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const f=k=>(We("data-v-2eefc587"),k=k(),Ee(),k),Be=f(()=>s("br",null,null,-1)),He=f(()=>s("br",null,null,-1)),Ge=f(()=>s("div",{class:"nav_data"},[s("div",{class:"descriptions-container",style:{"font-size":"14px"}},[s("div",null,[s("span",{class:"label"},"\u6309\u65F6\u95F4\u8303\u56F4\u67E5\u8BE2\u5B9E\u65F6\u80FD\u8017")])])],-1)),Je=f(()=>s("tr",null,[s("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[s("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),Ke={class:"realTotal"},Qe=f(()=>s("br",null,null,-1)),Xe=f(()=>s("br",null,null,-1)),Ze=f(()=>s("br",null,null,-1)),ea=f(()=>s("br",null,null,-1)),aa=qe(be({name:"PowerAnalysis",__name:"index",setup(k){const Z=Oe(),{push:ee}=ye(),E=o([]),ae=o(0),te=o(0),le=o(0),F=we(),_=o(!1),p=o([]),y=o(0),P=o(0),d=o(void 0),n=ke({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,cabinetIds:[]}),ne=o([15,30,50,100]),re=o(),I=o(!1);o([{imgUrl:A},{imgUrl:A},{imgUrl:A},{imgUrl:A}]);const ie=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],oe=a=>{const e=(a-1)*n.pageSize+1,t=a*n.pageSize,v=[];for(let x=e;x<=t;x++)v.push("\u5E8F\u53F7"+x);return v},N=o(null);let m=null;const j=o([]);window.addEventListener("resize",function(){m==null||m.resize()}),_e(()=>n.granularity,()=>{T()});const se=o([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"230px"},{label:"\u5F00\u59CB\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"eleActiveStart",istrue:!0,formatter:h},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"createTimeMin",formatter:L,width:"150px",istrue:!0}]},{label:"\u7ED3\u675F\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"eleActiveEnd",istrue:!0,formatter:h},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"createTimeMax",formatter:L,width:"150px",istrue:!0}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eleActive",istrue:!0,formatter:h},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),z=async()=>{_.value=!0;try{if(d.value==null)return void alert("\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4");if(d.value!=null){const e=K(Q(X(d.value[0]))),t=K(Q(X(d.value[1])));n.timeRange=[e,t]}d.value==null&&(n.timeRange=void 0);const a=await W.getCabinetEleTotalRealtime(n);j.value=a.list.map(e=>{return t=e.eleActive,v=1,isNaN(t)?null:Number(t).toFixed(v);var t,v}),p.value=a.list,P.value=a.total,a.total>1e4?y.value=1e4:y.value=a.total}finally{N.value&&F&&(m=Ve(N.value),m.setOption({title:{text:"\u5404\u673A\u67DC\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:ue},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:oe(n.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:j.value,label:{show:!0,position:"top"},barWidth:50}]}),m.on("click",function(a){R(p.value[a.dataIndex].roomId,p.value[a.dataIndex].createTimeMin,p.value[a.dataIndex].createTimeMax)}),F.appContext.config.globalProperties.rankChart=m),_.value=!1}};function ue(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+p.value[t.dataIndex].location+"<br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+$(null,null,p.value[t.dataIndex].createTimeMin)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+h(null,null,p.value[t.dataIndex].eleActiveStart)+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+$(null,null,p.value[t.dataIndex].createTimeMax)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+h(null,null,p.value[t.dataIndex].eleActiveEnd)+"kWh <br/>"+t.marker+"\u8017\u7535\u91CF\uFF1A"+h(null,null,p.value[t.dataIndex].eleActive)+"kWh"}const pe=De(()=>{const a=Math.ceil(y.value/n.pageSize);return n.pageNo===a&&y.value>=1e4});function $(a,e,t){return t?q(t).format("YYYY-MM-DD"):""}function L(a,e,t){return t?q(t).format("YYYY-MM-DD"):""}function h(a,e,t){return t==null?"":Number(t).toFixed(1)}const de=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},T=()=>{n.pageNo=1,z()},ce=async a=>{let e=[];a.forEach(t=>{t.type==3&&e.push(t.id)}),e.length==0&&a.length!=0&&(e.push(0),m==null||m.clear(),Se({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),n.cabinetIds=e,T()},me=async()=>{try{await Z.exportConfirm(),n.pageNo=1,I.value=!0;const a={timeout:0},e=await W.getCabinetEleTotalRealtimeExcel(n,a);await $e.excel(e,"\u673A\u67DC\u5B9E\u65F6\u80FD\u8017.xlsx")}catch{}finally{I.value=!1}},R=(a,e,t)=>{ee("/cabinet/nenghao/powerAnalysis?start="+e+"&end="+t+"&id="+a)},O=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return Me(()=>{(async()=>{const t=await Le.getRoomMenuAll({});E.value=t})(),(async()=>{const t=await W.getNavNewData({});ae.value=t.day,te.value=t.week,le.value=t.month})();const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);d.value=[O(e),O(a)],z()}),(a,e)=>{const t=Ye,v=Ae,x=Ie,D=Ne,ge=ze,M=Te,ve=Re,fe=je,he=Pe,xe=Fe,V=Ue;return g(),w(xe,{dataList:r(E),onCheck:ce,navTitle:"\u673A\u67DC\u5B9E\u65F6\u80FD\u8017"},{NavInfo:i(()=>[Be,b(),He,Ge]),ActionBar:i(()=>[u(ge,{class:"-mb-15px",model:r(n),ref_key:"queryFormRef",ref:re,inline:!0,"label-width":"auto"},{default:i(()=>[u(v,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[u(t,{"value-format":"YYYY-MM-DD",modelValue:r(d),"onUpdate:modelValue":e[0]||(e[0]=l=>Ce(d)?d.value=l:null),type:"daterange",shortcuts:ie,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":de},null,8,["modelValue"])]),_:1}),u(v,null,{default:i(()=>[u(D,{onClick:T},{default:i(()=>[u(x,{icon:"ep:search",class:"mr-5px"}),b(" \u641C\u7D22")]),_:1}),u(D,{type:"success",plain:"",loading:r(I),onClick:me},{default:i(()=>[u(x,{icon:"ep:download",class:"mr-5px"}),b(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:i(()=>[B((g(),w(ve,{data:r(p),stripe:!0,"show-overflow-tooltip":!0},U({default:i(()=>[u(M,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:l})=>[b(H(l+1+(r(n).pageNo-1)*r(n).pageSize),1)]),_:1}),(g(!0),S(Y,null,G(r(se),l=>(g(),S(Y,{key:l.label},[!l.children&&l.istrue?(g(),w(M,{key:l.prop,label:l.label,align:l.align,prop:l.prop,formatter:l.formatter,width:l.width},U({_:2},[l.slot==="actions"?{name:"default",fn:i(({row:c})=>[u(D,{link:"",type:"primary",onClick:C=>R(c.id,String(r(d)[0]),String(r(d)[1]))},{default:i(()=>[b("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):l.istrue?(g(),w(M,{key:1,label:l.label,align:l.align},{default:i(()=>[(g(!0),S(Y,null,G(l.children,c=>(g(),S(Y,{key:c.prop},[c.istrue?(g(),w(M,{key:c.prop,label:c.label,align:c.align,prop:c.prop,formatter:c.formatter,width:c.width},U({_:2},[c.slot==="actions"?{name:"default",fn:i(({row:C})=>[u(D,{link:"",type:"primary",onClick:ta=>R(C.id,C.createTimeMin,C.createTimeMax)},{default:i(()=>[b("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):J("",!0)],64))),128))]),_:2},1032,["label","align"])):J("",!0)],64))),128))]),_:2},[r(pe)?{name:"append",fn:i(()=>[Je]),key:"0"}:void 0]),1032,["data"])),[[V,r(_)]]),u(fe,{total:r(y),"page-size-arr":r(ne),layout:"sizes, prev, pager, next, jumper",page:r(n).pageNo,"onUpdate:page":e[1]||(e[1]=l=>r(n).pageNo=l),limit:r(n).pageSize,"onUpdate:limit":e[2]||(e[2]=l=>r(n).pageSize=l),onPagination:z},null,8,["total","page-size-arr","page","limit"]),s("div",Ke,"\u5171 "+H(r(P))+" \u6761",1),Qe,Xe,Ze,ea,u(he,null,{default:i(()=>[B(s("div",{ref_key:"rankChartContainer",ref:N,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[V,r(_)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-2eefc587"]]);export{aa as default};
