import{d as xe,u as be,e as o,an as we,f as ke,aj as De,g as _e,aX as E,h as Me,o as v,n as w,w as i,l as x,k as u,a as r,m as Ye,s as V,aY as W,t as H,c as N,F as z,p as J,q as G,j as s,aZ as Ne,P as ze,O as Ce,_ as Se,A as Ae,Q as Ie,D as Te,G as Ee,R as We,J as Re,K as Fe}from"./index-mcOGIq4g.js";import{_ as Ue}from"./CommonMenu-CxUjeIT-.js";import{_ as Ke}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Pe}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as je}from"./download--D_IyRio.js";import{E as R}from"./index-5UHMZISN.js";import{f as Q,g as Be,c as X,e as Le}from"./formatTime-f-_athMZ.js";import{I as qe}from"./index-D-gmWooi.js";import"./index-KYPw-eK3.js";import{P as C}from"./PDU-QxJ-Axz0.js";import{u as Oe}from"./useMessage-CGTQbR_M.js";import{i as Ve}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as He}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const f=k=>(Re("data-v-949c6e92"),k=k(),Fe(),k),Je=f(()=>s("br",null,null,-1)),Ge=f(()=>s("br",null,null,-1)),Qe=f(()=>s("div",{class:"nav_data"},[s("div",{class:"descriptions-container",style:{"font-size":"14px"}},[s("div",{class:"description-item"},[s("span",{class:"label"},"\u6309\u65F6\u95F4\u8303\u56F4\u67E5\u8BE2\u5B9E\u65F6\u80FD\u8017")])])],-1)),Xe=f(()=>s("tr",null,[s("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[s("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),Ze={class:"realTotal"},$e=f(()=>s("br",null,null,-1)),ea=f(()=>s("br",null,null,-1)),aa=f(()=>s("br",null,null,-1)),ta=f(()=>s("br",null,null,-1)),la=He(xe({name:"PowerAnalysis",__name:"bus",setup(k){const Z=Oe(),{push:$}=be(),F=o([]),ee=o(0),ae=o(0),te=o(0),U=we(),D=o(!1),p=o([]),b=o(0),K=o(0),d=o(void 0),l=ke({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,devkeys:[]}),le=o([15,30,50,100]),ne=o(),S=o(!1);o([{imgUrl:C},{imgUrl:C},{imgUrl:C},{imgUrl:C}]);const re=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],ie=a=>{const e=(a-1)*l.pageSize+1,t=a*l.pageSize,g=[];for(let y=e;y<=t;y++)g.push("\u5E8F\u53F7"+y);return g},A=o(null);let m=null;const P=o([]),oe=a=>{const e=(a-1)*l.pageSize+1;return a*l.pageSize-e+1};window.addEventListener("resize",function(){m==null||m.resize()}),De(()=>l.granularity,()=>{T()});const se=o([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"250%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"devKey",istrue:!0,width:"180px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"busName",istrue:!0,width:"100%"},{label:"\u5F00\u59CB\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"eleActiveStart",istrue:!0,formatter:h},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"createTimeMin",formatter:B,width:"110px",istrue:!0}]},{label:"\u7ED3\u675F\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"eleActiveEnd",istrue:!0,formatter:h},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"createTimeMax",formatter:B,width:"110px",istrue:!0}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eleActive",istrue:!0,formatter:h},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),I=async()=>{D.value=!0;try{if(d.value==null)return void alert("\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4");if(d.value!=null){const e=Q(Be(X(d.value[0]))),t=Q(Le(X(d.value[1])));l.timeRange=[e,t]}d.value==null&&(l.timeRange=void 0);const a=await R.getBusEleTotalRealtime(l);P.value=a.list.map(e=>{return t=e.eleActive,g=1,isNaN(t)?null:Number(t).toFixed(g);var t,g}),p.value=a.list,K.value=a.total,a.total>1e4?b.value=1e4:b.value=a.total}finally{(()=>{if(A.value&&U){const e=oe(l.pageNo);m=Ve(A.value),m.setOption({title:{text:"\u5404\u59CB\u7AEF\u7BB1\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:ue},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:ie(l.pageNo),axisLabel:{interval:0,formatter:function(t,g){return e>30?"":t}}},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:P.value,barWidth:"auto",label:{show:e<=30,position:"top"}}]}),U.appContext.config.globalProperties.rankChart=m}})(),D.value=!1}};function ue(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+(p.value[t.dataIndex].location?p.value[t.dataIndex].location:"\u672A\u7ED1\u5B9A\u8BBE\u5907")+"<br/>"+t.marker+"\u8BBE\u5907\u5730\u5740\uFF1A"+p.value[t.dataIndex].devKey+"<br/>"+t.marker+"\u8BBE\u5907\u540D\u79F0\uFF1A"+p.value[t.dataIndex].busName+"<br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+j(null,null,p.value[t.dataIndex].createTimeMin)+"\u5F00\u59CB\u7535\u80FD\uFF1A"+h(null,null,p.value[t.dataIndex].eleActiveStart)+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+j(null,null,p.value[t.dataIndex].createTimeMax)+"\u7ED3\u675F\u7535\u80FD\uFF1A"+h(null,null,p.value[t.dataIndex].eleActiveEnd)+"kWh <br/>"+t.marker+"\u8017\u7535\u91CF\uFF1A"+h(null,null,p.value[t.dataIndex].eleActive)+"kWh"}const pe=_e(()=>{const a=Math.ceil(b.value/l.pageSize);return l.pageNo===a&&b.value>=1e4});function j(a,e,t){return t?E(t).format("YYYY-MM-DD"):""}function B(a,e,t){return t?E(t).format("YYYY-MM-DD"):""}function h(a,e,t){return t==null?"":Number(t).toFixed(1)}const de=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},T=()=>{l.pageNo=1,I()},ce=async a=>{let e=[];a.forEach(t=>{t.type==6&&e.push(t.unique)}),e.length==0&&a.length!=0&&(e.push(0),m==null||m.clear(),Ne({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),l.devkeys=e,T()},me=async()=>{try{await Z.exportConfirm(),l.pageNo=1,S.value=!0;const a={timeout:0},e=await R.getBusEleTotalRealtimeExcel(l,a);await je.excel(e,"\u59CB\u7AEF\u7BB1\u5B9E\u65F6\u80FD\u8017.xlsx")}catch{}finally{S.value=!1}},L=(a,e,t)=>{$({path:"/bus/nenghao/powerAnalysis/bus",state:{devKey:a,start:e,end:t}})};Me(()=>{(async()=>{const t=await qe.getBusMenu();F.value=t})(),(async()=>{const t=await R.getNavNewData({});ee.value=t.day,ae.value=t.week,te.value=t.month})();const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);d.value=[q(e),q(a)],I()});const q=a=>E(a).format("YYYY-MM-DD");return(a,e)=>{const t=ze,g=Ce,y=Se,_=Ae,ge=Ie,M=Te,ve=Ee,fe=Pe,he=Ke,ye=Ue,O=We;return v(),w(ye,{dataList:r(F),onCheck:ce,navTitle:"\u6BCD\u7EBF\u59CB\u7AEF\u7BB1\u5B9E\u65F6\u80FD\u8017"},{NavInfo:i(()=>[Je,x(),Ge,Qe]),ActionBar:i(()=>[u(ge,{class:"-mb-15px",model:r(l),ref_key:"queryFormRef",ref:ne,inline:!0,"label-width":"auto"},{default:i(()=>[u(g,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[u(t,{"value-format":"YYYY-MM-DD",modelValue:r(d),"onUpdate:modelValue":e[0]||(e[0]=n=>Ye(d)?d.value=n:null),type:"daterange",shortcuts:re,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":de},null,8,["modelValue"])]),_:1}),u(g,null,{default:i(()=>[u(_,{onClick:T},{default:i(()=>[u(y,{icon:"ep:search",class:"mr-5px"}),x(" \u641C\u7D22")]),_:1}),u(_,{type:"success",plain:"",loading:r(S),onClick:me},{default:i(()=>[u(y,{icon:"ep:download",class:"mr-5px"}),x(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:i(()=>[V((v(),w(ve,{data:r(p),"show-overflow-tooltip":!0,"empty-text":"\u6682\u65E0\u6570\u636E"},W({default:i(()=>[u(M,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:n})=>[x(H(n+1+(r(l).pageNo-1)*r(l).pageSize),1)]),_:1}),(v(!0),N(z,null,J(r(se),n=>(v(),N(z,{key:n.label},[!n.children&&n.istrue?(v(),w(M,{key:n.prop,label:n.label,align:n.align,prop:n.prop,formatter:n.formatter,width:n.width},W({_:2},[n.slot==="actions"?{name:"default",fn:i(({row:c})=>[u(_,{link:"",type:"primary",onClick:Y=>L(c.devKey,String(r(d)[0]),String(r(d)[1]))},{default:i(()=>[x("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):n.istrue?(v(),w(M,{key:1,label:n.label,align:n.align},{default:i(()=>[(v(!0),N(z,null,J(n.children,c=>(v(),N(z,{key:c.prop},[c.istrue?(v(),w(M,{key:c.prop,label:c.label,align:c.align,prop:c.prop,formatter:c.formatter,width:c.width},W({_:2},[c.slot==="actions"?{name:"default",fn:i(({row:Y})=>[u(_,{link:"",type:"primary",onClick:na=>L(Y.devKey,Y.createTimeMin,Y.createTimeMax)},{default:i(()=>[x("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):G("",!0)],64))),128))]),_:2},1032,["label","align"])):G("",!0)],64))),128))]),_:2},[r(pe)?{name:"append",fn:i(()=>[Xe]),key:"0"}:void 0]),1032,["data"])),[[O,r(D)]]),u(fe,{total:r(b),"page-size-arr":r(le),layout:"sizes, prev, pager, next, jumper",page:r(l).pageNo,"onUpdate:page":e[1]||(e[1]=n=>r(l).pageNo=n),limit:r(l).pageSize,"onUpdate:limit":e[2]||(e[2]=n=>r(l).pageSize=n),onPagination:I},null,8,["total","page-size-arr","page","limit"]),s("div",Ze,"\u5171 "+H(r(K))+" \u6761",1),$e,ea,aa,ta,u(he,null,{default:i(()=>[V(s("div",{ref_key:"rankChartContainer",ref:A,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[O,r(D)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-949c6e92"]]);export{la as default};
