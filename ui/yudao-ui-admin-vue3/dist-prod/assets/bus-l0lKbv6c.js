import{d as de,u as be,e as s,f as ge,g as he,aj as xe,aX as O,h as fe,o as d,n as E,w as _,l as w,j as m,t as y,a as t,k as o,m as Q,s as we,aY as ye,c as B,F as X,p as ke,q as S,aZ as De,S as Ce,N as Be,O as Ne,c5 as Ye,P as Ae,_ as Me,A as ze,Q as He,D as Ve,G as Ee,R as Se,J as Fe,K as Ie}from"./index-mcOGIq4g.js";import{_ as Re}from"./CommonMenu-CxUjeIT-.js";import{_ as Ue}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as je}from"./download--D_IyRio.js";import{E as F}from"./index-CrozypxO.js";import{f as Z}from"./formatTime-f-_athMZ.js";import{I as qe}from"./index-D-gmWooi.js";import{u as Pe}from"./useMessage-CGTQbR_M.js";import{_ as Te}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const b=k=>(Fe("data-v-ca9b7754"),k=k(),Ie(),k),We=b(()=>m("br",null,null,-1)),Ge=b(()=>m("br",null,null,-1)),Ke={class:"nav_data"},Le={class:"descriptions-container",style:{"font-size":"14px"}},Je={class:"description-item"},Oe=b(()=>m("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),Qe={class:"value"},Xe={class:"description-item"},Ze=b(()=>m("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),$e={class:"value"},ea={class:"description-item"},aa=b(()=>m("span",{class:"label"},"\u6700\u8FD1\u4E00\u5C0F\u65F6 :",-1)),ta={class:"value"},la=b(()=>m("div",null,[m("span",null,"\u5168\u90E8\u59CB\u7AEF\u7BB1\u65B0\u589E\u73AF\u5883\u8BB0\u5F55"),m("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ra={key:0},na=b(()=>m("tr",null,[m("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[m("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ia={key:0,class:"realTotal"},ma=Te(de({name:"BusEnvHistoryData",__name:"bus",setup(k){const{push:$}=be(),I=s([]),R=s(0),U=s(0),j=s(0),ee=Pe(),N=s(!0),Y=s([]),g=s(0),q=s(0),c=s(),l=ge({pageNo:1,pageSize:15,granularity:"realtime",timeRange:void 0,devkeys:[]}),ae=s([15,30,50,100]),te=s(),A=s(!1),le=[{text:"\u6700\u8FD1\u4E00\u5C0F\u65F6",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-1),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5929",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-1),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}}],re={multiple:!0},h=s([["tem_a"],["tem_b"],["tem_c"],["tem_n"],["dev_key"]]),M=s([{value:"tem_a",label:"A\u8DEF\u6E29\u5EA6"},{value:"tem_b",label:"B\u8DEF\u6E29\u5EA6"},{value:"tem_c",label:"C\u8DEF\u6E29\u5EA6"},{value:"tem_n",label:"\u4E2D\u7EBF\u6E29\u5EA6"},{value:"dev_key",label:"\u8BBE\u5907\u5730\u5740"}]),z=s(["tem_a","tem_b","tem_c","tem_n","dev_key"]),ne=a=>{let e=a.map(u=>u[u.length-1]),r=z.value.filter(u=>!e.includes(u));D.value.forEach(u=>{var v,C;for(const f of e)if((v=u.prop)!=null&&v.startsWith(f)){u.istrue=!0;break}for(const f of r)if((C=u.prop)!=null&&C.startsWith(f)){u.istrue=!1;break}})},ie=he(()=>{const a=Math.ceil(g.value/l.pageSize);return l.pageNo===a&&g.value>=1e4});xe(()=>l.granularity,a=>{a=="realtime"?(h.value=[["tem_a"],["tem_b"],["tem_c"],["tem_n"],["dev_key"]],M.value=[{value:"tem_a",label:"A\u8DEF\u6E29\u5EA6"},{value:"tem_b",label:"B\u8DEF\u6E29\u5EA6"},{value:"tem_c",label:"C\u8DEF\u6E29\u5EA6"},{value:"tem_n",label:"\u4E2D\u7EBF\u6E29\u5EA6"},{value:"dev_key",label:"\u8BBE\u5907\u5730\u5740"}],z.value=["tem_a","tem_b","tem_c","tem_n","dev_key"],D.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"250px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u65F6\u95F4",align:"center",prop:"create_time",width:"200px",formatter:p,istrue:!0},{label:"A\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a",istrue:!0,formatter:n,width:"110px"},{label:"B\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b",istrue:!0,formatter:n,width:"110px"},{label:"C\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c",istrue:!0,formatter:n,width:"110px"},{label:"\u4E2D\u7EBF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n",istrue:!0,formatter:n,width:"110px"},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}],l.pageNo=1,l.pageSize=15,x()):(h.value=[["tem_a_value","tem_a_avg_value"],["tem_a_value","tem_a_max"],["tem_a_value","tem_a_min"],["tem_b_value","tem_b_avg_value"],["tem_b_value","tem_b_max"],["tem_b_value","tem_b_min"],["tem_c_value","tem_c_avg_value"],["tem_c_value","tem_c_max"],["tem_c_value","tem_c_min"],["tem_n_value","tem_n_avg_value"],["tem_n_value","tem_n_max"],["tem_n_value","tem_n_min"]],M.value=[{value:"tem_a_value",label:"A\u8DEF\u6E29\u5EA6",children:[{value:"tem_a_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_a_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_a_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"tem_b_value",label:"B\u8DEF\u6E29\u5EA6",children:[{value:"tem_b_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_b_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_b_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"tem_c_value",label:"C\u8DEF\u6E29\u5EA6",children:[{value:"tem_c_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_c_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_c_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"tem_n_value",label:"\u4E2D\u7EBF\u6E29\u5EA6",children:[{value:"tem_n_avg_value",label:"\u5E73\u5747\u6E29\u5EA6"},{value:"tem_n_max",label:"\u6700\u9AD8\u6E29\u5EA6"},{value:"tem_n_min",label:"\u6700\u4F4E\u6E29\u5EA6"}]},{value:"dev_key",label:"\u8BBE\u5907\u5730\u5740"}],z.value=["tem_a_avg_value","tem_a_max","tem_a_min","tem_b_avg_value","tem_b_max","tem_b_min","tem_c_avg_value","tem_c_max","tem_c_min","tem_n_avg_value","tem_n_max","tem_n_min","dev_key"],D.value=[{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"250px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u8BB0\u5F55\u65F6\u95F4",align:"center",prop:"create_time",width:"230px",istrue:!0,formatter:p},{label:"A\u8DEF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a_avg_value",istrue:!0,width:"180px",formatter:n},{label:"A\u8DEF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a_max_value",istrue:!0,width:"180px",formatter:n},{label:"A\u8DEF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_a_max_time",width:"230px",istrue:!0,formatter:p},{label:"A\u8DEF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a_min_value",istrue:!0,width:"180px",formatter:n},{label:"A\u8DEF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_a_min_time",width:"230px",istrue:!0},{label:"B\u8DEF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b_avg_value",istrue:!0,width:"180px",formatter:n},{label:"B\u8DEF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b_max_value",istrue:!0,width:"180px",formatter:n},{label:"B\u8DEF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_b_max_time",width:"230px",istrue:!0,formatter:p},{label:"B\u8DEF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b_min_value",istrue:!0,width:"180px",formatter:n},{label:"B\u8DEF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_b_min_time",width:"230px",istrue:!0,formatter:p},{label:"C\u8DEF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c_avg_value",istrue:!0,width:"180px",formatter:n},{label:"C\u8DEF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c_max_value",istrue:!0,width:"180px",formatter:n},{label:"C\u8DEF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_c_max_time",width:"230px",istrue:!0,formatter:p},{label:"C\u8DEF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c_min_value",istrue:!0,width:"180px",formatter:n},{label:"C\u8DEF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_c_min_time",width:"230px",istrue:!0,formatter:p},{label:"\u4E2D\u7EBF\u5E73\u5747\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n_avg_value",istrue:!0,width:"180px",formatter:n},{label:"\u4E2D\u7EBF\u6700\u9AD8\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n_max_value",istrue:!0,width:"180px",formatter:n},{label:"\u4E2D\u7EBF\u6700\u9AD8\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_n_max_time",width:"230px",istrue:!0,formatter:p},{label:"\u4E2D\u7EBF\u6700\u4F4E\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n_min_value",istrue:!0,width:"180px",formatter:n},{label:"\u4E2D\u7EBF\u6700\u4F4E\u6E29\u5EA6\u65F6\u95F4",align:"center",prop:"tem_n_min_time",width:"230px",istrue:!0,formatter:p},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"160px"}],l.pageNo=1,l.pageSize=15,x())});const D=s([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"250px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"200%"},{label:"\u65F6\u95F4",align:"center",prop:"create_time",width:"200px",formatter:p,istrue:!0},{label:"A\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_a",istrue:!0,formatter:n,width:"110px"},{label:"B\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_b",istrue:!0,formatter:n,width:"110px"},{label:"C\u8DEF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_c",istrue:!0,formatter:n,width:"110px"},{label:"\u4E2D\u7EBF\u6E29\u5EA6(\u2103)",align:"center",prop:"tem_n",istrue:!0,formatter:n,width:"110px"},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),x=async()=>{N.value=!0;try{if(c.value!=null){const e=Z(c.value[0]),r=Z(c.value[1]);l.timeRange=[e,r]}const a=await F.getBusEnvDataPage(l);Y.value=a.list,q.value=a.total,a.total>1e4?g.value=1e4:g.value=a.total}finally{N.value=!1}};function p(a,e,r){return r?O(r).format("YYYY-MM-DD HH:mm"):""}function n(a,e,r){return Number(r).toFixed(0)}const me=async a=>{let e=[];a.forEach(r=>{r.type==6&&e.push(r.unique)}),e.length==0&&a.length!=0&&(e.push(0),De({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),l.devkeys=e,P()},oe=a=>a>new Date,P=()=>{l.pageNo=1,x()},se=async()=>{try{await ee.exportConfirm(),l.pageNo=1,A.value=!0;const a={timeout:0},e=await F.exportBusEnvHistoryData(l,a);await je.excel(e,"\u59CB\u7AEF\u7BB1\u73AF\u5883\u5386\u53F2\u6570\u636E.xlsx")}catch{}finally{A.value=!1}},T=a=>O(a).format("YYYY-MM-DD HH:mm:ss");return fe(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);c.value=[T(e),T(a)],(async()=>{const r=await qe.getBusMenu();I.value=r})(),(async()=>{const r=await F.getBusEnvNavNewData();R.value=r.hour,U.value=r.day,j.value=r.week})(),x()}),(a,e)=>{const r=Ce,u=Be,v=Ne,C=Ye,f=Ae,W=Me,H=ze,_e=He,G=Ve,ue=Ee,pe=Ue,ce=Re,ve=Se;return d(),E(ce,{dataList:t(I),onCheck:me,navTitle:"\u59CB\u7AEF\u7BB1\u6E29\u5EA6\u6570\u636E"},{NavInfo:_(()=>[We,w(),Ge,m("div",Ke,[m("div",Le,[m("div",Je,[Oe,m("span",Qe,y(t(j))+"\u6761",1)]),m("div",Xe,[Ze,m("span",$e,y(t(U))+"\u6761",1)]),m("div",ea,[aa,m("span",ta,y(t(R))+"\u6761",1)]),la])])]),ActionBar:_(()=>[o(_e,{class:"-mb-15px",model:t(l),ref_key:"queryFormRef",ref:te,inline:!0,"label-width":"auto"},{default:_(()=>[o(v,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:_(()=>[o(u,{modelValue:t(l).granularity,"onUpdate:modelValue":e[0]||(e[0]=i=>t(l).granularity=i),placeholder:"\u8BF7\u9009\u62E9\u5206\u949F/\u5C0F\u65F6/\u5929",class:"!w-100px"},{default:_(()=>[o(r,{label:"\u5206\u949F",value:"realtime"}),o(r,{label:"\u5C0F\u65F6",value:"hour"}),o(r,{label:"\u5929",value:"day"})]),_:1},8,["modelValue"])]),_:1}),o(v,{label:"\u7B5B\u9009\u5217"},{default:_(()=>[o(C,{modelValue:t(h),"onUpdate:modelValue":e[1]||(e[1]=i=>Q(h)?h.value=i:null),options:t(M),props:re,"collapse-tags":"","collapse-tags-tooltip":"","show-all-levels":!1,onChange:ne,class:"!w-200px"},null,8,["modelValue","options"])]),_:1}),o(v,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:_(()=>[o(f,{"value-format":"YYYY-MM-DD HH:mm:ss",modelValue:t(c),"onUpdate:modelValue":e[2]||(e[2]=i=>Q(c)?c.value=i:null),type:"datetimerange",shortcuts:le,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":oe,class:"!w-335px"},null,8,["modelValue"])]),_:1}),o(v,null,{default:_(()=>[o(H,{onClick:P},{default:_(()=>[o(W,{icon:"ep:search",class:"mr-5px"}),w(" \u641C\u7D22")]),_:1}),o(H,{type:"success",plain:"",onClick:se,loading:t(A)},{default:_(()=>[o(W,{icon:"ep:download",class:"mr-5px"}),w(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:_(()=>[we((d(),E(ue,{data:t(Y),"show-overflow-tooltip":!1},ye({default:_(()=>[o(G,{label:"\u5E8F\u53F7",align:"center",width:"100px"},{default:_(({$index:i})=>[w(y(i+1+(t(l).pageNo-1)*t(l).pageSize),1)]),_:1}),(d(!0),B(X,null,ke(t(D),i=>(d(),B(X,null,[i.istrue?(d(),E(G,{key:i.prop,label:i.label,align:i.align,prop:i.prop,formatter:i.formatter,width:i.width},{default:_(({row:V})=>[i.slot==="actions"?(d(),B("div",ra,[o(H,{link:"",type:"primary",onClick:oa=>{return K=V.bus_id,L=V.dev_key,J=V.location,void $({path:"/bus/record/envAnalysis/bus",state:{busId:K,devKey:L,location:J}});var K,L,J}},{default:_(()=>[w("\u8BE6\u60C5")]),_:2},1032,["onClick"])])):S("",!0)]),_:2},1032,["label","align","prop","formatter","width"])):S("",!0)],64))),256))]),_:2},[t(ie)?{name:"append",fn:_(()=>[na]),key:"0"}:void 0]),1032,["data"])),[[ve,t(N)]]),o(pe,{total:t(g),"page-size-arr":t(ae),layout:"sizes, prev, pager, next, jumper",page:t(l).pageNo,"onUpdate:page":e[3]||(e[3]=i=>t(l).pageNo=i),limit:t(l).pageSize,"onUpdate:limit":e[4]||(e[4]=i=>t(l).pageSize=i),onPagination:x},null,8,["total","page-size-arr","page","limit"]),t(Y).length!=0?(d(),B("div",ia,"\u5171 "+y(t(q))+" \u6761",1)):S("",!0)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-ca9b7754"]]);export{ma as default};
