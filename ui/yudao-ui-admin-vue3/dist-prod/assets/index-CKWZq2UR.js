import{d as Te,e as l,an as Pe,f as Ie,aj as ve,h as Ee,T as ce,o as v,n as _,w as m,l as F,j as o,a as n,c as w,t as f,q as I,F as ne,k as r,m as ye,s as Me,p as Ce,aZ as Fe,L as Se,M as Re,P as Ne,O as Ve,_ as Le,A as Oe,Q as Ye,D as qe,G as ze,R as Be,J as Ge,K as Ze}from"./index-mcOGIq4g.js";import"./index-KYPw-eK3.js";import{H as ge}from"./index-1a85tQeY.js";import{f as H}from"./formatTime-f-_athMZ.js";import{C as je}from"./index-JEsRnusb.js";import{d as Ue}from"./download--D_IyRio.js";import Je from"./CommonMenu1-CqqTrekC.js";import{u as Ke}from"./useMessage-CGTQbR_M.js";import{i as re}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as Qe}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./install-DiAPpr4Z.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";const b=E=>(Ge("data-v-c3e74d98"),E=E(),Ze(),E),$e=b(()=>o("br",null,null,-1)),We=b(()=>o("br",null,null,-1)),Xe={class:"nav_data"},ea={class:"nav_header"},aa={key:0,style:{"font-size":"14px"}},ta=b(()=>o("br",null,null,-1)),la=b(()=>o("span",null,"\u81F3",-1)),na={class:"description-item"},ra=b(()=>o("span",{class:"label"},"\u6700\u5927\u503C :",-1)),sa={key:2,class:"description-item"},oa=b(()=>o("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ia={class:"value"},ua=b(()=>o("br",null,null,-1)),ma={class:"description-item"},da=b(()=>o("span",{class:"label"},"\u6700\u5C0F\u503C :",-1)),pa={key:3,class:"description-item"},va=b(()=>o("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ca={class:"value"},ya=b(()=>o("div",{style:{"text-align":"center"}},[o("div",{class:"line",style:{"margin-top":"10px"}})],-1)),ga={style:{height:"67vh"}},ba=Te({name:"CabinetHistoryLine",__name:"index",setup(E){const S=l([]),D=l(""),R=l(""),y=l("realtimeTabPane"),N=l("myChart"),se=Pe(),oe=l([]),T=l([]),V=l(!1),be=Ke(),L=l(!1),ie=l(0),u=Ie({rackId:void 0,granularity:"realtime",nowAddress:void 0,timeRange:C(1)}),O=l(!1),xe=[{text:"\u6700\u8FD1\u4E00\u5C0F\u65F6",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-1),[e,a]}},{text:"\u6700\u8FD1\u5341\u4E8C\u5C0F\u65F6",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-12),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5929",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-24),[e,a]}},{text:"\u6700\u8FD1\u4E24\u5929",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-48),[e,a]}}],fe=[{text:"\u6700\u8FD1\u4E00\u5929",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-24),[e,a]}},{text:"\u6700\u8FD1\u4E09\u5929",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-72),[e,a]}},{text:"\u6700\u8FD1\u4E03\u5929",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-168),[e,a]}}],he=[{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-720),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-2160),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-4320),[e,a]}}],x=l([]),k=l([]),Y=l([]),q=l([]),z=l([]),B=l([]),G=l([]),Z=l([]),j=l([]),U=l([]),J=l([]),K=l([]),Q=l([]),$=l(0),W=l(),X=l(0),ee=l(),A=l(!1),ae=async()=>{O.value=!0;try{const a=await ge.getHistoryDataDetails(u);a!=null&&a.total!=0?(V.value=!0,A.value=!0,k.value=a.list.map(e=>g(e.active_total,3)),Y.value=a.list.map(e=>g(e.apparent_total,3)),y.value==="dayExtremumTabPane"?x.value=a.list.map(e=>H(e.create_time,"YYYY-MM-DD")):x.value=a.list.map(e=>H(e.create_time)),q.value=a.list.map(e=>g(e.active_total_avg_value,3)),z.value=a.list.map(e=>g(e.active_total_max_value,3)),B.value=a.list.map(e=>H(e.active_total_max_time)),G.value=a.list.map(e=>g(e.active_total_min_value,3)),Z.value=a.list.map(e=>H(e.active_total_min_time)),j.value=a.list.map(e=>g(e.apparent_total_avg_value,3)),U.value=a.list.map(e=>g(e.apparent_total_max_value,3)),J.value=a.list.map(e=>H(e.apparent_total_max_time)),K.value=a.list.map(e=>g(e.apparent_total_min_value,3)),Q.value=a.list.map(e=>H(e.apparent_total_min_time)),$.value=Math.max(...k.value),X.value=Math.min(...k.value),k.value.forEach(function(e,t){e==$.value&&(W.value=x.value[t]),e==X.value&&(ee.value=x.value[t])}),D.value=R.value):(A.value=!1,V.value=!1,Fe({message:"\u6682\u65E0\u6570\u636E",type:"warning"}))}finally{O.value=!1}},te=l(null);let s=null;const ue=()=>{s==null||s.dispose()};window.addEventListener("resize",function(){s==null||s.resize()}),ve(()=>y.value,async a=>{a=="realtimeTabPane"?(u.granularity="realtime",u.timeRange=C(1)):a=="hourExtremumTabPane"?(u.granularity="hour",u.timeRange=C(24)):(u.granularity="day",u.timeRange=C(720)),ie.value++}),ve(()=>[y.value,ie.value],async a=>{const[e]=a;e=="realtimeTabPane"?(await ae(),ue(),A.value==1&&(s=re(document.getElementById("chartContainer")),s&&s.setOption({title:{text:""},tooltip:{trigger:"axis",formatter:M},legend:{data:["\u6709\u529F\u529F\u7387","\u89C6\u5728\u529F\u7387"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:x.value},yAxis:{type:"value"},series:[{name:"\u6709\u529F\u529F\u7387",type:"line",symbol:"none",data:k.value},{name:"\u89C6\u5728\u529F\u7387",type:"line",symbol:"none",data:Y.value}],dataZoom:[{type:"inside"}]}))):(await ae(),ue(),A.value==1&&(s=re(document.getElementById("chartContainer")),s&&s.setOption({title:{text:""},tooltip:{trigger:"axis",formatter:M},legend:{data:["\u5E73\u5747\u6709\u529F\u529F\u7387","\u6700\u5927\u6709\u529F\u529F\u7387","\u6700\u5C0F\u6709\u529F\u529F\u7387","\u5E73\u5747\u89C6\u5728\u529F\u7387","\u6700\u5927\u89C6\u5728\u529F\u7387","\u6700\u5C0F\u89C6\u5728\u529F\u7387"],selected:{\u5E73\u5747\u6709\u529F\u529F\u7387:!0,\u6700\u5927\u6709\u529F\u529F\u7387:!1,\u6700\u5C0F\u6709\u529F\u529F\u7387:!1,\u5E73\u5747\u89C6\u5728\u529F\u7387:!0,\u6700\u5927\u89C6\u5728\u529F\u7387:!1,\u6700\u5C0F\u89C6\u5728\u529F\u7387:!1}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:x.value},yAxis:{type:"value"},series:[{name:"\u5E73\u5747\u6709\u529F\u529F\u7387",type:"line",data:q.value},{name:"\u6700\u5927\u6709\u529F\u529F\u7387",type:"line",data:z.value,lineStyle:{type:"dashed"}},{name:"\u6700\u5C0F\u6709\u529F\u529F\u7387",type:"line",data:G.value,lineStyle:{type:"dashed"}},{name:"\u5E73\u5747\u89C6\u5728\u529F\u7387",type:"line",data:j.value},{name:"\u6700\u5927\u89C6\u5728\u529F\u7387",type:"line",data:U.value,lineStyle:{type:"dashed"}},{name:"\u6700\u5C0F\u89C6\u5728\u529F\u7387",type:"line",data:K.value,lineStyle:{type:"dashed"}}],dataZoom:[{type:"inside"}]}))),T.value=s==null?void 0:s.getOption().series,me()});const me=()=>{var a,e;if(A.value==1){const t=[],h=((e=(a=T.value[0])==null?void 0:a.data)==null?void 0:e.length)||0;for(let d=0;d<h;d++){const c={};c.create_time=x.value[d],c.totalActivePowMaxTimeData=B.value[d],c.totalActivePowMinTimeData=Z.value[d],c.totalApparentPowMaxTimeData=J.value[d],c.totalApparentPowMinTimeData=Q.value[d];for(const P of T.value)c[P.name]=P.data[d];t.push(c)}oe.value=t}};function M(a){var e="";return a.forEach(function(t){switch(t.seriesName){case"\u6709\u529F\u529F\u7387":case"\u5E73\u5747\u6709\u529F\u529F\u7387":e+=t.marker+" "+t.seriesName+": "+t.value+" kW  \u8BB0\u5F55\u65F6\u95F4: "+a[0].name+"<br/>";break;case"\u6700\u5927\u6709\u529F\u529F\u7387":e+=t.marker+" "+t.seriesName+": "+t.value+" kW  \u53D1\u751F\u65F6\u95F4: "+B.value[t.dataIndex]+"<br/>";break;case"\u6700\u5C0F\u6709\u529F\u529F\u7387":e+=t.marker+" "+t.seriesName+": "+t.value+" kW  \u53D1\u751F\u65F6\u95F4: "+Z.value[t.dataIndex]+"<br/>";break;case"\u89C6\u5728\u529F\u7387":case"\u5E73\u5747\u89C6\u5728\u529F\u7387":e+=t.marker+" "+t.seriesName+": "+t.value+" kVA  \u8BB0\u5F55\u65F6\u95F4: "+a[0].name+"<br/>";break;case"\u6700\u5927\u89C6\u5728\u529F\u7387":e+=t.marker+" "+t.seriesName+": "+t.value+" kVA  \u53D1\u751F\u65F6\u95F4: "+J.value[t.dataIndex]+"<br/>";break;case"\u6700\u5C0F\u89C6\u5728\u529F\u7387":e+=t.marker+" "+t.seriesName+": "+t.value+" kVA  \u53D1\u751F\u65F6\u95F4: "+Q.value[t.dataIndex]+"<br/>"}}),e}function C(a){var e=60*new Date().getTimezoneOffset()*1e3,t=new Date(new Date().getTime()-e);return[new Date(t.getTime()-36e5*a).toISOString().slice(0,19).replace("T"," "),t.toISOString().slice(0,19).replace("T"," ")]}const _e=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e};function g(a,e){return isNaN(a)?null:Number(a).toFixed(e)}const le=async()=>{await ae(),A.value==1&&te.value&&se&&(s=re(te.value),s&&(y.value=="realtimeTabPane"?s.setOption({title:{text:""},tooltip:{trigger:"axis",formatter:M},legend:{data:["\u6709\u529F\u529F\u7387","\u89C6\u5728\u529F\u7387"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:x.value},yAxis:{type:"value"},series:[{name:"\u6709\u529F\u529F\u7387",type:"line",symbol:"none",data:k.value},{name:"\u89C6\u5728\u529F\u7387",type:"line",symbol:"none",data:Y.value}],dataZoom:[{type:"inside"}]}):s.setOption({title:{text:""},tooltip:{trigger:"axis",formatter:M},legend:{data:["\u5E73\u5747\u6709\u529F\u529F\u7387","\u6700\u5927\u6709\u529F\u529F\u7387","\u6700\u5C0F\u6709\u529F\u529F\u7387","\u5E73\u5747\u89C6\u5728\u529F\u7387","\u6700\u5927\u89C6\u5728\u529F\u7387","\u6700\u5C0F\u89C6\u5728\u529F\u7387"],selected:{\u5E73\u5747\u6709\u529F\u529F\u7387:!0,\u6700\u5927\u6709\u529F\u529F\u7387:!1,\u6700\u5C0F\u6709\u529F\u529F\u7387:!1,\u5E73\u5747\u89C6\u5728\u529F\u7387:!0,\u6700\u5927\u89C6\u5728\u529F\u7387:!1,\u6700\u5C0F\u89C6\u5728\u529F\u7387:!1}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:x.value},yAxis:{type:"value"},series:[{name:"\u5E73\u5747\u6709\u529F\u529F\u7387",type:"line",data:q.value},{name:"\u6700\u5927\u6709\u529F\u529F\u7387",type:"line",data:z.value,lineStyle:{type:"dashed"}},{name:"\u6700\u5C0F\u6709\u529F\u529F\u7387",type:"line",data:G.value,lineStyle:{type:"dashed"}},{name:"\u5E73\u5747\u89C6\u5728\u529F\u7387",type:"line",data:j.value},{name:"\u6700\u5927\u89C6\u5728\u529F\u7387",type:"line",data:U.value,lineStyle:{type:"dashed"}},{name:"\u6700\u5C0F\u89C6\u5728\u529F\u7387",type:"line",data:K.value,lineStyle:{type:"dashed"}}],dataZoom:[{type:"inside"}]})),se.appContext.config.globalProperties.realtimeChart=s),T.value=s==null?void 0:s.getOption().series,me()},we=async a=>{a.type!=null&&a.type==5&&(u.rackId=a.id,de(S.value,a.unique,e=>{R.value=e}),le())};function de(a,e,t,h=""){for(let d of a){const c=h===""?d.name:h+"-"+d.name;d.unique===e&&t(c),d.children&&d.children.length>0&&de(d.children,e,t,c)}}Ee(async()=>{(async()=>{const t=await je.getRackMenuAll({});S.value=t})();const a=ce().query.rackId,e=ce().query.location;u.rackId=a?parseInt(a,10):void 0,u.rackId!=null&&(await le(),D.value=e,R.value=e)});const De=async()=>{try{await be.exportConfirm(),L.value=!0;const a={timeout:0};u.nowAddress=D.value;const e=await ge.getHistoryDataDetailsExcel(u,a);await Ue.excel(e,"\u673A\u67B6\u7535\u529B\u5206\u6790.xlsx")}catch{}finally{L.value=!1}};return(a,e)=>{const t=Se,h=Re,d=Ne,c=Ve,P=Le,pe=Oe,ke=Ye,p=qe,Ae=ze,He=Be;return v(),_(Je,{dataList:n(S),onNodeClick:we,navTitle:"\u673A\u67B6\u7535\u529B\u5206\u6790",showCheckbox:!1},{NavInfo:m(()=>[$e,F(),We,o("div",Xe,[o("div",ea,[n(D)?(v(),w("span",aa,f(n(D)),1)):I("",!0),ta,n(D)&&n(u).timeRange!=null?(v(),w(ne,{key:1},[o("span",null,f(n(u).timeRange[0]),1),la,o("span",null,f(n(u).timeRange[1]),1)],64)):I("",!0),o("div",na,[ra,o("span",null,f(g(n($),3))+" kW",1)]),n(W)?(v(),w("div",sa,[oa,o("span",ia,f(n(W)),1)])):I("",!0),ua,o("div",ma,[da,o("span",null,f(g(n(X),3))+" kW",1)]),n(ee)?(v(),w("div",pa,[va,o("span",ca,f(n(ee)),1)])):I("",!0),ya])])]),ActionBar:m(()=>[r(h,{modelValue:n(y),"onUpdate:modelValue":e[0]||(e[0]=i=>ye(y)?y.value=i:null)},{default:m(()=>[r(t,{label:"\u539F\u59CB\u6570\u636E",name:"realtimeTabPane"}),r(t,{label:"\u5C0F\u65F6\u6781\u503C\u6570\u636E",name:"hourExtremumTabPane"}),r(t,{label:"\u5929\u6781\u503C\u6570\u636E",name:"dayExtremumTabPane"})]),_:1},8,["modelValue"]),r(ke,{class:"-mb-15px",model:n(u),ref:"queryFormRef",inline:!0,"label-width":"70px"},{default:m(()=>[r(c,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:m(()=>[r(d,{"value-format":"YYYY-MM-DD HH:mm:ss",modelValue:n(u).timeRange,"onUpdate:modelValue":e[1]||(e[1]=i=>n(u).timeRange=i),type:"datetimerange",shortcuts:n(y)==="realtimeTabPane"?xe:n(y)==="hourExtremumTabPane"?fe:n(y)==="dayExtremumTabPane"?he:[],"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":_e,class:"!w-350px"},null,8,["modelValue","shortcuts"])]),_:1}),r(c,null,{default:m(()=>[r(pe,{onClick:le},{default:m(()=>[r(P,{icon:"ep:search",class:"mr-5px"}),F(" \u641C\u7D22")]),_:1}),r(pe,{type:"success",plain:"",onClick:De,loading:n(L)},{default:m(()=>[r(P,{icon:"ep:download",class:"mr-5px"}),F(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:m(()=>[Me((v(),w("div",null,[n(V)?(v(),_(h,{key:0,modelValue:n(N),"onUpdate:modelValue":e[2]||(e[2]=i=>ye(N)?N.value=i:null)},{default:m(()=>[r(t,{label:"\u56FE\u8868",name:"myChart"},{default:m(()=>[o("div",{ref_key:"chartContainer",ref:te,id:"chartContainer",style:{width:"70vw",height:"65vh"}},null,512)]),_:1}),r(t,{label:"\u6570\u636E",name:"myData"},{default:m(()=>[o("div",ga,[r(Ae,{border:!0,stripe:!0,data:n(oe),style:{height:"67vh",width:"99.97%"},"header-cell-style":{backgroundColor:"#F5F7FA",color:"#909399",textAlign:"center",borderLeft:"1px #EDEEF2 solid",borderBottom:"1px #EDEEF2 solid",fontFamily:"Microsoft YaHei",fontWeight:"bold"},"cell-style":{color:"#606266",fontSize:"14px",textAlign:"center",borderBottom:"0.25px #F5F7FA solid",borderLeft:"0.25px #F5F7FA solid"},"row-style":{fontSize:"14px",textAlign:"center"},"empty-text":"\u6682\u65E0\u6570\u636E","max-height":"818"},{default:m(()=>[r(p,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:m(({$index:i})=>[F(f(i+1),1)]),_:1}),r(p,{prop:"create_time",label:"\u8BB0\u5F55\u65F6\u95F4"}),(v(!0),w(ne,null,Ce(n(T),i=>(v(),w(ne,{key:i.name},[i.name==="\u6700\u5927\u6709\u529F\u529F\u7387"?(v(),_(p,{key:0,label:"\u6709\u529F\u529F\u7387\u6700\u5927\u503C"},{default:m(()=>[r(p,{prop:i.name,label:"\u6570\u503C"},null,8,["prop"]),r(p,{prop:"totalActivePowMaxTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:2},1024)):i.name==="\u6700\u5C0F\u6709\u529F\u529F\u7387"?(v(),_(p,{key:1,label:"\u6709\u529F\u529F\u7387\u6700\u5C0F\u503C"},{default:m(()=>[r(p,{prop:i.name,label:"\u6570\u503C"},null,8,["prop"]),r(p,{prop:"totalActivePowMinTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:2},1024)):i.name==="\u6700\u5927\u89C6\u5728\u529F\u7387"?(v(),_(p,{key:2,label:"\u89C6\u5728\u529F\u7387\u6700\u5927\u503C"},{default:m(()=>[r(p,{prop:i.name,label:"\u6570\u503C"},null,8,["prop"]),r(p,{prop:"totalApparentPowMaxTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:2},1024)):i.name==="\u6700\u5C0F\u89C6\u5728\u529F\u7387"?(v(),_(p,{key:3,label:"\u89C6\u5728\u529F\u7387\u6700\u5C0F\u503C"},{default:m(()=>[r(p,{prop:i.name,label:"\u6570\u503C"},null,8,["prop"]),r(p,{prop:"totalApparentPowMinTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:2},1024)):(v(),_(p,{key:4,prop:i.name,label:i.name},null,8,["prop","label"]))],64))),128))]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"])):I("",!0)])),[[He,n(O)]])]),_:1},8,["dataList"])}}}),xa=Qe(ba,[["__scopeId","data-v-c3e74d98"]]);export{xa as default};
