import{d as Q,a5 as T,u as Z,e as g,g as A,a as e,f as v,aj as D,s as G,I as H,o as f,n as J,w as o,k as a,c as k,t as F,q as w,x as K,at as W,ab as C,au as X,a8 as Y,Z as $,O as ee,E as ae,z as oe,Q as le}from"./index-mcOGIq4g.js";import{_ as ie}from"./XButton-zTH-RG3W.js";import{u as b}from"./useIcon-p6YtqOQ1.js";import{u as se,L as te,a as ne}from"./useLogin-BGuj3iei.js";import{u as re}from"./useMessage-CGTQbR_M.js";import{r as S}from"./formRules-CpfMmool.js";import{_ as de}from"./_plugin-vue_export-helper-BCo6x5W8.js";const me={key:1,class:"getMobileCode",style:{cursor:"pointer"}},ue=de(Q({name:"MobileForm",__name:"MobileForm",setup(pe){const{t}=K(),N=re(),I=T(),{currentRoute:M,push:V}=Z(),h=g(),u=g(!1);b({icon:"ep:house"});const L=b({icon:"ep:cellphone"}),q=b({icon:"ep:circle-check"}),{validForm:E}=ne(h),{handleBackLogin:j,getLoginState:z}=se(),B=A(()=>e(z)===te.MOBILE),O={mobileNumber:[S],code:[S]},i=v({codeImg:"",token:"",loading:{signIn:!1},loginForm:{uuid:"",mobileNumber:"",code:""}}),r=v({smsCode:{mobile:"",scene:21},loginSms:{mobile:"",code:""}}),s=g(0),p=g(""),P=async()=>{r.smsCode.mobile=i.loginForm.mobileNumber,await W(r.smsCode).then(async()=>{N.success(t("login.SmsSendMsg")),s.value=60;let n=setInterval(()=>{s.value=s.value-1,s.value<=0&&clearInterval(n)},1e3)})};return D(()=>M.value,n=>{var l;p.value=(l=n==null?void 0:n.query)==null?void 0:l.redirect},{immediate:!0}),(n,l)=>{const y=$,c=ee,d=ae,_=oe,x=ie,R=le;return G((f(),J(R,{ref_key:"formSmsLogin",ref:h,model:e(i).loginForm,rules:O,class:"login-form","label-position":"top","label-width":"120px",size:"large"},{default:o(()=>[a(_,{style:{"margin-right":"-10px","margin-left":"-10px"}},{default:o(()=>[a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:o(()=>[a(c,{prop:"mobileNumber"},{default:o(()=>[a(y,{modelValue:e(i).loginForm.mobileNumber,"onUpdate:modelValue":l[0]||(l[0]=m=>e(i).loginForm.mobileNumber=m),placeholder:e(t)("login.mobileNumberPlaceholder"),"prefix-icon":e(L)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:o(()=>[a(c,{prop:"code"},{default:o(()=>[a(_,{gutter:5,justify:"space-between",style:{width:"100%"}},{default:o(()=>[a(d,{span:24},{default:o(()=>[a(y,{modelValue:e(i).loginForm.code,"onUpdate:modelValue":l[1]||(l[1]=m=>e(i).loginForm.code=m),placeholder:e(t)("login.codePlaceholder"),"prefix-icon":e(q)},{append:o(()=>[e(s)<=0?(f(),k("span",{key:0,class:"getMobileCode",style:{cursor:"pointer"},onClick:P},F(e(t)("login.getSmsCode")),1)):w("",!0),e(s)>0?(f(),k("span",me,F(e(s))+"\u79D2\u540E\u53EF\u91CD\u65B0\u83B7\u53D6 ",1)):w("",!0)]),_:1},8,["modelValue","placeholder","prefix-icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:o(()=>[a(c,null,{default:o(()=>[a(x,{loading:e(u),title:e(t)("login.login"),class:"w-[100%]",type:"primary",onClick:l[2]||(l[2]=m=>(async()=>{await E()&&(C.service({lock:!0,text:"\u6B63\u5728\u52A0\u8F7D\u7CFB\u7EDF\u4E2D...",background:"rgba(0, 0, 0, 0.7)"}),u.value=!0,r.loginSms.mobile=i.loginForm.mobileNumber,r.loginSms.code=i.loginForm.code,await X(r.loginSms).then(async U=>{Y(U),p.value||(p.value="/"),V({path:p.value||I.addRouters[0].path})}).catch(()=>{}).finally(()=>{u.value=!1,setTimeout(()=>{C.service().close()},400)}))})())},null,8,["loading","title"])]),_:1})]),_:1}),a(d,{span:24,style:{"padding-right":"10px","padding-left":"10px"}},{default:o(()=>[a(c,null,{default:o(()=>[a(x,{loading:e(u),title:e(t)("login.backLogin"),class:"w-[100%]",onClick:l[3]||(l[3]=m=>e(j)())},null,8,["loading","title"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])),[[H,e(B)]])}}}),[["__scopeId","data-v-734ead92"]]);export{ue as default};
