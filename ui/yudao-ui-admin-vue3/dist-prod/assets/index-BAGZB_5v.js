import{d as he,e as s,aX as P,f as we,aj as xe,g as De,h as Ne,o as v,n as z,w as i,l as D,j as n,t as _,a as t,k as o,m as Q,s as Ye,aY as X,c as W,F as $,p as ke,q as Me,S as ze,N as Ce,O as Se,P as Ve,_ as Fe,A as Ue,Q as qe,D as Be,G as Re,B as Ie,R as Te,J as Pe,K as We}from"./index-mcOGIq4g.js";import{_ as je}from"./CommonMenu-CxUjeIT-.js";import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ee}from"./download--D_IyRio.js";import{E as C}from"./index-D85m9HA9.js";import{f as Z,e as ee,c as ae,a as Le}from"./formatTime-f-_athMZ.js";import{I as He}from"./index-DA5JCs6I.js";import{u as Ge}from"./useMessage-CGTQbR_M.js";import{_ as Je}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const y=N=>(Pe("data-v-1cc6ebef"),N=N(),We(),N),Ke=y(()=>n("br",null,null,-1)),Oe=y(()=>n("br",null,null,-1)),Qe={class:"nav_data"},Xe={class:"descriptions-container",style:{"font-size":"14px"}},$e={class:"description-item"},Ze=y(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ea={class:"value"},aa={class:"description-item"},ta=y(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),la={class:"value"},ra={class:"description-item"},oa=y(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),na={class:"value"},sa={key:1},ia=y(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ua={class:"realTotal"},pa={style:{"font-size":"13px"}},da=he({name:"BillStatistics",__name:"index",setup(N){const j=s([]),A=s(0),E=s(0),L=s(0),Y=s(!1),S=s([]),V=s(""),F=s(""),te=Ge(),U=s(!0),H=s([]),h=s(0),G=s(0);let q=new Date;const m=s([P(new Date(q.getFullYear(),q.getMonth(),1)).format("YYYY-MM-DD"),P(q).format("YYYY-MM-DD")]),l=we({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,roomIds:[]}),le=s([15,30,50,100]),re=s(),B=s(!1),oe=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];xe(()=>l.granularity,()=>{l.granularity=="day"?R.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:k,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:f},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:J},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:R.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u5F00\u59CB\u65E5\u671F",align:"center",prop:"start_time",formatter:k,istrue:!0},{label:"\u7ED3\u675F\u65E5\u671F",align:"center",prop:"end_time",formatter:k,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:f},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:f}],T()});const R=s([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:k,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:f},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:J},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]),ne=a=>{const{columns:e,data:u}=a,p=[];return e.forEach((w,c)=>{if(c===0)return void(p[c]="\u5408\u8BA1");const x=u.map(d=>Number(d[w.property]));x.every(d=>isNaN(d))?p[c]="N/A":(p[c]=x.reduce((d,M)=>{const g=Number(M);return isNaN(g)?d:d+M},0),p[c]=p[c].toFixed(1))}),p},I=async()=>{U.value=!0;try{if(m.value!=null&&m.value.length==2){const e=Z(ee(ae(m.value[0]))),u=864e5,p=Z(ee(Le(ae(m.value[1]),u)));l.timeRange=[e,p]}const a=await C.getBillDataPage(l);H.value=a.list,G.value=a.total,a.total>1e4?h.value=1e4:h.value=a.total}finally{U.value=!1}},se=De(()=>{const a=Math.ceil(h.value/l.pageSize);return l.pageNo===a&&h.value>=1e4});function k(a,e,u){return u?P(u).format("YYYY-MM-DD"):""}function f(a,e,u){return Number(u).toFixed(1)}function J(a,e,u){return Number(u).toFixed(2)}const ie=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},T=()=>{l.pageNo=1,I()},ue=async()=>{try{await te.exportConfirm(),l.pageNo=1,B.value=!0;const a={timeout:0},e=await C.exportBillPageData(l,a);await Ee.excel(e,"\u673A\u623F\u7535\u8D39\u7EDF\u8BA1.xlsx")}catch{}finally{B.value=!1}},pe=async a=>{let e=[];a.forEach(u=>e.push(u.id)),l.roomIds=e,T()};return Ne(()=>{(async()=>{const a=await He.getRoomList();j.value=a.map(e=>({id:e.id,name:e.roomName,children:[]}))})(),(async()=>{const a=await C.getNavNewData({});A.value=a.day,E.value=a.week,L.value=a.month})(),I()}),(a,e)=>{const u=ze,p=Ce,w=Se,c=Ve,x=Fe,d=Ue,M=qe,g=Be,K=Re,de=Ae,ce=Ie,me=je,ge=Te;return v(),z(me,{dataList:t(j),onCheck:pe,navTitle:"\u673A\u623F\u7535\u8D39\u7EDF\u8BA1"},{NavInfo:i(()=>[Ke,D(),Oe,n("div",Qe,[n("div",Xe,[n("div",$e,[Ze,n("span",ea,_(t(A))+"\u6761",1)]),n("div",aa,[ta,n("span",la,_(t(E))+"\u6761",1)]),n("div",ra,[oa,n("span",na,_(t(L))+"\u6761",1)])])])]),ActionBar:i(()=>[o(M,{class:"-mb-15px",model:t(l),ref_key:"queryFormRef",ref:re,inline:!0,"label-width":"auto"},{default:i(()=>[o(w,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:i(()=>[o(p,{modelValue:t(l).granularity,"onUpdate:modelValue":e[0]||(e[0]=r=>t(l).granularity=r),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:i(()=>[o(u,{label:"\u5929",value:"day"}),o(u,{label:"\u5468",value:"week"}),o(u,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[o(c,{"value-format":"YYYY-MM-DD",modelValue:t(m),"onUpdate:modelValue":e[1]||(e[1]=r=>Q(m)?m.value=r:null),type:"daterange",shortcuts:oe,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ie},null,8,["modelValue"])]),_:1}),o(w,null,{default:i(()=>[o(d,{onClick:T},{default:i(()=>[o(x,{icon:"ep:search",class:"mr-5px"}),D(" \u641C\u7D22")]),_:1}),o(d,{type:"success",plain:"",loading:t(B),onClick:ue},{default:i(()=>[o(x,{icon:"ep:download",class:"mr-5px"}),D(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:i(()=>[Ye((v(),z(K,{data:t(H),stripe:!0,"show-overflow-tooltip":!0,border:!0},X({default:i(()=>[o(g,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:r})=>[D(_(r+1+(t(l).pageNo-1)*t(l).pageSize),1)]),_:1}),(v(!0),W($,null,ke(t(R),r=>(v(),W($,null,[r.istrue?(v(),z(g,{key:r.prop,label:r.label,align:r.align,prop:r.prop,formatter:r.formatter,width:r.width},X({_:2},[r.slot==="actions"&&t(l).granularity=="day"?{name:"default",fn:i(({row:b})=>[b.bill_mode_real&&b.bill_mode_real==2?(v(),z(d,{key:0,link:"",type:"primary",onClick:ma=>(async(ve,O,fe,be)=>{S.value=[],V.value="",F.value="";let _e={roomId:ve,startTime:O};const ye=await C.getSubBillDetails(_e);S.value=ye.list,V.value=fe,F.value=O+" - "+be,Y.value=!0})(b.aisle_id,b.start_time,b.location,b.end_time)},{default:i(()=>[D("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):(v(),W("div",sa,"\u56FA\u5B9A\u8BA1\u8D39"))]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):Me("",!0)],64))),256))]),_:2},[t(se)?{name:"append",fn:i(()=>[ia]),key:"0"}:void 0]),1032,["data"])),[[ge,t(U)]]),o(de,{total:t(h),"page-size-arr":t(le),layout:"sizes, prev, pager, next, jumper",page:t(l).pageNo,"onUpdate:page":e[2]||(e[2]=r=>t(l).pageNo=r),limit:t(l).pageSize,"onUpdate:limit":e[3]||(e[3]=r=>t(l).pageSize=r),onPagination:I},null,8,["total","page-size-arr","page","limit"]),n("div",ua,"\u5171 "+_(t(G))+" \u6761",1),o(ce,{modelValue:t(Y),"onUpdate:modelValue":e[4]||(e[4]=r=>Q(Y)?Y.value=r:null),title:t(V),width:"600",draggable:""},{default:i(()=>[n("span",pa,_(t(F)),1),o(K,{data:t(S),border:"","show-summary":"","summary-method":ne,style:{width:"100%"}},{default:i(()=>[o(g,{prop:"bill_period",label:"\u65F6\u95F4\u6BB5"}),o(g,{prop:"eq_value",label:"\u8017\u7535\u91CF(kWh)",formatter:f}),o(g,{prop:"bill_value",label:"\u7535\u8D39(\u5143)",formatter:f})]),_:1},8,["data"])]),_:1},8,["modelValue","title"])]),_:1},8,["dataList"])}}}),ca=Je(da,[["__scopeId","data-v-1cc6ebef"]]);export{ca as default};
