import{d as De,e as s,an as xe,f as _e,aj as ke,h as Ce,T as ie,o as g,n as G,w as r,l as A,j as l,a as i,c as D,t as b,q as x,k as n,m as Q,s as Me,F as oe,p as Te,aZ as Z,L as Ye,M as Fe,P as Ee,O as Ie,_ as Ae,A as Pe,Q as Se,D as Ne,G as Ue,R as Ve,J as qe,K as Le}from"./index-mcOGIq4g.js";import"./index-KYPw-eK3.js";import{I as Oe}from"./index-Bla3Qadp.js";import{d as He}from"./download--D_IyRio.js";import{f as T,e as re,c as _,a as Re,b as ue}from"./formatTime-f-_athMZ.js";import{E as de}from"./index-U3-JpcYo.js";import We from"./CommonMenu1-CCeNFGEe.js";import{u as Be}from"./useMessage-CGTQbR_M.js";import{i as je}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as ze}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./install-DiAPpr4Z.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";const f=Y=>(qe("data-v-d377b88e"),Y=Y(),Le(),Y),Ge=f(()=>l("br",null,null,-1)),Qe=f(()=>l("br",null,null,-1)),Ze={class:"nav_data"},Je={class:"nav_header"},Ke={key:0},$e=f(()=>l("br",null,null,-1)),Xe={key:0,class:"descriptions-container",style:{"font-size":"14px"}},ea={class:"description-item"},aa=f(()=>l("span",{class:"label"},"\u5F00\u59CB\u65E5\u671F :",-1)),ta={class:"description-item"},la=f(()=>l("span",{class:"label"},"\u7ED3\u675F\u65E5\u671F :",-1)),na={class:"description-item"},sa=f(()=>l("span",{class:"label"},"\u603B\u8017\u7535\u91CF :",-1)),ia={class:"description-item"},oa=f(()=>l("span",{class:"label"},"\u6700\u5927\u8017\u7535\u91CF :",-1)),ra={key:0,class:"description-item"},ua=f(()=>l("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),da={class:"value"},ca={class:"description-item"},pa=f(()=>l("span",{class:"label"},"\u6700\u5C0F\u8017\u7535\u91CF :",-1)),ma={key:1,class:"description-item"},va=f(()=>l("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),fa={class:"value"},ha=f(()=>l("div",{class:"line",style:{"margin-top":"10px"}},null,-1)),ga={style:{height:"58vh"}},ba=De({name:"ECDistribution",__name:"index",setup(Y){const ce=Be(),P=s([]),F=s(""),S=s(""),y=s("dayTabPane"),N=s("lineChart"),J=s([]),E=s([]),K=xe(),u=s(L(7)),U=s(!1),V=s(!1),q=s(!1),c=_e({pageNo:1,pageSize:15,aisleId:void 0,granularity:"day",timeRange:["",""]});function L(a){var e=new Date,t=new Date;return t.setDate(t.getDate()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}function O(a){var e=new Date,t=new Date;return t.setMonth(t.getMonth()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}const pe=[{text:"\u6700\u8FD1\u4E24\u5468",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-336),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];ke(()=>y.value,async a=>{a=="dayTabPane"?(c.granularity="day",u.value=L(7)):a=="weekTabPane"?(c.granularity="week",u.value=O(1)):(c.granularity="month",u.value=O(12)),z()});const $=s([]),k=s([]),X=s([]),ee=s([]),C=s([]),ae=s([]),H=s(0),R=s(0),I=s(),W=s(0),B=s(),te=async()=>{U.value=!0;try{c.timeRange[0]=T(re(_(u.value[0])));const a=864e5;c.timeRange[1]=T(re(Re(_(u.value[1]),a)));const e=await de.getEQDataDetails(c);e!=null&&e.total!=0?(V.value=!0,H.value=0,$.value=e.list.map(t=>w(t.start_ele,1)),k.value=e.list.map(t=>T(t.start_time,"YYYY-MM-DD")),X.value=e.list.map(t=>w(t.end_ele,1)),ee.value=e.list.map(t=>T(t.end_time,"YYYY-MM-DD")),C.value=e.list.map(t=>w(t.eq_value,1)),ae.value=e.list.map(t=>T(t.create_time,"YYYY-MM-DD")),R.value=Math.max(...C.value),W.value=Math.min(...C.value),C.value.forEach(function(t,m){t==R.value&&(I.value=k.value[m]),t==W.value&&(B.value=k.value[m]),H.value+=Number(t)}),F.value=S.value):(V.value=!1,Z({message:"\u6682\u65E0\u6570\u636E",type:"warning"}))}finally{U.value=!1}},j=s(null);let p=null;const le=()=>{p&&p.dispose(),j.value&&K&&(p=je(j.value),p.setOption({title:{text:"\u8017\u7535\u91CF\u8D8B\u52BF\u56FE",top:-4},tooltip:{trigger:"axis",formatter:me},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:k.value},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"line",data:C.value}],dataZoom:[{type:"inside"}]}),K.appContext.config.globalProperties.lineChart=p,E.value=p==null?void 0:p.getOption().series,(()=>{var t,m;const a=[],e=((m=(t=E.value[0])==null?void 0:t.data)==null?void 0:m.length)||0;for(let o=0;o<e;o++){const d={};d.create_time=ae.value[o],d.startEleData=$.value[o],d.startTimeData=k.value[o],d.endEleData=X.value[o],d.endTimeData=ee.value[o];for(const M of E.value)d[M.name]=M.data[o];a.push(d)}J.value=a})())};function w(a,e){return isNaN(a)?null:Number(a).toFixed(e)}function me(a){var e="";return a.forEach(function(t){t.seriesName==="\u8017\u7535\u91CF"&&(e+=t.marker+" "+t.seriesName+": "+t.value+" kWh")}),e}const ve=()=>{y.value=="weekTabPane"&&ue(_(u.value[0]),_(u.value[1]))<7&&(u.value=L(7),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E7\u5929,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u5468",type:"warning"})),y.value=="monthTabPane"&&ue(_(u.value[0]),_(u.value[1]))<30&&(u.value=O(1),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E1\u4E2A\u6708,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u4E2A\u6708",type:"warning"}))},fe=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e};window.addEventListener("resize",function(){p==null||p.resize()});const he=async a=>{a.type!=null&&a.type==2&&(c.aisleId=a.id,ne(P.value,a.unique,e=>{S.value=e}),z())};function ne(a,e,t,m=""){for(let o of a){const d=m===""?o.name:m+"-"+o.name;o.unique===e&&t(d),o.children&&o.children.length>0&&ne(o.children,e,t,d)}}const ge=async()=>{try{await ce.exportConfirm(),c.pageNo=1,q.value=!0;const a={timeout:0},e=await de.exportDetailPageData(c,a);await He.excel(e,"\u67DC\u5217\u80FD\u8017\u6392\u540D.xlsx")}catch{}finally{q.value=!1}},z=async()=>{await te(),le()};return Ce(async()=>{(async()=>{const t=await Oe.getAisleMenu();P.value=t})();const a=ie().query.aisleId,e=ie().query.location;c.aisleId=a?parseInt(a,10):void 0,c.aisleId!=null&&(await te(),F.value=e,S.value=e,le())}),(a,e)=>{const t=Ye,m=Fe,o=Ee,d=Ie,M=Ae,se=Pe,be=Se,h=Ne,ye=Ue,we=Ve;return g(),G(We,{dataList:i(P),onNodeClick:he,navTitle:"\u67DC\u5217\u80FD\u8017\u6392\u540D",showCheckbox:!1},{NavInfo:r(()=>[Ge,A(),Qe,l("div",Ze,[l("div",Je,[i(F)?(g(),D("span",Ke,b(i(F)),1)):x("",!0)]),$e,i(I)?(g(),D("div",Xe,[l("div",ea,[aa,l("span",null,b(i(u)[0]),1)]),l("div",ta,[la,l("span",null,b(i(u)[1]),1)]),l("div",na,[sa,l("span",null,b(w(i(H),1))+" kWh",1)]),l("div",ia,[oa,l("span",null,b(w(i(R),1))+" kWh",1)]),i(I)?(g(),D("div",ra,[ua,l("span",da,b(i(I)),1)])):x("",!0),l("div",ca,[pa,l("span",null,b(w(i(W),1))+" kWh",1)]),i(B)?(g(),D("div",ma,[va,l("span",fa,b(i(B)),1)])):x("",!0),ha])):x("",!0)])]),ActionBar:r(()=>[n(m,{modelValue:i(y),"onUpdate:modelValue":e[0]||(e[0]=v=>Q(y)?y.value=v:null)},{default:r(()=>[n(t,{label:"\u65E5\u6570\u636E",name:"dayTabPane"}),n(t,{label:"\u5468\u6570\u636E",name:"weekTabPane"}),n(t,{label:"\u6708\u6570\u636E",name:"monthTabPane"})]),_:1},8,["modelValue"]),n(be,{class:"-mb-15px",model:i(c),ref:"queryFormRef",inline:!0,"label-width":"auto"},{default:r(()=>[n(d,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:r(()=>[n(o,{"value-format":"YYYY-MM-DD",modelValue:i(u),"onUpdate:modelValue":e[1]||(e[1]=v=>Q(u)?u.value=v:null),type:"daterange",shortcuts:pe,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":fe,class:"!w-350px",onChange:ve},null,8,["modelValue"])]),_:1}),n(d,null,{default:r(()=>[n(se,{onClick:z},{default:r(()=>[n(M,{icon:"ep:search",class:"mr-5px"}),A(" \u641C\u7D22")]),_:1}),n(se,{type:"success",plain:"",onClick:ge,loading:i(q)},{default:r(()=>[n(M,{icon:"ep:download",class:"mr-5px"}),A(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:r(()=>[i(V)?(g(),G(m,{key:0,modelValue:i(N),"onUpdate:modelValue":e[2]||(e[2]=v=>Q(N)?N.value=v:null)},{default:r(()=>[n(t,{label:"\u56FE\u8868",name:"lineChart"},{default:r(()=>[Me(l("div",{ref_key:"chartContainer",ref:j,id:"chartContainer",style:{width:"70vw",height:"58vh"}},null,512),[[we,i(U)]])]),_:1}),n(t,{label:"\u6570\u636E",name:"lineChartData"},{default:r(()=>[l("div",ga,[n(ye,{border:!0,stripe:!0,data:i(J),style:{height:"67vh",width:"99.97%"},"header-cell-style":{backgroundColor:"#F5F7FA",color:"#909399",textAlign:"center",borderLeft:"1px #EDEEF2 solid",borderBottom:"1px #EDEEF2 solid",fontFamily:"Microsoft YaHei",fontWeight:"bold"},"cell-style":{color:"#606266",fontSize:"14px",textAlign:"center",borderBottom:"0.25px #F5F7FA solid",borderLeft:"0.25px #F5F7FA solid"},"row-style":{fontSize:"14px",textAlign:"center"},"empty-text":"\u6682\u65E0\u6570\u636E","max-height":"818"},{default:r(()=>[n(h,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:r(({$index:v})=>[A(b(v+1),1)]),_:1}),(g(!0),D(oe,null,Te(i(E),v=>(g(),D(oe,{key:v.name},[n(h,{label:"\u5F00\u59CB\u7535\u80FD"},{default:r(()=>[n(h,{prop:"startEleData",label:"\u6570\u503C"}),n(h,{prop:"startTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:1}),n(h,{label:"\u7ED3\u675F\u7535\u80FD"},{default:r(()=>[n(h,{prop:"endEleData",label:"\u6570\u503C"}),n(h,{prop:"endTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:1}),v.name==="\u8017\u7535\u91CF"?(g(),G(h,{key:0,label:"\u8017\u7535\u91CF"},{default:r(()=>[n(h,{prop:v.name,label:"\u6570\u503C"},null,8,["prop"]),n(h,{prop:"create_time",label:"\u8BB0\u5F55\u65F6\u95F4"})]),_:2},1024)):x("",!0)],64))),128))]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"])):x("",!0)]),_:1},8,["dataList"])}}}),ya=ze(ba,[["__scopeId","data-v-d377b88e"]]);export{ya as default};
