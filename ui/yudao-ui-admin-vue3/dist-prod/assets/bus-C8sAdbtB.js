import{d as Ye,e as l,an as Ee,f as Ie,aj as Ae,h as Ne,o as g,n as Z,w as u,j as i,a as n,c as b,t as h,q as w,k as s,m as J,l as $,s as Ue,F as fe,p as Pe,aZ as S,L as Se,M as Ve,P as We,O as ze,_ as Le,A as qe,Q as Be,D as He,G as Re,R as Oe,J as je,K as Ge}from"./index-mcOGIq4g.js";import"./index-KYPw-eK3.js";import{I as Ke}from"./index-D-gmWooi.js";import{f as Y,e as ge,c as _,a as Qe,b as he}from"./formatTime-f-_athMZ.js";import{E as ye}from"./index-5UHMZISN.js";import{P as V}from"./PDU-QxJ-Axz0.js";import{d as Ze}from"./download--D_IyRio.js";import Je from"./CommonMenu1-DzAutgxP.js";import{u as $e}from"./useMessage-CGTQbR_M.js";import{i as Xe}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as ea}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./install-DiAPpr4Z.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";const y=E=>(je("data-v-b3fc3448"),E=E(),Ge(),E),aa={class:"nav_data"},ta={class:"nav_header"},la={key:0},na={key:1},sa=y(()=>i("br",null,null,-1)),ia={key:0,class:"descriptions-container",style:{"font-size":"14px"}},oa={class:"description-item"},ra=y(()=>i("span",{class:"label"},"\u7F51\u7EDC\u5730\u5740 :",-1)),ua={class:"description-item"},da=y(()=>i("span",{class:"label"},"\u603B\u8017\u7535\u91CF :",-1)),va={class:"description-item"},ca=y(()=>i("span",{class:"label"},"\u6700\u5927\u8017\u7535\u91CF :",-1)),pa={key:0,class:"description-item"},ma=y(()=>i("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),fa={class:"value"},ga={class:"description-item"},ha=y(()=>i("span",{class:"label"},"\u6700\u5C0F\u8017\u7535\u91CF :",-1)),ya={key:1,class:"description-item"},ba=y(()=>i("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),wa={class:"value"},xa=y(()=>i("div",{class:"line",style:{"margin-top":"10px"}},null,-1)),Da={style:{height:"58vh"}},ka=ea(Ye({name:"ECDistribution",__name:"bus",setup(E){var ve,ce,pe;const W=l(!1),X=$e(),z=l([]),x=l(""),L=l(""),q=l(""),D=l("dayTabPane"),B=l("lineChart"),ee=l([]),I=l([]),ae=Ee(),d=l(O(14)),H=l(!1),R=l(!1),te=l(),o=Ie({pageNo:1,pageSize:15,nowAddress:void 0,devkey:void 0,busId:void 0,granularity:"day",timeRange:["",""]});function O(a){var e=new Date,t=new Date;return t.setDate(t.getDate()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}function j(a){var e=new Date,t=new Date;return t.setMonth(t.getMonth()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}l([{imgUrl:V},{imgUrl:V},{imgUrl:V},{imgUrl:V}]);const be=[{text:"\u6700\u8FD1\u4E24\u5468",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-336),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];Ae(()=>D.value,async a=>{a=="dayTabPane"?(o.granularity="day",d.value=O(14)):a=="weekTabPane"?(o.granularity="week",d.value=j(3)):(o.granularity="month",d.value=j(12)),K()});const le=l([]),C=l([]),ne=l([]),se=l([]),M=l([]),ie=l([]),A=l(0),N=l(0),F=l(),U=l(0),P=l(),oe=async()=>{if(o.devkey!=null){H.value=!0;try{o.timeRange[0]=Y(ge(_(d.value[0])));const a=864e5;o.timeRange[1]=Y(ge(Qe(_(d.value[1]),a)));const e=await ye.getEQDataDetails(o);e.list==null&&(S.warning("\u6682\u65E0\u6570\u636E\uFF01"),e.list=[]),e!=null&&e.total!=0?(R.value=!0,A.value=0,le.value=e.list.map(t=>k(t.start_ele,1)),C.value=e.list.map(t=>Y(t.start_time,"YYYY-MM-DD")),ne.value=e.list.map(t=>k(t.end_ele,1)),se.value=e.list.map(t=>Y(t.end_time,"YYYY-MM-DD")),M.value=e.list.map(t=>k(t.eq_value,1)),ie.value=e.list.map(t=>Y(t.create_time,"YYYY-MM-DD")),N.value=Math.max(...M.value),U.value=Math.min(...M.value),M.value.forEach(function(t,p){t==N.value&&(F.value=C.value[p]),t==U.value&&(P.value=C.value[p]),A.value+=Number(t)}),x.value=q.value):(N.value=0,U.value=0,A.value=0,F.value="",P.value="",R.value=!1,S({message:"\u6682\u65E0\u6570\u636E",type:"warning"}))}finally{H.value=!1}}else X.warning("\u8BF7\u5148\u9009\u62E9\u8BBE\u5907\uFF01")},G=l(null);let c=null;const re=()=>{c&&c.dispose(),G.value&&ae&&(c=Xe(G.value),c.setOption({title:{text:"\u8017\u7535\u91CF\u8D8B\u52BF\u56FE",top:-4},tooltip:{trigger:"axis",formatter:xe},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:C.value},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"line",data:M.value}],dataZoom:[{type:"inside"}]}),ae.appContext.config.globalProperties.lineChart=c,I.value=c==null?void 0:c.getOption().series,(()=>{var t,p;const a=[],e=((p=(t=I.value[0])==null?void 0:t.data)==null?void 0:p.length)||0;for(let r=0;r<e;r++){const v={};v.create_time=ie.value[r],v.startEleData=le.value[r],v.startTimeData=C.value[r],v.endEleData=ne.value[r],v.endTimeData=se.value[r];for(const T of I.value)v[T.name]=T.data[r];a.push(v)}ee.value=a})())},we=async()=>{try{await X.exportConfirm(),o.pageNo=1,W.value=!0,o.nowAddress=x.value;const a={timeout:0},e=await ye.exportBusDetailsPageData(o,a);await Ze.excel(e,"\u59CB\u7AEF\u7BB1\u80FD\u8017\u6392\u540D\u5386\u53F2\u6570\u636E.xlsx")}catch{}finally{W.value=!1}};function k(a,e){return isNaN(a)?0:Number(a).toFixed(e)=="-Infinity"?"\u221E":Number(a).toFixed(e)=="Infinity"?"-\u221E":Number(a).toFixed(e)}function xe(a){var e="";return a.forEach(function(t){t.seriesName==="\u8017\u7535\u91CF"&&(e+=t.marker+" "+t.seriesName+": "+t.value+" kWh")}),e}const De=()=>{D.value=="weekTabPane"&&he(_(d.value[0]),_(d.value[1]))<7&&(d.value=O(7),S({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E7\u5929,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u5468",type:"warning"})),D.value=="monthTabPane"&&he(_(d.value[0]),_(d.value[1]))<30&&(d.value=j(1),S({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E1\u4E2A\u6708,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u4E2A\u6708",type:"warning"}))},ke=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e};window.addEventListener("resize",function(){c==null||c.resize()});const _e=async a=>{a.type!=null&&a.type==6&&(o.busId=void 0,o.devkey=a.unique,ue(z.value,a.unique,e=>{q.value=e}),K())};function ue(a,e,t,p=""){for(let r of a){const v=p===""?r.name:p+"-"+r.name;r.unique===e&&t(v),r.children&&r.children.length>0&&ue(r.children,e,t,v)}}const K=async()=>{await oe(),re()},de=l((ve=history==null?void 0:history.state)==null?void 0:ve.location),Q=l((ce=history==null?void 0:history.state)==null?void 0:ce.devKey),Ce=l((pe=history==null?void 0:history.state)==null?void 0:pe.busId);return Ne(async()=>{(async()=>{const a=await Ke.getBusMenu();z.value=a})(),o.busId=Ce.value,o.devkey=Q.value,te.value=Q||void 0,o.busId!=null&&(x.value=de,L.value=Q,q.value=de,await oe(),re())}),(a,e)=>{const t=Se,p=Ve,r=We,v=ze,T=Le,me=qe,Me=Be,f=He,Fe=Re,Te=Oe;return g(),Z(Je,{dataList:n(z),onNodeClick:_e,navTitle:"\u59CB\u7AEF\u7BB1\u80FD\u8017\u6392\u540D",showCheckbox:!1},{NavInfo:u(()=>[i("div",aa,[i("div",ta,[n(x)?(g(),b("span",la,h(n(x)?"\u6682\u672A\u7ED1\u5B9A\u8BBE\u5907":n(x)),1)):w("",!0),n(L)?(g(),b("span",na,"("+h(n(L))+")",1)):w("",!0)]),sa,n(F)?(g(),b("div",ia,[i("div",oa,[ra,i("span",null,h(n(te)),1)]),i("div",ua,[da,i("span",null,h(k(n(A),1))+" kWh",1)]),i("div",va,[ca,i("span",null,h(k(n(N),1))+" kWh",1)]),n(F)?(g(),b("div",pa,[ma,i("span",fa,h(n(F)),1)])):w("",!0),i("div",ga,[ha,i("span",null,h(k(n(U),1))+" kWh",1)]),n(P)?(g(),b("div",ya,[ba,i("span",wa,h(n(P)),1)])):w("",!0),xa])):w("",!0)])]),ActionBar:u(()=>[s(p,{modelValue:n(D),"onUpdate:modelValue":e[0]||(e[0]=m=>J(D)?D.value=m:null)},{default:u(()=>[s(t,{label:"\u65E5\u6570\u636E",name:"dayTabPane"}),s(t,{label:"\u5468\u6570\u636E",name:"weekTabPane"}),s(t,{label:"\u6708\u6570\u636E",name:"monthTabPane"})]),_:1},8,["modelValue"]),s(Me,{class:"-mb-15px",model:n(o),ref:"queryFormRef",inline:!0,"label-width":"auto"},{default:u(()=>[s(v,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:u(()=>[s(r,{"value-format":"YYYY-MM-DD",modelValue:n(d),"onUpdate:modelValue":e[1]||(e[1]=m=>J(d)?d.value=m:null),type:"daterange",shortcuts:be,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ke,class:"!w-350px",onChange:De},null,8,["modelValue"])]),_:1}),s(v,null,{default:u(()=>[s(me,{onClick:K},{default:u(()=>[s(T,{icon:"ep:search",class:"mr-5px"}),$(" \u641C\u7D22")]),_:1}),s(me,{type:"success",plain:"",onClick:we,loading:n(W)},{default:u(()=>[s(T,{icon:"ep:download",class:"mr-5px"}),$(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:u(()=>[n(R)?(g(),Z(p,{key:0,modelValue:n(B),"onUpdate:modelValue":e[2]||(e[2]=m=>J(B)?B.value=m:null)},{default:u(()=>[s(t,{label:"\u56FE\u8868",name:"lineChart"},{default:u(()=>[Ue(i("div",{ref_key:"chartContainer",ref:G,id:"chartContainer",style:{width:"70vw",height:"58vh"}},null,512),[[Te,n(H)]])]),_:1}),s(t,{label:"\u6570\u636E",name:"lineChartData"},{default:u(()=>[i("div",Da,[s(Fe,{border:!0,stripe:!0,data:n(ee),style:{height:"100%",width:"99.97%"},"header-cell-style":{backgroundColor:"#F5F7FA",color:"#909399",textAlign:"center",borderLeft:"1px #EDEEF2 solid",borderBottom:"1px #EDEEF2 solid",fontFamily:"Microsoft YaHei",fontWeight:"bold"},"cell-style":{color:"#606266",fontSize:"14px",textAlign:"center",borderBottom:"0.25px #F5F7FA solid",borderLeft:"0.25px #F5F7FA solid"},"row-style":{fontSize:"14px",textAlign:"center"},"empty-text":"\u6682\u65E0\u6570\u636E","max-height":"818"},{default:u(()=>[s(f,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:u(({$index:m})=>[$(h(m+1+(n(o).pageNo-1)*n(o).pageSize),1)]),_:1}),(g(!0),b(fe,null,Pe(n(I),m=>(g(),b(fe,{key:m.name},[s(f,{label:"\u5F00\u59CB\u7535\u80FD"},{default:u(()=>[s(f,{prop:"startEleData",label:"\u5F00\u59CB\u7535\u80FD(kWh)"}),s(f,{prop:"startTimeData",label:"\u5F00\u59CB\u65E5\u671F"})]),_:1}),s(f,{label:"\u7ED3\u675F\u7535\u80FD"},{default:u(()=>[s(f,{prop:"endEleData",label:"\u7ED3\u675F\u7535\u80FD(kWh)"}),s(f,{prop:"endTimeData",label:"\u7ED3\u675F\u65E5\u671F"})]),_:1}),m.name==="\u8017\u7535\u91CF"?(g(),Z(f,{key:0,label:"\u8017\u7535\u91CF"},{default:u(()=>[s(f,{prop:m.name,label:"\u8017\u7535\u91CF(kWh)"},null,8,["prop"]),s(f,{prop:"create_time",label:"\u8BB0\u5F55\u65E5\u671F"})]),_:2},1024)):w("",!0)],64))),128))]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"])):w("",!0)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-b3fc3448"]]);export{ka as default};
