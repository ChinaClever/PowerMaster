import{d as Ie,u as Me,T as q,e as s,an as Ne,aX as z,f as qe,aj as ze,g as Fe,h as Se,o as v,n as k,w as i,l as h,j as n,t as D,a as o,k as u,m as Te,s as re,aY as H,c as F,F as S,p as oe,q as ie,S as Ae,N as Pe,O as Ue,P as Ve,_ as We,A as Ee,Q as Re,D as Le,G as Qe,R as je,J as He,K as Je}from"./index-mcOGIq4g.js";import{_ as Ke}from"./CommonMenu-CxUjeIT-.js";import{_ as Oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ge}from"./download--D_IyRio.js";import{E as T}from"./index-D85m9HA9.js";import{f as A,e as P,c as U,a as se}from"./formatTime-f-_athMZ.js";import{I as Xe}from"./index-DA5JCs6I.js";import"./index-KYPw-eK3.js";import{u as $e}from"./useMessage-CGTQbR_M.js";import{i as Ze}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as ea}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const d=Y=>(He("data-v-305c5dce"),Y=Y(),Je(),Y),aa=d(()=>n("br",null,null,-1)),ta=d(()=>n("br",null,null,-1)),la={class:"nav_data"},na={class:"descriptions-container",style:{"font-size":"14px"}},ra={class:"description-item"},oa=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ia={class:"value"},sa={class:"description-item"},ua=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),pa={class:"value"},da={class:"description-item"},ma=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ca={class:"value"},va=d(()=>n("br",null,null,-1)),ga=d(()=>n("div",null,[n("span",null,"\u5168\u90E8\u673A\u623F\u65B0\u589E\u80FD\u8017\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),fa=d(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ya={class:"realTotal"},ha=d(()=>n("br",null,null,-1)),ba=d(()=>n("br",null,null,-1)),wa=d(()=>n("br",null,null,-1)),xa=d(()=>n("br",null,null,-1)),_a=ea(Ie({name:"PowerAnalysis",__name:"index",setup(Y){const ue=$e(),{push:pe}=Me(),b=q(),J=s([]),K=s(0),O=s(0),B=s(0),G=Ne(),w=s(!0),m=s([]),f=s(0),V=s(0),c=s([]);if(b.query.startTime!=null&&b.query.endTime!=null)c.value=[b.query.startTime,b.query.endTime];else{let a=new Date;c.value=[z(new Date(a.getFullYear(),a.getMonth(),1)).format("YYYY-MM-DD"),z(a).format("YYYY-MM-DD")]}b.query.roomIds!=null&&(l.roomIds=[b.query.roomIds]);const l=qe({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,roomIds:[]}),de=s([15,30,50,100]),me=s(),W=s(!1),ce=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],ve=a=>{const e=(a-1)*l.pageSize+1,t=a*l.pageSize,g=[];for(let y=e;y<=t;y++)g.push("\u5E8F\u53F7"+y);return g},E=s(null);let x=null;const R=s([]),X=()=>{E.value&&G&&(x=Ze(E.value),x.setOption({title:{text:"\u5404\u673A\u623F\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:fe},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:ve(l.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:R.value,label:{show:!0,position:"top"}}]}),G.appContext.config.globalProperties.rankChart=x)};window.addEventListener("resize",function(){x==null||x.resize()}),ze(()=>l.granularity,()=>{Q()});const ge=s([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"180px"},{label:"\u8BB0\u5F55\u65E5\u671F",align:"center",prop:"create_time",formatter:C,width:"200px",istrue:!0},{label:"\u5F00\u59CB",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:$,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"start_ele",istrue:!0,formatter:I}]},{label:"\u7ED3\u675F",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"end_time",formatter:$,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"end_ele",istrue:!0,formatter:I}]},{label:`\u8017\u7535\u91CF
(kWh)`,align:"center",prop:"eq_value",istrue:!0,formatter:I},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),L=async()=>{w.value=!0;try{if(c.value!=null){const e=A(P(U(c.value[0]))),t=864e5,g=A(P(se(U(c.value[1]),t)));l.timeRange=[e,g]}c.value==null&&(l.timeRange=void 0);const a=await T.getEQDataPage(l);R.value=a.list.map(e=>Z(e.eq_value,1)),m.value=a.list,V.value=a.total,a.total>1e4?f.value=1e4:f.value=a.total}finally{X(),w.value=!1}};function fe(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+m.value[t.dataIndex].location+"  ",e+="<br/>"+t.marker+"\u8BB0\u5F55\u65E5\u671F\uFF1A"+C(null,null,m.value[t.dataIndex].create_time)+" "+t.seriesName+": "+t.value+"kWh<br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+C(null,null,m.value[t.dataIndex].end_time)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+m.value[t.dataIndex].end_ele.toFixed(1)+"kWh<br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+C(null,null,m.value[t.dataIndex].start_time)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+I(null,null,m.value[t.dataIndex].start_ele)+"kWh<br/>"}const ye=Fe(()=>{const a=Math.ceil(f.value/l.pageSize);return l.pageNo===a&&f.value>=1e4});function C(a,e,t){return t?z(t).format("YYYY-MM-DD"):""}function $(a,e,t){return t?z(t).format("MM-DD"):""}function I(a,e,t){return Number(t).toFixed(1)}const Z=(a,e)=>isNaN(a)?null:Number(a).toFixed(e),he=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},Q=()=>{l.pageNo=1,L()},be=async a=>{let e=[];a.forEach(t=>e.push(t.id)),l.roomIds=e,Q()},we=async()=>{try{await ue.exportConfirm(),l.pageNo=1,W.value=!0;const a={timeout:0},e=await T.exportEQPageData(l,a);await Ge.excel(e,"\u673A\u623F\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{W.value=!1}},ee=(a,e)=>{pe("/room/energyConsumption/ecdistribution?roomId="+a+"&location="+e)},_=s(""),ae=s(""),te=s(0);return Se(()=>{(async()=>{const a=await Xe.getRoomList();J.value=a.map(e=>({id:e.id,name:e.roomName,children:[]}))})(),(async()=>{const a=await T.getNavNewData({});K.value=a.day,O.value=a.week,B.value=a.month})(),_.value=q().query.start,ae.value=q().query.end,te.value=q().query.roomId,_.value!=null?(async()=>{w.value=!0;try{if(_.value!=null){const e=A(P(U(_.value))),t=864e5,g=A(P(se(U(ae.value),t)));l.timeRange=[e,g]}_.value==null&&(l.timeRange=void 0),l.roomIds=[te.value];const a=await T.getEQDataPage(l);R.value=a.list.map(e=>Z(e.eq_value,1)),m.value=a.list,V.value=a.total,a.total>1e4?f.value=1e4:f.value=a.total}finally{X(),w.value=!1}})():L()}),(a,e)=>{const t=Ae,g=Pe,y=Ue,xe=Ve,le=We,M=Ee,_e=Re,N=Le,ke=Qe,De=Be,Ye=Oe,Ce=Ke,ne=je;return v(),k(Ce,{dataList:o(J),onCheck:be,navTitle:"\u673A\u623F\u80FD\u8017\u8D8B\u52BF"},{NavInfo:i(()=>[aa,h(),ta,n("div",la,[n("div",na,[n("div",ra,[oa,n("span",ia,D(o(K))+"\u6761",1)]),n("div",sa,[ua,n("span",pa,D(o(O))+"\u6761",1)]),n("div",da,[ma,n("span",ca,D(o(B))+"\u6761",1)]),h(),va,ga])])]),ActionBar:i(()=>[u(_e,{class:"-mb-15px",model:o(l),ref_key:"queryFormRef",ref:me,inline:!0,"label-width":"auto"},{default:i(()=>[u(y,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:i(()=>[u(g,{modelValue:o(l).granularity,"onUpdate:modelValue":e[0]||(e[0]=r=>o(l).granularity=r),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:i(()=>[u(t,{label:"\u5929",value:"day"}),u(t,{label:"\u5468",value:"week"}),u(t,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),u(y,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[u(xe,{"value-format":"YYYY-MM-DD",modelValue:o(c),"onUpdate:modelValue":e[1]||(e[1]=r=>Te(c)?c.value=r:null),type:"daterange",shortcuts:ce,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":he},null,8,["modelValue"])]),_:1}),u(y,null,{default:i(()=>[u(M,{onClick:Q},{default:i(()=>[u(le,{icon:"ep:search",class:"mr-5px"}),h(" \u641C\u7D22")]),_:1}),u(M,{type:"success",plain:"",loading:o(W),onClick:we},{default:i(()=>[u(le,{icon:"ep:download",class:"mr-5px"}),h(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:i(()=>[re((v(),k(ke,{data:o(m),stripe:!0,"show-overflow-tooltip":!0},H({default:i(()=>[u(N,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:r})=>[h(D(r+1+(o(l).pageNo-1)*o(l).pageSize),1)]),_:1}),(v(!0),F(S,null,oe(o(ge),r=>(v(),F(S,{key:r.label},[!r.children&&r.istrue?(v(),k(N,{key:r.prop,label:r.label,align:r.align,prop:r.prop,formatter:r.formatter,width:r.width},H({_:2},[r.slot==="actions"?{name:"default",fn:i(({row:p})=>[u(M,{link:"",type:"primary",onClick:j=>ee(p.room_id,p.location)},{default:i(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):r.istrue?(v(),k(N,{key:1,label:r.label,align:r.align},{default:i(()=>[(v(!0),F(S,null,oe(r.children,p=>(v(),F(S,{key:p.prop},[p.istrue?(v(),k(N,{key:p.prop,label:p.label,align:p.align,prop:p.prop,formatter:p.formatter,width:p.width},H({_:2},[p.slot==="actions"?{name:"default",fn:i(({row:j})=>[u(M,{link:"",type:"primary",onClick:ka=>ee(j.room_id,j.location)},{default:i(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):ie("",!0)],64))),128))]),_:2},1032,["label","align"])):ie("",!0)],64))),128))]),_:2},[o(ye)?{name:"append",fn:i(()=>[fa]),key:"0"}:void 0]),1032,["data"])),[[ne,o(w)]]),u(De,{total:o(f),"page-size-arr":o(de),layout:"sizes, prev, pager, next, jumper",page:o(l).pageNo,"onUpdate:page":e[2]||(e[2]=r=>o(l).pageNo=r),limit:o(l).pageSize,"onUpdate:limit":e[3]||(e[3]=r=>o(l).pageSize=r),onPagination:L},null,8,["total","page-size-arr","page","limit"]),n("div",ya,"\u5171 "+D(o(V))+" \u6761",1),ha,ba,wa,xa,u(Ye,null,{default:i(()=>[re(n("div",{ref_key:"rankChartContainer",ref:E,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[ne,o(w)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-305c5dce"]]);export{_a as default};
