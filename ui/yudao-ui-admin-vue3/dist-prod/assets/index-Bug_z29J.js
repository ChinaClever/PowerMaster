import{d as ye,e as n,an as De,f as we,aj as _e,aZ as U,h as xe,T as ne,o as y,n as J,w as r,l as V,j as s,t as g,a as o,c as W,q as L,k as l,m as K,s as Ye,F as se,p as Me,L as ke,M as Ce,P as Te,O as Ee,_ as Fe,A as Ie,Q as Ae,D as Pe,G as Ne,R as Ue,J as Ve,K as We}from"./index-mcOGIq4g.js";import"./index-KYPw-eK3.js";import{I as Le}from"./index-DA5JCs6I.js";import{f as b,e as oe,c as Y,a as Oe,b as re}from"./formatTime-f-_athMZ.js";import{E as ie}from"./index-D85m9HA9.js";import{d as Re}from"./download--D_IyRio.js";import{_ as Se}from"./CommonMenu1-CkTmz-fQ.js";import{u as qe}from"./useMessage-CGTQbR_M.js";import{i as He}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as ze}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./install-DiAPpr4Z.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";const D=k=>(Ve("data-v-ef4ff1d5"),k=k(),We(),k),Be=D(()=>s("br",null,null,-1)),je=D(()=>s("br",null,null,-1)),Qe={class:"nav_data"},Ge={class:"nav_header"},Ze={class:"nav_content"},Je={class:"description-item"},Ke=D(()=>s("span",{class:"label"},"\u603B\u8017\u7535\u91CF :",-1)),$e={class:"description-item"},Xe=D(()=>s("span",{class:"label"},"\u6700\u5927\u8017\u7535\u91CF :",-1)),ea={key:0,class:"description-item"},aa=D(()=>s("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ta={class:"value"},la={class:"description-item"},na=D(()=>s("span",{class:"label"},"\u6700\u5C0F\u8017\u7535\u91CF :",-1)),sa={key:1,class:"description-item"},oa=D(()=>s("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ra={class:"value"},ia={style:{height:"58vh"}},ua=ye({name:"ECDistribution",__name:"index",setup(k){const O=n(!1),$=n([]),C=n(""),T=n(""),w=n("dayTabPane"),R=n("lineChart"),X=n([]),E=n([]),ee=De(),i=n(q(7)),S=n(!1),ue=qe(),u=we({roomId:void 0,granularity:"day",timeRange:["",""]});function q(t){var e=new Date,a=new Date;return a.setDate(a.getDate()-t),[a.toISOString().slice(0,10),e.toISOString().slice(0,10)]}function H(t){var e=new Date,a=new Date;return a.setMonth(a.getMonth()-t),[a.toISOString().slice(0,10),e.toISOString().slice(0,10)]}const de=[{text:"\u6700\u8FD1\u4E24\u5468",value:()=>{const t=new Date,e=new Date;return e.setHours(e.getHours()-336),[e,t]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const t=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-1),[e,t]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const t=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,t]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const t=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-6),[e,t]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const t=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,t]}}];_e(()=>w.value,async t=>{t=="dayTabPane"?(u.granularity="day",i.value=q(7)):t=="weekTabPane"?(u.granularity="week",i.value=H(1)):(u.granularity="month",i.value=H(12)),Z()});const z=n([]),_=n([]),B=n([]),j=n([]),x=n([]),Q=n([]),F=n(0),I=n(0),A=n(),P=n(0),N=n(),ae=async()=>{S.value=!0;try{u.timeRange[0]=b(oe(Y(i.value[0])));const t=864e5;u.timeRange[1]=b(oe(Oe(Y(i.value[1]),t)));const e=await ie.getEQDataDetails(u);e!=null&&e.total!=0?(F.value=0,z.value=e.list.map(a=>h(a.start_ele,1)),_.value=e.list.map(a=>b(a.start_time,"YYYY-MM-DD")),B.value=e.list.map(a=>h(a.end_ele,1)),j.value=e.list.map(a=>b(a.end_time,"YYYY-MM-DD")),x.value=e.list.map(a=>h(a.eq_value,1)),Q.value=e.list.map(a=>b(a.create_time,"YYYY-MM-DD")),I.value=Math.max(...x.value),P.value=Math.min(...x.value),x.value.forEach(function(a,m){a==I.value&&(A.value=_.value[m]),a==P.value&&(N.value=_.value[m]),F.value+=Number(a)}),C.value=T.value):(U({message:"\u6682\u65E0\u6570\u636E",type:"warning"}),F.value=0,e.list=[],z.value=e.list.map(a=>h(a.start_ele,1)),_.value=e.list.map(a=>b(a.start_time,"YYYY-MM-DD")),B.value=e.list.map(a=>h(a.end_ele,1)),j.value=e.list.map(a=>b(a.end_time,"YYYY-MM-DD")),x.value=e.list.map(a=>h(a.eq_value,1)),Q.value=e.list.map(a=>b(a.create_time,"YYYY-MM-DD")),I.value="0.0",P.value="0.0",A.value="\u65E0\u6570\u636E",N.value="\u65E0\u6570\u636E",C.value=T.value)}finally{S.value=!1}},G=n(null);let d=null;const te=()=>{d&&d.dispose(),G.value&&ee&&(d=He(G.value),d.setOption({title:{text:"\u8017\u7535\u91CF\u8D8B\u52BF\u56FE",top:-4},tooltip:{trigger:"axis",formatter:me},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:_.value},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"line",data:x.value}],dataZoom:[{type:"inside"}]}),ee.appContext.config.globalProperties.lineChart=d,E.value=d==null?void 0:d.getOption().series,(()=>{var a,m;const t=[],e=((m=(a=E.value[0])==null?void 0:a.data)==null?void 0:m.length)||0;for(let c=0;c<e;c++){const p={};p.create_time=Q.value[c],p.startEleData=z.value[c],p.startTimeData=_.value[c],p.endEleData=B.value[c],p.endTimeData=j.value[c];for(const M of E.value)p[M.name]=M.data[c];t.push(p)}X.value=t})())};function h(t,e){return isNaN(t)?null:Number(t).toFixed(e)}function me(t){var e="";return t.forEach(function(a){a.seriesName==="\u8017\u7535\u91CF"&&(e+=a.marker+" "+a.seriesName+": "+a.value+" kWh")}),e}const ve=()=>{w.value=="weekTabPane"&&re(Y(i.value[0]),Y(i.value[1]))<7&&(i.value=q(7),U({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E7\u5929,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u5468",type:"warning"})),w.value=="monthTabPane"&&re(Y(i.value[0]),Y(i.value[1]))<30&&(i.value=H(1),U({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E1\u4E2A\u6708,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u4E2A\u6708",type:"warning"}))},ce=t=>{const e=new Date;return e.setHours(0,0,0,0),t.setHours(0,0,0,0),t>e};window.addEventListener("resize",function(){d==null||d.resize()});const pe=async t=>{u.roomId=t.id,T.value=t.name,Z()},Z=async()=>{u.roomId!=null?(await ae(),te()):U.error("\u673A\u623F\u4E0D\u80FD\u4E3A\u7A7A")};xe(async()=>{(async()=>{const a=await Le.getRoomList();$.value=a.map(m=>({id:m.id,name:m.roomName,children:[]}))})();const t=ne().query.roomId,e=ne().query.location;u.roomId=t?parseInt(t,10):void 0,u.roomId!=null&&(await ae(),C.value=e,T.value=e,te())});const fe=async()=>{try{await ue.exportConfirm(),O.value=!0;const t={timeout:0},e=await ie.getEQDataDetailsExcel(u,t);await Re.excel(e,"\u673A\u623F\u80FD\u8017\u6392\u540D.xlsx")}catch{}finally{O.value=!1}};return(t,e)=>{const a=ke,m=Ce,c=Te,p=Ee,M=Fe,le=Ie,he=Ae,f=Pe,ge=Ne,be=Ue;return y(),J(Se,{dataList:o($),onNodeClick:pe,navTitle:"\u673A\u623F\u80FD\u8017\u6392\u540D",showCheckbox:!1},{NavInfo:r(()=>[Be,V(),je,s("div",Qe,[s("div",Ge,[s("span",null,g(o(C)),1),s("span",null,g(o(i)[0])+"\u81F3"+g(o(i)[1]),1)]),s("div",Ze,[s("div",Je,[Ke,s("span",null,g(h(o(F),1))+" kWh",1)]),s("div",$e,[Xe,s("span",null,g(h(o(I),1))+" kWh",1)]),o(A)?(y(),W("div",ea,[aa,s("span",ta,g(o(A)),1)])):L("",!0),s("div",la,[na,s("span",null,g(h(o(P),1))+" kWh",1)]),o(N)?(y(),W("div",sa,[oa,s("span",ra,g(o(N)),1)])):L("",!0)])])]),ActionBar:r(()=>[l(m,{modelValue:o(w),"onUpdate:modelValue":e[0]||(e[0]=v=>K(w)?w.value=v:null)},{default:r(()=>[l(a,{label:"\u65E5\u6570\u636E",name:"dayTabPane"}),l(a,{label:"\u5468\u6570\u636E",name:"weekTabPane"}),l(a,{label:"\u6708\u6570\u636E",name:"monthTabPane"})]),_:1},8,["modelValue"]),l(he,{class:"-mb-15px",model:o(u),ref:"queryFormRef",inline:!0,"label-width":"auto"},{default:r(()=>[l(p,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:r(()=>[l(c,{"value-format":"YYYY-MM-DD",modelValue:o(i),"onUpdate:modelValue":e[1]||(e[1]=v=>K(i)?i.value=v:null),type:"daterange",shortcuts:de,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ce,class:"!w-350px",onChange:ve},null,8,["modelValue"])]),_:1}),l(p,null,{default:r(()=>[l(le,{onClick:Z},{default:r(()=>[l(M,{icon:"ep:search",class:"mr-5px"}),V(" \u641C\u7D22")]),_:1}),l(le,{type:"success",plain:"",onClick:fe,loading:o(O)},{default:r(()=>[l(M,{icon:"ep:download",class:"mr-5px"}),V(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:r(()=>[l(m,{modelValue:o(R),"onUpdate:modelValue":e[2]||(e[2]=v=>K(R)?R.value=v:null)},{default:r(()=>[l(a,{label:"\u56FE\u8868",name:"lineChart"},{default:r(()=>[Ye(s("div",{ref_key:"chartContainer",ref:G,id:"chartContainer",style:{width:"70vw",height:"58vh"}},null,512),[[be,o(S)]])]),_:1}),l(a,{label:"\u6570\u636E",name:"lineChartData"},{default:r(()=>[s("div",ia,[o(u).roomId!=null?(y(),J(ge,{key:0,border:!0,stripe:!0,data:o(X),style:{height:"67vh",width:"99.97%"},"header-cell-style":{backgroundColor:"#F5F7FA",color:"#909399",textAlign:"center",borderLeft:"1px #EDEEF2 solid",borderBottom:"1px #EDEEF2 solid",fontFamily:"Microsoft YaHei",fontWeight:"bold"},"cell-style":{color:"#606266",fontSize:"14px",textAlign:"center",borderBottom:"0.25px #F5F7FA solid",borderLeft:"0.25px #F5F7FA solid"},"row-style":{fontSize:"14px",textAlign:"center"},"empty-text":"\u6682\u65E0\u6570\u636E","max-height":"818"},{default:r(()=>[l(f,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:r(({$index:v})=>[V(g(v+1),1)]),_:1}),(y(!0),W(se,null,Me(o(E),v=>(y(),W(se,{key:v.name},[l(f,{label:"\u5F00\u59CB\u7535\u80FD"},{default:r(()=>[l(f,{prop:"startEleData",label:"\u5F00\u59CB\u7535\u80FD(kWh)"}),l(f,{prop:"startTimeData",label:"\u5F00\u59CB\u65F6\u95F4"})]),_:1}),l(f,{label:"\u7ED3\u675F\u7535\u80FD"},{default:r(()=>[l(f,{prop:"endEleData",label:"\u7ED3\u675F\u7535\u80FD(kWh)"}),l(f,{prop:"endTimeData",label:"\u7ED3\u675F\u65F6\u95F4"})]),_:1}),v.name==="\u8017\u7535\u91CF"?(y(),J(f,{key:0,label:"\u8017\u7535\u91CF"},{default:r(()=>[l(f,{prop:v.name,label:"\u8017\u7535\u91CF(kWh)"},null,8,["prop"]),l(f,{prop:"create_time",label:"\u8BB0\u5F55\u65F6\u95F4"})]),_:2},1024)):L("",!0)],64))),128))]),_:1},8,["data"])):L("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["dataList"])}}}),da=ze(ua,[["__scopeId","data-v-ef4ff1d5"]]);export{da as default};
