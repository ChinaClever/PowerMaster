import{d as Fe,e as l,an as Te,f as Ye,aj as Ee,h as Ne,o as g,n as G,w as u,j as o,a as n,c as y,t as h,q as b,k as s,m as K,l as Q,s as Ue,F as ve,p as Ie,aZ as Z,L as Pe,M as Se,P as Ve,O as We,_ as ze,A as Ae,Q as Be,D as Le,G as Oe,R as qe,J as He,K as Re}from"./index-mcOGIq4g.js";import"./index-KYPw-eK3.js";import{I as je}from"./index-D-gmWooi.js";import{f as F,e as fe,c as k,a as Ge,b as ge}from"./formatTime-f-_athMZ.js";import{E as he}from"./index-5UHMZISN.js";import{P as I}from"./PDU-QxJ-Axz0.js";import{d as Ke}from"./download--D_IyRio.js";import Qe from"./CommonMenu1-DzAutgxP.js";import{u as Ze}from"./useMessage-CGTQbR_M.js";import{i as Je}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as $e}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./install-DiAPpr4Z.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";const x=T=>(He("data-v-aadbcf9b"),T=T(),Re(),T),Xe={class:"nav_data"},ea={class:"nav_header"},aa={key:0},ta={key:1},la=x(()=>o("br",null,null,-1)),na={key:0,class:"descriptions-container",style:{"font-size":"14px"}},sa={class:"description-item"},oa=x(()=>o("span",{class:"label"},"\u603B\u8017\u7535\u91CF :",-1)),ia={class:"description-item"},ra=x(()=>o("span",{class:"label"},"\u6700\u5927\u8017\u7535\u91CF :",-1)),ua={key:0,class:"description-item"},da=x(()=>o("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ca={class:"value"},ma={class:"description-item"},pa=x(()=>o("span",{class:"label"},"\u6700\u5C0F\u8017\u7535\u91CF :",-1)),va={key:1,class:"description-item"},fa=x(()=>o("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ga={class:"value"},ha=x(()=>o("div",{class:"line",style:{"margin-top":"10px"}},null,-1)),ya={style:{height:"58vh"}},ba=$e(Fe({name:"ECDistribution",__name:"box",setup(T){var ue,de,ce,me;const J=Ze(),P=l(!1),S=l([]),w=l("dayTabPane"),V=l("lineChart"),$=l([]),Y=l([]),X=Te(),d=l(A(14)),W=l(!1),z=l(!1),i=Ye({pageNo:1,pageSize:15,boxId:void 0,granularity:"day",timeRange:["",""],devkey:void 0});function A(a){var e=new Date,t=new Date;return t.setDate(t.getDate()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}function B(a){var e=new Date,t=new Date;return t.setMonth(t.getMonth()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}l([{imgUrl:I},{imgUrl:I},{imgUrl:I},{imgUrl:I}]);const ye=[{text:"\u6700\u8FD1\u4E24\u5468",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-336),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];Ee(()=>w.value,async a=>{a=="dayTabPane"?(i.granularity="day",d.value=A(14)):a=="weekTabPane"?(i.granularity="week",d.value=B(3)):(i.granularity="month",d.value=B(12)),j()});const ee=l([]),_=l([]),ae=l([]),te=l([]),C=l([]),le=l([]),L=l(0),O=l(0),E=l(),q=l(0),H=l(),ne=async()=>{if(i.devkey!=null){W.value=!0;try{i.timeRange[0]=F(fe(k(d.value[0])));const a=864e5;i.timeRange[1]=F(fe(Ge(k(d.value[1]),a)));const e=await he.getBoxEQDataDetails(i);e!=null&&e.total!=0?(z.value=!0,L.value=0,ee.value=e.list.map(t=>D(t.start_ele,1)),_.value=e.list.map(t=>F(t.start_time,"YYYY-MM-DD")),ae.value=e.list.map(t=>D(t.end_ele,1)),te.value=e.list.map(t=>F(t.end_time,"YYYY-MM-DD")),C.value=e.list.map(t=>D(t.eq_value,1)),le.value=e.list.map(t=>F(t.create_time,"YYYY-MM-DD")),O.value=Math.max(...C.value),q.value=Math.min(...C.value),C.value.forEach(function(t,p){t==O.value&&(E.value=_.value[p]),t==q.value&&(H.value=_.value[p]),L.value+=Number(t)}),N.value=ie.value):(z.value=!1,Z({message:"\u6682\u65E0\u6570\u636E",type:"warning"}))}finally{W.value=!1}}else J.warning("\u8BF7\u5148\u9009\u62E9\u8BBE\u5907\uFF01")},R=l(null);let m=null;const se=()=>{m&&m.dispose(),R.value&&X&&(m=Je(R.value),m.setOption({title:{text:"\u8017\u7535\u91CF\u8D8B\u52BF\u56FE",top:-4},tooltip:{trigger:"axis",formatter:be},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:_.value},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"line",data:C.value}],dataZoom:[{type:"inside"}]}),X.appContext.config.globalProperties.lineChart=m,Y.value=m==null?void 0:m.getOption().series,(()=>{var t,p;const a=[],e=((p=(t=Y.value[0])==null?void 0:t.data)==null?void 0:p.length)||0;for(let r=0;r<e;r++){const c={};c.create_time=le.value[r],c.startEleData=ee.value[r],c.startTimeData=_.value[r],c.endEleData=ae.value[r],c.endTimeData=te.value[r];for(const M of Y.value)c[M.name]=M.data[r];a.push(c)}$.value=a})())};function D(a,e){return isNaN(a)?null:Number(a).toFixed(e)}function be(a){var e="";return a.forEach(function(t){t.seriesName==="\u8017\u7535\u91CF"&&(e+=t.marker+" "+t.seriesName+": "+t.value+" kWh")}),e}const xe=()=>{w.value=="weekTabPane"&&ge(k(d.value[0]),k(d.value[1]))<7&&(d.value=A(7),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E7\u5929,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u5468",type:"warning"})),w.value=="monthTabPane"&&ge(k(d.value[0]),k(d.value[1]))<30&&(d.value=B(1),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E1\u4E2A\u6708,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u4E2A\u6708",type:"warning"}))},we=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e};window.addEventListener("resize",function(){m==null||m.resize()});const De=async a=>{a.type!=null&&a.type==7&&(i.boxId=void 0,i.devkey=a.unique,oe(S.value,a.unique,e=>{ie.value=e}),j())};function oe(a,e,t,p=""){for(let r of a){const c=p===""?r.name:p+"-"+r.name;r.unique===e&&t(c),r.children&&r.children.length>0&&oe(r.children,e,t,c)}}const ke=async()=>{try{await J.exportConfirm(),i.pageNo=1,P.value=!0;const a={timeout:0},e=await he.exportBoxDetailsPageData(i,a);await Ke.excel(e,"\u63D2\u63A5\u7BB1\u80FD\u8017\u6392\u540D\u5386\u53F2\u6570\u636E.xlsx")}catch{}finally{P.value=!1}},j=async()=>{await ne(),se()},N=l((ue=history==null?void 0:history.state)==null?void 0:ue.locationName),U=l((de=history==null?void 0:history.state)==null?void 0:de.devKey),ie=l((ce=history==null?void 0:history.state)==null?void 0:ce.locationName),re=l((me=history==null?void 0:history.state)==null?void 0:me.id);return Ne(async()=>{(async()=>{const a=await je.getBoxMenu();S.value=a})(),U!=null&&(i.devkey=U),re!=null&&(i.boxId=re),i.boxId!=null&&(await ne(),se())}),(a,e)=>{const t=Pe,p=Se,r=Ve,c=We,M=ze,pe=Ae,_e=Be,f=Le,Ce=Oe,Me=qe;return g(),G(Qe,{dataList:n(S),onNodeClick:De,navTitle:"\u63D2\u63A5\u7BB1\u80FD\u8017\u6392\u540D",showCheckbox:!1},{NavInfo:u(()=>[o("div",Xe,[o("div",ea,[n(N)?(g(),y("span",aa,h(n(N)?"\u6682\u672A\u7ED1\u5B9A\u8BBE\u5907":n(N)),1)):b("",!0),n(U)?(g(),y("span",ta,"("+h(n(U))+")",1)):b("",!0)]),la,n(E)?(g(),y("div",na,[o("div",sa,[oa,o("span",null,h(D(n(L),1))+" kWh",1)]),o("div",ia,[ra,o("span",null,h(D(n(O),1))+" kWh",1)]),n(E)?(g(),y("div",ua,[da,o("span",ca,h(n(E)),1)])):b("",!0),o("div",ma,[pa,o("span",null,h(D(n(q),1))+" kWh",1)]),n(H)?(g(),y("div",va,[fa,o("span",ga,h(n(H)),1)])):b("",!0),ha])):b("",!0)])]),ActionBar:u(()=>[s(p,{modelValue:n(w),"onUpdate:modelValue":e[0]||(e[0]=v=>K(w)?w.value=v:null)},{default:u(()=>[s(t,{label:"\u65E5\u6570\u636E",name:"dayTabPane"}),s(t,{label:"\u5468\u6570\u636E",name:"weekTabPane"}),s(t,{label:"\u6708\u6570\u636E",name:"monthTabPane"})]),_:1},8,["modelValue"]),s(_e,{class:"-mb-15px",model:n(i),ref:"queryFormRef",inline:!0,"label-width":"auto"},{default:u(()=>[s(c,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:u(()=>[s(r,{"value-format":"YYYY-MM-DD",modelValue:n(d),"onUpdate:modelValue":e[1]||(e[1]=v=>K(d)?d.value=v:null),type:"daterange",shortcuts:ye,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":we,class:"!w-350px",onChange:xe},null,8,["modelValue"])]),_:1}),s(c,null,{default:u(()=>[s(pe,{onClick:j},{default:u(()=>[s(M,{icon:"ep:search",class:"mr-5px"}),Q(" \u641C\u7D22")]),_:1}),s(pe,{type:"success",plain:"",onClick:ke,loading:n(P)},{default:u(()=>[s(M,{icon:"ep:download",class:"mr-5px"}),Q(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:u(()=>[n(z)?(g(),G(p,{key:0,modelValue:n(V),"onUpdate:modelValue":e[2]||(e[2]=v=>K(V)?V.value=v:null)},{default:u(()=>[s(t,{label:"\u56FE\u8868",name:"lineChart"},{default:u(()=>[Ue(o("div",{ref_key:"chartContainer",ref:R,id:"chartContainer",style:{width:"70vw",height:"58vh"}},null,512),[[Me,n(W)]])]),_:1}),s(t,{label:"\u6570\u636E",name:"lineChartData"},{default:u(()=>[o("div",ya,[s(Ce,{border:!0,stripe:!0,data:n($),style:{height:"100%",width:"99.97%"},"header-cell-style":{backgroundColor:"#F5F7FA",color:"#909399",textAlign:"center",borderLeft:"1px #EDEEF2 solid",borderBottom:"1px #EDEEF2 solid",fontFamily:"Microsoft YaHei",fontWeight:"bold"},"cell-style":{color:"#606266",fontSize:"14px",textAlign:"center",borderBottom:"0.25px #F5F7FA solid",borderLeft:"0.25px #F5F7FA solid"},"row-style":{fontSize:"14px",textAlign:"center"},"empty-text":"\u6682\u65E0\u6570\u636E","max-height":"818"},{default:u(()=>[s(f,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:u(({$index:v})=>[Q(h(v+1+(n(i).pageNo-1)*n(i).pageSize),1)]),_:1}),(g(!0),y(ve,null,Ie(n(Y),v=>(g(),y(ve,{key:v.name},[s(f,{label:"\u5F00\u59CB\u7535\u80FD"},{default:u(()=>[s(f,{prop:"startEleData",label:"\u5F00\u59CB\u7535\u80FD(kWh)"}),s(f,{prop:"startTimeData",label:"\u5F00\u59CB\u65E5\u671F"})]),_:1}),s(f,{label:"\u7ED3\u675F\u7535\u80FD"},{default:u(()=>[s(f,{prop:"endEleData",label:"\u7ED3\u675F\u7535\u80FD(kWh)"}),s(f,{prop:"endTimeData",label:"\u7ED3\u675F\u65E5\u671F"})]),_:1}),v.name==="\u8017\u7535\u91CF"?(g(),G(f,{key:0,label:"\u8017\u7535\u91CF"},{default:u(()=>[s(f,{prop:v.name,label:"\u7535\u91CF(kWh)"},null,8,["prop"]),s(f,{prop:"create_time",label:"\u8BB0\u5F55\u65E5\u671F"})]),_:2},1024)):b("",!0)],64))),128))]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"])):b("",!0)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-aadbcf9b"]]);export{ba as default};
