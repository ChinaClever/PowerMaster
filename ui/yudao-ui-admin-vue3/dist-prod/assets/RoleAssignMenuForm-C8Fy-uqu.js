import{d as O,x as Q,e as u,f as X,o as b,n as C,w as l,k as s,a as d,l as c,s as q,t as V,m as h,bX as z,O as B,ba as D,dd as G,Q as J,A as L,R as P}from"./index-mcOGIq4g.js";import{_ as T}from"./Dialog.vue_vue_type_style_index_0_lang-BHwm1lq5.js";import{E as W}from"./el-card-FPJq94NZ.js";import{d as Y,h as Z}from"./tree-Cts6wVCK.js";import{g as $}from"./index-BrAk6oq9.js";import{g as ee,a as ae}from"./index-DyyrZzBm.js";import{u as le}from"./useMessage-CGTQbR_M.js";import{_ as se}from"./_plugin-vue_export-helper-BCo6x5W8.js";const te=se(O({name:"SystemRoleAssignMenuForm",__name:"RoleAssignMenuForm",emits:["success"],setup(de,{expose:g,emit:w}){const{t:I}=Q(),R=le(),n=u(!1),m=u(!1),t=X({id:0,name:"",code:"",menuIds:[]}),p=u(),_=u([]),i=u(!1),o=u(),f=u(!1);g({open:async a=>{n.value=!0,F(),_.value=Z(await $()),t.id=a.id,t.name=a.name,t.code=a.code,m.value=!0;try{t.value.menuIds=await ee(a.id),t.value.menuIds.forEach(e=>{o.value.setChecked(e,!0,!1)})}finally{m.value=!1}}});const M=w,A=async()=>{if(p&&await p.value.validate()){m.value=!0;try{const a={roleId:t.id,menuIds:[...o.value.getCheckedKeys(!1),...o.value.getHalfCheckedKeys()]};await ae(a),R.success(I("common.updateSuccess")),n.value=!1,M("success")}finally{m.value=!1}}},F=()=>{var a,e;f.value=!1,i.value=!1,t.value={id:0,name:"",code:"",menuIds:[]},(a=o.value)==null||a.setCheckedNodes([]),(e=p.value)==null||e.resetFields()},U=()=>{o.value.setCheckedNodes(f.value?_.value:[])},E=()=>{var e;const a=(e=o.value)==null?void 0:e.store.nodesMap;for(let v in a)a[v].expanded!==i.value&&(a[v].expanded=i.value)};return(a,e)=>{const v=z,y=B,k=D,H=G,K=W,N=J,x=L,S=T,j=P;return b(),C(S,{modelValue:d(n),"onUpdate:modelValue":e[3]||(e[3]=r=>h(n)?n.value=r:null),title:"\u83DC\u5355\u6743\u9650"},{footer:l(()=>[s(x,{disabled:d(m),type:"primary",onClick:A},{default:l(()=>[c("\u786E \u5B9A")]),_:1},8,["disabled"]),s(x,{onClick:e[2]||(e[2]=r=>n.value=!1)},{default:l(()=>[c("\u53D6 \u6D88")]),_:1})]),default:l(()=>[q((b(),C(N,{ref_key:"formRef",ref:p,model:d(t),"label-width":"80px"},{default:l(()=>[s(y,{label:"\u89D2\u8272\u540D\u79F0"},{default:l(()=>[s(v,null,{default:l(()=>[c(V(d(t).name),1)]),_:1})]),_:1}),s(y,{label:"\u89D2\u8272\u6807\u8BC6"},{default:l(()=>[s(v,null,{default:l(()=>[c(V(d(t).code),1)]),_:1})]),_:1}),s(y,{label:"\u83DC\u5355\u6743\u9650"},{default:l(()=>[s(K,{class:"cardHeight"},{header:l(()=>[c(" \u5168\u9009/\u5168\u4E0D\u9009: "),s(k,{modelValue:d(f),"onUpdate:modelValue":e[0]||(e[0]=r=>h(f)?f.value=r:null),"active-text":"\u662F","inactive-text":"\u5426","inline-prompt":"",onChange:U},null,8,["modelValue"]),c(" \u5168\u90E8\u5C55\u5F00/\u6298\u53E0: "),s(k,{modelValue:d(i),"onUpdate:modelValue":e[1]||(e[1]=r=>h(i)?i.value=r:null),"active-text":"\u5C55\u5F00","inactive-text":"\u6298\u53E0","inline-prompt":"",onChange:E},null,8,["modelValue"])]),default:l(()=>[s(H,{ref_key:"treeRef",ref:o,data:d(_),props:d(Y),"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019","node-key":"id","show-checkbox":""},null,8,["data","props"])]),_:1})]),_:1})]),_:1},8,["model"])),[[j,d(m)]])]),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-16ab792e"]]);export{te as default};
