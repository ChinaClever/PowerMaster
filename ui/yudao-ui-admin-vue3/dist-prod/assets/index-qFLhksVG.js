import{d as Ne,u as Ye,e as o,an as Me,f as ze,aj as Ie,g as qe,aX as ne,h as Se,T as j,o as g,n as _,w as s,l as h,j as n,t as k,a as i,k as u,m as Ue,s as re,aY as L,c as z,F as I,p as ie,q as oe,aZ as Re,S as We,N as Ae,O as Fe,P as Ve,_ as Ee,A as Te,Q as Pe,D as Qe,G as je,R as Le,J as He,K as Ke}from"./index-mcOGIq4g.js";import{_ as Oe}from"./CommonMenu-CxUjeIT-.js";import{_ as Xe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Be}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ge}from"./download--D_IyRio.js";import{E as q}from"./index-CRHHgC4s.js";import{f as S,e as U,c as R}from"./formatTime-f-_athMZ.js";import{C as Je}from"./index-JEsRnusb.js";import"./index-KYPw-eK3.js";import{P as W}from"./PDU-QxJ-Axz0.js";import{u as Ze}from"./useMessage-CGTQbR_M.js";import{i as $e}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as ea}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const d=D=>(He("data-v-c4f74660"),D=D(),Ke(),D),aa=d(()=>n("br",null,null,-1)),ta=d(()=>n("br",null,null,-1)),la={class:"nav_data"},na={class:"descriptions-container",style:{"font-size":"14px"}},ra={class:"description-item"},ia=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),oa={class:"value"},sa={class:"description-item"},ua=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),pa={class:"value"},da={class:"description-item"},ca=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ma={class:"value"},va=d(()=>n("br",null,null,-1)),ga=d(()=>n("div",null,[n("span",null,"\u5168\u90E8\u673A\u67DC\u65B0\u589E\u80FD\u8017\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),fa=d(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),ba={class:"realTotal"},ha=d(()=>n("br",null,null,-1)),ya=d(()=>n("br",null,null,-1)),wa=d(()=>n("br",null,null,-1)),xa=d(()=>n("br",null,null,-1)),_a=ea(Ne({name:"PowerAnalysis",__name:"index",setup(D){const se=Ze(),{push:ue}=Ye(),H=o([]),K=o(0),O=o(0),X=o(0),B=Me(),y=o(!0),c=o([]),f=o(0),A=o(0),m=o(void 0),l=ze({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,cabinetIds:[]}),pe=o([15,30,50,100]),de=o(),F=o(!1);o([{imgUrl:W},{imgUrl:W},{imgUrl:W},{imgUrl:W}]);const ce=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],me=a=>{const e=(a-1)*l.pageSize+1,t=a*l.pageSize,N=[];for(let b=e;b<=t;b++)N.push("\u5E8F\u53F7"+b);return N},V=o(null);let v=null;const E=o([]),G=()=>{V.value&&B&&(v=$e(V.value),v.setOption({title:{text:"\u5404\u673A\u67DC\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:ge},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:me(l.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:E.value,label:{show:!0,position:"top"},barWidth:50}]}),B.appContext.config.globalProperties.rankChart=v)};window.addEventListener("resize",function(){v==null||v.resize()}),Ie(()=>l.granularity,()=>{P()});const ve=o([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"230px"},{label:"\u8BB0\u5F55\u65E5\u671F",align:"center",prop:"create_time",formatter:C,width:"200px",istrue:!0},{label:"\u5F00\u59CB",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:J,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"start_ele",istrue:!0,formatter:w}]},{label:"\u7ED3\u675F",align:"center",istrue:!0,children:[{label:"\u65E5\u671F",align:"center",prop:"end_time",formatter:J,width:"150px",istrue:!0},{label:"\u7535\u80FD(kWh)",align:"center",prop:"end_ele",istrue:!0,formatter:w}]},{label:`\u8017\u7535\u91CF
(kWh)`,align:"center",prop:"eq_value",istrue:!0,formatter:w},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),T=async()=>{y.value=!0;try{if(m.value!=null){const e=S(U(R(m.value[0]))),t=S(U(R(m.value[1])));m.value=[e,t],l.timeRange=[e,t]}m.value==null&&(l.timeRange=void 0);const a=await q.getEQDataPage(l);E.value=a.list.map(e=>Z(e.eq_value,1)),c.value=a.list,A.value=a.total,a.total>1e4?f.value=1e4:f.value=a.total}finally{G(),y.value=!1}};function ge(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+c.value[t.dataIndex].location+"  ",e+="<br/>"+t.marker+"\u8BB0\u5F55\u65E5\u671F\uFF1A"+C(null,null,c.value[t.dataIndex].create_time)+" "+t.seriesName+": "+t.value+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+C(null,null,c.value[t.dataIndex].end_time)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+w(null,null,c.value[t.dataIndex].end_ele)+"kWh <br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+C(null,null,c.value[t.dataIndex].start_time)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+w(null,null,c.value[t.dataIndex].start_ele)+"kWh <br/>"}const fe=qe(()=>{const a=Math.ceil(f.value/l.pageSize);return l.pageNo===a&&f.value>=1e4});function C(a,e,t){return t?ne(t).format("YYYY-MM-DD"):""}function J(a,e,t){return t?ne(t).format("YYYY-MM-DD"):""}function w(a,e,t){return Number(t).toFixed(1)}function Z(a,e){return isNaN(a)?null:Number(a).toFixed(e)}const be=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},P=()=>{l.pageNo=1,T()},he=async a=>{let e=[];a.forEach(t=>{t.type==3&&e.push(t.id)}),e.length==0&&a.length!=0&&(e.push(0),v==null||v.clear(),Re({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),l.cabinetIds=e,P()},ye=async()=>{try{await se.exportConfirm(),l.pageNo=1,F.value=!0;const a={timeout:0},e=await q.exportEQPageData(l,a);await Ge.excel(e,"\u673A\u67DC\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{F.value=!1}},$=(a,e)=>{ue("/cabinet/nenghao/ecdistribution?cabinetId="+a+"&location="+e)},x=o(""),ee=o(""),ae=o(0);return Se(()=>{(async()=>{const a=await Je.getRoomMenuAll({});H.value=a})(),(async()=>{const a=await q.getNavNewData({});K.value=a.day,O.value=a.week,X.value=a.month})(),x.value=j().query.start,ee.value=j().query.end,ae.value=j().query.id,x.value!=null?(async()=>{y.value=!0;try{if(x.value!=null){const e=S(U(R(x.value))),t=S(U(R(ee.value)));m.value=[e,t],l.timeRange=[e,t]}x.value==null&&(l.timeRange=void 0),l.cabinetIds=[ae.value];const a=await q.getEQDataPage(l);E.value=a.list.map(e=>Z(e.eq_value,1)),c.value=a.list,A.value=a.total,a.total>1e4?f.value=1e4:f.value=a.total}finally{G(),y.value=!1}})():T()}),(a,e)=>{const t=We,N=Ae,b=Fe,we=Ve,te=Ee,Y=Te,xe=Pe,M=Qe,_e=je,ke=Be,De=Xe,Ce=Oe,le=Le;return g(),_(Ce,{dataList:i(H),onCheck:he,navTitle:"\u673A\u67DC\u80FD\u8017\u6570\u636E"},{NavInfo:s(()=>[aa,h(),ta,n("div",la,[n("div",na,[n("div",ra,[ia,n("span",oa,k(i(K))+"\u6761",1)]),n("div",sa,[ua,n("span",pa,k(i(O))+"\u6761",1)]),n("div",da,[ca,n("span",ma,k(i(X))+"\u6761",1)]),h(),va,ga])])]),ActionBar:s(()=>[u(xe,{class:"-mb-15px",model:i(l),ref_key:"queryFormRef",ref:de,inline:!0,"label-width":"auto"},{default:s(()=>[u(b,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:s(()=>[u(N,{modelValue:i(l).granularity,"onUpdate:modelValue":e[0]||(e[0]=r=>i(l).granularity=r),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:s(()=>[u(t,{label:"\u5929",value:"day"}),u(t,{label:"\u5468",value:"week"}),u(t,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),u(b,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:s(()=>[u(we,{"value-format":"YYYY-MM-DD",modelValue:i(m),"onUpdate:modelValue":e[1]||(e[1]=r=>Ue(m)?m.value=r:null),type:"daterange",shortcuts:ce,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":be},null,8,["modelValue"])]),_:1}),u(b,null,{default:s(()=>[u(Y,{onClick:P},{default:s(()=>[u(te,{icon:"ep:search",class:"mr-5px"}),h(" \u641C\u7D22")]),_:1}),u(Y,{type:"success",plain:"",loading:i(F),onClick:ye},{default:s(()=>[u(te,{icon:"ep:download",class:"mr-5px"}),h(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:s(()=>[re((g(),_(_e,{data:i(c),stripe:!0,"show-overflow-tooltip":!0},L({default:s(()=>[u(M,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:s(({$index:r})=>[h(k(r+1+(i(l).pageNo-1)*i(l).pageSize),1)]),_:1}),(g(!0),z(I,null,ie(i(ve),r=>(g(),z(I,{key:r.label},[!r.children&&r.istrue?(g(),_(M,{key:r.prop,label:r.label,align:r.align,prop:r.prop,formatter:r.formatter,width:r.width},L({_:2},[r.slot==="actions"?{name:"default",fn:s(({row:p})=>[u(Y,{link:"",type:"primary",onClick:Q=>$(p.cabinet_id,p.location)},{default:s(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):r.istrue?(g(),_(M,{key:1,label:r.label,align:r.align},{default:s(()=>[(g(!0),z(I,null,ie(r.children,p=>(g(),z(I,{key:p.prop},[p.istrue?(g(),_(M,{key:p.prop,label:p.label,align:p.align,prop:p.prop,formatter:p.formatter,width:p.width},L({_:2},[p.slot==="actions"?{name:"default",fn:s(({row:Q})=>[u(Y,{link:"",type:"primary",onClick:ka=>$(Q.cabinet_id,Q.location)},{default:s(()=>[h("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):oe("",!0)],64))),128))]),_:2},1032,["label","align"])):oe("",!0)],64))),128))]),_:2},[i(fe)?{name:"append",fn:s(()=>[fa]),key:"0"}:void 0]),1032,["data"])),[[le,i(y)]]),u(ke,{total:i(f),"page-size-arr":i(pe),layout:"sizes, prev, pager, next, jumper",page:i(l).pageNo,"onUpdate:page":e[2]||(e[2]=r=>i(l).pageNo=r),limit:i(l).pageSize,"onUpdate:limit":e[3]||(e[3]=r=>i(l).pageSize=r),onPagination:T},null,8,["total","page-size-arr","page","limit"]),n("div",ba,"\u5171 "+k(i(A))+" \u6761",1),ha,ya,wa,xa,u(De,null,{default:s(()=>[re(n("div",{ref_key:"rankChartContainer",ref:V,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[le,i(y)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-c4f74660"]]);export{_a as default};
