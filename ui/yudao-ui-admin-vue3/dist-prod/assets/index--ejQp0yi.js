import{d as he,u as we,e as o,an as xe,f as be,aj as ke,g as ye,aX as q,h as _e,o as g,n as k,w as i,l as x,k as u,a as r,m as De,s as B,aY as I,t as G,c as N,F as Y,p as H,q as O,j as s,aZ as Me,P as Ce,O as Ne,_ as Ye,A as Ae,Q as Se,D as Te,G as ze,R as Ie,J as Re,K as Fe}from"./index-mcOGIq4g.js";import{_ as We}from"./CommonMenu-CxUjeIT-.js";import{_ as Ee}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Ue}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as je}from"./download--D_IyRio.js";import{E as R}from"./index-DEdYoS9M.js";import{f as J,g as Pe,c as K,e as $e}from"./formatTime-f-_athMZ.js";import{C as Le}from"./index-JEsRnusb.js";import"./index-KYPw-eK3.js";import{u as Ve}from"./useMessage-CGTQbR_M.js";import{i as qe}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as Be}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const f=y=>(Re("data-v-14f8074c"),y=y(),Fe(),y),Ge=f(()=>s("br",null,null,-1)),He=f(()=>s("br",null,null,-1)),Oe=f(()=>s("div",{class:"nav_data"},[s("div",{style:{"font-size":"14px"}},[s("div",null,[s("span",{class:"label"},"\u6309\u65F6\u95F4\u8303\u56F4\u67E5\u8BE2\u5B9E\u65F6\u80FD\u8017")])])],-1)),Je=f(()=>s("tr",null,[s("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[s("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),Ke={class:"realTotal"},Qe=f(()=>s("br",null,null,-1)),Xe=f(()=>s("br",null,null,-1)),Ze=f(()=>s("br",null,null,-1)),ea=f(()=>s("br",null,null,-1)),aa=Be(he({name:"PowerAnalysis",__name:"index",setup(y){const{push:Q}=we(),F=o([]),X=o(0),Z=o(0),ee=o(0),W=xe(),_=o(!1),ae=Ve(),c=o([]),b=o(0),E=o(0),p=o(void 0),n=be({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,rackIds:[]}),te=o([15,30,50,100]),le=o(),A=o(!1),ne=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],re=a=>{const e=(a-1)*n.pageSize+1,t=a*n.pageSize,v=[];for(let w=e;w<=t;w++)v.push("\u5E8F\u53F7"+w);return v},S=o(null);let m=null;const U=o([]);window.addEventListener("resize",function(){m==null||m.resize()}),ke(()=>n.granularity,()=>{z()});const ie=o([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"180px"},{label:"\u673A\u67B6\u540D",align:"center",prop:"rackName",istrue:!0,width:"100px"},{label:"\u5F00\u59CB\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u5F00\u59CB\u7535\u80FD(kWh)",align:"center",prop:"eleActiveStart",istrue:!0,formatter:h},{label:"\u5F00\u59CB\u65F6\u95F4",align:"center",prop:"createTimeMin",formatter:P,width:"150px",istrue:!0}]},{label:"\u7ED3\u675F\u7535\u80FD",align:"center",istrue:!0,children:[{label:"\u7ED3\u675F\u7535\u80FD(kWh)",align:"center",prop:"eleActiveEnd",istrue:!0,formatter:h},{label:"\u7ED3\u675F\u65F6\u95F4",align:"center",prop:"createTimeMax",formatter:P,width:"150px",istrue:!0}]},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eleActive",istrue:!0,formatter:h},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"100px"}]),T=async()=>{_.value=!0;try{if(p.value==null)return void alert("\u8BF7\u8F93\u5165\u65F6\u95F4\u8303\u56F4");if(p.value!=null){const e=J(Pe(K(p.value[0]))),t=J($e(K(p.value[1])));n.timeRange=[e,t]}p.value==null&&(n.timeRange=void 0);const a=await R.getRackTotalRealtime(n);U.value=a.list.map(e=>{return t=e.eleActive,v=1,isNaN(t)?null:Number(t).toFixed(v);var t,v}),c.value=a.list,E.value=a.total,a.total>1e4?b.value=1e4:b.value=a.total}finally{S.value&&W&&(m=qe(S.value),m.setOption({title:{text:"\u5404\u673A\u67B6\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:oe},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:re(n.pageNo)},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:U.value,label:{show:!0,position:"top"},barWidth:50}]}),W.appContext.config.globalProperties.rankChart=m),_.value=!1}};function oe(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+c.value[t.dataIndex].location+"<br/>"+t.marker+"\u673A\u67B6\u540D\uFF1A"+c.value[t.dataIndex].rackName+"<br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+j(null,null,c.value[t.dataIndex].createTimeMin)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+h(null,null,c.value[t.dataIndex].eleActiveStart)+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+j(null,null,c.value[t.dataIndex].createTimeMax)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+h(null,null,c.value[t.dataIndex].eleActiveEnd)+"kWh <br/>"+t.marker+"\u8017\u7535\u91CF\uFF1A"+h(null,null,c.value[t.dataIndex].eleActive)+"kWh"}const se=ye(()=>{const a=Math.ceil(b.value/n.pageSize);return n.pageNo===a&&b.value>=1e4});function j(a,e,t){return t?q(t).format("YYYY-MM-DD"):""}function P(a,e,t){return t?q(t).format("YYYY-MM-DD"):""}function h(a,e,t){return t==null?"":Number(t).toFixed(1)}const ue=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},z=()=>{n.pageNo=1,T()},pe=async a=>{let e=[];a.forEach(t=>{t.type==5&&e.push(t.id)}),e.length==0&&a.length!=0&&(e.push(0),m==null||m.clear(),Me({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),n.rackIds=e,z()},$=(a,e,t)=>{Q("/u/nenghao/powerAnalysis?type=total&granularity=day&start="+e+"&end="+t+"&rackId="+a)},de=async()=>{try{await ae.exportConfirm(),n.pageNo=1,A.value=!0;const a={timeout:0},e=await R.getRackTotalRealtimeExcel(n,a);await je.excel(e,"\u673A\u67B6\u5B9E\u65F6\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{A.value=!1}};_e(()=>{(async()=>{const t=await Le.getRackMenuAll({});F.value=t})(),(async()=>{const t=await R.getNavNewData({});X.value=t.day,Z.value=t.week,ee.value=t.month})();const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);p.value=[L(e),L(a)],T()});const L=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return(a,e)=>{const t=Ce,v=Ne,w=Ye,D=Ae,ce=Se,M=Te,me=ze,ge=Ue,ve=Ee,fe=We,V=Ie;return g(),k(fe,{dataList:r(F),onCheck:pe,navTitle:"\u673A\u67B6\u5B9E\u65F6\u80FD\u8017"},{NavInfo:i(()=>[Ge,x(),He,Oe]),ActionBar:i(()=>[u(ce,{class:"-mb-15px",model:r(n),ref_key:"queryFormRef",ref:le,inline:!0,"label-width":"auto"},{default:i(()=>[u(v,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[u(t,{"value-format":"YYYY-MM-DD",modelValue:r(p),"onUpdate:modelValue":e[0]||(e[0]=l=>De(p)?p.value=l:null),type:"daterange",shortcuts:ne,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":ue},null,8,["modelValue"])]),_:1}),u(v,null,{default:i(()=>[u(D,{onClick:z},{default:i(()=>[u(w,{icon:"ep:search",class:"mr-5px"}),x(" \u641C\u7D22")]),_:1}),u(D,{type:"success",plain:"",loading:r(A),onClick:de},{default:i(()=>[u(w,{icon:"ep:download",class:"mr-5px"}),x(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:i(()=>[B((g(),k(me,{data:r(c),stripe:!0,"show-overflow-tooltip":!0},I({default:i(()=>[u(M,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:l})=>[x(G(l+1+(r(n).pageNo-1)*r(n).pageSize),1)]),_:1}),(g(!0),N(Y,null,H(r(ie),l=>(g(),N(Y,{key:l.label},[!l.children&&l.istrue?(g(),k(M,{key:l.prop,label:l.label,align:l.align,prop:l.prop,formatter:l.formatter,width:l.width},I({_:2},[l.slot==="actions"?{name:"default",fn:i(({row:d})=>[u(D,{link:"",type:"primary",onClick:C=>$(d.id,String(r(p)[0]),String(r(p)[1]))},{default:i(()=>[x("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):l.istrue?(g(),k(M,{key:1,label:l.label,align:l.align},{default:i(()=>[(g(!0),N(Y,null,H(l.children,d=>(g(),N(Y,{key:d.prop},[d.istrue?(g(),k(M,{key:d.prop,label:d.label,align:d.align,prop:d.prop,formatter:d.formatter,width:d.width},I({_:2},[d.slot==="actions"?{name:"default",fn:i(({row:C})=>[u(D,{link:"",type:"primary",onClick:ta=>$(C.id,C.createTimeMin,C.createTimeMax)},{default:i(()=>[x("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):O("",!0)],64))),128))]),_:2},1032,["label","align"])):O("",!0)],64))),128))]),_:2},[r(se)?{name:"append",fn:i(()=>[Je]),key:"0"}:void 0]),1032,["data"])),[[V,r(_)]]),u(ge,{total:r(b),"page-size-arr":r(te),layout:"sizes, prev, pager, next, jumper",page:r(n).pageNo,"onUpdate:page":e[1]||(e[1]=l=>r(n).pageNo=l),limit:r(n).pageSize,"onUpdate:limit":e[2]||(e[2]=l=>r(n).pageSize=l),onPagination:T},null,8,["total","page-size-arr","page","limit"]),s("div",Ke,"\u5171 "+G(r(E))+" \u6761",1),Qe,Xe,Ze,ea,u(ve,null,{default:i(()=>[B(s("div",{ref_key:"rankChartContainer",ref:S,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[V,r(_)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-14f8074c"]]);export{aa as default};
