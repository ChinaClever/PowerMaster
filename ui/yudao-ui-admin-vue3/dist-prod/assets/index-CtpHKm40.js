import{d as De,e as s,an as xe,f as _e,aj as ke,h as Ce,T as oe,o as b,n as G,w as i,l as A,j as l,a as o,c as M,t as h,q as T,k as n,m as Q,s as Me,F as re,p as Te,aZ as Z,L as Ye,M as Fe,P as Ee,O as Ae,_ as Ie,A as Pe,Q as Se,D as Ne,G as Ue,R as Ve,J as Oe,K as Le}from"./index-mcOGIq4g.js";import"./index-KYPw-eK3.js";import{C as Re}from"./index-JEsRnusb.js";import{f as Y,e as ie,c as D,a as He,b as ue}from"./formatTime-f-_athMZ.js";import{E as de}from"./index-DEdYoS9M.js";import{d as We}from"./download--D_IyRio.js";import ze from"./CommonMenu1-CJqidMpa.js";import{u as Be}from"./useMessage-CGTQbR_M.js";import{i as qe}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as je}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./install-DiAPpr4Z.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";const g=F=>(Oe("data-v-33855e77"),F=F(),Le(),F),Ge=g(()=>l("br",null,null,-1)),Qe=g(()=>l("br",null,null,-1)),Ze={class:"nav_data"},Je={class:"nav_header"},Ke={key:0},$e={class:"description-item"},Xe=g(()=>l("span",{class:"label"},"\u5F00\u59CB\u65E5\u671F :",-1)),ea={class:"description-item"},aa=g(()=>l("span",{class:"label"},"\u7ED3\u675F\u65E5\u671F :",-1)),ta={class:"description-item"},la=g(()=>l("span",{class:"label"},"\u603B\u8017\u7535\u91CF :",-1)),na={class:"description-item"},sa=g(()=>l("span",{class:"label"},"\u6700\u5927\u8017\u7535\u91CF :",-1)),oa={key:1,class:"description-item"},ra=g(()=>l("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ia={class:"value"},ua={class:"description-item"},da=g(()=>l("span",{class:"label"},"\u6700\u5C0F\u8017\u7535\u91CF :",-1)),ca={key:2,class:"description-item"},pa=g(()=>l("span",{class:"label"},"\u53D1\u751F\u65F6\u95F4 :",-1)),ma={class:"value"},va={style:{height:"58vh"}},fa=De({name:"ECDistribution",__name:"index",setup(F){const I=s(!1),ce=Be(),P=s([]),x=s(""),S=s(""),y=s("dayTabPane"),N=s("lineChart"),J=s([]),E=s([]),K=xe(),u=s(O(14)),U=s(!1),V=s(!1),d=_e({pageNo:1,pageSize:15,rackId:void 0,granularity:"day",nowAddress:void 0,timeRange:["",""]});function O(a){var e=new Date,t=new Date;return t.setDate(t.getDate()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}function L(a){var e=new Date,t=new Date;return t.setMonth(t.getMonth()-a),[t.toISOString().slice(0,10),e.toISOString().slice(0,10)]}const pe=[{text:"\u6700\u8FD1\u4E24\u5468",value:()=>{const a=new Date,e=new Date;return e.setHours(e.getHours()-336),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setUTCMonth(e.getUTCMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}];ke(()=>y.value,async a=>{a=="dayTabPane"?(d.granularity="day",u.value=O(14)):a=="weekTabPane"?(d.granularity="week",u.value=L(3)):(d.granularity="month",u.value=L(12)),j()});const $=s([]),_=s([]),X=s([]),ee=s([]),k=s([]),ae=s([]),R=s(0),H=s(0),W=s(),z=s(0),B=s(),te=async()=>{U.value=!0;try{d.timeRange[0]=Y(ie(D(u.value[0])));const a=864e5;d.timeRange[1]=Y(ie(He(D(u.value[1]),a)));const e=await de.getEQDataDetails(d);e!=null&&e.total!=0?(V.value=!0,R.value=0,$.value=e.list.map(t=>w(t.start_ele,1)),_.value=e.list.map(t=>Y(t.start_time,"YYYY-MM-DD")),X.value=e.list.map(t=>w(t.end_ele,1)),ee.value=e.list.map(t=>Y(t.end_time,"YYYY-MM-DD")),k.value=e.list.map(t=>w(t.eq_value,1)),ae.value=e.list.map(t=>Y(t.create_time,"YYYY-MM-DD")),H.value=Math.max(...k.value),z.value=Math.min(...k.value),k.value.forEach(function(t,m){t==H.value&&(W.value=_.value[m]),t==z.value&&(B.value=_.value[m]),R.value+=Number(t)}),x.value=S.value):(V.value=!1,Z({message:"\u6682\u65E0\u6570\u636E",type:"warning"}))}finally{U.value=!1}},q=s(null);let p=null;const le=()=>{p&&p.dispose(),q.value&&K&&(p=qe(q.value),p.setOption({title:{text:"\u8017\u7535\u91CF\u8D8B\u52BF\u56FE",top:-4},tooltip:{trigger:"axis",formatter:me},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:_.value},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"line",data:k.value}],dataZoom:[{type:"inside"}]}),K.appContext.config.globalProperties.lineChart=p,E.value=p==null?void 0:p.getOption().series,(()=>{var t,m;const a=[],e=((m=(t=E.value[0])==null?void 0:t.data)==null?void 0:m.length)||0;for(let r=0;r<e;r++){const c={};c.create_time=ae.value[r],c.startEleData=$.value[r],c.startTimeData=_.value[r],c.endEleData=X.value[r],c.endTimeData=ee.value[r];for(const C of E.value)c[C.name]=C.data[r];a.push(c)}J.value=a})())};function w(a,e){return isNaN(a)?null:Number(a).toFixed(e)}function me(a){var e="";return a.forEach(function(t){t.seriesName==="\u8017\u7535\u91CF"&&(e+=t.marker+" "+t.seriesName+": "+t.value+" kWh")}),e}const ve=()=>{y.value=="weekTabPane"&&ue(D(u.value[0]),D(u.value[1]))<7&&(u.value=O(7),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E7\u5929,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u5468",type:"warning"})),y.value=="monthTabPane"&&ue(D(u.value[0]),D(u.value[1]))<30&&(u.value=L(1),Z({message:"\u65F6\u95F4\u9009\u62E9\u4E0D\u5C11\u4E8E1\u4E2A\u6708,\u5DF2\u9ED8\u8BA4\u9009\u62E9\u6700\u8FD1\u4E00\u4E2A\u6708",type:"warning"}))},fe=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e};window.addEventListener("resize",function(){p==null||p.resize()});const he=async a=>{a.type!=null&&a.type==5&&(d.rackId=a.id,ne(P.value,a.unique,e=>{S.value=e}),j())};function ne(a,e,t,m=""){for(let r of a){const c=m===""?r.name:m+"-"+r.name;r.unique===e&&t(c),r.children&&r.children.length>0&&ne(r.children,e,t,c)}}const j=async()=>{await te(),le()},ge=async()=>{try{await ce.exportConfirm(),d.nowAddress=x.value,d.pageNo=1,I.value=!0;const a={timeout:0},e=await de.exportOutletsPageData(d,a);await We.excel(e,"\u673A\u67B6\u80FD\u8017\u6392\u540D.xlsx")}catch{}finally{I.value=!1}};return Ce(async()=>{(async()=>{const t=await Re.getRackMenuAll({});P.value=t})();const a=oe().query.rackId,e=oe().query.location;d.rackId=a?parseInt(a,10):void 0,d.rackId!=null&&(await te(),x.value=e,S.value=e,le())}),(a,e)=>{const t=Ye,m=Fe,r=Ee,c=Ae,C=Ie,se=Pe,be=Se,f=Ne,ye=Ue,we=Ve;return b(),G(ze,{dataList:o(P),onNodeClick:he,navTitle:"\u673A\u67B6\u80FD\u8017\u6392\u540D",showCheckbox:!1},{NavInfo:i(()=>[Ge,A(),Qe,l("div",Ze,[l("div",Je,[o(x)?(b(),M("span",Ke,h(o(x)),1)):T("",!0),l("div",$e,[Xe,l("span",null,h(o(u)[0]),1)]),l("div",ea,[aa,l("span",null,h(o(u)[1]),1)]),l("div",ta,[la,l("span",null,h(w(o(R),1))+" kWh",1)]),l("div",na,[sa,l("span",null,h(w(o(H),1))+" kWh",1)]),o(W)?(b(),M("div",oa,[ra,l("span",ia,h(o(W)),1)])):T("",!0),l("div",ua,[da,l("span",null,h(w(o(z),1))+" kWh",1)]),o(B)?(b(),M("div",ca,[pa,l("span",ma,h(o(B)),1)])):T("",!0)])])]),ActionBar:i(()=>[n(m,{modelValue:o(y),"onUpdate:modelValue":e[0]||(e[0]=v=>Q(y)?y.value=v:null)},{default:i(()=>[n(t,{label:"\u65E5\u6570\u636E",name:"dayTabPane"}),n(t,{label:"\u5468\u6570\u636E",name:"weekTabPane"}),n(t,{label:"\u6708\u6570\u636E",name:"monthTabPane"})]),_:1},8,["modelValue"]),n(be,{class:"-mb-15px",model:o(d),ref:"queryFormRef",inline:!0,"label-width":"auto"},{default:i(()=>[n(c,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:i(()=>[n(r,{"value-format":"YYYY-MM-DD",modelValue:o(u),"onUpdate:modelValue":e[1]||(e[1]=v=>Q(u)?u.value=v:null),type:"daterange",shortcuts:pe,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":fe,class:"!w-350px",onChange:ve},null,8,["modelValue"])]),_:1}),n(c,null,{default:i(()=>[n(se,{onClick:j},{default:i(()=>[n(C,{icon:"ep:search",class:"mr-5px"}),A(" \u641C\u7D22")]),_:1}),n(se,{type:"success",plain:"",onClick:ge,loading:o(I)},{default:i(()=>[n(C,{icon:"ep:download",class:"mr-5px"}),A(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:i(()=>[o(V)?(b(),G(m,{key:0,modelValue:o(N),"onUpdate:modelValue":e[2]||(e[2]=v=>Q(N)?N.value=v:null)},{default:i(()=>[n(t,{label:"\u56FE\u8868",name:"lineChart"},{default:i(()=>[Me(l("div",{ref_key:"chartContainer",ref:q,id:"chartContainer",style:{width:"70vw",height:"58vh"}},null,512),[[we,o(U)]])]),_:1}),n(t,{label:"\u6570\u636E",name:"lineChartData"},{default:i(()=>[l("div",va,[n(ye,{border:!0,stripe:!0,data:o(J),style:{height:"67vh",width:"99.97%"},"header-cell-style":{backgroundColor:"#F5F7FA",color:"#909399",textAlign:"center",borderLeft:"1px #EDEEF2 solid",borderBottom:"1px #EDEEF2 solid",fontFamily:"Microsoft YaHei",fontWeight:"bold"},"cell-style":{color:"#606266",fontSize:"14px",textAlign:"center",borderBottom:"0.25px #F5F7FA solid",borderLeft:"0.25px #F5F7FA solid"},"row-style":{fontSize:"14px",textAlign:"center"},"empty-text":"\u6682\u65E0\u6570\u636E","max-height":"818"},{default:i(()=>[n(f,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:i(({$index:v})=>[A(h(v+1),1)]),_:1}),(b(!0),M(re,null,Te(o(E),v=>(b(),M(re,{key:v.name},[n(f,{label:"\u5F00\u59CB\u7535\u80FD"},{default:i(()=>[n(f,{prop:"startEleData",label:"\u6570\u503C"}),n(f,{prop:"startTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:1}),n(f,{label:"\u7ED3\u675F\u7535\u80FD"},{default:i(()=>[n(f,{prop:"endEleData",label:"\u6570\u503C"}),n(f,{prop:"endTimeData",label:"\u53D1\u751F\u65F6\u95F4"})]),_:1}),v.name==="\u8017\u7535\u91CF"?(b(),G(f,{key:0,label:"\u8017\u7535\u91CF"},{default:i(()=>[n(f,{prop:v.name,label:"\u6570\u503C"},null,8,["prop"]),n(f,{prop:"create_time",label:"\u8BB0\u5F55\u65F6\u95F4"})]),_:2},1024)):T("",!0)],64))),128))]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"])):T("",!0)]),_:1},8,["dataList"])}}}),ha=je(fa,[["__scopeId","data-v-33855e77"]]);export{ha as default};
