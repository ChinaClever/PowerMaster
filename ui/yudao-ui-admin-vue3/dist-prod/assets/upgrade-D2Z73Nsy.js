import{d as H,e as r,f as J,o as u,c as w,k as a,w as t,j as K,a as o,F as V,p as C,n as m,q as b,l as d,s as W,ax as X,m as Y,b8 as ee,aZ as le,S as ae,N as te,O as oe,Z as ie,_ as pe,A as ue,Q as se,D as de,G as ne,az as re,aA as me,aS as ce,R as fe}from"./index-mcOGIq4g.js";import{_ as ge}from"./Dialog.vue_vue_type_style_index_0_lang-BHwm1lq5.js";import{_ as ye}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{_ as ve}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{m as D}from"./index-bbtkn_W1.js";import{C as _e}from"./index-JEsRnusb.js";import{_ as be}from"./ipTable.vue_vue_type_script_setup_true_lang-Bx7v6uBX.js";import{u as he}from"./useMessage-CGTQbR_M.js";import"./index-BFNvSS9e.js";import"./el-card-FPJq94NZ.js";const we={class:"flex justify-between"},Ve=H({__name:"upgrade",setup(ke){const h=he(),k=r(!1),x=r(!1),f=r(!1),s=r({type:0,rooms:[],ips:[]});r(0);const S=r([]),U=r([]),v=r([]),i=J({type:0,rooms:[],ip:"",pageNo:1,pageSize:24,pageTotal:0}),A=[{value:0,label:"\u5168\u90E8"},{value:1,label:"\u673A\u623F"},{value:2,label:"ip"}],_=async(p=!1)=>{k.value=!0,p&&(i.pageNo=1);try{const e=await D.getUpgradeFilePage({pageNo:i.pageNo,pageSize:i.pageSize,upgradeDev:i.type});e.list&&(S.value=e.list,i.pageTotal=e.total)}finally{k.value=!1}},P=p=>{s.value.ips=p},R=(p,e)=>{v.value=e},B=(p,e)=>{v.value=e},E=(p,e)=>{h.warning(`\u5F53\u524D\u9650\u5236\u9009\u62E9 3 \u4E2A\u6587\u4EF6\uFF0C\u672C\u6B21\u9009\u62E9\u4E86 ${p.length} \u4E2A\u6587\u4EF6\uFF0C\u5171\u9009\u62E9\u4E86 ${p.length+e.length} \u4E2A\u6587\u4EF6`)},L=async()=>{if(v.value.length!=0){x.value=!0;try{let p=new FormData;v.value.forEach(c=>{p.append("files",c.raw)});const e={upgradeDev:s.value.type};e.upgradeDev==2&&(e.ipList=s.value.ips.map(c=>c.ip)),e.upgradeDev==1&&(e.roomIds=s.value.rooms),await D.getUpgradeFillUpload(e,p)&&(h.success("\u4E0A\u4F20\u6210\u529F\uFF01"),f.value=!1,_(!0))}catch{}finally{x.value=!1}}else h.error("\u8BF7\u4E0A\u4F20\u6587\u4EF6")};return(async()=>{const p=await _e.getRoomList({});U.value=p||[]})(),_(),(p,e)=>{const c=ae,N=te,n=oe,M=ie,Z=pe,g=ue,T=se,F=ve,y=de,$=ne,q=ye,z=re,G=me,I=ce,O=ge,Q=fe;return u(),w(V,null,[a(F,null,{default:t(()=>[K("div",we,[a(T,{class:"-mb-15px",model:o(i),inline:!0,"label-width":"68px"},{default:t(()=>[a(n,{label:"\u641C\u7D22\u65B9\u5F0F\uFF1A","label-width":"90",prop:"type"},{default:t(()=>[a(N,{modelValue:o(i).type,"onUpdate:modelValue":e[0]||(e[0]=l=>o(i).type=l),clearable:"",style:{width:"140px"}},{default:t(()=>[(u(),w(V,null,C(A,l=>a(c,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(i).type==1?(u(),m(n,{key:0,label:"\u673A\u623F\uFF1A"},{default:t(()=>[a(N,{multiple:"","collapse-tags":"",modelValue:o(i).rooms,"onUpdate:modelValue":e[1]||(e[1]=l=>o(i).rooms=l),placeholder:"\u8BF7\u9009\u62E9",style:{width:"140px"}},{default:t(()=>[(u(!0),w(V,null,C(o(U),l=>(u(),m(c,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),o(i).type==2?(u(),m(n,{key:1,label:"ip\uFF1A"},{default:t(()=>[a(M,{modelValue:o(i).ip,"onUpdate:modelValue":e[2]||(e[2]=l=>o(i).ip=l),placeholder:"\u8BF7\u8F93\u5165ip",clearable:"",class:"!w-160px",height:"35"},null,8,["modelValue"])]),_:1})):b("",!0),a(n,null,{default:t(()=>[o(i).type==2||o(i).type==1?(u(),m(g,{key:0,style:{"margin-left":"12px"},onClick:e[3]||(e[3]=l=>_(!0))},{default:t(()=>[a(Z,{icon:"ep:search"}),d("\u641C\u7D22")]),_:1})):b("",!0)]),_:1})]),_:1},8,["model"]),a(g,{type:"primary",onClick:e[4]||(e[4]=l=>f.value=!0),plain:""},{default:t(()=>[d("\u4E0A\u4F20")]),_:1})])]),_:1}),a(F,null,{default:t(()=>[W((u(),m($,{style:{width:"100%"},height:"600",data:o(S)},{default:t(()=>[a(y,{label:"\u5347\u7EA7\u8BBE\u5907","min-width":"110",align:"center",prop:"upgradeDevMsg"}),a(y,{label:"\u5347\u7EA7\u6587\u4EF6","min-width":"110",align:"center",prop:"fileNames"}),a(y,{label:"\u6587\u4EF6\u8DEF\u5F84","min-width":"110",align:"center",prop:"filePath"}),a(y,{label:"\u4E0A\u4F20\u7ED3\u679C","min-width":"110",align:"center",prop:"cabinetName"}),a(y,{label:"\u521B\u5EFA\u65F6\u95F4","min-width":"110",align:"center",prop:"createTime"}),a(y,{fixed:"right",label:"\u64CD\u4F5C",width:"120"},{default:t(l=>[a(g,{link:"",type:"primary",size:"small",onClick:X(xe=>{return j=l.row.id,void ee.confirm("\u786E\u5B9A\u5220\u9664\u8FD9\u6B21\u8BB0\u5F55\u5417?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{await D.deleteFillRecord(j)&&h.success("\u5220\u9664\u6210\u529F"),_(!0)}).catch(()=>{le({type:"info",message:"\u53D6\u6D88\u4E86"})});var j},["prevent"])},{default:t(()=>[d(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,o(k)]]),a(q,{total:o(i).pageTotal,page:o(i).pageNo,"onUpdate:page":e[5]||(e[5]=l=>o(i).pageNo=l),limit:o(i).pageSize,"onUpdate:limit":e[6]||(e[6]=l=>o(i).pageSize=l),onPagination:e[7]||(e[7]=l=>_(!1))},null,8,["total","page","limit"])]),_:1}),a(O,{modelValue:o(f),"onUpdate:modelValue":e[11]||(e[11]=l=>Y(f)?f.value=l:null),title:"\u4E0A\u4F20\u5BF9\u8C61"},{footer:t(()=>[a(g,{onClick:e[10]||(e[10]=l=>f.value=!1)},{default:t(()=>[d("\u53D6 \u6D88")]),_:1}),a(g,{loading:o(x),onClick:L,type:"primary"},{default:t(()=>[d("\u786E \u5B9A")]),_:1},8,["loading"])]),default:t(()=>[a(T,{"label-width":"100"},{default:t(()=>[a(n,{label:"\u7C7B\u578B\uFF1A"},{default:t(()=>[a(G,{modelValue:o(s).type,"onUpdate:modelValue":e[8]||(e[8]=l=>o(s).type=l)},{default:t(()=>[a(z,{label:0},{default:t(()=>[d("\u5168\u90E8")]),_:1}),a(z,{label:1},{default:t(()=>[d("\u673A\u623F")]),_:1}),a(z,{label:2},{default:t(()=>[d("ip")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(s).type==1?(u(),m(n,{key:0,label:"\u673A\u623F\uFF1A"},{default:t(()=>[a(N,{multiple:"",modelValue:o(s).rooms,"onUpdate:modelValue":e[9]||(e[9]=l=>o(s).rooms=l),"collapse-tags":"",placeholder:"\u8BF7\u9009\u62E9",style:{width:"140px"}},{default:t(()=>[(u(!0),w(V,null,C(o(U),l=>(u(),m(c,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),o(s).type==2?(u(),m(n,{key:1,label:"ip\uFF1A"},{default:t(()=>[a(be,{onUpdate:P})]),_:1})):b("",!0),a(n,{label:"\u6587\u4EF6\uFF1A"},{default:t(()=>[a(I,{class:"upload-demo",action:"https://jsonplaceholder.typicode.com/posts/","on-remove":R,"on-change":B,"auto-upload":!1,multiple:"",limit:10,"on-exceed":E,"file-list":o(v)},{default:t(()=>[a(g,{size:"small",type:"primary"},{default:t(()=>[d("\u70B9\u51FB\u4E0A\u4F20")]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});export{Ve as default};
