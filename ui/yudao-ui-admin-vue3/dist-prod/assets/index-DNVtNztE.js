import{d as fe,e as i,f as be,aj as _e,g as ye,aX as he,h as we,o as c,n as h,w as o,l as v,j as n,t as f,a as t,k as p,m as xe,s as ke,aY as T,c as C,F as E,p as De,q as Ne,aZ as Me,S as Se,N as Ye,O as ze,P as Ce,_ as Re,A as Ve,Q as Fe,D as qe,G as Ie,R as Be,J as Pe,K as Ue}from"./index-mcOGIq4g.js";import{_ as $e}from"./CommonMenu-CxUjeIT-.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as Ae}from"./download--D_IyRio.js";import{E as w}from"./index-DEdYoS9M.js";import{f as G,e as J,c as K,a as We}from"./formatTime-f-_athMZ.js";import{C as He}from"./index-JEsRnusb.js";import{u as Le}from"./useMessage-CGTQbR_M.js";import{_ as Te}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import"./el-card-FPJq94NZ.js";import"./NavTree-CcS5UKLK.js";import"./index-BFNvSS9e.js";const d=b=>(Pe("data-v-2cbec259"),b=b(),Ue(),b),Ee=d(()=>n("br",null,null,-1)),Ge=d(()=>n("br",null,null,-1)),Je={class:"nav_data"},Ke={class:"descriptions-container",style:{"font-size":"14px"}},Oe={class:"description-item"},Qe=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),Xe={class:"value"},Ze={class:"description-item"},ea=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),aa={class:"value"},ta={class:"description-item"},la=d(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ra={class:"value"},na=d(()=>n("div",null,[n("span",null,"\u5168\u90E8\u673A\u67B6\u65B0\u589E\u7535\u8D39\u7EDF\u8BA1"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),sa={key:1},ia=d(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),oa={class:"realTotal"},pa=Te(fe({name:"BillStatistics",__name:"index",setup(b){const R=i([]),V=i(0),F=i(0),q=i(0),O=i(!1),I=i([]),B=i(""),P=i(""),x=i(!0),Q=Le(),U=i([]),g=i(0),$=i(0),u=i(void 0),r=be({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,rackIds:[]}),X=i([15,30,50,100]),Z=i(),k=i(!1),ee=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}}];_e(()=>r.granularity,()=>{r.granularity=="day"?D.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u673A\u67B6\u540D",align:"center",prop:"rack_name",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:_,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:j},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]:D.value=[{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u673A\u67B6\u540D",align:"center",prop:"rack_name",istrue:!0},{label:"\u5F00\u59CB\u65E5\u671F",align:"center",prop:"start_time",formatter:_,istrue:!0},{label:"\u7ED3\u675F\u65E5\u671F",align:"center",prop:"end_time",formatter:_,istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:y}],M()});const D=i([{label:"\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0},{label:"\u673A\u67B6\u540D",align:"center",prop:"rack_name",istrue:!0},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:_,width:"200px",istrue:!0},{label:"\u8017\u7535\u91CF(kWh)",align:"center",prop:"eq_value",istrue:!0,formatter:y},{label:"\u7535\u8D39(\u5143)",align:"center",prop:"bill_value",istrue:!0,formatter:j},{label:"\u8BA1\u8D39\u65B9\u5F0F",align:"center",slot:"actions",istrue:!0}]),N=async()=>{x.value=!0;try{if(u.value!=null){const e=G(J(K(u.value[0]))),l=864e5,S=G(J(We(K(u.value[1]),l)));r.timeRange=[e,S]}const a=await w.getBillDataPage(r);U.value=a.list,$.value=a.total,a.total>1e4?g.value=1e4:g.value=a.total}finally{x.value=!1}},ae=ye(()=>{const a=Math.ceil(g.value/r.pageSize);return r.pageNo===a&&g.value>=1e4});function _(a,e,l){return l?he(l).format("YYYY-MM-DD"):""}function y(a,e,l){return Number(l).toFixed(1)}function j(a,e,l){return Number(l).toFixed(2)}const te=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},M=()=>{r.pageNo=1,N()},le=async a=>{let e=[];a.forEach(l=>{l.type==5&&e.push(l.id)}),e.length==0&&a.length!=0&&(e.push(0),Me({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),r.rackIds=e,M()},re=async()=>{try{await Q.exportConfirm(),r.pageNo=1,k.value=!0;const a={timeout:0},e=await w.exportBillPageData(r,a);await Ae.excel(e,"\u673A\u67B6\u7535\u8D39\u7EDF\u8BA1.xlsx")}catch{}finally{k.value=!1}};we(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1);u.value=[A(e),A(a)],(async()=>{const l=await He.getRackMenuAll({});R.value=l})(),(async()=>{const l=await w.getNavNewData({});V.value=l.day,F.value=l.week,q.value=l.month})(),N()});const A=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`;return(a,e)=>{const l=Se,S=Ye,Y=ze,ne=Ce,W=Re,z=Ve,se=Fe,H=qe,ie=Ie,oe=je,pe=$e,ue=Be;return c(),h(pe,{dataList:t(R),onCheck:le,navTitle:"\u673A\u67B6\u7535\u8D39\u7EDF\u8BA1"},{NavInfo:o(()=>[Ee,v(),Ge,n("div",Je,[n("div",Ke,[n("div",Oe,[Qe,n("span",Xe,f(t(V))+"\u6761",1)]),n("div",Ze,[ea,n("span",aa,f(t(F))+"\u6761",1)]),n("div",ta,[la,n("span",ra,f(t(q))+"\u6761",1)]),na])])]),ActionBar:o(()=>[p(se,{class:"-mb-15px",model:t(r),ref_key:"queryFormRef",ref:Z,inline:!0,"label-width":"auto"},{default:o(()=>[p(Y,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:o(()=>[p(S,{modelValue:t(r).granularity,"onUpdate:modelValue":e[0]||(e[0]=s=>t(r).granularity=s),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:o(()=>[p(l,{label:"\u5929",value:"day"}),p(l,{label:"\u5468",value:"week"}),p(l,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),p(Y,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[p(ne,{"value-format":"YYYY-MM-DD",modelValue:t(u),"onUpdate:modelValue":e[1]||(e[1]=s=>xe(u)?u.value=s:null),type:"daterange",shortcuts:ee,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4","disabled-date":te},null,8,["modelValue"])]),_:1}),p(Y,null,{default:o(()=>[p(z,{onClick:M},{default:o(()=>[p(W,{icon:"ep:search",class:"mr-5px"}),v(" \u641C\u7D22")]),_:1}),p(z,{type:"success",plain:"",loading:t(k),onClick:re},{default:o(()=>[p(W,{icon:"ep:download",class:"mr-5px"}),v(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:o(()=>[ke((c(),h(ie,{data:t(U),stripe:!0,"show-overflow-tooltip":!0,border:!0},T({default:o(()=>[p(H,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:o(({$index:s})=>[v(f(s+1+(t(r).pageNo-1)*t(r).pageSize),1)]),_:1}),(c(!0),C(E,null,De(t(D),s=>(c(),C(E,null,[s.istrue?(c(),h(H,{key:s.prop,label:s.label,align:s.align,prop:s.prop,formatter:s.formatter,width:s.width},T({_:2},[s.slot==="actions"&&t(r).granularity=="day"?{name:"default",fn:o(({row:m})=>[m.bill_mode_real&&m.bill_mode_real==2?(c(),h(z,{key:0,link:"",type:"primary",onClick:ua=>(async(ce,L,de,me)=>{I.value=[],B.value="",P.value="";let ge={rackId:ce,startTime:L};const ve=await w.getSubBillDetails(ge);I.value=ve.list,B.value=de,P.value=L+" - "+me,O.value=!0})(m.rack_id,m.start_time,m.location,m.end_time)},{default:o(()=>[v("\u5206\u6BB5\u8BA1\u8D39")]),_:2},1032,["onClick"])):(c(),C("div",sa,"\u56FA\u5B9A\u8BA1\u8D39"))]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):Ne("",!0)],64))),256))]),_:2},[t(ae)?{name:"append",fn:o(()=>[ia]),key:"0"}:void 0]),1032,["data"])),[[ue,t(x)]]),p(oe,{total:t(g),"page-size-arr":t(X),layout:"sizes, prev, pager, next, jumper",page:t(r).pageNo,"onUpdate:page":e[2]||(e[2]=s=>t(r).pageNo=s),limit:t(r).pageSize,"onUpdate:limit":e[3]||(e[3]=s=>t(r).pageSize=s),onPagination:N},null,8,["total","page-size-arr","page","limit"]),n("div",oa,"\u5171 "+f(t($))+" \u6761",1)]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-2cbec259"]]);export{pa as default};
