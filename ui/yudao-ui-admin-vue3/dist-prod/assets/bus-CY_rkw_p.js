import{d as Ye,u as Fe,e as s,an as Se,f as Pe,aj as Ue,g as Re,aX as re,h as Ve,o as v,n as w,w as o,l as y,j as n,t as x,a as i,k as u,m as qe,s as ie,aY as Q,c as Y,F,p as se,q as oe,aZ as j,S as Ae,N as Ee,O as We,P as Le,_ as Qe,A as je,Q as Ke,D as Be,G as He,R as Je,J as Oe,K as Te}from"./index-mcOGIq4g.js";import{_ as Xe}from"./CommonMenu-CxUjeIT-.js";import{_ as Ge}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BHQCcaX3.js";import{_ as Ze}from"./index.vue_vue_type_script_setup_true_lang-DcNux-x9.js";import{d as $e}from"./download--D_IyRio.js";import{E as S}from"./index-5UHMZISN.js";import{f as P,e as K,c as U,a as ea}from"./formatTime-f-_athMZ.js";import{I as aa}from"./index-D-gmWooi.js";import"./index-KYPw-eK3.js";import{P as R}from"./PDU-QxJ-Axz0.js";import{u as ta}from"./useMessage-CGTQbR_M.js";import{i as la}from"./installCanvasRenderer-WHaFMoQ9.js";import{_ as na}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./NavTree-CcS5UKLK.js";import"./el-card-FPJq94NZ.js";import"./index-BFNvSS9e.js";import"./install-DiAPpr4Z.js";const c=k=>(Oe("data-v-a596d0b9"),k=k(),Te(),k),ra=c(()=>n("br",null,null,-1)),ia=c(()=>n("br",null,null,-1)),sa={class:"nav_data"},oa={class:"nav_content"},ua={class:"descriptions-container",style:{"font-size":"14px"}},pa={class:"description-item"},da=c(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5929 :",-1)),ca={class:"value"},ma={class:"description-item"},ga=c(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u5468 :",-1)),va={class:"value"},fa={class:"description-item"},ba=c(()=>n("span",{class:"label"},"\u6700\u8FD1\u4E00\u6708 :",-1)),ha={class:"value"},ya=c(()=>n("br",null,null,-1)),_a=c(()=>n("div",null,[n("span",null,"\u6BCD\u7EBF\u59CB\u7AEF\u7BB1\u65B0\u589E\u80FD\u8017\u8BB0\u5F55"),n("div",{class:"line",style:{"margin-top":"10px"}})],-1)),wa=c(()=>n("tr",null,[n("td",{colspan:"\u5217\u6570",style:{"text-align":"center",padding:"12px 0"}},[n("span",{style:{margin:"0 12px",color:"red"}},"\u6570\u636E\u91CF\u8FC7\u5927\uFF0C\u8BF7\u7B5B\u9009\u540E\u67E5\u770B\u66F4\u591A\u6570\u636E\u3002")])],-1)),xa={class:"realTotal"},ka=c(()=>n("br",null,null,-1)),Da=c(()=>n("br",null,null,-1)),Na=c(()=>n("br",null,null,-1)),za=c(()=>n("br",null,null,-1)),Ca=na(Ye({name:"PowerAnalysis",__name:"bus",setup(k){var ee,ae,te;const ue=ta(),{push:pe}=Fe(),B=s([]),H=s(0),J=s(0),O=s(0),T=Se(),_=s(!0),m=s([]),b=s(0),V=s(0),f=s(void 0),l=Pe({pageNo:1,pageSize:15,granularity:"day",timeRange:void 0,devkeys:void 0}),de=s([15,30,50,100]),ce=s(),q=s(!1);s([{imgUrl:R},{imgUrl:R},{imgUrl:R},{imgUrl:R}]);const me=[{text:"\u6700\u8FD1\u4E00\u5468",value:()=>{const a=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,a]}},{text:"\u6700\u8FD1\u4E00\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-1),[e,a]}},{text:"\u6700\u8FD1\u4E09\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-3),[e,a]}},{text:"\u6700\u8FD1\u516D\u4E2A\u6708",value:()=>{const a=new Date,e=new Date;return e.setMonth(e.getMonth()-6),[e,a]}},{text:"\u6700\u8FD1\u4E00\u5E74",value:()=>{const a=new Date,e=new Date;return e.setFullYear(e.getFullYear()-1),[e,a]}}],ge=a=>{const e=(a-1)*l.pageSize+1,t=a*l.pageSize,p=[];for(let h=e;h<=t;h++)p.push("\u5E8F\u53F7"+h);return p},A=s(null);let g=null;const D=s([]),X=()=>{if(A.value&&T){const e=ve(l.pageNo);g=la(A.value),g.setOption({title:{text:"\u5404\u59CB\u7AEF\u7BB1\u8017\u7535\u91CF"},tooltip:{trigger:"axis",formatter:be},legend:{data:[]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",data:ge(l.pageNo),axisLabel:{interval:0,formatter:function(t,p){return e>30?"":t}}},yAxis:{type:"value",name:"kWh"},series:[{name:"\u8017\u7535\u91CF",type:"bar",data:D.value,barWidth:"auto",label:{show:e<=30,position:"top"}}]}),T.appContext.config.globalProperties.rankChart=g}},ve=a=>{const e=(a-1)*l.pageSize+1;return a*l.pageSize-e+1};window.addEventListener("resize",function(){g==null||g.resize()}),Ue(()=>l.granularity,()=>{W()});const fe=s([{label:"\u6240\u5728\u4F4D\u7F6E",align:"center",prop:"location",istrue:!0,width:"300%"},{label:"\u8BBE\u5907\u5730\u5740",align:"center",prop:"dev_key",istrue:!0,width:"180px"},{label:"\u8BBE\u5907\u540D\u79F0",align:"center",prop:"bus_name",istrue:!0,width:"150%"},{label:"\u8BB0\u5F55\u65E5\u671F",align:"center",prop:"create_time",formatter:N,width:"140px",istrue:!0},{label:"\u5F00\u59CB",align:"center",istrue:!0,children:[{label:"\u7535\u80FD(kWh)",align:"center",prop:"start_ele",istrue:!0,formatter:z},{label:"\u65E5\u671F",align:"center",prop:"start_time",formatter:G,width:"100px",istrue:!0}]},{label:"\u7ED3\u675F",align:"center",istrue:!0,children:[{label:"\u7535\u80FD(kWh)",align:"center",prop:"end_ele",istrue:!0,formatter:z},{label:"\u65E5\u671F",align:"center",prop:"end_time",formatter:G,width:"100px",istrue:!0}]},{label:`\u8017\u7535\u91CF
(kWh)`,align:"center",prop:"eq_value",istrue:!0,formatter:function(a,e,t){let p;return l.granularity=="day"?(p=a.end_ele-a.start_ele,p<0&&(p=a.end_ele)):p=a.end_ele-a.start_ele,Number(p).toFixed(1)}},{label:"\u64CD\u4F5C",align:"center",slot:"actions",istrue:!0,width:"120px"}]),E=async()=>{_.value=!0;try{if(f.value!=null){const e=P(K(U(f.value[0]))),t=864e5,p=P(K(ea(U(f.value[1]),t)));l.timeRange=[e,p]}f.value==null&&(l.timeRange=void 0);const a=await S.getEQDataPage(l);a.list==null&&(D.value=[],m.value=[],j({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),D.value=a.list.map(e=>{const t=e.end_ele-e.start_ele;return t<0?e.end_ele:Z(t,1)}),m.value=a.list,V.value=a.total,a.total>1e4?b.value=1e4:b.value=a.total}finally{X(),_.value=!1}};function be(a){var e="",t=a[0];return e+="\u4F4D\u7F6E\uFF1A"+(m.value[t.dataIndex].location?m.value[t.dataIndex].location:"\u672A\u7ED1\u5B9A\u8BBE\u5907")+"  ",e+="<br/>"+t.marker+"\u8BB0\u5F55\u65E5\u671F\uFF1A"+N(null,null,m.value[t.dataIndex].create_time)+" "+t.seriesName+": "+t.value+"kWh <br/>"+t.marker+"\u7ED3\u675F\u65E5\u671F\uFF1A"+N(null,null,m.value[t.dataIndex].end_time)+" \u7ED3\u675F\u7535\u80FD\uFF1A"+z(null,null,m.value[t.dataIndex].end_ele)+"kWh <br/>"+t.marker+"\u5F00\u59CB\u65E5\u671F\uFF1A"+N(null,null,m.value[t.dataIndex].start_time)+" \u5F00\u59CB\u7535\u80FD\uFF1A"+z(null,null,m.value[t.dataIndex].start_ele)+"kWh <br/>"}const he=Re(()=>{const a=Math.ceil(b.value/l.pageSize);return l.pageNo===a&&b.value>=1e4});function N(a,e,t){return t?re(t).format("YYYY-MM-DD"):""}function G(a,e,t){return t?re(t).format("MM-DD"):""}function z(a,e,t){return Number(t).toFixed(1)}function Z(a,e){return isNaN(a)?null:Number(a).toFixed(e)}const ye=a=>{const e=new Date;return e.setHours(0,0,0,0),a.setHours(0,0,0,0),a>e},W=()=>{l.pageNo=1,E()},_e=async a=>{let e=[];a.forEach(t=>{t.type==6&&e.push(t.unique)}),e.length==0&&a.length!=0&&(e.push(0),g==null||g.clear(),j({message:"\u6682\u65E0\u6570\u636E",type:"warning"})),l.devkeys=e,W()},we=async()=>{try{await ue.exportConfirm(),l.pageNo=1,q.value=!0;const a={timeout:0},e=await S.exportEQPageData(l,a);await $e.excel(e,"\u59CB\u7AEF\u7BB1\u80FD\u8017\u8D8B\u52BF.xlsx")}catch{}finally{q.value=!1}},$=(a,e,t)=>{pe({path:"/bus/nenghao/ecdistribution/bus",state:{busId:a,location:e,devKey:t}})},L=s((ee=history==null?void 0:history.state)==null?void 0:ee.start),xe=s((ae=history==null?void 0:history.state)==null?void 0:ae.end),ke=s((te=history==null?void 0:history.state)==null?void 0:te.devKey);return Ve(()=>{(async()=>{const e=await aa.getBusMenu();B.value=e})(),(async()=>{const e=await S.getNavNewData({});H.value=e.day,J.value=e.week,O.value=e.month})();const a=new Date;new Date(a.getFullYear(),a.getMonth(),1),L.value!=null?(async()=>{_.value=!0;try{if(L.value!=null){const t=P(K(U(L.value))),p=P(U(xe.value));f.value=[t,p],l.timeRange=[t,p]}l.devkeys=[ke.value];const e=await S.getEQDataPage(l);e==null&&j.error("\u6682\u65E0\u6570\u636E"),D.value=e.list.map(t=>Z(t.eq_value,1)),m.value=e.list,V.value=e.total,e.total>1e4?b.value=1e4:b.value=e.total}finally{X(),_.value=!1}})():E()}),(a,e)=>{const t=Ae,p=Ee,h=We,De=Le,le=Qe,C=je,Ne=Ke,M=Be,ze=He,Ce=Ze,Me=Ge,Ie=Xe,ne=Je;return v(),w(Ie,{dataList:i(B),onCheck:_e,navTitle:"\u6BCD\u7EBF\u59CB\u7AEF\u7BB1\u80FD\u8017\u6570\u636E"},{NavInfo:o(()=>[ra,y(),ia,n("div",sa,[n("div",oa,[n("div",ua,[n("div",pa,[da,n("span",ca,x(i(H))+"\u6761",1)]),n("div",ma,[ga,n("span",va,x(i(J))+"\u6761",1)]),n("div",fa,[ba,n("span",ha,x(i(O))+"\u6761",1)]),y(),ya,_a])])])]),ActionBar:o(()=>[u(Ne,{class:"-mb-15px",model:i(l),ref_key:"queryFormRef",ref:ce,inline:!0,"label-width":"auto"},{default:o(()=>[u(h,{label:"\u9897\u7C92\u5EA6",prop:"granularity"},{default:o(()=>[u(p,{modelValue:i(l).granularity,"onUpdate:modelValue":e[0]||(e[0]=r=>i(l).granularity=r),placeholder:"\u8BF7\u9009\u62E9\u5929/\u5468/\u6708",class:"!w-120px"},{default:o(()=>[u(t,{label:"\u5929",value:"day"}),u(t,{label:"\u5468",value:"week"}),u(t,{label:"\u6708",value:"month"})]),_:1},8,["modelValue"])]),_:1}),u(h,{label:"\u65F6\u95F4\u6BB5",prop:"timeRange"},{default:o(()=>[u(De,{"value-format":"YYYY-MM-DD",modelValue:i(f),"onUpdate:modelValue":e[1]||(e[1]=r=>qe(f)?f.value=r:null),type:"daterange",shortcuts:me,"range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F","disabled-date":ye},null,8,["modelValue"])]),_:1}),u(h,null,{default:o(()=>[u(C,{onClick:W},{default:o(()=>[u(le,{icon:"ep:search",class:"mr-5px"}),y(" \u641C\u7D22")]),_:1}),u(C,{type:"success",plain:"",loading:i(q),onClick:we},{default:o(()=>[u(le,{icon:"ep:download",class:"mr-5px"}),y(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),Content:o(()=>[ie((v(),w(ze,{data:i(m),"show-overflow-tooltip":!0},Q({default:o(()=>[u(M,{label:"\u5E8F\u53F7",align:"center",width:"80px"},{default:o(({$index:r})=>[y(x(r+1+(i(l).pageNo-1)*i(l).pageSize),1)]),_:1}),(v(!0),Y(F,null,se(i(fe),r=>(v(),Y(F,{key:r.label},[!r.children&&r.istrue?(v(),w(M,{key:r.prop,label:r.label,align:r.align,prop:r.prop,formatter:r.formatter,width:r.width},Q({_:2},[r.slot==="actions"?{name:"default",fn:o(({row:d})=>[u(C,{link:"",type:"primary",onClick:I=>$(d.bus_id,d.location,d.dev_key)},{default:o(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):r.istrue?(v(),w(M,{key:1,label:r.label,align:r.align},{default:o(()=>[(v(!0),Y(F,null,se(r.children,d=>(v(),Y(F,{key:d.prop},[d.istrue?(v(),w(M,{key:d.prop,label:d.label,align:d.align,prop:d.prop,formatter:d.formatter,width:d.width},Q({_:2},[d.slot==="actions"?{name:"default",fn:o(({row:I})=>[u(C,{link:"",type:"primary",onClick:Ma=>$(I.bus_id,I.location,I.dev_key)},{default:o(()=>[y("\u8BE6\u60C5")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["label","align","prop","formatter","width"])):oe("",!0)],64))),128))]),_:2},1032,["label","align"])):oe("",!0)],64))),128))]),_:2},[i(he)?{name:"append",fn:o(()=>[wa]),key:"0"}:void 0]),1032,["data"])),[[ne,i(_)]]),u(Ce,{total:i(b),"page-size-arr":i(de),layout:"sizes, prev, pager, next, jumper",page:i(l).pageNo,"onUpdate:page":e[2]||(e[2]=r=>i(l).pageNo=r),limit:i(l).pageSize,"onUpdate:limit":e[3]||(e[3]=r=>i(l).pageSize=r),onPagination:E},null,8,["total","page-size-arr","page","limit"]),n("div",xa,"\u5171 "+x(i(V))+" \u6761",1),ka,Da,Na,za,u(Me,null,{default:o(()=>[ie(n("div",{ref_key:"rankChartContainer",ref:A,id:"rankChartContainer",style:{height:"65vh"}},null,512),[[ne,i(_)]])]),_:1})]),_:1},8,["dataList"])}}}),[["__scopeId","data-v-a596d0b9"]]);export{Ca as default};
