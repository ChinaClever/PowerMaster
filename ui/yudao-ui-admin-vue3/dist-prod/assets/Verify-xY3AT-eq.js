import{x as ee,am as te,an as ne,e as i,f as L,g as se,aj as ve,h as re,o as W,c as C,a as e,v as w,j as n,s as ie,I as ae,k as he,w as de,a0 as G,t as M,q,a3 as ge,ao as oe,ap as ce,aq as ue,F as fe,p as ye,ar as me,l as be,n as xe,as as Se,J as we,K as ze}from"./index-mcOGIq4g.js";import{C as K}from"./index-Di4T52Sc.js";import{_ as ke}from"./_plugin-vue_export-helper-BCo6x5W8.js";function Y(t,f="XwKsGlMcdPMEhR1B"){const l=K.enc.Utf8.parse(f),o=K.enc.Utf8.parse(t);return K.AES.encrypt(o,l,{mode:K.mode.ECB,padding:K.pad.Pkcs7}).toString()}function pe(t){let f,l,o,g;const r=window,c=t.$el.parentNode.offsetWidth||r.offsetWidth,y=t.$el.parentNode.offsetHeight||r.offsetHeight;return f=t.imgSize.width.indexOf("%")!=-1?parseInt(t.imgSize.width)/100*c+"px":t.imgSize.width,l=t.imgSize.height.indexOf("%")!=-1?parseInt(t.imgSize.height)/100*y+"px":t.imgSize.height,o=t.barSize.width.indexOf("%")!=-1?parseInt(t.barSize.width)/100*c+"px":t.barSize.width,g=t.barSize.height.indexOf("%")!=-1?parseInt(t.barSize.height)/100*y+"px":t.barSize.height,{imgWidth:f,imgHeight:l,barWidth:o,barHeight:g}}const Te={style:{position:"relative"}},We=["src"],Ie=[n("i",{class:"iconfont icon-refresh"},null,-1)],He=["textContent"],$e=["textContent"],Oe=["src"],Ce={__name:"VerifySlide",props:{captchaType:{type:String},type:{type:String,default:"1"},mode:{type:String,default:"fixed"},vSpace:{type:Number,default:5},explain:{type:String,default:""},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object,default:()=>({width:"50px",height:"50px"})},barSize:{type:Object,default:()=>({width:"310px",height:"30px"})}},setup(t){const f=t,{t:l}=ee(),{mode:o,captchaType:g,type:r,blockSize:c,explain:y}=te(f),{proxy:p}=ne();let u=i(""),z=i(""),_=i(""),P=i(""),I=i(""),m=i(""),B=i(""),b=i(""),k=i(""),E=i(""),v=L({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),N=i(void 0),H=i(void 0),$=i(void 0),j=i("#ddd"),O=i(void 0),J=i("icon-right"),D=i(!1),d=i(!1),s=i(!0),x=i(""),S=i(""),X=i(0);const V=se(()=>p.$el.querySelector(".verify-bar-area")),F=()=>{y.value===""?k.value=l("captcha.slide"):k.value=y.value,le(),oe(()=>{let{imgHeight:a,imgWidth:h,barHeight:T,barWidth:Z}=pe(p);v.imgHeight=a,v.imgWidth=h,v.barHeight=T,v.barWidth=Z,p.$parent.$emit("ready",p)}),window.removeEventListener("touchmove",function(a){U(a)}),window.removeEventListener("mousemove",function(a){U(a)}),window.removeEventListener("touchend",function(){A()}),window.removeEventListener("mouseup",function(){A()}),window.addEventListener("touchmove",function(a){U(a)}),window.addEventListener("mousemove",function(a){U(a)}),window.addEventListener("touchend",function(){A()}),window.addEventListener("mouseup",function(){A()})};ve(r,()=>{F()}),re(()=>{F(),p.$el.onselectstart=function(){return!1}});const R=a=>{if((a=a||window.event).touches)h=a.touches[0].pageX;else var h=a.clientX;X.value=Math.floor(h-V.value.getBoundingClientRect().left),m.value=+new Date,d.value==0&&(k.value="",$.value="#337ab7",j.value="#337AB7",O.value="#fff",a.stopPropagation(),D.value=!0)},U=a=>{if(a=a||window.event,D.value&&d.value==0){if(a.touches)h=a.touches[0].pageX;else var h=a.clientX;var T=h-V.value.getBoundingClientRect().left;T>=V.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2&&(T=V.value.offsetWidth-parseInt(parseInt(c.value.width)/2)-2),T<=0&&(T=parseInt(parseInt(c.value.width)/2)),N.value=T-X.value+"px",H.value=T-X.value+"px"}},A=()=>{if(B.value=+new Date,D.value&&d.value==0){var a=parseInt((N.value||"0").replace("px",""));a=310*a/parseInt(v.imgWidth);let h={captchaType:g.value,pointJson:u.value?Y(JSON.stringify({x:a,y:5}),u.value):JSON.stringify({x:a,y:5}),token:I.value};ce(h).then(T=>{if(T.repCode=="0000"){$.value="#5cb85c",j.value="#5cb85c",O.value="#fff",J.value="icon-check",s.value=!1,d.value=!0,o.value=="pop"&&setTimeout(()=>{p.$parent.clickShow=!1,Q()},1500),z.value=!0,b.value=`${((B.value-m.value)/1e3).toFixed(2)}s
            ${l("captcha.success")}`;var Z=u.value?Y(I.value+"---"+JSON.stringify({x:a,y:5}),u.value):I.value+"---"+JSON.stringify({x:a,y:5});setTimeout(()=>{b.value="",p.$parent.closeBox(),p.$parent.$emit("success",{captchaVerification:Z})},1e3)}else $.value="#d9534f",j.value="#d9534f",O.value="#fff",J.value="icon-close",z.value=!1,setTimeout(function(){Q()},1e3),p.$parent.$emit("error",p),b.value=l("captcha.fail"),setTimeout(()=>{b.value=""},1e3)}),D.value=!1}},Q=async()=>{s.value=!0,E.value="",x.value="left .3s",N.value=0,H.value=void 0,S.value="width .3s",j.value="#ddd",$.value="#fff",O.value="#000",J.value="icon-right",d.value=!1,await le(),setTimeout(()=>{S.value="",x.value="",k.value=y.value},300)},le=async()=>{let a={captchaType:g.value};const h=await ue(a);h.repCode=="0000"?(_.value=h.repData.originalImageBase64,P.value=h.repData.jigsawImageBase64,I.value=h.repData.token,u.value=h.repData.secretKey):b.value=h.repMsg};return(a,h)=>(W(),C("div",Te,[e(r)==="2"?(W(),C("div",{key:0,style:w({height:parseInt(e(v).imgHeight)+t.vSpace+"px"}),class:"verify-img-out"},[n("div",{style:w({width:e(v).imgWidth,height:e(v).imgHeight}),class:"verify-img-panel"},[n("img",{src:"data:image/png;base64,"+e(_),alt:"",style:{display:"block",width:"100%",height:"100%"}},null,8,We),ie(n("div",{class:"verify-refresh",onClick:Q},Ie,512),[[ae,e(s)]]),he(ge,{name:"tips"},{default:de(()=>[e(b)?(W(),C("span",{key:0,class:G([e(z)?"suc-bg":"err-bg","verify-tips"])},M(e(b)),3)):q("",!0)]),_:1})],4)],4)):q("",!0),n("div",{style:w({width:e(v).imgWidth,height:t.barSize.height,"line-height":t.barSize.height}),class:"verify-bar-area"},[n("span",{class:"verify-msg",textContent:M(e(k))},null,8,He),n("div",{style:w({width:e(H)!==void 0?e(H):t.barSize.height,height:t.barSize.height,"border-color":e(j),transaction:e(S)}),class:"verify-left-bar"},[n("span",{class:"verify-msg",textContent:M(e(E))},null,8,$e),n("div",{style:w({width:t.barSize.height,height:t.barSize.height,"background-color":e($),left:e(N),transition:e(x)}),class:"verify-move-block",onMousedown:R,onTouchstart:R},[n("i",{class:G(["verify-icon iconfont",e(J)]),style:w({color:e(O)})},null,6),e(r)==="2"?(W(),C("div",{key:0,style:w({width:Math.floor(47*parseInt(e(v).imgWidth)/310)+"px",height:e(v).imgHeight,top:"-"+(parseInt(e(v).imgHeight)+t.vSpace)+"px","background-size":e(v).imgWidth+" "+e(v).imgHeight}),class:"verify-sub-block"},[n("img",{src:"data:image/png;base64,"+e(P),alt:"",style:{display:"block",width:"100%",height:"100%","-webkit-user-drag":"none"}},null,8,Oe)],4)):q("",!0)],36)],4)],4)]))}},Ne={style:{position:"relative"}},je={class:"verify-img-out"},Be=[n("i",{class:"iconfont icon-refresh"},null,-1)],Ee=["src"],Je={class:"verify-msg"},De={name:"Vue3Verify",components:{VerifySlide:Ce,VerifyPoints:{__name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},barSize:{type:Object,default:()=>({width:"310px",height:"40px"})}},setup(t){const f=t,{t:l}=ee(),{mode:o,captchaType:g}=te(f),{proxy:r}=ne();let c=i(""),y=i(3),p=L([]),u=L([]),z=i(1),_=i(""),P=L([]),I=i(""),m=L({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),B=L([]),b=i(""),k=i(void 0),E=i(void 0),v=i(!0),N=i(!0);re(()=>{p.splice(0,p.length),u.splice(0,u.length),z.value=1,J(),oe(()=>{let{imgHeight:d,imgWidth:s,barHeight:x,barWidth:S}=pe(r);m.imgHeight=d,m.imgWidth=s,m.barHeight=x,m.barWidth=S,r.$parent.$emit("ready",r)}),r.$el.onselectstart=function(){return!1}});const H=i(null),$=function(d,s){return{x:s.offsetX,y:s.offsetY}},j=function(d){return B.push(Object.assign({},d)),z.value+1},O=async function(){B.splice(0,B.length),k.value="#000",E.value="#ddd",N.value=!0,p.splice(0,p.length),u.splice(0,u.length),z.value=1,await J(),v.value=!0},J=async()=>{let d={captchaType:g.value};const s=await ue(d);s.repCode=="0000"?(_.value=s.repData.originalImageBase64,I.value=s.repData.token,c.value=s.repData.secretKey,P.value=s.repData.wordList,b.value=l("captcha.point")+"\u3010"+P.value.join(",")+"\u3011"):b.value=s.repMsg},D=function(d,s){return d.map(x=>({x:Math.round(310*x.x/parseInt(s.imgWidth)),y:Math.round(155*x.y/parseInt(s.imgHeight))}))};return(d,s)=>(W(),C("div",Ne,[n("div",je,[n("div",{style:w({width:e(m).imgWidth,height:e(m).imgHeight,"background-size":e(m).imgWidth+" "+e(m).imgHeight,"margin-bottom":t.vSpace+"px"}),class:"verify-img-panel"},[ie(n("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:O},Be,512),[[ae,e(v)]]),n("img",{ref_key:"canvas",ref:H,src:"data:image/png;base64,"+e(_),alt:"",style:{display:"block",width:"100%",height:"100%"},onClick:s[0]||(s[0]=x=>e(N)?(S=>{if(u.push($(H,S)),z.value==y.value){z.value=j($(H,S));let X=D(u,m);u.length=0,u.push(...X),setTimeout(()=>{var V=c.value?Y(I.value+"---"+JSON.stringify(u),c.value):I.value+"---"+JSON.stringify(u);let F={captchaType:g.value,pointJson:c.value?Y(JSON.stringify(u),c.value):JSON.stringify(u),token:I.value};ce(F).then(R=>{R.repCode=="0000"?(k.value="#4cae4c",E.value="#5cb85c",b.value=l("captcha.success"),N.value=!1,o.value=="pop"&&setTimeout(()=>{r.$parent.clickShow=!1,O()},1500),r.$parent.$emit("success",{captchaVerification:V})):(r.$parent.$emit("error",r),k.value="#d9534f",E.value="#d9534f",b.value=l("captcha.fail"),setTimeout(()=>{O()},700))})},400)}z.value<y.value&&(z.value=j($(H,S)))})(x):void 0)},null,8,Ee),(W(!0),C(fe,null,ye(e(B),(x,S)=>(W(),C("div",{key:S,style:w({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(x.y-10)+"px",left:parseInt(x.x-10)+"px"}),class:"point-area"},M(S+1),5))),128))],4)]),n("div",{style:w({width:e(m).imgWidth,color:e(k),"border-color":e(E),"line-height":t.barSize.height}),class:"verify-bar-area"},[n("span",Je,M(e(b)),1)],4)]))}}},props:{captchaType:{type:String,required:!0},figure:{type:Number},arith:{type:Number},mode:{type:String,default:"pop"},vSpace:{type:Number},explain:{type:String},imgSize:{type:Object,default:()=>({width:"310px",height:"155px"})},blockSize:{type:Object},barSize:{type:Object}},setup(t){const{t:f}=ee(),{captchaType:l,mode:o}=te(t),g=i(!1),r=i(void 0),c=i(void 0),y=i({}),p=se(()=>o.value!="pop"||g.value);return me(()=>{switch(l.value){case"blockPuzzle":r.value="2",c.value="VerifySlide";break;case"clickWord":r.value="",c.value="VerifyPoints"}}),{t:f,clickShow:g,verifyType:r,componentType:c,instance:y,showBox:p,closeBox:()=>{g.value=!1,y.value.refresh&&y.value.refresh()},show:()=>{o.value=="pop"&&(g.value=!0)}}}},Ve={key:0,class:"verifybox-top"},Le=[(t=>(we("data-v-11821620"),t=t(),ze(),t))(()=>n("i",{class:"iconfont icon-close"},null,-1))],Me=ke(De,[["render",function(t,f,l,o,g,r){return ie((W(),C("div",{class:G(l.mode=="pop"?"mask":"")},[n("div",{class:G(l.mode=="pop"?"verifybox":""),style:w({"max-width":parseInt(l.imgSize.width)+20+"px"})},[l.mode=="pop"?(W(),C("div",Ve,[be(M(o.t("captcha.verification"))+" ",1),n("span",{class:"verifybox-close",onClick:f[0]||(f[0]=(...c)=>o.closeBox&&o.closeBox(...c))},Le)])):q("",!0),n("div",{style:w({padding:l.mode=="pop"?"10px":"0"}),class:"verifybox-bottom"},[o.componentType?(W(),xe(Se(o.componentType),{key:0,ref:"instance",arith:l.arith,barSize:l.barSize,blockSize:l.blockSize,captchaType:l.captchaType,explain:l.explain,figure:l.figure,imgSize:l.imgSize,mode:l.mode,type:o.verifyType,vSpace:l.vSpace},null,8,["arith","barSize","blockSize","captchaType","explain","figure","imgSize","mode","type","vSpace"])):q("",!0)],4)],6)],2)),[[ae,o.showBox]])}],["__scopeId","data-v-11821620"]]);export{Me as _};
